<html lang="en">
	<head>
		<title>Yuka | Convex Hull</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<link rel="stylesheet" type="text/css" href="../lib/styles.css">
		<link rel="shortcut icon" type="image/x-icon" href="https://mugen87.github.io/yuka/favicon.ico">
	</head>
<body>

	<section id="info">
		<p>
			Demonstrates an intersection test between two convex hulls.
		</p>
	</section>

	<script type="module">

	import * as YUKA from '../../build/yuka.module.js';
	import * as THREE from '../lib/three.module.js';
	import { OrbitControls } from '../lib/OrbitControls.module.js';

	import { createConvexHullHelper } from './common/js/ConvexHullHelper.js';

	let renderer, scene, camera;

	init();
	animate();

	function init() {

		scene = new THREE.Scene();

		camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 1000 );
		camera.position.set( 0, 20, 40 );
		camera.lookAt( scene.position );

		//

		renderer = new THREE.WebGLRenderer( { antialias: true } );
		renderer.setPixelRatio( window.devicePixelRatio );
		renderer.setSize( window.innerWidth, window.innerHeight );
		document.body.appendChild( renderer.domElement );

		// points

		const points1 = [
			new YUKA.Vector3( 1, 1, 1 ),
			new YUKA.Vector3( 4, - 1, 4 ),
			new YUKA.Vector3( 3, 6, - 3 ),
			new YUKA.Vector3( - 7, - 5, 0 ),
			new YUKA.Vector3( 2, 9, 19 ),
			new YUKA.Vector3( 7, 4, 8 ),
			new YUKA.Vector3( 14, - 14, 2 ),
			new YUKA.Vector3( - 9, 1, 11 ),
			new YUKA.Vector3( 0, 14, - 8 )
		];

		const points2 = [
			new YUKA.Vector3( 2, 14, 5 ),
			new YUKA.Vector3( 2, 14, 6 ),
			new YUKA.Vector3( 2, 12, 5 ),
			new YUKA.Vector3( 2, 12, 6 ),
			new YUKA.Vector3( 0, 14, 5 ),
			new YUKA.Vector3( 0, 14, 6 ),
			new YUKA.Vector3( 0, 12, 5 ),
			new YUKA.Vector3( 0, 12, 6 )
		];

		const hull1 = createConvexHull( points1 );
		const hull2 = createConvexHull( points2 );

		const obb1 = createOBB( points1 );
		const obb2 = createOBB( points2 );

		const boxGeometry = new THREE.BoxBufferGeometry( 0.5, 0.5, 0.5 );
		const boxMaterial = new THREE.MeshBasicMaterial( { color: 0xff0000 } );
		const box = new THREE.Mesh( boxGeometry, boxMaterial );
		box.position.set( 0, 0, 0 );
		scene.add( box );

		const sphere = new YUKA.BoundingSphere( new YUKA.Vector3( 0, 0, 0 ), 5 );

		console.log( obb1.intersectsBoundingSphere( sphere ) );

		// console.log( hull1.intersectsConvexHull( hull2 ) );

		//

		window.addEventListener( 'resize', onWindowResize, false );

		const controls = new OrbitControls( camera, renderer.domElement );
		controls.minDistance = 1;

	}

	function onWindowResize() {

		camera.aspect = window.innerWidth / window.innerHeight;
		camera.updateProjectionMatrix();

		renderer.setSize( window.innerWidth, window.innerHeight );

	}

	function animate() {

		requestAnimationFrame( animate );
		renderer.render( scene, camera );

	}

	function createConvexHull( points ) {

		var vertices = [];

		for ( const point of points )Â {

			vertices.push( point.x, point.y, point.z );

		}

		const geometry = new THREE.BufferGeometry();
		geometry.addAttribute( 'position', new THREE.Float32BufferAttribute( vertices, 3 ) );
		const material = new THREE.PointsMaterial( { size: 0.5 } );

		const pointCloud = new THREE.Points( geometry, material );
		scene.add( pointCloud );

		const hull = new YUKA.ConvexHull().fromPoints( points );

		const helper = createConvexHullHelper( hull );
		scene.add( helper );

		return hull;

	}

	function createOBB( points ) {

		const obb = new YUKA.OBB().fromPoints( points );

		const boxGeometry = new THREE.BoxBufferGeometry( obb.halfSizes.x * 2, obb.halfSizes.y * 2, obb.halfSizes.z * 2 );
		const boxMaterial = new THREE.MeshBasicMaterial( { wireframe: true } );
		const box = new THREE.Mesh( boxGeometry, boxMaterial );

		box.position.copy( obb.center );

		const quaternion = new YUKA.Quaternion().fromMatrix3( obb.rotation );

		box.quaternion.copy( quaternion );

		scene.add( box );

		return obb;

	}

	</script>

</body>
</html>
