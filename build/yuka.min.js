/*

 The MIT License

 Copyright  2018 Yuka authors

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,g,m){d!=Array.prototype&&d!=Object.prototype&&(d[g]=m.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var d=0;return function(g){return $jscomp.SYMBOL_PREFIX+(g||"")+d++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(d){var g=0;return $jscomp.iteratorPrototype(function(){return g<d.length?{done:!1,value:d[g++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.makeIterator=function(d){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var g=d[Symbol.iterator];return g?g.call(d):$jscomp.arrayIterator(d)};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(d){var g=function(){};g.prototype=d;return new g};
$jscomp.underscoreProtoCanBeSet=function(){var d={a:!0},g={};try{return g.__proto__=d,g.a}catch(m){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(d,g){d.__proto__=g;if(d.__proto__!==g)throw new TypeError(d+" is not extensible");return d}:null;
$jscomp.inherits=function(d,g){d.prototype=$jscomp.objectCreate(g.prototype);d.prototype.constructor=d;if($jscomp.setPrototypeOf){var m=$jscomp.setPrototypeOf;m(d,g)}else for(m in g)if("prototype"!=m)if(Object.defineProperties){var q=Object.getOwnPropertyDescriptor(g,m);q&&Object.defineProperty(d,m,q)}else d[m]=g[m];d.superClass_=g.prototype};$jscomp.arrayFromIterator=function(d){for(var g,m=[];!(g=d.next()).done;)m.push(g.value);return m};
$jscomp.arrayFromIterable=function(d){return d instanceof Array?d:$jscomp.arrayFromIterator($jscomp.makeIterator(d))};$jscomp.checkEs6ConformanceViaProxy=function(){try{var d={},g=Object.create(new $jscomp.global.Proxy(d,{get:function(m,q,e){return m==d&&"q"==q&&e==g}}));return!0===g.q}catch(m){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.owns=function(d,g){return Object.prototype.hasOwnProperty.call(d,g)};$jscomp.polyfill=function(d,g,m,q){if(g){m=$jscomp.global;d=d.split(".");for(q=0;q<d.length-1;q++){var e=d[q];e in m||(m[e]={});m=m[e]}d=d[d.length-1];q=m[d];g=g(q);g!=q&&null!=g&&$jscomp.defineProperty(m,d,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("WeakMap",function(d){function g(){if(!d||!Object.seal)return!1;try{var k=Object.seal({}),p=Object.seal({}),x=new d([[k,2],[p,3]]);if(2!=x.get(k)||3!=x.get(p))return!1;x.delete(k);x.set(p,4);return!x.has(k)&&4==x.get(p)}catch(ra){return!1}}function m(d){$jscomp.owns(d,e)||$jscomp.defineProperty(d,e,{value:{}})}function q(d){var p=Object[d];p&&(Object[d]=function(d){m(d);return p(d)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(g())return d;
var e="$jscomp_hidden_"+Math.random();q("freeze");q("preventExtensions");q("seal");var N=0,k=function(d){this.id_=(N+=Math.random()+1).toString();if(d){$jscomp.initSymbol();$jscomp.initSymbolIterator();d=$jscomp.makeIterator(d);for(var p;!(p=d.next()).done;)p=p.value,this.set(p[0],p[1])}};k.prototype.set=function(d,p){m(d);if(!$jscomp.owns(d,e))throw Error("WeakMap key fail: "+d);d[e][this.id_]=p;return this};k.prototype.get=function(d){return $jscomp.owns(d,e)?d[e][this.id_]:void 0};k.prototype.has=
function(d){return $jscomp.owns(d,e)&&$jscomp.owns(d[e],this.id_)};k.prototype.delete=function(d){return $jscomp.owns(d,e)&&$jscomp.owns(d[e],this.id_)?delete d[e][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(d){function g(){if($jscomp.ASSUME_NO_NATIVE_MAP||!d||"function"!=typeof d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var p=Object.seal({x:4}),k=new d($jscomp.makeIterator([[p,"s"]]));if("s"!=k.get(p)||1!=k.size||k.get({x:4})||k.set({x:4},"t")!=k||2!=k.size)return!1;var g=k.entries(),e=g.next();if(e.done||e.value[0]!=p||"s"!=e.value[1])return!1;e=g.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!g.next().done?!1:!0}catch(Y){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(g())return d;$jscomp.initSymbol();$jscomp.initSymbolIterator();var m=new WeakMap,q=function(d){this.data_={};this.head_=k();this.size=0;if(d){d=$jscomp.makeIterator(d);for(var p;!(p=d.next()).done;)p=p.value,this.set(p[0],p[1])}};q.prototype.set=function(d,k){d=0===d?0:d;var p=e(this,d);p.list||(p.list=this.data_[p.id]=[]);p.entry?p.entry.value=k:(p.entry={next:this.head_,previous:this.head_.previous,head:this.head_,
key:d,value:k},p.list.push(p.entry),this.head_.previous.next=p.entry,this.head_.previous=p.entry,this.size++);return this};q.prototype.delete=function(d){d=e(this,d);return d.entry&&d.list?(d.list.splice(d.index,1),d.list.length||delete this.data_[d.id],d.entry.previous.next=d.entry.next,d.entry.next.previous=d.entry.previous,d.entry.head=null,this.size--,!0):!1};q.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=k();this.size=0};q.prototype.has=function(d){return!!e(this,d).entry};
q.prototype.get=function(d){return(d=e(this,d).entry)&&d.value};q.prototype.entries=function(){return N(this,function(d){return[d.key,d.value]})};q.prototype.keys=function(){return N(this,function(d){return d.key})};q.prototype.values=function(){return N(this,function(d){return d.value})};q.prototype.forEach=function(d,k){for(var p=this.entries(),e;!(e=p.next()).done;)e=e.value,d.call(k,e[1],e[0],this)};q.prototype[Symbol.iterator]=q.prototype.entries;var e=function(d,k){var e=k&&typeof k;"object"==
e||"function"==e?m.has(k)?e=m.get(k):(e=""+ ++fa,m.set(k,e)):e="p_"+k;var p=d.data_[e];if(p&&$jscomp.owns(d.data_,e))for(d=0;d<p.length;d++){var g=p[d];if(k!==k&&g.key!==g.key||k===g.key)return{id:e,list:p,index:d,entry:g}}return{id:e,list:p,index:-1,entry:void 0}},N=function(d,k){var e=d.head_;return $jscomp.iteratorPrototype(function(){if(e){for(;e.head!=d.head_;)e=e.previous;for(;e.next!=e.head;)return e=e.next,{done:!1,value:k(e)};e=null}return{done:!0,value:void 0}})},k=function(){var d={};return d.previous=
d.next=d.head=d},fa=0;return q},"es6","es3");$jscomp.polyfill("Number.EPSILON",function(d){return Math.pow(2,-52)},"es6","es3");$jscomp.polyfill("Array.from",function(d){return d?d:function(d,m,q){$jscomp.initSymbolIterator();m=null!=m?m:function(d){return d};var e=[],g=d[Symbol.iterator];if("function"==typeof g){d=g.call(d);for(var k=0;!(g=d.next()).done;)e.push(m.call(q,g.value,k++))}else for(g=d.length,k=0;k<g;k++)e.push(m.call(q,d[k],k));return e}},"es6","es3");
$jscomp.iteratorFromArray=function(d,g){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var m=0,q={next:function(){if(m<d.length){var e=m++;return{value:g(e,d[e]),done:!1}}q.next=function(){return{done:!0,value:void 0}};return q.next()}};q[Symbol.iterator]=function(){return q};return q};$jscomp.polyfill("Array.prototype.values",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,m){return m})}},"es8","es3");
$jscomp.polyfill("Set",function(d){function g(){if($jscomp.ASSUME_NO_NATIVE_SET||!d||"function"!=typeof d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var g=Object.seal({x:4}),e=new d($jscomp.makeIterator([g]));if(!e.has(g)||1!=e.size||e.add(g)!=e||1!=e.size||e.add({x:4})!=e||2!=e.size)return!1;var m=e.entries(),k=m.next();if(k.done||k.value[0]!=g||k.value[1]!=g)return!1;k=m.next();return k.done||k.value[0]==g||4!=k.value[0].x||k.value[1]!=k.value[0]?!1:m.next().done}catch(fa){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(g())return d;$jscomp.initSymbol();$jscomp.initSymbolIterator();var m=function(d){this.map_=new Map;if(d){d=$jscomp.makeIterator(d);for(var e;!(e=d.next()).done;)this.add(e.value)}this.size=this.map_.size};m.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};m.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};m.prototype.clear=
function(){this.map_.clear();this.size=0};m.prototype.has=function(d){return this.map_.has(d)};m.prototype.entries=function(){return this.map_.entries()};m.prototype.values=function(){return this.map_.values()};m.prototype.keys=m.prototype.values;m.prototype[Symbol.iterator]=m.prototype.values;m.prototype.forEach=function(d,e){var g=this;this.map_.forEach(function(k){return d.call(e,k,k,g)})};return m},"es6","es3");
$jscomp.polyfill("Array.prototype.entries",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,m){return[d,m]})}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(d){function g(){this.batch_=null}function m(d){return d instanceof e?d:new e(function(k,e){k(d)})}if(d&&!$jscomp.FORCE_POLYFILL_PROMISE)return d;g.prototype.asyncExecute=function(d){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(d);return this};g.prototype.asyncExecuteBatch_=function(){var d=this;this.asyncExecuteFunction(function(){d.executeBatch_()})};var q=$jscomp.global.setTimeout;g.prototype.asyncExecuteFunction=function(d){q(d,
0)};g.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var d=this.batch_;this.batch_=[];for(var e=0;e<d.length;++e){var g=d[e];d[e]=null;try{g()}catch(x){this.asyncThrow_(x)}}}this.batch_=null};g.prototype.asyncThrow_=function(d){this.asyncExecuteFunction(function(){throw d;})};var e=function(d){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var e=this.createResolveAndReject_();try{d(e.resolve,e.reject)}catch(p){e.reject(p)}};e.prototype.createResolveAndReject_=
function(){function d(d){return function(k){g||(g=!0,d.call(e,k))}}var e=this,g=!1;return{resolve:d(this.resolveTo_),reject:d(this.reject_)}};e.prototype.resolveTo_=function(d){if(d===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(d instanceof e)this.settleSameAsPromise_(d);else{a:switch(typeof d){case "object":var k=null!=d;break a;case "function":k=!0;break a;default:k=!1}k?this.resolveToNonPromiseObj_(d):this.fulfill_(d)}};e.prototype.resolveToNonPromiseObj_=function(d){var e=
void 0;try{e=d.then}catch(p){this.reject_(p);return}"function"==typeof e?this.settleSameAsThenable_(e,d):this.fulfill_(d)};e.prototype.reject_=function(d){this.settle_(2,d)};e.prototype.fulfill_=function(d){this.settle_(1,d)};e.prototype.settle_=function(d,e){if(0!=this.state_)throw Error("Cannot settle("+d+", "+e+"): Promise already settled in state"+this.state_);this.state_=d;this.result_=e;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var d=
0;d<this.onSettledCallbacks_.length;++d)N.asyncExecute(this.onSettledCallbacks_[d]);this.onSettledCallbacks_=null}};var N=new g;e.prototype.settleSameAsPromise_=function(d){var e=this.createResolveAndReject_();d.callWhenSettled_(e.resolve,e.reject)};e.prototype.settleSameAsThenable_=function(d,e){var g=this.createResolveAndReject_();try{d.call(e,g.resolve,g.reject)}catch(x){g.reject(x)}};e.prototype.then=function(d,g){function k(d,e){return"function"==typeof d?function(e){try{m(d(e))}catch(A){q(A)}}:
e}var m,q,fa=new e(function(d,e){m=d;q=e});this.callWhenSettled_(k(d,m),k(g,q));return fa};e.prototype.catch=function(d){return this.then(void 0,d)};e.prototype.callWhenSettled_=function(d,e){function g(){switch(k.state_){case 1:d(k.result_);break;case 2:e(k.result_);break;default:throw Error("Unexpected state: "+k.state_);}}var k=this;null==this.onSettledCallbacks_?N.asyncExecute(g):this.onSettledCallbacks_.push(g)};e.resolve=m;e.reject=function(d){return new e(function(e,g){g(d)})};e.race=function(d){return new e(function(e,
g){for(var k=$jscomp.makeIterator(d),p=k.next();!p.done;p=k.next())m(p.value).callWhenSettled_(e,g)})};e.all=function(d){var g=$jscomp.makeIterator(d),k=g.next();return k.done?m([]):new e(function(d,e){function p(e){return function(g){q[e]=g;x--;0==x&&d(q)}}var q=[],x=0;do q.push(void 0),x++,m(k.value).callWhenSettled_(p(q.length-1),e),k=g.next();while(!k.done)})};return e},"es6","es3");
(function(d,g){"object"===typeof exports&&"undefined"!==typeof module?g(exports):"function"===typeof define&&define.amd?define(["exports"],g):g(d.YUKA={})})(this,function(d){function g(){!0===this.detectPageVisibility&&!1===document.hidden&&(this.currentTime=this.now())}function m(a,b){return a<b?-1:a>b?1:0}function q(a,b){return a.cost<b.cost?-1:a.cost>b.cost?1:0}function e(a,b){return a.cost<b.cost?-1:a.cost>b.cost?1:0}function N(a,b){return a.cost<b.cost?1:a.cost>b.cost?-1:0}function k(a,b){return"string"!==
typeof a||""===a?"":/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:b+a}function fa(a){for(var b=this.tasks;0<a.timeRemaining()&&0<b.length;)b[0].execute(),b.shift();0<b.length?(this._taskHandle=requestIdleCallback(this._handler,this.options),this._active=!0):(this._taskHandle=0,this._active=!1)}var p=function(a,b,c,h,d){this.sender=a;this.receiver=b;this.message=c;this.delay=h;this.data=d},x=function(){};x.setLevel=function(a){ra=a};x.log=function(a){for(var b=[],c=0;c<
arguments.length;++c)b[c-0]=arguments[c];ra<=x.LEVEL.LOG&&console.log.apply(console,$jscomp.arrayFromIterable(b))};x.warn=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];ra<=x.LEVEL.WARN&&console.warn.apply(console,$jscomp.arrayFromIterable(b))};x.error=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];ra<=x.LEVEL.ERROR&&console.error.apply(console,$jscomp.arrayFromIterable(b))};x.LEVEL=Object.freeze({LOG:0,WARN:1,ERROR:2,SILENT:3});var ra=x.LEVEL.WARN,
ha=function(){this.delayedTelegrams=[]};ha.prototype.deliver=function(a){var b=a.receiver;!1===b.handleMessage(a)&&x.warn("YUKA.MessageDispatcher: Message not handled by receiver: %o",b);return this};ha.prototype.dispatch=function(a,b,c,h,d){a=new p(a,b,c,h,d);0>=h?this.deliver(a):this.delayedTelegrams.push(a);return this};ha.prototype.dispatchDelayedMessages=function(a){for(var b=this.delayedTelegrams.length;b--;){var c=this.delayedTelegrams[b];c.delay-=a;0>=c.delay&&(this.deliver(c),this.delayedTelegrams.pop())}return this};
ha.prototype.clear=function(){this.delayedTelegrams.length=0;return this};var Y=[],J=function(){this.entities=[];this.triggers=[];this.spatialIndex=null;this._indexMap=new Map;this._messageDispatcher=new ha};J.prototype.add=function(a){this.entities.push(a);a.manager=this;return this};J.prototype.remove=function(a){var b=this.entities.indexOf(a);this.entities.splice(b,1);a.manager=null;return this};J.prototype.addTrigger=function(a){this.triggers.push(a);return this};J.prototype.removeTrigger=function(a){a=
this.triggers.indexOf(a);this.triggers.splice(a,1);return this};J.prototype.clear=function(){this.entities.length=0;this.triggers.length=0;this._messageDispatcher.clear();return this};J.prototype.getEntityByName=function(a){for(var b=this.entities,c=0,h=b.length;c<h;c++){var d=b[c];if(d.name===a)return d}return null};J.prototype.update=function(a){for(var b=this.entities,c=this.triggers,h=b.length-1;0<=h;h--)this.updateEntity(b[h],a);for(b=c.length-1;0<=b;b--)this.updateTrigger(c[b],a);this._messageDispatcher.dispatchDelayedMessages(a);
return this};J.prototype.updateEntity=function(a,b){if(!0===a.active){this.updateNeighborhood(a);!1===a._started&&(a.start(),a._started=!0);a.update(b);a.updateWorldMatrix();for(var c=a.children,h=c.length-1;0<=h;h--)this.updateEntity(c[h],b);null!==this.spatialIndex&&(b=this._indexMap.get(a)||-1,b=this.spatialIndex.updateEntity(a,b),this._indexMap.set(a,b));b=a._renderComponent;c=a._renderComponentCallback;null!==b&&null!==c&&c(a,b)}return this};J.prototype.updateNeighborhood=function(a){if(!0===
a.updateNeighborhood){a.neighbors.length=0;null!==this.spatialIndex?this.spatialIndex.query(a.position,a.neighborhoodRadius,Y):(Y.length=0,Y.push.apply(Y,$jscomp.arrayFromIterable(this.entities)));for(var b=a.neighborhoodRadius*a.neighborhoodRadius,c=0,h=Y.length;c<h;c++){var d=Y[c];a!==d&&!0===d.active&&a.position.squaredDistanceTo(d.position)<=b&&a.neighbors.push(d)}}return this};J.prototype.updateTrigger=function(a,b){if(!0===a.active){a.update(b);b=this.entities;for(var c=b.length-1;0<=c;c--){var h=
b[c];!0===h.active&&a.check(h)}}return this};J.prototype.sendMessage=function(a,b,c,h,d){this._messageDispatcher.dispatch(a,b,c,h,d);return this};var sa=function(){this._events=new Map};sa.prototype.addEventListener=function(a,b){var c=this._events;!1===c.has(a)&&c.set(a,[]);a=c.get(a);-1===a.indexOf(b)&&a.push(b)};sa.prototype.removeEventListener=function(a,b){a=this._events.get(a);void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1))};sa.prototype.hasEventListener=function(a,b){a=this._events.get(a);
return void 0!==a&&-1!==a.indexOf(b)};sa.prototype.dispatchEvent=function(a){var b=this._events.get(a.type);if(void 0!==b){a.target=this;for(var c=0,h=b.length;c<h;c++)b[c].call(this,a)}};var A=function(){};A.clamp=function(a,b,c){return Math.max(b,Math.min(c,a))};A.randInt=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};A.randFloat=function(a,b){return a+Math.random()*(b-a)};A.area=function(a,b,c){return(c.x-a.x)*(b.z-a.z)-(b.x-a.x)*(c.z-a.z)};var f=function(a,b,c){this.x=void 0===a?0:
a;this.y=void 0===b?0:b;this.z=void 0===c?0:c};f.prototype.set=function(a,b,c){this.x=a;this.y=b;this.z=c;return this};f.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};f.prototype.clone=function(){return(new this.constructor).copy(this)};f.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};f.prototype.addScalar=function(a){this.x+=a;this.y+=a;this.z+=a;return this};f.prototype.addVectors=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this};
f.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};f.prototype.subScalar=function(a){this.x-=a;this.y-=a;this.z-=a;return this};f.prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this};f.prototype.multiply=function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this};f.prototype.multiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};f.prototype.multiplyVectors=function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this};
f.prototype.divide=function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this};f.prototype.divideScalar=function(a){this.x/=a;this.y/=a;this.z/=a;return this};f.prototype.divideVectors=function(a,b){this.x=a.x/b.x;this.y=a.y/b.y;this.z=a.z/b.z;return this};f.prototype.clamp=function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this};f.prototype.min=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,
a.y);this.z=Math.min(this.z,a.z);return this};f.prototype.max=function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this};f.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};f.prototype.cross=function(a){var b=this.x,c=this.y,h=this.z;this.x=c*a.z-h*a.y;this.y=h*a.x-b*a.z;this.z=b*a.y-c*a.x;return this};f.prototype.crossVectors=function(a,b){var c=a.x,h=a.y;a=a.z;var d=b.x,l=b.y;b=b.z;this.x=h*b-a*l;this.y=a*d-c*b;this.z=c*l-h*d;return this};
f.prototype.angleTo=function(a){a=this.dot(a)/Math.sqrt(this.squaredLength()*a.squaredLength());return Math.acos(A.clamp(a,-1,1))};f.prototype.length=function(){return Math.sqrt(this.squaredLength())};f.prototype.squaredLength=function(){return this.dot(this)};f.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)};f.prototype.distanceTo=function(a){return Math.sqrt(this.squaredDistanceTo(a))};f.prototype.squaredDistanceTo=function(a){var b=this.x-a.x,c=this.y-
a.y;a=this.z-a.z;return b*b+c*c+a*a};f.prototype.manhattanDistanceTo=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)};f.prototype.normalize=function(){return this.divideScalar(this.length()||1)};f.prototype.applyMatrix4=function(a){var b=this.x,c=this.y,h=this.z;a=a.elements;var d=1/(a[3]*b+a[7]*c+a[11]*h+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*h+a[12])*d;this.y=(a[1]*b+a[5]*c+a[9]*h+a[13])*d;this.z=(a[2]*b+a[6]*c+a[10]*h+a[14])*d;return this};f.prototype.applyRotation=
function(a){var b=this.x,c=this.y,h=this.z,d=a.x,l=a.y,r=a.z;a=a.w;var f=a*b+l*h-r*c,e=a*c+r*b-d*h,g=a*h+d*c-l*b;b=-d*b-l*c-r*h;this.x=f*a+b*-d+e*-r-g*-l;this.y=e*a+b*-l+g*-d-f*-r;this.z=g*a+b*-r+f*-l-e*-d;return this};f.prototype.extractPositionFromMatrix=function(a){a=a.elements;this.x=a[12];this.y=a[13];this.z=a[14];return this};f.prototype.transformDirection=function(a){var b=this.x,c=this.y,h=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*h;this.y=a[1]*b+a[5]*c+a[9]*h;this.z=a[2]*b+a[6]*c+a[10]*
h;return this.normalize()};f.prototype.fromMatrix3Column=function(a,b){return this.fromArray(a.elements,3*b)};f.prototype.fromMatrix4Column=function(a,b){return this.fromArray(a.elements,4*b)};f.prototype.fromSpherical=function(a,b,c){var h=Math.sin(b)*a;this.x=h*Math.sin(c);this.y=Math.cos(b)*a;this.z=h*Math.cos(c);return this};f.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];return this};f.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;
a[b+1]=this.y;a[b+2]=this.z;return a};f.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z};var eb=new f(0,1,0),Ub=new f,ta=new f,Vb=new f,Wb=new f,y=function(){this.elements=[1,0,0,0,1,0,0,0,1]};y.prototype.set=function(a,b,c,h,d,l,r,f,e){var n=this.elements;n[0]=a;n[3]=b;n[6]=c;n[1]=h;n[4]=d;n[7]=l;n[2]=r;n[5]=f;n[8]=e;return this};y.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];
b[8]=a[8];return this};y.prototype.clone=function(){return(new this.constructor).copy(this)};y.prototype.identity=function(){this.set(1,0,0,0,1,0,0,0,1);return this};y.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};y.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};y.prototype.multiplyMatrices=function(a,b){var c=a.elements,h=b.elements;b=this.elements;a=c[0];var d=c[3],l=c[6],r=c[1],f=c[4],e=c[7],g=c[2],k=c[5];c=c[8];var m=h[0],p=h[3],q=h[6],x=h[1],fb=
h[4],gb=h[7],t=h[2],u=h[5];h=h[8];b[0]=a*m+d*x+l*t;b[3]=a*p+d*fb+l*u;b[6]=a*q+d*gb+l*h;b[1]=r*m+f*x+e*t;b[4]=r*p+f*fb+e*u;b[7]=r*q+f*gb+e*h;b[2]=g*m+k*x+c*t;b[5]=g*p+k*fb+c*u;b[8]=g*q+k*gb+c*h;return this};y.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this};y.prototype.extractBasis=function(a,b,c){a.fromMatrix3Column(this,0);b.fromMatrix3Column(this,1);c.fromMatrix3Column(this,2);return this};y.prototype.makeBasis=
function(a,b,c){this.set(a.x,b.x,c.x,a.y,b.y,c.y,a.z,b.z,c.z);return this};y.prototype.lookAt=function(a,b,c){Ub.crossVectors(c,a).normalize();ta.crossVectors(eb,b).normalize();0===ta.squaredLength()&&(Wb.copy(b).addScalar(Number.EPSILON),ta.crossVectors(eb,Wb).normalize());Vb.crossVectors(b,ta).normalize();Xb.makeBasis(ta,Vb,b);Yb.makeBasis(Ub,c,a);this.multiplyMatrices(Xb,Yb.transpose());return this};y.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];
a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this};y.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,h=a.y,d=a.z,l=a.w,r=c+c,f=h+h,e=d+d;a=c*r;var g=c*f;c*=e;var k=h*f;h*=e;d*=e;r*=l;f*=l;l*=e;b[0]=1-(k+d);b[3]=g-l;b[6]=c+f;b[1]=g+l;b[4]=1-(a+d);b[7]=h-r;b[2]=c-f;b[5]=h+r;b[8]=1-(a+k);return this};y.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,h=0;9>h;h++)c[h]=a[h+b];return this};y.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=this.elements;a[b+0]=c[0];
a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a};y.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var c=0;9>c;c++)if(b[c]!==a[c])return!1;return!0};var Xb=new y,Yb=new y,Zb=new y,v=function(a,b,c,h){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c;this.w=void 0===h?1:h};v.prototype.set=function(a,b,c,h){this.x=a;this.y=b;this.z=c;this.w=h;return this};v.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=
a.z;this.w=a.w;return this};v.prototype.clone=function(){return(new this.constructor).copy(this)};v.prototype.inverse=function(){return this.conjugate().normalize()};v.prototype.conjugate=function(){this.x*=-1;this.y*=-1;this.z*=-1;return this};v.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w};v.prototype.length=function(){return Math.sqrt(this.squaredLength())};v.prototype.squaredLength=function(){return this.dot(this)};v.prototype.normalize=function(){var a=this.length();
0===a?(this.z=this.y=this.x=0,this.w=1):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this};v.prototype.multiply=function(a){return this.multiplyQuaternions(this,a)};v.prototype.premultiply=function(a){return this.multiplyQuaternions(a,this)};v.prototype.multiplyQuaternions=function(a,b){var c=a.x,h=a.y,d=a.z;a=a.w;var l=b.x,r=b.y,f=b.z;b=b.w;this.x=c*b+a*l+h*f-d*r;this.y=h*b+a*r+d*l-c*f;this.z=d*b+a*f+c*r-h*l;this.w=a*b-c*l-h*r-d*f;return this};v.prototype.angleTo=function(a){return 2*Math.acos(Math.abs(A.clamp(this.dot(a),
-1,1)))};v.prototype.rotateTo=function(a,b){var c=this.angleTo(a);if(.0001>c)return!0;this.slerp(a,Math.min(1,b/c));return!1};v.prototype.lookAt=function(a,b,c){Zb.lookAt(a,b,c);this.fromMatrix3(Zb)};v.prototype.slerp=function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this.x,h=this.y,d=this.z,l=this.w,r=l*a.w+c*a.x+h*a.y+d*a.z;0>r?(this.w=-a.w,this.x=-a.x,this.y=-a.y,this.z=-a.z,r=-r):this.copy(a);if(1<=r)return this.w=l,this.x=c,this.y=h,this.z=d,this;a=Math.sqrt(1-r*r);if(.001>
Math.abs(a))return this.w=.5*(l+this.w),this.x=.5*(c+this.x),this.y=.5*(h+this.y),this.z=.5*(d+this.z),this;var f=Math.atan2(a,r);r=Math.sin((1-b)*f)/a;b=Math.sin(b*f)/a;this.w=l*r+this.w*b;this.x=c*r+this.x*b;this.y=h*r+this.y*b;this.z=d*r+this.z*b;return this};v.prototype.fromEuler=function(a,b,c){var h=Math.cos(a/2),d=Math.cos(b/2),l=Math.cos(c/2);a=Math.sin(a/2);b=Math.sin(b/2);c=Math.sin(c/2);this.x=a*d*l+h*b*c;this.y=h*b*l-a*d*c;this.z=h*d*c+a*b*l;this.w=h*d*l-a*b*c;return this};v.prototype.fromMatrix3=
function(a){var b=a.elements,c=b[0];a=b[3];var h=b[6],d=b[1],l=b[4],r=b[7],f=b[2],e=b[5];b=b[8];var g=c+l+b;0<g?(c=.5/Math.sqrt(g+1),this.w=.25/c,this.x=(e-r)*c,this.y=(h-f)*c,this.z=(d-a)*c):c>l&&c>b?(c=2*Math.sqrt(1+c-l-b),this.w=(e-r)/c,this.x=.25*c,this.y=(a+d)/c,this.z=(h+f)/c):l>b?(c=2*Math.sqrt(1+l-c-b),this.w=(h-f)/c,this.x=(a+d)/c,this.y=.25*c,this.z=(r+e)/c):(c=2*Math.sqrt(1+b-c-l),this.w=(d-a)/c,this.x=(h+f)/c,this.y=(r+e)/c,this.z=.25*c);return this};v.prototype.fromArray=function(a,b){b=
void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this};v.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a};v.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w};var w=function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};w.prototype.set=function(a,b,c,h,d,l,r,f,e,g,k,m,p,q,x,t){var n=this.elements;n[0]=a;n[4]=b;n[8]=c;n[12]=h;n[1]=d;n[5]=l;n[9]=r;n[13]=f;n[2]=
e;n[6]=g;n[10]=k;n[14]=m;n[3]=p;n[7]=q;n[11]=x;n[15]=t;return this};w.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this};w.prototype.clone=function(){return(new this.constructor).copy(this)};w.prototype.identity=function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};w.prototype.multiply=function(a){return this.multiplyMatrices(this,
a)};w.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};w.prototype.multiplyMatrices=function(a,b){var c=a.elements,h=b.elements;b=this.elements;a=c[0];var d=c[4],l=c[8],r=c[12],f=c[1],e=c[5],g=c[9],k=c[13],m=c[2],p=c[6],q=c[10],x=c[14],t=c[3],u=c[7],v=c[11];c=c[15];var w=h[0],y=h[4],z=h[8],A=h[12],C=h[1],B=h[5],D=h[9],E=h[13],F=h[2],G=h[6],H=h[10],I=h[14],J=h[3],K=h[7],L=h[11];h=h[15];b[0]=a*w+d*C+l*F+r*J;b[4]=a*y+d*B+l*G+r*K;b[8]=a*z+d*D+l*H+r*L;b[12]=a*A+d*E+l*I+r*h;b[1]=
f*w+e*C+g*F+k*J;b[5]=f*y+e*B+g*G+k*K;b[9]=f*z+e*D+g*H+k*L;b[13]=f*A+e*E+g*I+k*h;b[2]=m*w+p*C+q*F+x*J;b[6]=m*y+p*B+q*G+x*K;b[10]=m*z+p*D+q*H+x*L;b[14]=m*A+p*E+q*I+x*h;b[3]=t*w+u*C+v*F+c*J;b[7]=t*y+u*B+v*G+c*K;b[11]=t*z+u*D+v*H+c*L;b[15]=t*A+u*E+v*I+c*h;return this};w.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this};w.prototype.extractBasis=function(a,
b,c){a.fromMatrix4Column(this,0);b.fromMatrix4Column(this,1);c.fromMatrix4Column(this,2);return this};w.prototype.makeBasis=function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this};w.prototype.compose=function(a,b,c){this.fromQuaternion(b);this.scale(c);this.setPosition(a);return this};w.prototype.scale=function(a){var b=this.elements,c=a.x,h=a.y;a=a.z;b[0]*=c;b[4]*=h;b[8]*=a;b[1]*=c;b[5]*=h;b[9]*=a;b[2]*=c;b[6]*=h;b[10]*=a;b[3]*=c;b[7]*=h;b[11]*=a;return this};w.prototype.setPosition=
function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this};w.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this};w.prototype.getInverse=function(a){var b=this.elements,c=a.elements,h=b[0],d=b[1],l=b[2],r=b[3],f=b[4],e=b[5],g=b[6],k=b[7],m=b[8],p=b[9],q=b[10],t=b[11],u=b[12],v=b[13],w=b[14];b=b[15];var y=p*w*k-v*q*k+
v*g*t-e*w*t-p*g*b+e*q*b,z=u*q*k-m*w*k-u*g*t+f*w*t+m*g*b-f*q*b,A=m*v*k-u*p*k+u*e*t-f*v*t-m*e*b+f*p*b,B=u*p*g-m*v*g-u*e*q+f*v*q+m*e*w-f*p*w,C=h*y+d*z+l*A+r*B;if(0===C)return x.warn("YUKA.Matrix4: .getInverse() can not invert matrix, determinant is 0."),this.identity();C=1/C;c[0]=y*C;c[1]=(v*q*r-p*w*r-v*l*t+d*w*t+p*l*b-d*q*b)*C;c[2]=(e*w*r-v*g*r+v*l*k-d*w*k-e*l*b+d*g*b)*C;c[3]=(p*g*r-e*q*r-p*l*k+d*q*k+e*l*t-d*g*t)*C;c[4]=z*C;c[5]=(m*w*r-u*q*r+u*l*t-h*w*t-m*l*b+h*q*b)*C;c[6]=(u*g*r-f*w*r-u*l*k+h*w*k+
f*l*b-h*g*b)*C;c[7]=(f*q*r-m*g*r+m*l*k-h*q*k-f*l*t+h*g*t)*C;c[8]=A*C;c[9]=(u*p*r-m*v*r-u*d*t+h*v*t+m*d*b-h*p*b)*C;c[10]=(f*v*r-u*e*r+u*d*k-h*v*k-f*d*b+h*e*b)*C;c[11]=(m*e*r-f*p*r-m*d*k+h*p*k+f*d*t-h*e*t)*C;c[12]=B*C;c[13]=(m*v*l-u*p*l+u*d*q-h*v*q-m*d*w+h*p*w)*C;c[14]=(u*e*l-f*v*l-u*d*g+h*v*g+f*d*w-h*e*w)*C;c[15]=(f*p*l-m*e*l+m*d*g-h*p*g-f*d*q+h*e*q)*C;return a};w.prototype.getMaxScale=function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],
a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))};w.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,h=a.y,d=a.z,l=a.w,f=c+c,e=h+h,g=d+d;a=c*f;var k=c*e;c*=g;var m=h*e;h*=g;d*=g;f*=l;e*=l;l*=g;b[0]=1-(m+d);b[4]=k-l;b[8]=c+e;b[1]=k+l;b[5]=1-(a+d);b[9]=h-f;b[2]=c-e;b[6]=h+f;b[10]=1-(a+m);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this};w.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,h=0;16>h;h++)c[h]=a[h+b];return this};w.prototype.toArray=function(a,b){b=
void 0===b?0:b;var c=this.elements;a[b+0]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a};w.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0};var $b=new v,Ia=new f,B=function(){this.name="";this.active=!0;this.children=[];this.parent=null;this.neighbors=[];this.neighborhoodRadius=
1;this.updateNeighborhood=!1;this.position=new f;this.rotation=new v;this.scale=new f(1,1,1);this.forward=new f(0,0,1);this.up=new f(0,1,0);this.boundingRadius=0;this.maxTurnRate=Math.PI;this.matrix=new w;this.worldMatrix=new w;this.manager=null;this._cache={position:new f,rotation:new v,scale:new f};this._renderComponentCallback=this._renderComponent=null;this._started=!1};B.prototype.start=function(){};B.prototype.update=function(){};B.prototype.add=function(a){null!==a.parent&&a.parent.remove(a);
this.children.push(a);a.parent=this;return this};B.prototype.remove=function(a){var b=this.children.indexOf(a);this.children.splice(b,1);a.parent=null;return this};B.prototype.getDirection=function(a){return a.copy(this.forward).applyRotation(this.rotation).normalize()};B.prototype.lookAt=function(a){Ia.subVectors(a,this.position).normalize();this.rotation.lookAt(this.forward,Ia,this.up);return this};B.prototype.rotateTo=function(a,b){Ia.subVectors(a,this.position).normalize();$b.lookAt(this.forward,
Ia,this.up);return this.rotation.rotateTo($b,this.maxTurnRate*b)};B.prototype.updateMatrix=function(){var a=this._cache;if(a.position.equals(this.position)&&a.rotation.equals(this.rotation)&&a.scale.equals(this.scale))return this;this.matrix.compose(this.position,this.rotation,this.scale);a.position.copy(this.position);a.rotation.copy(this.rotation);a.scale.copy(this.scale);return this};B.prototype.updateWorldMatrix=function(a,b){b=void 0===b?!1:b;var c=this.parent,h=this.children;!0===(void 0===
a?!1:a)&&null!==c&&c.updateWorldMatrix(!0);this.updateMatrix();null===c?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix);if(!0===b)for(a=0,b=h.length;a<b;a++)h[a].updateWorldMatrix(!1,!0);return this};B.prototype.setRenderComponent=function(a,b){this._renderComponent=a;this._renderComponentCallback=b;return this};B.prototype.handleMessage=function(){return!1};B.prototype.sendMessage=function(a,b,c,h){null!==this.manager?this.manager.sendMessage(this,
a,b,void 0===c?0:c,void 0===h?null:h):x.error("YUKA.GameEntity: The game entity must be added to a manager in order to send a message.");return this};var ua=new f,T=[new f,new f,new f,new f,new f,new f,new f,new f],z=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.min=a;this.max=b};z.prototype.set=function(a,b){this.min=a;this.max=b;return this};z.prototype.copy=function(a){this.min.copy(a.min);this.max.copy(a.max);return this};z.prototype.clone=function(){return(new this.constructor).copy(this)};
z.prototype.clampPoint=function(a,b){b.copy(a).clamp(this.min,this.max);return b};z.prototype.containsPoint=function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0};z.prototype.expand=function(a){this.min.min(a);this.max.max(a);return this};z.prototype.getCenter=function(a){return a.addVectors(this.min,this.max).multiplyScalar(.5)};z.prototype.intersectsAABB=function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||
a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0};z.prototype.intersectsBoundingSphere=function(a){this.clampPoint(a.center,ua);return ua.squaredDistanceTo(a.center)<=a.radius*a.radius};z.prototype.fromCenterAndSize=function(a,b){ua.copy(b).multiplyScalar(.5);this.min.copy(a).sub(ua);this.max.copy(a).add(ua);return this};z.prototype.fromPoints=function(a){this.min.set(Infinity,Infinity,Infinity);this.max.set(-Infinity,-Infinity,-Infinity);for(var b=0,c=a.length;b<c;b++)this.expand(a[b]);
return this};z.prototype.applyMatrix4=function(a){var b=this.min,c=this.max;T[0].set(b.x,b.y,b.z).applyMatrix4(a);T[1].set(b.x,b.y,c.z).applyMatrix4(a);T[2].set(b.x,c.y,b.z).applyMatrix4(a);T[3].set(b.x,c.y,c.z).applyMatrix4(a);T[4].set(c.x,b.y,b.z).applyMatrix4(a);T[5].set(c.x,b.y,c.z).applyMatrix4(a);T[6].set(c.x,c.y,b.z).applyMatrix4(a);T[7].set(c.x,c.y,c.z).applyMatrix4(a);return this.fromPoints(T)};z.prototype.equals=function(a){return a.min.equals(this.min)&&a.max.equals(this.max)};var E=function(a,
b){this.center=a=void 0===a?new f:a;this.radius=void 0===b?0:b};E.prototype.set=function(a,b){this.center=a;this.radius=b;return this};E.prototype.copy=function(a){this.center.copy(a.center);this.radius=a.radius;return this};E.prototype.clone=function(){return(new this.constructor).copy(this)};E.prototype.containsPoint=function(a){return a.squaredDistanceTo(this.center)<=this.radius*this.radius};E.prototype.intersectsBoundingSphere=function(a){var b=this.radius+a.radius;return a.center.squaredDistanceTo(this.center)<=
b*b};E.prototype.applyMatrix4=function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScale();return this};E.prototype.equals=function(a){return a.center.equals(this.center)&&a.radius===this.radius};var hb=function(a,b){this.vertices=a=void 0===a?new Float32Array:a;this.indices=void 0===b?null:b;this.backfaceCulling=!0;this.aabb=new z;this.boundingSphere=new E;this.computeBoundingVolume()};hb.prototype.computeBoundingVolume=function(){var a=this.vertices,b=new f,c=this.aabb,h=this.boundingSphere;
c.min.set(Infinity,Infinity,Infinity);c.max.set(-Infinity,-Infinity,-Infinity);for(var d=0,l=a.length;d<l;d+=3)b.x=a[d],b.y=a[d+1],b.z=a[d+2],c.expand(b);c.getCenter(h.center);h.radius=h.center.distanceTo(c.max);return this};var ac=new f,ib=new f,Z=function(){var a=B.call(this)||this;a.velocity=new f;a.maxSpeed=1;a.updateOrientation=!0;return a};$jscomp.inherits(Z,B);Z.prototype.update=function(a){this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));
ac.copy(this.velocity).multiplyScalar(a);ib.copy(this.position).add(ac);this.updateOrientation&&1e-8<this.getSpeedSquared()&&this.lookAt(ib);this.position.copy(ib);return this};Z.prototype.getSpeed=function(){return this.velocity.length()};Z.prototype.getSpeedSquared=function(){return this.velocity.squaredLength()};var ia=function(){this.currentTime=this.previousTime=this.startTime=0;this.detectPageVisibility=!0;"undefined"!==typeof document&&void 0!==document.hidden&&(this._pageVisibilityHandler=
g.bind(this),document.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))};ia.prototype.getDelta=function(){return(this.currentTime-this.previousTime)/1E3};ia.prototype.getElapsed=function(){return(this.currentTime-this.startTime)/1E3};ia.prototype.update=function(){this.previousTime=this.currentTime;this.currentTime=this.now();return this};ia.prototype.now=function(){return("undefined"===typeof performance?Date:performance).now()};var bc=function(a){this.updateFrequency=void 0===
a?0:a;this._time=new ia;this._nextUpdateTime=0};bc.prototype.ready=function(){this._time.update();return this._time.currentTime>=this._nextUpdateTime?(this._nextUpdateTime=this._time.currentTime+1E3/this.updateFrequency,!0):!1};var ja=function(){};ja.prototype.enter=function(){};ja.prototype.execute=function(){};ja.prototype.exit=function(){};ja.prototype.onMessage=function(){return!1};var O=function(a){this.owner=void 0===a?null:a;this.globalState=this.previousState=this.currentState=null;this.states=
new Map};O.prototype.update=function(){null!==this.globalState&&this.globalState.execute(this.owner);null!==this.currentState&&this.currentState.execute(this.owner);return this};O.prototype.add=function(a,b){b instanceof ja?this.states.set(a,b):x.warn('YUKA.StateMachine: .add() needs a parameter of type "YUKA.State".');return this};O.prototype.remove=function(a){this.states.delete(a);return this};O.prototype.get=function(a){return this.states.get(a)};O.prototype.changeTo=function(a){a=this.get(a);
this._change(a);return this};O.prototype.revert=function(){this._change(this.previousState);return this};O.prototype.in=function(a){return this.get(a)===this.currentState};O.prototype.handleMessage=function(a){return null!==this.currentState&&!0===this.currentState.onMessage(this.owner,a)||null!==this.globalState&&!0===this.globalState.onMessage(this.owner,a)?!0:!1};O.prototype._change=function(a){this.previousState=this.currentState;this.currentState.exit(this.owner);this.currentState=a;this.currentState.enter(this.owner)};
var ka=function(){};ka.prototype.clearDegreeOfMembership=function(){};ka.prototype.getDegreeOfMembership=function(){};ka.prototype.updateDegreeOfMembership=function(){};var K=function(a){this.terms=a=void 0===a?[]:a;return this};$jscomp.inherits(K,ka);K.prototype.clearDegreeOfMembership=function(){for(var a=this.terms,b=0,c=a.length;b<c;b++)a[b].clearDegreeOfMembership();return this};K.prototype.updateDegreeOfMembership=function(a){for(var b=this.terms,c=0,d=b.length;c<d;c++)b[c].updateDegreeOfMembership(a);
return this};var jb=function(){var a=Array.from(arguments);return K.call(this,a)||this};$jscomp.inherits(jb,K);jb.prototype.getDegreeOfMembership=function(){for(var a=this.terms,b=Infinity,c=0,d=a.length;c<d;c++){var n=a[c].getDegreeOfMembership();n<b&&(b=n)}return b};var va=function(a){return K.call(this,[void 0===a?null:a])||this};$jscomp.inherits(va,K);va.prototype.clearDegreeOfMembership=function(){this.terms[0].clearDegreeOfMembership();return this};va.prototype.getDegreeOfMembership=function(){var a=
this.terms[0].getDegreeOfMembership();return Math.sqrt(a)};va.prototype.updateDegreeOfMembership=function(a){this.terms[0].updateDegreeOfMembership(Math.sqrt(a));return this};var kb=function(){var a=Array.from(arguments);return K.call(this,a)||this};$jscomp.inherits(kb,K);kb.prototype.getDegreeOfMembership=function(){for(var a=this.terms,b=-Infinity,c=0,d=a.length;c<d;c++){var n=a[c].getDegreeOfMembership();n>b&&(b=n)}return b};var wa=function(a){return K.call(this,[void 0===a?null:a])||this};$jscomp.inherits(wa,
K);wa.prototype.clearDegreeOfMembership=function(){this.terms[0].clearDegreeOfMembership();return this};wa.prototype.getDegreeOfMembership=function(){var a=this.terms[0].getDegreeOfMembership();return a*a};wa.prototype.updateDegreeOfMembership=function(a){this.terms[0].updateDegreeOfMembership(a*a);return this};var F=function(a){this.degreeOfMembership=0;this.representativeValue=void 0===a?0:a;this.right=this.left=0;return this};$jscomp.inherits(F,ka);F.prototype.computeDegreeOfMembership=function(){};
F.prototype.clearDegreeOfMembership=function(){this.degreeOfMembership=0;return this};F.prototype.getDegreeOfMembership=function(){return this.degreeOfMembership};F.prototype.updateDegreeOfMembership=function(a){a>this.degreeOfMembership&&(this.degreeOfMembership=a);return this};var lb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var d=F.call(this,(b+a)/2)||this;d.left=a;d.midpoint=b;d.right=c;return d};$jscomp.inherits(lb,F);lb.prototype.computeDegreeOfMembership=function(a){var b=
this.midpoint,c=this.right;return a>=this.left&&a<=b?1:a>b&&a<=c?1/(c-b)*(c-a):0};var mb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var d=F.call(this,(b+c)/2)||this;d.left=a;d.midpoint=b;d.right=c;return d};$jscomp.inherits(mb,F);mb.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.left,d=this.right;return a>=c&&a<=b?1/(b-c)*(a-c):a>b&&a<=d?1:0};var nb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var d=F.call(this,b)||this;d.left=
a;d.midpoint=b;d.right=c;return d};$jscomp.inherits(nb,F);nb.prototype.computeDegreeOfMembership=function(a){var b=this.right;return a>=this.left&&a<=b?1:0};var ob=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var d=F.call(this,b)||this;d.left=a;d.midpoint=b;d.right=c;return d};$jscomp.inherits(ob,F);ob.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.left,d=this.right;return a>=c&&a<=b?1/(b-c)*(a-c):a>b&&a<=d?1/(d-b)*(d-a):0};var L=function(){this.rules=
[];this.flvs=new Map};L.prototype.addFLV=function(a,b){this.flvs.set(a,b);return this};L.prototype.removeFLV=function(a){this.flvs.delete(a);return this};L.prototype.addRule=function(a){this.rules.push(a);return this};L.prototype.removeRule=function(a){var b=this.rules;a=b.indexOf(a);b.splice(a,1);return this};L.prototype.fuzzify=function(a,b){this.flvs.get(a).fuzzify(b);return this};L.prototype.defuzzify=function(a,b){b=void 0===b?L.DEFUZ_TYPE.MAXAV:b;var c=this.flvs,d=this.rules;this._initConsequences();
for(var n=0,l=d.length;n<l;n++)d[n].evaluate();a=c.get(a);switch(b){case L.DEFUZ_TYPE.MAXAV:b=a.defuzzifyMaxAv();break;case L.DEFUZ_TYPE.CENTROID:b=a.defuzzifyCentroid();break;default:x.warn("YUKA.FuzzyModule: Unknown defuzzification method:",b),b=a.defuzzifyMaxAv()}return b};L.prototype._initConsequences=function(){for(var a=this.rules,b=0,c=a.length;b<c;b++)a[b].initConsequence();return this};L.DEFUZ_TYPE=Object.freeze({MAXAV:0,CENTROID:1});var pb=function(a,b){this.antecedent=void 0===a?null:a;
this.consequence=void 0===b?null:b};pb.prototype.initConsequence=function(){this.consequence.clearDegreeOfMembership();return this};pb.prototype.evaluate=function(){this.consequence.updateDegreeOfMembership(this.antecedent.getDegreeOfMembership());return this};var la=function(){this.fuzzySets=[];this.minRange=Infinity;this.maxRange=-Infinity};la.prototype.add=function(a){this.fuzzySets.push(a);a.left<this.minRange&&(this.minRange=a.left);a.right>this.maxRange&&(this.maxRange=a.right);return this};
la.prototype.remove=function(a){var b=this.fuzzySets;a=b.indexOf(a);b.splice(a,1);this.minRange=Infinity;this.maxRange=-Infinity;a=0;for(var c=b.length;a<c;a++){var d=b[a];d.left<this.minRange&&(this.minRange=d.left);d.right>this.maxRange&&(this.maxRange=d.right)}return this};la.prototype.fuzzify=function(a){if(a<this.minRange||a>this.maxRange)x.warn("YUKA.FuzzyVariable: Value for fuzzification out of range.");else{for(var b=this.fuzzySets,c=0,d=b.length;c<d;c++){var n=b[c];n.degreeOfMembership=n.computeDegreeOfMembership(a)}return this}};
la.prototype.defuzzifyMaxAv=function(){for(var a=this.fuzzySets,b=0,c=0,d=0,n=a.length;d<n;d++){var l=a[d];b+=l.degreeOfMembership;c+=l.representativeValue*l.degreeOfMembership}return 0===b?0:c/b};la.prototype.defuzzifyCentroid=function(a){a=void 0===a?10:a;for(var b=this.fuzzySets,c=(this.maxRange-this.minRange)/a,d=0,n=0,l=1;l<=a;l++)for(var f=this.minRange+l*c,e=0,g=b.length;e<g;e++){var k=b[e];k=Math.min(k.degreeOfMembership,k.computeDegreeOfMembership(f));d+=k;n+=f*k}return 0===d?0:n/d};var u=
function(a){this.owner=void 0===a?null:a;this.status=u.STATUS.INACTIVE};u.prototype.activate=function(){};u.prototype.execute=function(){};u.prototype.terminate=function(){};u.prototype.handleMessage=function(){return!1};u.prototype.active=function(){return this.status===u.STATUS.ACTIVE};u.prototype.inactive=function(){return this.status===u.STATUS.INACTIVE};u.prototype.completed=function(){return this.status===u.STATUS.COMPLETED};u.prototype.failed=function(){return this.status===u.STATUS.FAILED};
u.prototype.replanIfFailed=function(){!0===this.failed()&&(this.status=u.STATUS.INACTIVE);return this};u.prototype.activateIfInactive=function(){!0===this.inactive()&&(this.activate(),this.status=u.STATUS.ACTIVE);return this};u.STATUS=Object.freeze({ACTIVE:"active",INACTIVE:"inactive",COMPLETED:"completed",FAILED:"failed"});var M=function(a){a=u.call(this,void 0===a?null:a)||this;a.subgoals=[];return a};$jscomp.inherits(M,u);M.prototype.addSubgoal=function(a){this.subgoals.unshift(a);return this};
M.prototype.removeSubgoal=function(a){a=this.subgoals.indexOf(a);this.subgoals.splice(a,1);return this};M.prototype.clearSubgoals=function(){for(var a=this.subgoals,b=0,c=a.length;b<c;b++)a[b].terminate();a.length=0;return this};M.prototype.currentSubgoal=function(){var a=this.subgoals.length;return 0<a?this.subgoals[a-1]:null};M.prototype.executeSubgoals=function(){for(var a=this.subgoals,b=a.length-1;0<=b;b--){var c=a[b];if(!0===c.completed()||!0===c.failed())c instanceof M&&c.clearSubgoals(),c.terminate(),
a.pop();else break}b=this.currentSubgoal();return null!==b?(b.activateIfInactive(),b.execute(),!0===b.completed()&&1<a.length?u.STATUS.ACTIVE:b.status):u.STATUS.COMPLETED};M.prototype.hasSubgoals=function(){return 0<this.subgoals.length};M.prototype.handleMessage=function(a){var b=this.currentSubgoal();return null!==b?b.handleMessage(a):!1};var qb=function(a){this.characterBias=void 0===a?1:a};qb.prototype.calculateDesirability=function(){return 0};qb.prototype.setGoal=function(){};var U=function(a){a=
M.call(this,void 0===a?null:a)||this;a.evaluators=[];return a};$jscomp.inherits(U,M);U.prototype.activate=function(){this.arbitrate()};U.prototype.execute=function(){this.activateIfInactive();var a=this.executeSubgoals();if(a===u.STATUS.COMPLETED||a===u.STATUS.FAILED)this.status=u.STATUS.INACTIVE};U.prototype.terminate=function(){this.clearSubgoals()};U.prototype.addEvaluator=function(a){this.evaluators.push(a);return this};U.prototype.removeEvaluator=function(a){a=this.evaluators.indexOf(a);this.evaluators.splice(a,
1);return this};U.prototype.arbitrate=function(){for(var a=this.evaluators,b=-1,c=null,d=0,n=a.length;d<n;d++){var l=a[d],f=l.calculateDesirability(this.owner);f*=l.characterBias;f>=b&&(b=f,c=l)}null!==c?c.setGoal(this.owner):x.error("YUKA.Think: Unable to determine goal evaluator for game entity:",this.owner);return this};var aa=function(a,b,c){this.from=void 0===a?-1:a;this.to=void 0===b?-1:b;this.cost=void 0===c?0:c};aa.prototype.copy=function(a){this.from=a.from;this.to=a.to;this.cost=a.cost;
return this};aa.prototype.clone=function(){return(new this.constructor).copy(this)};var D=function(){this.digraph=!1;this._nodes=new Map;this._edges=new Map};D.prototype.addNode=function(a){var b=a.index;this._nodes.set(b,a);this._edges.set(b,[]);return this};D.prototype.addEdge=function(a){var b=this._edges.get(a.from);b.push(a);if(!1===this.digraph){var c=a.clone();c.from=a.to;c.to=a.from;b=this._edges.get(a.to);b.push(c)}return this};D.prototype.getNode=function(a){return this._nodes.get(a)||null};
D.prototype.getEdge=function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=this._edges.get(a);for(var c=0,d=a.length;c<d;c++){var n=a[c];if(n.to===b)return n}}return null};D.prototype.getNodes=function(a){a.length=0;a.push.apply(a,$jscomp.arrayFromIterable(this._nodes.values()));return a};D.prototype.getEdgesOfNode=function(a,b){a=this._edges.get(a);void 0!==a&&(b.length=0,b.push.apply(b,$jscomp.arrayFromIterable(a)));return b};D.prototype.getNodeCount=function(){return this._nodes.size};D.prototype.getEdgeCount=
function(){for(var a=0,b=$jscomp.makeIterator(this._edges.values()),c=b.next();!c.done;c=b.next())a+=c.value.length;return a};D.prototype.removeNode=function(a){this._nodes.delete(a.index);if(!1===this.digraph){var b=this._edges.get(a.index);b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next()){c=this._edges.get(c.value.to);for(var d=c.length-1;0<=d;d--){var n=c[d];if(n.to===a.index){d=c.indexOf(n);c.splice(d,1);break}}}}else for(b=$jscomp.makeIterator(this._edges.values()),c=b.next();!c.done;c=
b.next())for(c=c.value,d=c.length-1;0<=d;d--)n=c[d],this.hasNode(n.to)&&this.hasNode(n.from)||(n=c.indexOf(n),c.splice(n,1));this._edges.delete(a.index);return this};D.prototype.removeEdge=function(a){var b=this._edges.get(a.from);if(void 0!==b){var c=b.indexOf(a);b.splice(c,1);if(!1===this.digraph){b=this._edges.get(a.to);c=0;for(var d=b.length;c<d;c++){var n=b[c];if(n.to===a.from){a=b.indexOf(n);b.splice(a,1);break}}}}return this};D.prototype.hasNode=function(a){return this._nodes.has(a)};D.prototype.hasEdge=
function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=this._edges.get(a);for(var c=0,d=a.length;c<d;c++)if(a[c].to===b)return!0}return!1};D.prototype.clear=function(){this._nodes.clear();this._edges.clear();return this};var rb=function(a){this.index=void 0===a?-1:a},sb=function(){};sb.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.distanceTo(a.position)};var cc=function(){};cc.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.squaredDistanceTo(a.position)};
var dc=function(){};dc.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.manhattanDistanceTo(a.position)};var ec=function(){};ec.calculate=function(){return 0};var V=function(a){a=void 0===a?m:a;this.data=[];this.length=0;this.compare=a};V.prototype.push=function(a){this.data.push(a);this.length++;this._up(this.length-1)};V.prototype.pop=function(){if(0===this.length)return null;var a=this.data[0];this.length--;0<this.length&&(this.data[0]=this.data[this.length],this._down(0));
this.data.pop();return a};V.prototype.peek=function(){return this.data[0]||null};V.prototype._up=function(a){for(var b=this.data,c=this.compare,d=b[a];0<a;){var n=a-1>>1,l=b[n];if(0<=c(d,l))break;b[a]=l;a=n}b[a]=d};V.prototype._down=function(a){for(var b=this.data,c=this.compare,d=b[a],n=this.length>>1;a<n;){var l=(a<<1)+1,f=l+1,e=b[l];f<this.length&&0>c(b[f],e)&&(l=f,e=b[f]);if(0<=c(e,d))break;b[a]=e;a=l}b[a]=d};var ma=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=
void 0===c?-1:c;this.found=!1;this.heuristic=sb;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};ma.prototype.search=function(){var a=[],b=new V(q);for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,a);for(var d=0,n=a.length;d<n;d++){var l=a[d],f=(this._cost.get(c)||
0)+l.cost,e=this.heuristic.calculate(this.graph,l.to,this.target);e=f+e;if(!1===this._searchFrontier.has(l.to)||f<this._cost.get(l.to))this._cost.set(l.to,f),this._searchFrontier.set(l.to,l),b.push({cost:e,index:l.to})}}}this.found=!1;return this};ma.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,a.unshift(b);return a};ma.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};
ma.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear();return this};var xa=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};xa.prototype.search=function(){var a=[],b=[],c=new aa(this.source,this.source);a.push(c);for(this._visited.add(this.source);0<a.length;){var d=a.shift();this._route.set(d.to,
d.from);d!==c&&this._spanningTree.add(d);if(d.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(d.to,b);d=0;for(var n=b.length;d<n;d++){var l=b[d];!1===this._visited.has(l.to)&&(a.push(l),this._visited.add(l.to))}}this.found=!1;return this};xa.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};xa.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};
xa.prototype.clear=function(){this.found=!1;this._route.clear();this._visited.clear();this._spanningTree.clear();return this};var ya=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};ya.prototype.search=function(){var a=[],b=[],c=new aa(this.source,this.source);for(a.push(c);0<a.length;){var d=a.pop();this._route.set(d.to,d.from);this._visited.add(d.to);d!==c&&this._spanningTree.add(d);
if(d.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(d.to,b);d=0;for(var n=b.length;d<n;d++){var l=b[d];!1===this._visited.has(l.to)&&a.push(l)}}this.found=!1;return this};ya.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};ya.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};ya.prototype.clear=function(){this.found=
!1;this._route.clear();this._visited.clear();this._spanningTree.clear();return this};var za=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};za.prototype.search=function(){var a=[],b=new V(e);for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,
this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,a);for(var d=0,n=a.length;d<n;d++){var l=a[d],f=(this._cost.get(c)||0)+l.cost;if(!1===this._searchFrontier.has(l.to)||f<this._cost.get(l.to))this._cost.set(l.to,f),this._searchFrontier.set(l.to,l),b.push({cost:f,index:l.to})}}}this.found=!1;return this};za.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,
a.unshift(b);return a};za.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};za.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear();return this};var fc=new f,Ja=new f,P=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.from=a;this.to=b};P.prototype.set=function(a,b){this.from=a;this.to=b;return this};P.prototype.copy=function(a){this.from.copy(a.from);this.to.copy(a.to);
return this};P.prototype.clone=function(){return(new this.constructor).copy(this)};P.prototype.delta=function(a){return a.subVectors(this.to,this.from)};P.prototype.at=function(a,b){return this.delta(b).multiplyScalar(a).add(this.from)};P.prototype.closestPointToPoint=function(a,b,c){a=this.closestPointToPointParameter(a,b);return this.at(a,c)};P.prototype.closestPointToPointParameter=function(a,b){b=void 0===b?!0:b;fc.subVectors(a,this.from);Ja.subVectors(this.to,this.from);a=Ja.dot(Ja);a=Ja.dot(fc)/
a;b&&(a=A.clamp(a,0,1));return a};P.prototype.equals=function(a){return a.from.equals(this.from)&&a.to.equals(this.to)};var gc=new f,Mc=new f,Q=function(a,b){this.normal=a=void 0===a?new f(0,0,1):a;this.constant=void 0===b?0:b};Q.prototype.set=function(a,b){this.normal=a;this.constant=b;return this};Q.prototype.copy=function(a){this.normal.copy(a.normal);this.constant=a.constant;return this};Q.prototype.clone=function(){return(new this.constructor).copy(this)};Q.prototype.distanceToPoint=function(a){return this.normal.dot(a)+
this.constant};Q.prototype.fromNormalAndCoplanarPoint=function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this};Q.prototype.fromCoplanarPoints=function(a,b,c){gc.subVectors(c,b).cross(Mc.subVectors(a,b)).normalize();this.fromNormalAndCoplanarPoint(gc,a);return this};Q.prototype.equals=function(a){return a.normal.equals(this.normal)&&a.constant===this.constant};var W=new f,tb=new f,Ka=new f,ub=new f,H=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.origin=a;this.direction=
b};H.prototype.set=function(a,b){this.origin=a;this.direction=b;return this};H.prototype.copy=function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this};H.prototype.clone=function(){return(new this.constructor).copy(this)};H.prototype.at=function(a,b){return b.copy(this.direction).multiplyScalar(a).add(this.origin)};H.prototype.intersectBoundingSphere=function(a,b){W.subVectors(a.center,this.origin);var c=W.dot(this.direction),d=W.dot(W)-c*c;a=a.radius*a.radius;if(d>a)return null;
a=Math.sqrt(a-d);d=c-a;c+=a;return 0>d&&0>c?null:0>d?this.at(c,b):this.at(d,b)};H.prototype.intersectAABB=function(a,b){var c=1/this.direction.x;var d=1/this.direction.y;var n=1/this.direction.z,l=this.origin;if(0<=c){var f=(a.min.x-l.x)*c;c*=a.max.x-l.x}else f=(a.max.x-l.x)*c,c*=a.min.x-l.x;if(0<=d){var e=(a.min.y-l.y)*d;d*=a.max.y-l.y}else e=(a.max.y-l.y)*d,d*=a.min.y-l.y;if(f>d||e>c)return null;if(e>f||f!==f)f=e;if(d<c||c!==c)c=d;0<=n?(e=(a.min.z-l.z)*n,a=(a.max.z-l.z)*n):(e=(a.max.z-l.z)*n,a=
(a.min.z-l.z)*n);if(f>a||e>c)return null;if(e>f||f!==f)f=e;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=f?f:c,b)};H.prototype.intersectTriangle=function(a,b,c){var d=a.a,n=a.c;tb.subVectors(a.b,d);Ka.subVectors(n,d);ub.crossVectors(tb,Ka);a=this.direction.dot(ub);if(0<a){if(b)return null;b=1}else if(0>a)b=-1,a=-a;else return null;W.subVectors(this.origin,d);d=b*this.direction.dot(Ka.crossVectors(W,Ka));if(0>d)return null;n=b*this.direction.dot(tb.cross(W));if(0>n||d+n>a)return null;d=-b*W.dot(ub);
return 0>d?null:this.at(d/a,c)};H.prototype.applyMatrix4=function(a){this.origin.applyMatrix4(a);this.direction.transformDirection(a);return this};H.prototype.equals=function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)};var La=function(a,b,c){return aa.call(this,void 0===a?-1:a,void 0===b?-1:b,void 0===c?0:c)||this};$jscomp.inherits(La,aa);var Ma=function(a,b,c){a=void 0===a?-1:a;b=void 0===b?new f:b;c=void 0===c?{}:c;a=rb.call(this,a)||this;a.position=b;a.userData=
c;return a};$jscomp.inherits(Ma,rb);var hc=function(){};hc.createGridLayout=function(a,b){var c=new D;c.digraph=!0;var d=a/2;a/=b;for(var n=0,l=0;l<=b;l++)for(var e=l*a-d,g=0;g<=b;g++){var k=new f(g*a-d,0,e);k=new Ma(n,k);c.addNode(k);n++}b=c.getNodeCount();d=Math.pow(a+a/2,2);for(a=0;a<b;a++)for(n=c.getNode(a),l=0;l<b;l++)a!==l&&(e=c.getNode(l).position.squaredDistanceTo(n.position),e<=d&&(e=new La(a,l,Math.sqrt(e)),c.addEdge(e)));return c};var Na=function(){this.portalEdges=[]};Na.prototype.push=
function(a,b){this.portalEdges.push({left:a,right:b});return this};Na.prototype.generate=function(){var a=this.portalEdges,b=[],c=0,d=0;var n=a[0].left;var l=a[0].left;var f=a[0].right;b.push(n);var e=1;for(var g=a.length;e<g;e++){var k=a[e].left,m=a[e].right;if(0>=A.area(n,f,m))if(n===f||0<A.area(n,l,m))f=m,d=e;else{b.push(l);n=l;e=c;f=l=n;d=c=e;continue}0<=A.area(n,l,k)&&(n===l||0>A.area(n,f,k)?(l=k,c=e):(b.push(f),n=f,e=d,f=l=n,d=c=e))}0!==b.length&&b[b.length-1]===a[a.length-1].left||b.push(a[a.length-
1].left);return b};var na=function(a){this.vertex=a=void 0===a?new f:a;this.polygon=this.twin=this.prev=this.next=null;this.nodeIndex=-1};na.prototype.from=function(){return this.vertex};na.prototype.to=function(){return this.next?this.next.vertex:null};na.prototype.length=function(){var a=this.from(),b=this.to();return null!==b?a.distanceTo(b):-1};na.prototype.squaredLength=function(){var a=this.from(),b=this.to();return null!==b?a.squaredDistanceTo(b):-1};var vb=new f,ic=new f,wb=new f,xb=new f,
Aa=new f,Ba=new P,I=function(){this.graph=new D;this.graph.digraph=!0;this.regions=[];this.spatialIndex=null;this.epsilonCoplanarTest=.001;this.epsilonContainsTest=1};I.prototype.fromPolygons=function(a){this.clear();for(var b=[],c=[],d=0,n=a.length;d<n;d++){var f=a[d],e=f.edge;do b.push(e),e=e.next;while(e!==f.edge);this.regions.push(f)}a=0;for(d=b.length;a<d;a++)if(n=b[a],null===n.twin)for(f=a+1,e=b.length;f<e;f++){var g=b[f];if(n.from().equals(g.to())&&n.to().equals(g.from())){n.twin=g;g.twin=
n;f=n.squaredLength();c.push({cost:f,edge:n});break}}c.sort(N);this._buildRegions(c);this._buildNodeIndices();this._buildGraph();return this};I.prototype.clear=function(){this.graph.clear();this.regions.length=0;this.spatialIndex=null;return this};I.prototype.getClosestRegion=function(a){for(var b=this.regions,c=null,d=Infinity,n=0,f=b.length;n<f;n++){var e=b[n],g=a.squaredDistanceTo(e.centroid);g<d&&(d=g,c=e)}return c};I.prototype.getRandomRegion=function(){var a=this.regions,b=Math.floor(Math.random()*
a.length);b===a.length&&(b=a.length-1);return a[b]};I.prototype.getRegionForPoint=function(a,b){b=void 0===b?.001:b;if(null!==this.spatialIndex){var c=this.spatialIndex.getIndexForPosition(a);c=this.spatialIndex.cells[c].entries}else c=this.regions;for(var d=0,f=c.length;d<f;d++){var e=c[d];if(!0===e.contains(a,b))return e}return null};I.prototype.findPath=function(a,b){var c=this.graph,d=[],n=this.getRegionForPoint(a,this.epsilonContainsTest),e=this.getRegionForPoint(b,this.epsilonContainsTest);
if(null===n||null===e)null===n&&(n=this.getClosestRegion(a)),null===e&&(e=this.getClosestRegion(b));if(n===e)d.push((new f).copy(a)),d.push((new f).copy(b));else if(n=this.regions.indexOf(n),e=this.regions.indexOf(e),c=new ma(c,n,e),c.search(),!0===c.found){c=c.getPath();e=new Na;e.push(a,a);a={left:null,right:null};n=0;for(var g=c.length-1;n<g;n++)this.regions[c[n]].getPortalEdgeTo(this.regions[c[n+1]],a),e.push(a.left,a.right);e.push(b,b);d.push.apply(d,$jscomp.arrayFromIterable(e.generate()))}return d};
I.prototype.clampMovement=function(a,b,c,d){var h=this.getRegionForPoint(c,this.epsilonContainsTest);if(null===h){if(null===a)throw Error("YUKA.NavMesh.clampMovement(): No current region available.");h=null;var f=Infinity,e=a.edge;do{if(null===e.twin){Ba.set(e.vertex,e.next.vertex);var g=Ba.closestPointToPointParameter(b);Ba.at(g,vb);g=vb.squaredDistanceTo(b);g<f&&(f=g,h=e,ic.copy(vb))}e=e.next}while(e!==a.edge);wb.subVectors(h.next.vertex,h.vertex).normalize();c=xb.subVectors(c,b).length();xb.divideScalar(c);
f=wb.dot(xb);Aa.copy(ic).add(wb.multiplyScalar(f*c));Ba.set(h.vertex,h.next.vertex);h=Ba.closestPointToPointParameter(Aa,!1);if(0<=h&&1>=h)d.copy(Aa);else{h=this.getRegionForPoint(Aa,this.epsilonContainsTest);if(null!==h)return d.copy(Aa),h;d.copy(b)}return a}return h};I.prototype.updateSpatialIndex=function(){if(null!==this.spatialIndex){this.spatialIndex.makeEmpty();for(var a=this.regions,b=0,c=a.length;b<c;b++)this.spatialIndex.addPolygon(a[b])}return this};I.prototype._buildRegions=function(a){for(var b=
this.regions,c,d,f,e,g=0,k=a.length;g<k;g++){var m=a[g],p=m.edge;c=p.prev;d=p.next;f=p.twin.prev;e=p.twin.next;p.prev.next=p.twin.next;p.next.prev=p.twin.prev;p.twin.prev.next=p.next;p.twin.next.prev=p.prev;var q=p.polygon;q.edge=p.prev;if(!0===q.convex()&&!0===q.coplanar(this.epsilonCoplanarTest)){c=q.edge;do c.polygon=q,c=c.next;while(c!==q.edge);m=b.indexOf(m.edge.twin.polygon);b.splice(m,1)}else c.next=p,d.prev=p,f.next=p.twin,e.prev=p.twin,q.edge=p}a=0;for(k=b.length;a<k;a++)b[a].computeCentroid()};
I.prototype._buildNodeIndices=function(){for(var a=this.regions,b=new Map,c=0,d=0,f=a.length;d<f;d++){var e=a[d],g=e.edge;do{if(null!==g.twin&&null===g.nodeIndex){for(var k=-1,m=g.from(),p=$jscomp.makeIterator(b.entries()),q=p.next();!q.done;q=p.next()){var t=$jscomp.makeIterator(q.value);q=t.next().value;t=t.next().value;if(!0===m.equals(t)){k=q;break}}-1===k&&(k=c++,b.set(k,m));g.nodeIndex=k;g.twin.next.nodeIndex=k}g=g.next}while(g!==e.edge)}};I.prototype._buildGraph=function(){for(var a=this.graph,
b=this.regions,c=[],d=0,f=b.length;d<f;d++){var e=b[d],g=[];c.push(g);var k=e.edge;do null!==k.twin&&(g.push(this.regions.indexOf(k.twin.polygon)),!1===a.hasNode(this.regions.indexOf(k.polygon))&&a.addNode(new Ma(this.regions.indexOf(k.polygon),k.polygon.centroid))),k=k.next;while(k!==e.edge)}b=0;for(d=c.length;b<d;b++)for(f=c[b],e=b,g=0,k=f.length;g<k;g++){var m=f[g];if(e!==m&&!1===a.hasEdge(e,m)){var p=a.getNode(e),q=a.getNode(m);p=p.position.distanceTo(q.position);a.addEdge(new La(e,m,p))}}return this};
var R=function(){this.centroid=new f;this.edge=null;this.plane=new Q};R.prototype.fromContour=function(a){var b=[];if(3>a.length)return x.error("YUKA.Polygon: Unable to create polygon from contour. It needs at least three points."),this;for(var c=0,d=a.length;c<d;c++){var e=new na(a[c]);b.push(e)}c=0;for(d=b.length;c<d;c++){if(0===c){e=b[c];var f=b[d-1];var g=b[c+1]}else c===d-1?(e=b[c],f=b[c-1],g=b[0]):(e=b[c],f=b[c-1],g=b[c+1]);e.prev=f;e.next=g;e.polygon=this}this.edge=b[0];this.plane.fromCoplanarPoints(a[0],
a[1],a[2]);return this};R.prototype.computeCentroid=function(){var a=this.centroid,b=this.edge,c=0;a.set(0,0,0);do a.add(b.from()),c++,b=b.next;while(b!==this.edge);a.divideScalar(c);return this};R.prototype.contains=function(a,b){b=void 0===b?.001:b;var c=this.plane,d=this.edge;do{var e=d.from(),f=d.to();if(!1===0<=A.area(e,f,a))return!1;d=d.next}while(d!==this.edge);a=c.distanceToPoint(a);return Math.abs(a)>b?!1:!0};R.prototype.convex=function(){var a=this.edge;do{var b=a.from(),c=a.to(),d=a.next.to();
if(!1===0<=A.area(b,c,d))return!1;a=a.next}while(a!==this.edge);return!0};R.prototype.coplanar=function(a){a=void 0===a?.001:a;var b=this.plane,c=this.edge;do{var d=b.distanceToPoint(c.from());if(Math.abs(d)>a)return!1;c=c.next}while(c!==this.edge);return!0};R.prototype.getContour=function(a){var b=this.edge;a.length=0;do a.push(b.vertex),b=b.next;while(b!==this.edge);return a};R.prototype.getPortalEdgeTo=function(a,b){var c=this.edge;do{if(null!==c.twin&&c.twin.polygon===a)return b.left=c.vertex,
b.right=c.next.vertex,b;c=c.next}while(c!==this.edge);b.left=null;b.right=null;return b};var jc=function(){};jc.prototype.load=function(a,b){return new Promise(function(c,d){fetch(a).then(function(a){if(200<=a.status&&300>a.status)return a.arrayBuffer();var b=Error(a.statusText||a.status);b.response=a;return Promise.reject(b)}).then(function(c){var d=new S,e=new TextDecoder;"glTF"===e.decode(new Uint8Array(c,0,4))?(d.parseBinary(c),c=d.extensions.get("BINARY").content):c=e.decode(new Uint8Array(c));
c=JSON.parse(c);if(void 0===c.asset||2>c.asset.version[0])throw Error("YUKA.NavMeshLoader: Unsupported asset version.");e=a.lastIndexOf("/");e=-1===e?"./":a.substr(0,e+1);return d.parse(c,e,b)}).then(function(a){c(a)}).catch(function(a){x.error("YUKA.NavMeshLoader: Unable to load navigation mesh.",a);d(a)})})};var S=function(){this.path=this.json=null;this.cache=new Map;this.extensions=new Map};S.prototype.parse=function(a,b,c){var d=this;this.json=a;this.path=b;return this.getDependency("mesh",0).then(function(a){a=
d.parseGeometry(a);var b=new I;c&&c.epsilonCoplanarTest&&(b.epsilonCoplanarTest=c.epsilonCoplanarTest);return b.fromPolygons(a)})};S.prototype.parseGeometry=function(a){var b=a.index,c=a.position;a=[];for(var d=[],e=0,g=c.length;e<g;e+=3){var k=new f;k.x=c[e+0];k.y=c[e+1];k.z=c[e+2];a.push(k)}if(b)for(c=0,g=b.length;c<g;c+=3)e=[a[b[c+0]],a[b[c+1]],a[b[c+2]]],e=(new R).fromContour(e),d.push(e);else for(b=0,g=a.length;b<g;b+=3)c=[a[b+0],a[b+1],a[b+2]],c=(new R).fromContour(c),d.push(c);return d};S.prototype.getDependencies=
function(a){var b=this,c=this.cache,d=c.get(a);d||(d=Promise.all((this.json[a+("mesh"===a?"es":"s")]||[]).map(function(c,d){return b.getDependency(a,d)})),c.set(a,d));return d};S.prototype.getDependency=function(a,b){var c=this.cache,d=a+":"+b,e=c.get(d);if(void 0===e){switch(a){case "accessor":e=this.loadAccessor(b);break;case "buffer":e=this.loadBuffer(b);break;case "bufferView":e=this.loadBufferView(b);break;case "mesh":e=this.loadMesh(b);break;default:throw Error("Unknown type: "+a);}c.set(d,
e)}return e};S.prototype.loadBuffer=function(a){var b=this,c=this.json.buffers[a];return void 0===c.uri&&0===a?Promise.resolve(this.extensions.get("BINARY").body):new Promise(function(a,d){var e=k(c.uri,b.path);fetch(e).then(function(a){return a.arrayBuffer()}).then(function(b){a(b)}).catch(function(a){x.error("YUKA.NavMeshLoader: Unable to load buffer.",a);d(a)})})};S.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var c=
b.byteOffset||0;return a.slice(c,c+(b.byteLength||0))})};S.prototype.loadAccessor=function(a){var b=this.json.accessors[a];return this.getDependency("bufferView",b.bufferView).then(function(a){return new Nc[b.componentType](a,b.byteOffset||0,b.count*Oc[b.type])})};S.prototype.loadMesh=function(a){var b=this.json.meshes[a];return this.getDependencies("accessor").then(function(a){var c=b.primitives[0];if(4!==c.mode)throw Error("YUKA.NavMeshLoader: Invalid geometry format. Please ensure to represent your geometry as triangles.");
return{index:a[c.indices],position:a[c.attributes.POSITION],normal:a[c.attributes.NORMAL]}})};S.prototype.parseBinary=function(a){for(var b=new DataView(a,12),c=0,d=new TextDecoder,e=null,f=null;c<b.byteLength;){var g=b.getUint32(c,!0);c+=4;var k=b.getUint32(c,!0);c+=4;k===kc.JSON?(e=new Uint8Array(a,12+c,g),e=d.decode(e)):k===kc.BIN&&(f=12+c,f=a.slice(f,f+g));c+=g}this.extensions.set("BINARY",{content:e,body:f})};var Oc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Nc={5120:Int8Array,5121:Uint8Array,
5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},kc={JSON:1313821514,BIN:5130562},ba=function(a){this.aabb=a=void 0===a?new z:a;this.entries=[]};ba.prototype.add=function(a){this.entries.push(a);return this};ba.prototype.remove=function(a){a=this.entries.indexOf(a);this.entries.splice(a,1);return this};ba.prototype.makeEmpty=function(){this.entries.length=0;return this};ba.prototype.empty=function(){return 0===this.entries.length};ba.prototype.intersects=function(a){return this.aabb.intersectsAABB(a)};
var Oa=new f,Ca=new z,lc=[],X=function(a,b,c,d,e,g){this.cells=[];this.width=a;this.height=b;this.depth=c;this.cellsX=d;this.cellsY=e;this.cellsZ=g;this._halfWidth=a/2;this._halfHeight=b/2;this._halfDepth=c/2;this._min=new f(-this._halfWidth,-this._halfHeight,-this._halfDepth);this._max=new f(this._halfWidth,this._halfHeight,this._halfDepth);a/=d;b/=e;c/=g;for(var h=0;h<d;h++)for(var n=h*a-this._halfWidth,l=0;l<e;l++)for(var k=l*b-this._halfHeight,m=0;m<g;m++){var p=m*c-this._halfDepth,q=new f,t=
new f;q.set(n,k,p);t.x=q.x+a;t.y=q.y+b;t.z=q.z+c;p=new z(q,t);p=new ba(p);this.cells.push(p)}};X.prototype.updateEntity=function(a,b){b=void 0===b?-1:b;var c=this.getIndexForPosition(a.position);b!==c&&(this.addEntityToPartition(a,c),-1!==b&&this.removeEntityFromPartition(a,b));return c};X.prototype.addEntityToPartition=function(a,b){this.cells[b].add(a);return this};X.prototype.removeEntityFromPartition=function(a,b){this.cells[b].remove(a);return this};X.prototype.getIndexForPosition=function(a){Oa.copy(a).clamp(this._min,
this._max);a=Math.abs(Math.floor(this.cellsX*(Oa.x+this._halfWidth)/this.width));var b=Math.abs(Math.floor(this.cellsY*(Oa.y+this._halfHeight)/this.height)),c=Math.abs(Math.floor(this.cellsZ*(Oa.z+this._halfDepth)/this.depth));a===this.cellsX&&(a=this.cellsX-1);b===this.cellsY&&(b=this.cellsY-1);c===this.cellsZ&&(c=this.cellsZ-1);return a*this.cellsY*this.cellsZ+b*this.cellsZ+c};X.prototype.query=function(a,b,c){var d=this.cells;c.length=0;Ca.min.copy(a).subScalar(b);Ca.max.copy(a).addScalar(b);a=
0;for(b=d.length;a<b;a++){var e=d[a];!1===e.empty()&&!0===e.intersects(Ca)&&c.push.apply(c,$jscomp.arrayFromIterable(e.entries))}return c};X.prototype.makeEmpty=function(){for(var a=this.cells,b=0,c=a.length;b<c;b++)a[b].makeEmpty();return this};X.prototype.addPolygon=function(a){var b=this.cells;a.getContour(lc);Ca.fromPoints(lc);for(var c=0,d=b.length;c<d;c++){var e=b[c];!0===e.intersects(Ca)&&e.add(a)}return this};var mc=function(a){this.entity=void 0===a?null:a;this.timeLastSensed=-1;this.lastSensedPosition=
new f;this.visible=!1},ca=function(a){this.owner=void 0===a?null:a;this.records=[];this.recordsMap=new Map;this.memorySpan=1};ca.prototype.getRecord=function(a){return this.recordsMap.get(a)};ca.prototype.createRecord=function(a){var b=new mc(a);this.records.push(b);this.recordsMap.set(a,b);return this};ca.prototype.deleteRecord=function(a){var b=this.getRecord(a);b=this.records.indexOf(b);this.records.splice(b,1);this.recordsMap.delete(a);return this};ca.prototype.hasRecord=function(a){return this.recordsMap.has(a)};
ca.prototype.clear=function(){this.records.length=0;this.recordsMap.clear();return this};ca.prototype.getValidMemoryRecords=function(a,b){for(var c=this.records,d=b.length=0,e=c.length;d<e;d++){var f=c[d];a-f.timeLastSensed<=this.memorySpan&&b.push(f)}return b};var nc=new E,G={a:new f,b:new f,c:new f},oc=new f,Pa=new H,Qa=new Q,pc=new w,yb=function(a){a=void 0===a?new hb:a;var b=B.call(this)||this;b.geometry=a;return b};$jscomp.inherits(yb,B);yb.prototype.intersectRay=function(a,b,c){c=void 0===c?
null:c;var d=this.geometry;nc.copy(d.boundingSphere).applyMatrix4(this.worldMatrix);if(null!==a.intersectBoundingSphere(nc,oc)&&(this.worldMatrix.getInverse(pc),Pa.copy(a).applyMatrix4(pc),null!==Pa.intersectAABB(d.aabb,oc))){a=d.vertices;var e=d.indices;if(null===e){e=0;for(var f=a.length;e<f;e+=9)if(G.a.set(a[e],a[e+1],a[e+2]),G.b.set(a[e+3],a[e+4],a[e+5]),G.c.set(a[e+6],a[e+7],a[e+8]),null!==Pa.intersectTriangle(G,d.backfaceCulling,b))return b.applyMatrix4(this.worldMatrix),null!==c&&(Qa.fromCoplanarPoints(G.a,
G.b,G.c),c.copy(Qa.normal),c.transformDirection(this.worldMatrix)),b}else{var g=0;for(f=e.length;g<f;g+=3){var k=e[g],m=e[g+1],p=e[g+2];G.a.set(a[3*k],a[3*k+1],a[3*k+2]);G.b.set(a[3*m],a[3*m+1],a[3*m+2]);G.c.set(a[3*p],a[3*p+1],a[3*p+2]);if(null!==Pa.intersectTriangle(G,d.backfaceCulling,b))return b.applyMatrix4(this.worldMatrix),null!==c&&(Qa.fromCoplanarPoints(G.a,G.b,G.c),c.copy(Qa.normal),c.transformDirection(this.worldMatrix)),b}}}return null};var Ra=new f,qc=new f,zb=new H,rc=new f,Sa=function(a){this.owner=
void 0===a?null:a;this.fieldOfView=Math.PI;this.range=Infinity;this.obstacles=[]};Sa.prototype.addObstacle=function(a){this.obstacles.push(a);return this};Sa.prototype.removeObstacle=function(a){a=this.obstacles.indexOf(a);this.obstacles.splice(a,1);return this};Sa.prototype.visible=function(a){var b=this.owner,c=this.obstacles;Ra.subVectors(a,b.position);a=Ra.length();if(a>this.range)return!1;b.getDirection(qc);if(qc.angleTo(Ra)>.5*this.fieldOfView)return!1;zb.origin.copy(b.position);zb.direction.copy(Ra).divideScalar(a||
1);for(var d=0,e=c.length;d<e;d++)if(null!==c[d].intersectRay(zb,rc)&&rc.squaredDistanceTo(b.position)<=a*a)return!1;return!0};var da=function(){this.loop=!1;this._waypoints=[];this._index=0};da.prototype.add=function(a){this._waypoints.push(a);return this};da.prototype.clear=function(){this._index=this._waypoints.length=0;return this};da.prototype.current=function(){return this._waypoints[this._index]};da.prototype.finished=function(){var a=this._waypoints.length-1;return!0===this.loop?!1:this._index===
a};da.prototype.advance=function(){this._index++;this._index===this._waypoints.length&&(!0===this.loop?this._index=0:this._index--);return this};var sc=function(a){this.count=void 0===a?10:a;this._history=[];for(a=this._slot=0;a<this.count;a++)this._history[a]=new f};sc.prototype.calculate=function(a,b){b.set(0,0,0);this._slot===this.count&&(this._slot=0);this._history[this._slot].copy(a);this._slot++;for(a=0;a<this.count;a++)b.add(this._history[a]);b.divideScalar(this.count);return b};var t=function(){this.active=
!0;this.weight=1};t.prototype.calculate=function(){};var Ta=new f,ea=function(a){this.vehicle=a;this.behaviors=[];this._steeringForce=new f};ea.prototype.add=function(a){this.behaviors.push(a);return this};ea.prototype.remove=function(a){a=this.behaviors.indexOf(a);this.behaviors.splice(a,1);return this};ea.prototype.calculate=function(a,b){this._calculateByOrder(a);return b.copy(this._steeringForce)};ea.prototype._accumulate=function(a){var b=this._steeringForce.length();b=this.vehicle.maxForce-
b;if(0>=b)return!1;a.length()>b&&a.normalize().multiplyScalar(b);this._steeringForce.add(a);return!0};ea.prototype._calculateByOrder=function(a){var b=this.behaviors;this._steeringForce.set(0,0,0);for(var c=0,d=b.length;c<d;c++){var e=b[c];if(!0===e.active&&(Ta.set(0,0,0),e.calculate(this.vehicle,Ta,a),Ta.multiplyScalar(e.weight),!1===this._accumulate(Ta)))break}};var tc=new f,Ua=new f,uc=new f,Da=new f,vc=new f,Ab=function(){var a=Z.call(this)||this;a.mass=1;a.maxForce=100;a.steering=new ea(a);a.smoother=
null;return a};$jscomp.inherits(Ab,Z);Ab.prototype.update=function(a){this.steering.calculate(a,tc);uc.copy(tc).divideScalar(this.mass);this.velocity.add(uc.multiplyScalar(a));this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));Ua.copy(this.velocity).multiplyScalar(a);Da.copy(this.position).add(Ua);!0===this.updateOrientation&&null===this.smoother&&1e-8<this.getSpeedSquared()&&this.lookAt(Da);this.position.copy(Da);!0===this.updateOrientation&&
null!==this.smoother&&(this.smoother.calculate(this.velocity,vc),Ua.copy(vc).multiplyScalar(a),Da.copy(this.position).add(Ua),this.lookAt(Da));return this};var Va=new f,Wa=new f,Bb=function(){return t.call(this)||this};$jscomp.inherits(Bb,t);Bb.prototype.calculate=function(a,b){Va.set(0,0,0);for(var c=a.neighbors,d=0,e=c.length;d<e;d++)c[d].getDirection(Wa),Va.add(Wa);0<c.length&&(Va.divideScalar(c.length),a.getDirection(Wa),b.subVectors(Va,Wa));return b};var wc=new f,Cb=new f,oa=function(a,b){a=
void 0===a?new f:a;b=void 0===b?3:b;var c=t.call(this)||this;c.target=a;c.deceleration=b;return c};$jscomp.inherits(oa,t);oa.prototype.calculate=function(a,b){var c=this.deceleration;Cb.subVectors(this.target,a.position);var d=Cb.length();0<d&&(c=Math.min(d/c,a.maxSpeed),wc.copy(Cb).multiplyScalar(c/d),b.subVectors(wc,a.velocity));return b};var Db=new f,pa=function(a){a=void 0===a?new f:a;var b=t.call(this)||this;b.target=a;return b};$jscomp.inherits(pa,t);pa.prototype.calculate=function(a,b){Db.subVectors(this.target,
a.position).normalize();Db.multiplyScalar(a.maxSpeed);return b.subVectors(Db,a.velocity)};var Xa=new f,Eb=function(){var a=t.call(this)||this;a._seek=new pa;return a};$jscomp.inherits(Eb,t);Eb.prototype.calculate=function(a,b){Xa.set(0,0,0);for(var c=a.neighbors,d=0,e=c.length;d<e;d++)Xa.add(c[d].position);0<c.length&&(Xa.divideScalar(c.length),this._seek.target=Xa,this._seek.calculate(a,b),b.normalize());return b};var Ea=new f,Ya=function(a,b){a=void 0===a?new f:a;b=void 0===b?10:b;var c=t.call(this)||
this;c.target=a;c.panicDistance=b;return c};$jscomp.inherits(Ya,t);Ya.prototype.calculate=function(a,b){var c=this.target;a.position.squaredDistanceTo(c)<=this.panicDistance*this.panicDistance&&(Ea.subVectors(a.position,c).normalize(),0===Ea.squaredLength()&&Ea.set(0,0,1),Ea.multiplyScalar(a.maxSpeed),b.subVectors(Ea,a.velocity));return b};var xc=new f,yc=new f,zc=new f,Fb=function(a,b,c){a=void 0===a?null:a;b=void 0===b?10:b;c=void 0===c?1:c;var d=t.call(this)||this;d.pursuer=a;d.panicDistance=b;
d.predictionFactor=c;d._flee=new Ya;return d};$jscomp.inherits(Fb,t);Fb.prototype.calculate=function(a,b){var c=this.pursuer;xc.subVectors(c.position,a.position);var d=xc.length()/(a.maxSpeed+c.getSpeed());d*=this.predictionFactor;yc.copy(c.velocity).multiplyScalar(d);zc.addVectors(c.position,yc);this._flee.target=zc;this._flee.panicDistance=this.panicDistance;this._flee.calculate(a,b);return b};var Gb=function(a,b){a=void 0===a?new da:a;b=void 0===b?1:b;var c=t.call(this)||this;c.path=a;c.nextWaypointDistance=
b;c._arrive=new oa;c._seek=new pa;return c};$jscomp.inherits(Gb,t);Gb.prototype.calculate=function(a,b){var c=this.path;c.current().squaredDistanceTo(a.position)<this.nextWaypointDistance*this.nextWaypointDistance&&c.advance();var d=c.current();!0===c.finished()?(this._arrive.target=d,this._arrive.calculate(a,b)):(this._seek.target=d,this._seek.calculate(a,b));return b};var Za=new f,$a=new f,Ac=new f,Bc=new f,Hb=function(a,b,c){a=void 0===a?null:a;b=void 0===b?null:b;c=void 0===c?3:c;var d=t.call(this)||
this;d.entity1=a;d.entity2=b;d.deceleration=c;d._arrive=new oa;return d};$jscomp.inherits(Hb,t);Hb.prototype.calculate=function(a,b){var c=this.entity1,d=this.entity2;Za.addVectors(c.position,d.position).multiplyScalar(.5);var e=a.position.distanceTo(Za)/a.maxSpeed;$a.copy(c.velocity).multiplyScalar(e);Ac.addVectors(c.position,$a);$a.copy(d.velocity).multiplyScalar(e);Bc.addVectors(d.position,$a);Za.addVectors(Ac,Bc).multiplyScalar(.5);this._arrive.deceleration=this.deceleration;this._arrive.target=
Za;this._arrive.calculate(a,b);return b};var Cc=new w,qa=new f,ab=new f,Ib=new f,Jb=new E,Pc=new H(new f(0,0,0),new f(0,0,1)),Kb=function(a){a=void 0===a?[]:a;var b=t.call(this)||this;b.obstacles=a;b.brakingWeight=.2;b.dBoxMinLength=4;return b};$jscomp.inherits(Kb,t);Kb.prototype.calculate=function(a,b){var c=this.obstacles,d=null,e=Infinity,f=this.dBoxMinLength+a.getSpeed()/a.maxSpeed*this.dBoxMinLength;a.matrix.getInverse(Cc);for(var g=0,k=c.length;g<k;g++){var m=c[g];if(m!==a&&(qa.copy(m.position).applyMatrix4(Cc),
0<qa.z&&Math.abs(qa.z)<f)){var p=m.boundingRadius+a.boundingRadius;Math.abs(qa.x)<p&&(Jb.center.copy(qa),Jb.radius=p,Pc.intersectBoundingSphere(Jb,Ib),Ib.z<e&&(e=Ib.z,d=m,ab.copy(qa)))}}null!==d&&(b.x=(d.boundingRadius-ab.x)*(1+(f-ab.z)/f),b.z=(d.boundingRadius-ab.z)*this.brakingWeight,b.applyRotation(a.rotation));return b};var Lb=new f,Dc=new f,Ec=new f,Fc=new f,Mb=function(a,b){a=void 0===a?null:a;b=void 0===b?new f:b;var c=t.call(this)||this;c.leader=a;c.offset=b;c._arrive=new oa;c._arrive.deceleration=
1.5;return c};$jscomp.inherits(Mb,t);Mb.prototype.calculate=function(a,b){var c=this.leader;Lb.copy(this.offset).applyMatrix4(c.matrix);Dc.subVectors(Lb,a.position);var d=Dc.length()/(a.maxSpeed+c.getSpeed());Ec.copy(c.velocity).multiplyScalar(d);Fc.addVectors(Lb,Ec);this._arrive.target=Fc;this._arrive.calculate(a,b);return b};var Nb=new f,Ob=new f,Gc=new f,Hc=new f,Ic=new f,Pb=function(a,b){a=void 0===a?null:a;b=void 0===b?1:b;var c=t.call(this)||this;c.evader=a;c.predictionFactor=b;c._seek=new pa;
return c};$jscomp.inherits(Pb,t);Pb.prototype.calculate=function(a,b){var c=this.evader;Nb.subVectors(c.position,a.position);a.getDirection(Ob);c.getDirection(Gc);var d=0<Nb.dot(Ob),e=-.95>Ob.dot(Gc);if(!0===d&&!0===e)return this._seek.target=c.position,this._seek.calculate(a,b),b;d=Nb.length()/(a.maxSpeed+c.getSpeed());d*=this.predictionFactor;Hc.copy(c.velocity).multiplyScalar(d);Ic.addVectors(c.position,Hc);this._seek.target=Ic;this._seek.calculate(a,b);return b};var bb=new f,Qb=function(){return t.call(this)||
this};$jscomp.inherits(Qb,t);Qb.prototype.calculate=function(a,b){for(var c=a.neighbors,d=0,e=c.length;d<e;d++){bb.subVectors(a.position,c[d].position);var f=bb.length();0===f&&(f=.0001);bb.normalize().divideScalar(f);b.add(bb)}return b};var Fa=new f,Rb=new f,Sb=function(a,b,c){a=void 0===a?1:a;b=void 0===b?5:b;c=void 0===c?5:c;var d=t.call(this)||this;d.radius=a;d.distance=b;d.jitter=c;d._targetLocal=new f;a=d.radius;b=d._targetLocal;c=Math.random()*Math.PI*2;b.x=a*Math.cos(c);b.z=a*Math.sin(c);
return d};$jscomp.inherits(Sb,t);Sb.prototype.calculate=function(a,b,c){c*=this.jitter;Rb.x=A.randFloat(-1,1)*c;Rb.z=A.randFloat(-1,1)*c;this._targetLocal.add(Rb);this._targetLocal.normalize();this._targetLocal.multiplyScalar(this.radius);Fa.copy(this._targetLocal);Fa.z+=this.distance;Fa.applyMatrix4(a.worldMatrix);b.subVectors(Fa,a.position);return b};var Jc=function(){};Jc.prototype.execute=function(){};var Tb=function(){this.tasks=[];this.options={timeout:1E3};this._active=!1;this._handler=fa.bind(this);
this._taskHandle=0};Tb.prototype.enqueue=function(a){this.tasks.push(a);return this};Tb.prototype.update=function(){0<this.tasks.length?!1===this._active&&(this._taskHandle=requestIdleCallback(this._handler,this.options),this._active=!0):this._active=!1;return this};var Ga=function(){};Ga.prototype.touching=function(){return!1};var Kc=new E,Ha=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this._aabb=new z(a,b);return this};$jscomp.inherits(Ha,Ga);Ha.prototype.fromPositionAndSize=function(a,
b){this._aabb.fromCenterAndSize(a,b);return this};Ha.prototype.touching=function(a){Kc.set(a.position,a.boundingRadius);return this._aabb.intersectsBoundingSphere(Kc)};$jscomp.global.Object.defineProperties(Ha.prototype,{min:{configurable:!0,enumerable:!0,get:function(){return this._aabb.min},set:function(a){this._aabb.min=a}},max:{configurable:!0,enumerable:!0,get:function(){return this._aabb.max},set:function(a){this._aabb.max=a}}});var Lc=new E,cb=function(a,b){a=void 0===a?new f:a;this._boundingSphere=
new E(a,void 0===b?0:b);return this};$jscomp.inherits(cb,Ga);cb.prototype.touching=function(a){Lc.set(a.position,a.boundingRadius);return this._boundingSphere.intersectsBoundingSphere(Lc)};$jscomp.global.Object.defineProperties(cb.prototype,{position:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.center},set:function(a){this._boundingSphere.center=a}},radius:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.radius},set:function(a){this._boundingSphere.radius=
a}}});var db=function(a){a=void 0===a?new Ga:a;this.active=!0;this.region=a};db.prototype.check=function(a){!0===this.active&&!0===this.region.touching(a)&&this.execute(a);return this};db.prototype.execute=function(){};db.prototype.update=function(){};d.EntityManager=J;d.EventDispatcher=sa;d.GameEntity=B;d.Logger=x;d.MeshGeometry=hb;d.MessageDispatcher=ha;d.MovingEntity=Z;d.Regulator=bc;d.Time=ia;d.Telegram=p;d.State=ja;d.StateMachine=O;d.FuzzyAND=jb;d.FuzzyFAIRLY=va;d.FuzzyOR=kb;d.FuzzyVERY=wa;d.LeftShoulderFuzzySet=
lb;d.RightShoulderFuzzySet=mb;d.SingletonFuzzySet=nb;d.TriangularFuzzySet=ob;d.FuzzyCompositeTerm=K;d.FuzzyModule=L;d.FuzzyRule=pb;d.FuzzySet=F;d.FuzzyTerm=ka;d.FuzzyVariable=la;d.CompositeGoal=M;d.Goal=u;d.GoalEvaluator=qb;d.Think=U;d.Edge=aa;d.Graph=D;d.Node=rb;d.PriorityQueue=V;d.AStar=ma;d.BFS=xa;d.DFS=ya;d.Dijkstra=za;d.AABB=z;d.BoundingSphere=E;d.LineSegment=P;d.MathUtils=A;d.Matrix3=y;d.Matrix4=w;d.Plane=Q;d.Quaternion=v;d.Ray=H;d.Vector3=f;d.NavEdge=La;d.NavNode=Ma;d.GraphUtils=hc;d.Corridor=
Na;d.HalfEdge=na;d.NavMesh=I;d.NavMeshLoader=jc;d.Polygon=R;d.Cell=ba;d.CellSpacePartitioning=X;d.MemoryRecord=mc;d.MemorySystem=ca;d.Obstacle=yb;d.Vision=Sa;d.Path=da;d.Smoother=sc;d.SteeringBehavior=t;d.SteeringManager=ea;d.Vehicle=Ab;d.AlignmentBehavior=Bb;d.ArriveBehavior=oa;d.CohesionBehavior=Eb;d.EvadeBehavior=Fb;d.FleeBehavior=Ya;d.FollowPathBehavior=Gb;d.InterposeBehavior=Hb;d.ObstacleAvoidanceBehavior=Kb;d.OffsetPursuitBehavior=Mb;d.PursuitBehavior=Pb;d.SeekBehavior=pa;d.SeparationBehavior=
Qb;d.WanderBehavior=Sb;d.Task=Jc;d.TaskQueue=Tb;d.RectangularTriggerRegion=Ha;d.SphericalTriggerRegion=cb;d.TriggerRegion=Ga;d.Trigger=db;d.HeuristicPolicyEuclid=sb;d.HeuristicPolicyEuclidSquared=cc;d.HeuristicPolicyManhattan=dc;d.HeuristicPolicyDijkstra=ec;d.WorldUp=eb;Object.defineProperty(d,"__esModule",{value:!0})});
