var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,n,p){d!=Array.prototype&&d!=Object.prototype&&(d[n]=p.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var d=0;return function(n){return $jscomp.SYMBOL_PREFIX+(n||"")+d++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(d){var n=0;return $jscomp.iteratorPrototype(function(){return n<d.length?{done:!1,value:d[n++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.makeIterator=function(d){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var n=d[Symbol.iterator];return n?n.call(d):$jscomp.arrayIterator(d)};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(d){var n=function(){};n.prototype=d;return new n};
$jscomp.underscoreProtoCanBeSet=function(){var d={a:!0},n={};try{return n.__proto__=d,n.a}catch(p){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(d,n){d.__proto__=n;if(d.__proto__!==n)throw new TypeError(d+" is not extensible");return d}:null;
$jscomp.inherits=function(d,n){d.prototype=$jscomp.objectCreate(n.prototype);d.prototype.constructor=d;if($jscomp.setPrototypeOf){var p=$jscomp.setPrototypeOf;p(d,n)}else for(p in n)if("prototype"!=p)if(Object.defineProperties){var m=Object.getOwnPropertyDescriptor(n,p);m&&Object.defineProperty(d,p,m)}else d[p]=n[p];d.superClass_=n.prototype};$jscomp.arrayFromIterator=function(d){for(var n,p=[];!(n=d.next()).done;)p.push(n.value);return p};
$jscomp.arrayFromIterable=function(d){return d instanceof Array?d:$jscomp.arrayFromIterator($jscomp.makeIterator(d))};$jscomp.checkEs6ConformanceViaProxy=function(){try{var d={},n=Object.create(new $jscomp.global.Proxy(d,{get:function(p,m,g){return p==d&&"q"==m&&g==n}}));return!0===n.q}catch(p){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.owns=function(d,n){return Object.prototype.hasOwnProperty.call(d,n)};$jscomp.polyfill=function(d,n,p,m){if(n){p=$jscomp.global;d=d.split(".");for(m=0;m<d.length-1;m++){var g=d[m];g in p||(p[g]={});p=p[g]}d=d[d.length-1];m=p[d];n=n(m);n!=m&&null!=n&&$jscomp.defineProperty(p,d,{configurable:!0,writable:!0,value:n})}};
$jscomp.polyfill("WeakMap",function(d){function n(){if(!d||!Object.seal)return!1;try{var x=Object.seal({}),f=Object.seal({}),l=new d([[x,2],[f,3]]);if(2!=l.get(x)||3!=l.get(f))return!1;l.delete(x);l.set(f,4);return!l.has(x)&&4==l.get(f)}catch(Y){return!1}}function p(d){$jscomp.owns(d,g)||$jscomp.defineProperty(d,g,{value:{}})}function m(d){var f=Object[d];f&&(Object[d]=function(d){p(d);return f(d)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(n())return d;
var g="$jscomp_hidden_"+Math.random();m("freeze");m("preventExtensions");m("seal");var J=0,l=function(d){this.id_=(J+=Math.random()+1).toString();if(d){$jscomp.initSymbol();$jscomp.initSymbolIterator();d=$jscomp.makeIterator(d);for(var f;!(f=d.next()).done;)f=f.value,this.set(f[0],f[1])}};l.prototype.set=function(d,f){p(d);if(!$jscomp.owns(d,g))throw Error("WeakMap key fail: "+d);d[g][this.id_]=f;return this};l.prototype.get=function(d){return $jscomp.owns(d,g)?d[g][this.id_]:void 0};l.prototype.has=
function(d){return $jscomp.owns(d,g)&&$jscomp.owns(d[g],this.id_)};l.prototype.delete=function(d){return $jscomp.owns(d,g)&&$jscomp.owns(d[g],this.id_)?delete d[g][this.id_]:!1};return l},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(d){function n(){if($jscomp.ASSUME_NO_NATIVE_MAP||!d||"function"!=typeof d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var f=Object.seal({x:4}),l=new d($jscomp.makeIterator([[f,"s"]]));if("s"!=l.get(f)||1!=l.size||l.get({x:4})||l.set({x:4},"t")!=l||2!=l.size)return!1;var g=l.entries(),m=g.next();if(m.done||m.value[0]!=f||"s"!=m.value[1])return!1;m=g.next();return m.done||4!=m.value[0].x||"t"!=m.value[1]||!g.next().done?!1:!0}catch(ea){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(n())return d;$jscomp.initSymbol();$jscomp.initSymbolIterator();var p=new WeakMap,m=function(d){this.data_={};this.head_=l();this.size=0;if(d){d=$jscomp.makeIterator(d);for(var f;!(f=d.next()).done;)f=f.value,this.set(f[0],f[1])}};m.prototype.set=function(d,l){d=0===d?0:d;var f=g(this,d);f.list||(f.list=this.data_[f.id]=[]);f.entry?f.entry.value=l:(f.entry={next:this.head_,previous:this.head_.previous,head:this.head_,
key:d,value:l},f.list.push(f.entry),this.head_.previous.next=f.entry,this.head_.previous=f.entry,this.size++);return this};m.prototype.delete=function(d){d=g(this,d);return d.entry&&d.list?(d.list.splice(d.index,1),d.list.length||delete this.data_[d.id],d.entry.previous.next=d.entry.next,d.entry.next.previous=d.entry.previous,d.entry.head=null,this.size--,!0):!1};m.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=l();this.size=0};m.prototype.has=function(d){return!!g(this,d).entry};
m.prototype.get=function(d){return(d=g(this,d).entry)&&d.value};m.prototype.entries=function(){return J(this,function(d){return[d.key,d.value]})};m.prototype.keys=function(){return J(this,function(d){return d.key})};m.prototype.values=function(){return J(this,function(d){return d.value})};m.prototype.forEach=function(d,l){for(var f=this.entries(),m;!(m=f.next()).done;)m=m.value,d.call(l,m[1],m[0],this)};m.prototype[Symbol.iterator]=m.prototype.entries;var g=function(d,l){var f=l&&typeof l;"object"==
f||"function"==f?p.has(l)?f=p.get(l):(f=""+ ++x,p.set(l,f)):f="p_"+l;var m=d.data_[f];if(m&&$jscomp.owns(d.data_,f))for(d=0;d<m.length;d++){var g=m[d];if(l!==l&&g.key!==g.key||l===g.key)return{id:f,list:m,index:d,entry:g}}return{id:f,list:m,index:-1,entry:void 0}},J=function(d,l){var f=d.head_;return $jscomp.iteratorPrototype(function(){if(f){for(;f.head!=d.head_;)f=f.previous;for(;f.next!=f.head;)return f=f.next,{done:!1,value:l(f)};f=null}return{done:!0,value:void 0}})},l=function(){var d={};return d.previous=
d.next=d.head=d},x=0;return m},"es6","es3");
$jscomp.polyfill("Set",function(d){function n(){if($jscomp.ASSUME_NO_NATIVE_SET||!d||"function"!=typeof d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var m=Object.seal({x:4}),g=new d($jscomp.makeIterator([m]));if(!g.has(m)||1!=g.size||g.add(m)!=g||1!=g.size||g.add({x:4})!=g||2!=g.size)return!1;var n=g.entries(),l=n.next();if(l.done||l.value[0]!=m||l.value[1]!=m)return!1;l=n.next();return l.done||l.value[0]==m||4!=l.value[0].x||l.value[1]!=l.value[0]?!1:n.next().done}catch(x){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(n())return d;$jscomp.initSymbol();$jscomp.initSymbolIterator();var p=function(d){this.map_=new Map;if(d){d=$jscomp.makeIterator(d);for(var m;!(m=d.next()).done;)this.add(m.value)}this.size=this.map_.size};p.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};p.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};p.prototype.clear=
function(){this.map_.clear();this.size=0};p.prototype.has=function(d){return this.map_.has(d)};p.prototype.entries=function(){return this.map_.entries()};p.prototype.values=function(){return this.map_.values()};p.prototype.keys=p.prototype.values;p.prototype[Symbol.iterator]=p.prototype.values;p.prototype.forEach=function(d,g){var m=this;this.map_.forEach(function(l){return d.call(g,l,l,m)})};return p},"es6","es3");$jscomp.polyfill("Number.EPSILON",function(d){return Math.pow(2,-52)},"es6","es3");
$jscomp.iteratorFromArray=function(d,n){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var p=0,m={next:function(){if(p<d.length){var g=p++;return{value:n(g,d[g]),done:!1}}m.next=function(){return{done:!0,value:void 0}};return m.next()}};m[Symbol.iterator]=function(){return m};return m};$jscomp.polyfill("Array.prototype.values",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,p){return p})}},"es8","es3");
$jscomp.polyfill("Array.prototype.entries",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,p){return[d,p]})}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(d){function n(){this.batch_=null}function p(d){return d instanceof g?d:new g(function(l,f){l(d)})}if(d&&!$jscomp.FORCE_POLYFILL_PROMISE)return d;n.prototype.asyncExecute=function(d){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(d);return this};n.prototype.asyncExecuteBatch_=function(){var d=this;this.asyncExecuteFunction(function(){d.executeBatch_()})};var m=$jscomp.global.setTimeout;n.prototype.asyncExecuteFunction=function(d){m(d,
0)};n.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var d=this.batch_;this.batch_=[];for(var g=0;g<d.length;++g){var f=d[g];d[g]=null;try{f()}catch(I){this.asyncThrow_(I)}}}this.batch_=null};n.prototype.asyncThrow_=function(d){this.asyncExecuteFunction(function(){throw d;})};var g=function(d){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var l=this.createResolveAndReject_();try{d(l.resolve,l.reject)}catch(f){l.reject(f)}};g.prototype.createResolveAndReject_=
function(){function d(d){return function(l){f||(f=!0,d.call(g,l))}}var g=this,f=!1;return{resolve:d(this.resolveTo_),reject:d(this.reject_)}};g.prototype.resolveTo_=function(d){if(d===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(d instanceof g)this.settleSameAsPromise_(d);else{a:switch(typeof d){case "object":var l=null!=d;break a;case "function":l=!0;break a;default:l=!1}l?this.resolveToNonPromiseObj_(d):this.fulfill_(d)}};g.prototype.resolveToNonPromiseObj_=function(d){var l=
void 0;try{l=d.then}catch(f){this.reject_(f);return}"function"==typeof l?this.settleSameAsThenable_(l,d):this.fulfill_(d)};g.prototype.reject_=function(d){this.settle_(2,d)};g.prototype.fulfill_=function(d){this.settle_(1,d)};g.prototype.settle_=function(d,g){if(0!=this.state_)throw Error("Cannot settle("+d+", "+g+"): Promise already settled in state"+this.state_);this.state_=d;this.result_=g;this.executeOnSettledCallbacks_()};g.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var d=
0;d<this.onSettledCallbacks_.length;++d)J.asyncExecute(this.onSettledCallbacks_[d]);this.onSettledCallbacks_=null}};var J=new n;g.prototype.settleSameAsPromise_=function(d){var l=this.createResolveAndReject_();d.callWhenSettled_(l.resolve,l.reject)};g.prototype.settleSameAsThenable_=function(d,g){var f=this.createResolveAndReject_();try{d.call(g,f.resolve,f.reject)}catch(I){f.reject(I)}};g.prototype.then=function(d,m){function f(d,f){return"function"==typeof d?function(e){try{l(d(e))}catch(ma){n(ma)}}:
f}var l,n,p=new g(function(d,f){l=d;n=f});this.callWhenSettled_(f(d,l),f(m,n));return p};g.prototype.catch=function(d){return this.then(void 0,d)};g.prototype.callWhenSettled_=function(d,g){function f(){switch(l.state_){case 1:d(l.result_);break;case 2:g(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?J.asyncExecute(f):this.onSettledCallbacks_.push(f)};g.resolve=p;g.reject=function(d){return new g(function(l,f){f(d)})};g.race=function(d){return new g(function(g,
f){for(var l=$jscomp.makeIterator(d),m=l.next();!m.done;m=l.next())p(m.value).callWhenSettled_(g,f)})};g.all=function(d){var l=$jscomp.makeIterator(d),f=l.next();return f.done?p([]):new g(function(d,g){function m(e){return function(f){n[e]=f;x--;0==x&&d(n)}}var n=[],x=0;do n.push(void 0),x++,p(f.value).callWhenSettled_(m(n.length-1),g),f=l.next();while(!f.done)})};return g},"es6","es3");
(function(d,n){"object"===typeof exports&&"undefined"!==typeof module?n(exports):"function"===typeof define&&define.amd?define(["exports"],n):n(d.YUKA={})})(this,function(d){function n(a,b){return a<b?-1:a>b?1:0}function p(a,b){return a.cost<b.cost?-1:a.cost>b.cost?1:0}function m(a,b){return a.cost<b.cost?-1:a.cost>b.cost?1:0}function g(a,b){return a.cost<b.cost?1:a.cost>b.cost?-1:0}function J(a,b){return"string"!==typeof a||""===a?"":/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?
a:b+a}var l=function(a,b,c,k,d){this.sender=a;this.receiver=b;this.message=c;this.delay=k;this.data=d},x=function(){};x.setLevel=function(a){f=a};x.log=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];f<=x.LEVEL.LOG&&console.log.apply(console,$jscomp.arrayFromIterable(b))};x.warn=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];f<=x.LEVEL.WARN&&console.warn.apply(console,$jscomp.arrayFromIterable(b))};x.error=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-
0]=arguments[c];f<=x.LEVEL.ERROR&&console.error.apply(console,$jscomp.arrayFromIterable(b))};x.LEVEL=Object.freeze({LOG:0,WARN:1,ERROR:2,SILENT:3});var f=x.LEVEL.WARN,I=function(){this.delayedTelegrams=[]};I.prototype.deliver=function(a){var b=a.receiver;!1===b.handleMessage(a)&&x.warn("YUKA.MessageDispatcher: Message not handled by receiver: %o",b);return this};I.prototype.dispatch=function(a,b,c,k,d){a=new l(a,b,c,k,d);0>=k?this.deliver(a):this.delayedTelegrams.push(a);return this};I.prototype.dispatchDelayedMessages=
function(a){for(var b=this.delayedTelegrams.length;b--;){var c=this.delayedTelegrams[b];c.delay-=a;0>=c.delay&&(this.deliver(c),this.delayedTelegrams.pop())}return this};I.prototype.clear=function(){this.delayedTelegrams.length=0;return this};var Y=[],F=function(){this.entities=[];this.triggers=[];this.spatialIndex=null;this._entityMap=new Map;this._indexMap=new Map;this._started=new Set;this._messageDispatcher=new I};F.prototype.add=function(a){this.entities.push(a);this._entityMap.set(a.id,a);a.manager=
this;return this};F.prototype.remove=function(a){var b=this.entities.indexOf(a);this.entities.splice(b,1);this._entityMap.delete(a.id);this._started.delete(a);a.manager=null;return this};F.prototype.addTrigger=function(a){this.triggers.push(a);return this};F.prototype.removeTrigger=function(a){a=this.triggers.indexOf(a);this.triggers.splice(a,1);return this};F.prototype.clear=function(){this.entities.length=0;this.triggers.length=0;this._entityMap.clear();this._started.clear();this._messageDispatcher.clear();
return this};F.prototype.getEntityById=function(a){return this._entityMap.get(a)||null};F.prototype.getEntityByName=function(a){for(var b=this.entities,c=0,k=b.length;c<k;c++){var d=b[c];if(d.name===a)return d}return null};F.prototype.update=function(a){for(var b=this.entities,c=this.triggers,k=0,d=b.length;k<d;k++)this.updateEntity(b[k],a);b=0;for(d=c.length;b<d;b++)this.updateTrigger(c[b],a);this._messageDispatcher.dispatchDelayedMessages(a);return this};F.prototype.updateEntity=function(a,b){if(!0===
a.active){this.updateNeighborhood(a);!1===this._started.has(a)&&(a.start(),this._started.add(a));a.update(b);a.updateWorldMatrix();for(var c=a.children,k=0,d=c.length;k<d;k++)this.updateEntity(c[k],b);null!==this.spatialIndex&&(b=this._indexMap.get(a)||-1,b=this.spatialIndex.updateEntity(a,b),this._indexMap.set(a,b));b=a._renderComponent;c=a._renderComponentCallback;null!==b&&null!==c&&c(a,b)}return this};F.prototype.updateNeighborhood=function(a){if(!0===a.updateNeighborhood){a.neighbors.length=
0;null!==this.spatialIndex?this.spatialIndex.query(a.position,a.neighborhoodRadius,Y):(Y.length=0,Y.push.apply(Y,$jscomp.arrayFromIterable(this.entities)));for(var b=a.neighborhoodRadius*a.neighborhoodRadius,c=0,k=Y.length;c<k;c++){var d=Y[c];a!==d&&!0===d.active&&a.position.squaredDistanceTo(d.position)<=b&&a.neighbors.push(d)}}return this};F.prototype.updateTrigger=function(a,b){if(!0===a.active){a.update(b);b=this.entities;for(var c=0,k=b.length;c<k;c++){var d=b[c];!0===d.active&&a.check(d)}}return this};
F.prototype.sendMessage=function(a,b,c,k,d){this._messageDispatcher.dispatch(a,b,c,k,d);return this};var ea=function(){this._events=new Map};ea.prototype.addEventListener=function(a,b){var c=this._events;!1===c.has(a)&&c.set(a,[]);a=c.get(a);-1===a.indexOf(b)&&a.push(b)};ea.prototype.removeEventListener=function(a,b){a=this._events.get(a);void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1))};ea.prototype.hasEventListener=function(a,b){a=this._events.get(a);return void 0!==a&&-1!==a.indexOf(b)};ea.prototype.dispatchEvent=
function(a){var b=this._events.get(a.type);if(void 0!==b){a.target=this;for(var c=0,k=b.length;c<k;c++)b[c].call(this,a)}};var D=function(){};D.clamp=function(a,b,c){return Math.max(b,Math.min(c,a))};D.randFloat=function(a,b){return a+Math.random()*(b-a)};D.area=function(a,b,c){return(c.x-a.x)*(b.z-a.z)-(b.x-a.x)*(c.z-a.z)};var e=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c};e.prototype.set=function(a,b,c){this.x=a;this.y=b;this.z=c;return this};e.prototype.copy=
function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};e.prototype.clone=function(){return(new this.constructor).copy(this)};e.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};e.prototype.addScalar=function(a){this.x+=a;this.y+=a;this.z+=a;return this};e.prototype.addVectors=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this};e.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};e.prototype.subScalar=function(a){this.x-=a;this.y-=
a;this.z-=a;return this};e.prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this};e.prototype.multiply=function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this};e.prototype.multiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};e.prototype.multiplyVectors=function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this};e.prototype.divide=function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this};e.prototype.divideScalar=function(a){this.x/=
a;this.y/=a;this.z/=a;return this};e.prototype.divideVectors=function(a,b){this.x=a.x/b.x;this.y=a.y/b.y;this.z=a.z/b.z;return this};e.prototype.clamp=function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this};e.prototype.min=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this};e.prototype.max=function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,
a.y);this.z=Math.max(this.z,a.z);return this};e.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};e.prototype.cross=function(a){var b=this.x,c=this.y,k=this.z;this.x=c*a.z-k*a.y;this.y=k*a.x-b*a.z;this.z=b*a.y-c*a.x;return this};e.prototype.crossVectors=function(a,b){var c=a.x,k=a.y;a=a.z;var d=b.x,h=b.y;b=b.z;this.x=k*b-a*h;this.y=a*d-c*b;this.z=c*h-k*d;return this};e.prototype.angleTo=function(a){a=this.dot(a)/Math.sqrt(this.squaredLength()*a.squaredLength());return Math.acos(D.clamp(a,
-1,1))};e.prototype.length=function(){return Math.sqrt(this.squaredLength())};e.prototype.squaredLength=function(){return this.dot(this)};e.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)};e.prototype.distanceTo=function(a){return Math.sqrt(this.squaredDistanceTo(a))};e.prototype.squaredDistanceTo=function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a};e.prototype.manhattanDistanceTo=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-
a.y)+Math.abs(this.z-a.z)};e.prototype.normalize=function(){return this.divideScalar(this.length()||1)};e.prototype.applyMatrix4=function(a){var b=this.x,c=this.y,k=this.z;a=a.elements;var d=1/(a[3]*b+a[7]*c+a[11]*k+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*k+a[12])*d;this.y=(a[1]*b+a[5]*c+a[9]*k+a[13])*d;this.z=(a[2]*b+a[6]*c+a[10]*k+a[14])*d;return this};e.prototype.applyRotation=function(a){var b=this.x,c=this.y,k=this.z,d=a.x,h=a.y,r=a.z;a=a.w;var e=a*b+h*k-r*c,f=a*c+r*b-d*k,g=a*k+d*c-h*b;b=-d*b-h*c-
r*k;this.x=e*a+b*-d+f*-r-g*-h;this.y=f*a+b*-h+g*-d-e*-r;this.z=g*a+b*-r+e*-h-f*-d;return this};e.prototype.transformDirection=function(a){var b=this.x,c=this.y,k=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*k;this.y=a[1]*b+a[5]*c+a[9]*k;this.z=a[2]*b+a[6]*c+a[10]*k;return this.normalize()};e.prototype.fromMatrix3Column=function(a,b){return this.fromArray(a.elements,3*b)};e.prototype.fromMatrix4Column=function(a,b){return this.fromArray(a.elements,4*b)};e.prototype.fromSpherical=function(a,b,c){var k=
Math.sin(b)*a;this.x=k*Math.sin(c);this.y=Math.cos(b)*a;this.z=k*Math.cos(c);return this};e.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];return this};e.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a};e.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z};var ma=new e(0,1,0),Ab=new e,na=new e,Bb=new e,Cb=new e,y=function(){this.elements=[1,0,0,0,1,0,0,0,1]};y.prototype.set=
function(a,b,c,k,d,h,r,e,f){var q=this.elements;q[0]=a;q[3]=b;q[6]=c;q[1]=k;q[4]=d;q[7]=h;q[2]=r;q[5]=e;q[8]=f;return this};y.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this};y.prototype.clone=function(){return(new this.constructor).copy(this)};y.prototype.identity=function(){this.set(1,0,0,0,1,0,0,0,1);return this};y.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};
y.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};y.prototype.multiplyMatrices=function(a,b){var c=a.elements,k=b.elements;b=this.elements;a=c[0];var d=c[3],h=c[6],r=c[1],e=c[4],f=c[7],g=c[2],l=c[5];c=c[8];var m=k[0],n=k[3],p=k[6],x=k[1],Xa=k[4],R=k[7],S=k[2],t=k[5];k=k[8];b[0]=a*m+d*x+h*S;b[3]=a*n+d*Xa+h*t;b[6]=a*p+d*R+h*k;b[1]=r*m+e*x+f*S;b[4]=r*n+e*Xa+f*t;b[7]=r*p+e*R+f*k;b[2]=g*m+l*x+c*S;b[5]=g*n+l*Xa+c*t;b[8]=g*p+l*R+c*k;return this};y.prototype.multiplyScalar=function(a){var b=
this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this};y.prototype.extractBasis=function(a,b,c){a.fromMatrix3Column(this,0);b.fromMatrix3Column(this,1);c.fromMatrix3Column(this,2);return this};y.prototype.makeBasis=function(a,b,c){this.set(a.x,b.x,c.x,a.y,b.y,c.y,a.z,b.z,c.z);return this};y.prototype.lookAt=function(a,b,c){Ab.crossVectors(c,a).normalize();na.crossVectors(ma,b).normalize();0===na.squaredLength()&&(Cb.copy(b).addScalar(Number.EPSILON),na.crossVectors(ma,
Cb).normalize());Bb.crossVectors(b,na).normalize();Db.makeBasis(na,Bb,b);Eb.makeBasis(Ab,c,a);this.multiplyMatrices(Db,Eb.transpose());return this};y.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this};y.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,k=a.y,d=a.z,h=a.w,r=c+c,e=k+k,f=d+d;a=c*r;var g=c*e;c*=f;var l=k*e;k*=f;d*=f;r*=h;e*=h;h*=f;b[0]=1-(l+d);b[3]=g-h;b[6]=c+e;b[1]=g+h;b[4]=1-(a+d);b[7]=
k-r;b[2]=c-e;b[5]=k+r;b[8]=1-(a+l);return this};y.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,k=0;9>k;k++)c[k]=a[k+b];return this};y.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=this.elements;a[b+0]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a};y.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var c=0;9>c;c++)if(b[c]!==a[c])return!1;return!0};var Db=new y,Eb=new y,Fb=new y,v=
function(a,b,c,k){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c;this.w=void 0===k?1:k};v.prototype.set=function(a,b,c,k){this.x=a;this.y=b;this.z=c;this.w=k;return this};v.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};v.prototype.clone=function(){return(new this.constructor).copy(this)};v.prototype.inverse=function(){return this.conjugate().normalize()};v.prototype.conjugate=function(){this.x*=-1;this.y*=-1;this.z*=-1;return this};v.prototype.dot=
function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w};v.prototype.length=function(){return Math.sqrt(this.squaredLength())};v.prototype.squaredLength=function(){return this.dot(this)};v.prototype.normalize=function(){var a=this.length();0===a?(this.z=this.y=this.x=0,this.w=1):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this};v.prototype.multiply=function(a){return this.multiplyQuaternions(this,a)};v.prototype.premultiply=function(a){return this.multiplyQuaternions(a,this)};v.prototype.multiplyQuaternions=
function(a,b){var c=a.x,k=a.y,d=a.z;a=a.w;var h=b.x,r=b.y,e=b.z;b=b.w;this.x=c*b+a*h+k*e-d*r;this.y=k*b+a*r+d*h-c*e;this.z=d*b+a*e+c*r-k*h;this.w=a*b-c*h-k*r-d*e;return this};v.prototype.angleTo=function(a){return 2*Math.acos(Math.abs(D.clamp(this.dot(a),-1,1)))};v.prototype.rotateTo=function(a,b){var c=this.angleTo(a);if(0===c)return this;this.slerp(a,Math.min(1,b/c));return this};v.prototype.lookAt=function(a,b,c){Fb.lookAt(a,b,c);this.fromMatrix3(Fb)};v.prototype.slerp=function(a,b){if(0===b)return this;
if(1===b)return this.copy(a);var c=this.x,k=this.y,d=this.z,h=this.w,r=h*a.w+c*a.x+k*a.y+d*a.z;0>r?(this.w=-a.w,this.x=-a.x,this.y=-a.y,this.z=-a.z,r=-r):this.copy(a);if(1<=r)return this.w=h,this.x=c,this.y=k,this.z=d,this;a=Math.sqrt(1-r*r);if(.001>Math.abs(a))return this.w=.5*(h+this.w),this.x=.5*(c+this.x),this.y=.5*(k+this.y),this.z=.5*(d+this.z),this;var e=Math.atan2(a,r);r=Math.sin((1-b)*e)/a;b=Math.sin(b*e)/a;this.w=h*r+this.w*b;this.x=c*r+this.x*b;this.y=k*r+this.y*b;this.z=d*r+this.z*b;return this};
v.prototype.fromEuler=function(a,b,c){var k=Math.cos(a/2),d=Math.cos(b/2),h=Math.cos(c/2);a=Math.sin(a/2);b=Math.sin(b/2);c=Math.sin(c/2);this.x=a*d*h+k*b*c;this.y=k*b*h-a*d*c;this.z=k*d*c+a*b*h;this.w=k*d*h-a*b*c;return this};v.prototype.fromMatrix3=function(a){var b=a.elements,c=b[0];a=b[3];var k=b[6],d=b[1],h=b[4],r=b[7],e=b[2],f=b[5];b=b[8];var g=c+h+b;0<g?(c=.5/Math.sqrt(g+1),this.w=.25/c,this.x=(f-r)*c,this.y=(k-e)*c,this.z=(d-a)*c):c>h&&c>b?(c=2*Math.sqrt(1+c-h-b),this.w=(f-r)/c,this.x=.25*
c,this.y=(a+d)/c,this.z=(k+e)/c):h>b?(c=2*Math.sqrt(1+h-c-b),this.w=(k-e)/c,this.x=(a+d)/c,this.y=.25*c,this.z=(r+f)/c):(c=2*Math.sqrt(1+b-c-h),this.w=(d-a)/c,this.x=(k+e)/c,this.y=(r+f)/c,this.z=.25*c);return this};v.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this};v.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a};v.prototype.equals=function(a){return a.x===this.x&&
a.y===this.y&&a.z===this.z&&a.w===this.w};var w=function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};w.prototype.set=function(a,b,c,d,q,h,r,e,f,g,l,m,n,p,x,t){var k=this.elements;k[0]=a;k[4]=b;k[8]=c;k[12]=d;k[1]=q;k[5]=h;k[9]=r;k[13]=e;k[2]=f;k[6]=g;k[10]=l;k[14]=m;k[3]=n;k[7]=p;k[11]=x;k[15]=t;return this};w.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];
b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this};w.prototype.clone=function(){return(new this.constructor).copy(this)};w.prototype.identity=function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};w.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};w.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};w.prototype.multiplyMatrices=function(a,b){var c=a.elements,k=b.elements;b=this.elements;a=c[0];var d=c[4],h=c[8],r=c[12],e=c[1],f=c[5],g=
c[9],l=c[13],m=c[2],n=c[6],p=c[10],x=c[14],t=c[3],R=c[7],S=c[11];c=c[15];var u=k[0],v=k[4],w=k[8],y=k[12],B=k[1],z=k[5],A=k[9],C=k[13],D=k[2],E=k[6],F=k[10],G=k[14],H=k[3],I=k[7],J=k[11];k=k[15];b[0]=a*u+d*B+h*D+r*H;b[4]=a*v+d*z+h*E+r*I;b[8]=a*w+d*A+h*F+r*J;b[12]=a*y+d*C+h*G+r*k;b[1]=e*u+f*B+g*D+l*H;b[5]=e*v+f*z+g*E+l*I;b[9]=e*w+f*A+g*F+l*J;b[13]=e*y+f*C+g*G+l*k;b[2]=m*u+n*B+p*D+x*H;b[6]=m*v+n*z+p*E+x*I;b[10]=m*w+n*A+p*F+x*J;b[14]=m*y+n*C+p*G+x*k;b[3]=t*u+R*B+S*D+c*H;b[7]=t*v+R*z+S*E+c*I;b[11]=t*
w+R*A+S*F+c*J;b[15]=t*y+R*C+S*G+c*k;return this};w.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this};w.prototype.extractBasis=function(a,b,c){a.fromMatrix4Column(this,0);b.fromMatrix4Column(this,1);c.fromMatrix4Column(this,2);return this};w.prototype.makeBasis=function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this};
w.prototype.compose=function(a,b,c){this.fromQuaternion(b);this.scale(c);this.setPosition(a);return this};w.prototype.scale=function(a){var b=this.elements,c=a.x,k=a.y;a=a.z;b[0]*=c;b[4]*=k;b[8]*=a;b[1]*=c;b[5]*=k;b[9]*=a;b[2]*=c;b[6]*=k;b[10]*=a;b[3]*=c;b[7]*=k;b[11]*=a;return this};w.prototype.setPosition=function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this};w.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=
a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this};w.prototype.getInverse=function(a){var b=this.elements,c=a.elements,k=c[0],d=c[1],h=c[2],r=c[3],e=c[4],f=c[5],g=c[6],l=c[7],m=c[8],n=c[9],p=c[10],t=c[11],u=c[12],v=c[13],w=c[14];c=c[15];var y=n*w*l-v*p*l+v*g*t-f*w*t-n*g*c+f*p*c,z=u*p*l-m*w*l-u*g*t+e*w*t+m*g*c-e*p*c,A=m*v*l-u*n*l+u*f*t-e*v*t-m*f*c+e*n*c,C=u*n*g-m*v*g-u*f*p+e*v*p+m*f*w-e*n*w,B=k*y+d*z+h*A+r*C;if(0===B)return x.warn("YUKA.Matrix4: .getInverse() can not invert matrix, determinant is 0."),
this.identity();B=1/B;b[0]=y*B;b[1]=(v*p*r-n*w*r-v*h*t+d*w*t+n*h*c-d*p*c)*B;b[2]=(f*w*r-v*g*r+v*h*l-d*w*l-f*h*c+d*g*c)*B;b[3]=(n*g*r-f*p*r-n*h*l+d*p*l+f*h*t-d*g*t)*B;b[4]=z*B;b[5]=(m*w*r-u*p*r+u*h*t-k*w*t-m*h*c+k*p*c)*B;b[6]=(u*g*r-e*w*r-u*h*l+k*w*l+e*h*c-k*g*c)*B;b[7]=(e*p*r-m*g*r+m*h*l-k*p*l-e*h*t+k*g*t)*B;b[8]=A*B;b[9]=(u*n*r-m*v*r-u*d*t+k*v*t+m*d*c-k*n*c)*B;b[10]=(e*v*r-u*f*r+u*d*l-k*v*l-e*d*c+k*f*c)*B;b[11]=(m*f*r-e*n*r-m*d*l+k*n*l+e*d*t-k*f*t)*B;b[12]=C*B;b[13]=(m*v*h-u*n*h+u*d*p-k*v*p-m*d*
w+k*n*w)*B;b[14]=(u*f*h-e*v*h-u*d*g+k*v*g+e*d*w-k*f*w)*B;b[15]=(e*n*h-m*f*h+m*d*g-k*n*g-e*d*p+k*f*p)*B;return a};w.prototype.getMaxScale=function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))};w.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,d=a.y,q=a.z,h=a.w,e=c+c,f=d+d,g=q+q;a=c*e;var l=c*f;c*=g;var m=d*f;d*=g;q*=g;e*=h;f*=h;h*=g;b[0]=1-(m+q);b[4]=l-h;b[8]=c+f;b[1]=l+h;b[5]=1-(a+q);b[9]=
d-e;b[2]=c-f;b[6]=d+e;b[10]=1-(a+m);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this};w.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,d=0;16>d;d++)c[d]=a[d+b];return this};w.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=this.elements;a[b+0]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a};
w.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0};var nc=0,Gb=new v,Ba=new e,A=function(){this.id=nc++;this.name="";this.active=!0;this.children=[];this.parent=null;this.neighbors=[];this.neighborhoodRadius=1;this.updateNeighborhood=!1;this.position=new e;this.rotation=new v;this.scale=new e(1,1,1);this.forward=new e(0,0,1);this.up=new e(0,1,0);this.boundingRadius=0;this.fieldOfView=this.maxTurnRate=Math.PI;this.visualRange=Infinity;
this.matrix=new w;this.worldMatrix=new w;this.manager=null;this._cache={position:new e,rotation:new v,scale:new e};this._renderComponentCallback=this._renderComponent=null};A.prototype.start=function(){};A.prototype.update=function(){};A.prototype.add=function(a){null!==a.parent&&a.parent.remove(a);this.children.push(a);a.parent=this;return this};A.prototype.remove=function(a){var b=this.children.indexOf(a);this.children.splice(b,1);a.parent=null;return this};A.prototype.getDirection=function(a){return a.copy(this.forward).applyRotation(this.rotation).normalize()};
A.prototype.lookAt=function(a){Ba.subVectors(a,this.position).normalize();this.rotation.lookAt(this.forward,Ba,this.up);return this};A.prototype.rotateTo=function(a,b){Ba.subVectors(a,this.position).normalize();Gb.lookAt(this.forward,Ba,this.up);this.rotation.rotateTo(Gb,this.maxTurnRate*b);return this};A.prototype.updateMatrix=function(){var a=this._cache;if(a.position.equals(this.position)&&a.rotation.equals(this.rotation)&&a.scale.equals(this.scale))return this;this.matrix.compose(this.position,
this.rotation,this.scale);a.position.copy(this.position);a.rotation.copy(this.rotation);a.scale.copy(this.scale);return this};A.prototype.updateWorldMatrix=function(a,b){b=void 0===b?!1:b;var c=this.parent,d=this.children;!0===(void 0===a?!1:a)&&null!==c&&c.updateWorldMatrix(!0);this.updateMatrix();null===c?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix);if(!0===b)for(a=0,b=d.length;a<b;a++)d[a].updateWorldMatrix(!1,!0);return this};A.prototype.setRenderComponent=
function(a,b){this._renderComponent=a;this._renderComponentCallback=b;return this};A.prototype.handleMessage=function(){return!1};A.prototype.sendMessage=function(a,b,c,d){null!==this.manager?this.manager.sendMessage(this,a,b,void 0===c?0:c,void 0===d?null:d):x.error("YUKA.GameEntity: The game entity must be added to a manager in order to send a message.");return this};var oa=new e,P=[new e,new e,new e,new e,new e,new e,new e,new e],z=function(a,b){a=void 0===a?new e:a;b=void 0===b?new e:b;this.min=
a;this.max=b};z.prototype.set=function(a,b){this.min=a;this.max=b;return this};z.prototype.copy=function(a){this.min.copy(a.min);this.max.copy(a.max);return this};z.prototype.clone=function(){return(new this.constructor).copy(this)};z.prototype.clampPoint=function(a,b){b.copy(a).clamp(this.min,this.max);return b};z.prototype.containsPoint=function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0};z.prototype.expand=function(a){this.min.min(a);
this.max.max(a);return this};z.prototype.getCenter=function(a){return a.addVectors(this.min,this.max).multiplyScalar(.5)};z.prototype.intersectsAABB=function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0};z.prototype.intersectsBoundingSphere=function(a){this.clampPoint(a.center,oa);return oa.squaredDistanceTo(a.center)<=a.radius*a.radius};z.prototype.fromCenterAndSize=function(a,b){oa.copy(b).multiplyScalar(.5);
this.min.copy(a).sub(oa);this.max.copy(a).add(oa);return this};z.prototype.fromPoints=function(a){this.min.set(Infinity,Infinity,Infinity);this.max.set(-Infinity,-Infinity,-Infinity);for(var b=0,c=a.length;b<c;b++)this.expand(a[b]);return this};z.prototype.applyMatrix4=function(a){var b=this.min,c=this.max;P[0].set(b.x,b.y,b.z).applyMatrix4(a);P[1].set(b.x,b.y,c.z).applyMatrix4(a);P[2].set(b.x,c.y,b.z).applyMatrix4(a);P[3].set(b.x,c.y,c.z).applyMatrix4(a);P[4].set(c.x,b.y,b.z).applyMatrix4(a);P[5].set(c.x,
b.y,c.z).applyMatrix4(a);P[6].set(c.x,c.y,b.z).applyMatrix4(a);P[7].set(c.x,c.y,c.z).applyMatrix4(a);return this.fromPoints(P)};z.prototype.equals=function(a){return a.min.equals(this.min)&&a.max.equals(this.max)};var E=function(a,b){this.center=a=void 0===a?new e:a;this.radius=void 0===b?0:b};E.prototype.set=function(a,b){this.center=a;this.radius=b;return this};E.prototype.copy=function(a){this.center.copy(a.center);this.radius=a.radius;return this};E.prototype.clone=function(){return(new this.constructor).copy(this)};
E.prototype.containsPoint=function(a){return a.squaredDistanceTo(this.center)<=this.radius*this.radius};E.prototype.intersectsBoundingSphere=function(a){var b=this.radius+a.radius;return a.center.squaredDistanceTo(this.center)<=b*b};E.prototype.applyMatrix4=function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScale();return this};E.prototype.equals=function(a){return a.center.equals(this.center)&&a.radius===this.radius};var Ya=function(a,b){this.vertices=a=void 0===a?new Float32Array:a;this.indices=
void 0===b?null:b;this.backfaceCulling=!0;this.aabb=new z;this.boundingSphere=new E;this.computeBoundingVolume()};Ya.prototype.computeBoundingVolume=function(){var a=this.vertices,b=new e,c=this.aabb,d=this.boundingSphere;c.min.set(Infinity,Infinity,Infinity);c.max.set(-Infinity,-Infinity,-Infinity);for(var q=0,h=a.length;q<h;q+=3)b.x=a[q],b.y=a[q+1],b.z=a[q+2],c.expand(b);c.getCenter(d.center);d.radius=d.center.distanceTo(c.max);return this};var Hb=new e,Za=new e,Z=function(){var a=A.call(this)||
this;a.velocity=new e;a.maxSpeed=1;a.updateOrientation=!0;return a};$jscomp.inherits(Z,A);Z.prototype.update=function(a){this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));Hb.copy(this.velocity).multiplyScalar(a);Za.copy(this.position).add(Hb);this.updateOrientation&&1e-8<this.getSpeedSquared()&&this.lookAt(Za);this.position.copy(Za)};Z.prototype.getSpeed=function(){return this.velocity.length()};Z.prototype.getSpeedSquared=
function(){return this.velocity.squaredLength()};var fa=function(){this.currentTime=this.previousTime=this.startTime=0};fa.prototype.getDelta=function(){return(this.currentTime-this.previousTime)/1E3};fa.prototype.getElapsed=function(){return(this.currentTime-this.startTime)/1E3};fa.prototype.update=function(){this.previousTime=this.currentTime;this.currentTime=this.now();return this};fa.prototype.now=function(){return("undefined"===typeof performance?Date:performance).now()};var Ib=function(a){this.updateFrequency=
void 0===a?0:a;this._time=new fa;this._nextUpdateTime=0};Ib.prototype.ready=function(){this._time.update();return this._time.currentTime>=this._nextUpdateTime?(this._nextUpdateTime=this._time.currentTime+1E3/this.updateFrequency,!0):!1};var ha=function(){};ha.prototype.enter=function(){};ha.prototype.execute=function(){};ha.prototype.exit=function(){};ha.prototype.onMessage=function(){return!1};var K=function(a){this.owner=a;this.globalState=this.previousState=this.currentState=null;this.states=new Map};
K.prototype.update=function(){null!==this.globalState&&this.globalState.execute(this.owner);null!==this.currentState&&this.currentState.execute(this.owner);return this};K.prototype.add=function(a,b){b instanceof ha?this.states.set(a,b):x.warn('YUKA.StateMachine: .add() needs a parameter of type "YUKA.State".');return this};K.prototype.remove=function(a){this.states.delete(a);return this};K.prototype.get=function(a){return this.states.get(a)};K.prototype.changeTo=function(a){a=this.get(a);this._change(a);
return this};K.prototype.revert=function(){this._change(this.previousState);return this};K.prototype.in=function(a){return this.get(a)===this.currentState};K.prototype.handleMessage=function(a){return null!==this.currentState&&!0===this.currentState.onMessage(this.owner,a)||null!==this.globalState&&!0===this.globalState.onMessage(this.owner,a)?!0:!1};K.prototype._change=function(a){this.previousState=this.currentState;this.currentState.exit(this.owner);this.currentState=a;this.currentState.enter(this.owner)};
var t=function(a){this.owner=void 0===a?null:a;this.status=t.STATUS.INACTIVE};t.prototype.activate=function(){};t.prototype.execute=function(){};t.prototype.terminate=function(){};t.prototype.handleMessage=function(){return!1};t.prototype.active=function(){return this.status===t.STATUS.ACTIVE};t.prototype.inactive=function(){return this.status===t.STATUS.INACTIVE};t.prototype.completed=function(){return this.status===t.STATUS.COMPLETED};t.prototype.failed=function(){return this.status===t.STATUS.FAILED};
t.prototype.replanIfFailed=function(){!0===this.failed()&&(this.status=t.STATUS.INACTIVE);return this};t.prototype.activateIfInactive=function(){!0===this.inactive()&&(this.activate(),this.status=t.STATUS.ACTIVE);return this};t.STATUS=Object.freeze({ACTIVE:"active",INACTIVE:"inactive",COMPLETED:"completed",FAILED:"failed"});var L=function(a){a=t.call(this,void 0===a?null:a)||this;a.subgoals=[];return a};$jscomp.inherits(L,t);L.prototype.addSubgoal=function(a){this.subgoals.push(a);return this};L.prototype.clearSubgoals=
function(){for(var a=this.subgoals,b=0,c=a.length;b<c;b++)a[b].terminate();a.length=0;return this};L.prototype.currentSubgoal=function(){var a=this.subgoals.length;return 0<a?this.subgoals[a-1]:null};L.prototype.executeSubgoals=function(){for(var a=this.subgoals,b=a.length-1;0<=b;b--){var c=a[b];if(!0===c.completed()||!0===c.failed())c.terminate(),a.pop();else break}b=this.currentSubgoal();return null!==b?(b.activateIfInactive(),b.execute(),!0===b.completed()&&1<a.length?t.STATUS.ACTIVE:b.status):
t.STATUS.COMPLETED};L.prototype.hasSubgoals=function(){return 0<this.subgoals.length};L.prototype.handleMessage=function(a){var b=this.currentSubgoal();return null!==b?b.handleMessage(a):!1};var $a=function(a){this.characterBias=void 0===a?1:a};$a.prototype.calculateDesirability=function(){return 0};$a.prototype.setGoal=function(){};var T=function(a){a=L.call(this,void 0===a?null:a)||this;a.evaluators=[];return a};$jscomp.inherits(T,L);T.prototype.activate=function(){this.arbitrate()};T.prototype.execute=
function(){this.activateIfInactive();var a=this.executeSubgoals();if(a===t.STATUS.COMPLETED||a===t.STATUS.FAILED)this.status=t.STATUS.INACTIVE};T.prototype.terminate=function(){this.clearSubgoals()};T.prototype.addEvaluator=function(a){this.evaluators.push(a);return this};T.prototype.removeEvaluator=function(a){a=this.evaluators.indexOf(a);this.evaluators.splice(a,1);return this};T.prototype.arbitrate=function(){for(var a=this.evaluators,b=-1,c=null,d=0,q=a.length;d<q;d++){var h=a[d],e=h.calculateDesirability(this.owner);
e*=h.characterBias;e>=b&&(b=e,c=h)}null!==c?c.setGoal(this.owner):x.error("YUKA.Think: Unable to determine goal evaluator for game entity:",this.owner);return this};var aa=function(a,b,c){this.from=void 0===a?-1:a;this.to=void 0===b?-1:b;this.cost=void 0===c?0:c};aa.prototype.copy=function(a){this.from=a.from;this.to=a.to;this.cost=a.cost;return this};aa.prototype.clone=function(){return(new this.constructor).copy(this)};var C=function(){this.digraph=!1;this._nodes=new Map;this._edges=new Map};C.prototype.addNode=
function(a){var b=a.index;this._nodes.set(b,a);this._edges.set(b,[]);return this};C.prototype.addEdge=function(a){var b=this._edges.get(a.from);b.push(a);if(!1===this.digraph){var c=a.clone();c.from=a.to;c.to=a.from;b=this._edges.get(a.to);b.push(c)}return this};C.prototype.getNode=function(a){return this._nodes.get(a)||null};C.prototype.getEdge=function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=this._edges.get(a);for(var c=0,d=a.length;c<d;c++){var q=a[c];if(q.to===b)return q}}return null};C.prototype.getNodes=
function(a){a.length=0;a.push.apply(a,$jscomp.arrayFromIterable(this._nodes.values()));return a};C.prototype.getEdgesOfNode=function(a,b){a=this._edges.get(a);void 0!==a&&(b.length=0,b.push.apply(b,$jscomp.arrayFromIterable(a)));return b};C.prototype.getNodeCount=function(){return this._nodes.size};C.prototype.getEdgeCount=function(){for(var a=0,b=$jscomp.makeIterator(this._edges.values()),c=b.next();!c.done;c=b.next())a+=c.value.length;return a};C.prototype.removeNode=function(a){this._nodes.delete(a.index);
if(!1===this.digraph){var b=this._edges.get(a.index);b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next()){c=this._edges.get(c.value.to);for(var d=c.length-1;0<=d;d--){var q=c[d];if(q.to===a.index){d=c.indexOf(q);c.splice(d,1);break}}}}else for(b=$jscomp.makeIterator(this._edges.values()),c=b.next();!c.done;c=b.next())for(c=c.value,d=c.length-1;0<=d;d--)q=c[d],this.hasNode(q.to)&&this.hasNode(q.from)||(q=c.indexOf(q),c.splice(q,1));this._edges.delete(a.index);return this};C.prototype.removeEdge=
function(a){var b=this._edges.get(a.from);if(void 0!==b){var c=b.indexOf(a);b.splice(c,1);if(!1===this.digraph){b=this._edges.get(a.to);c=0;for(var d=b.length;c<d;c++){var q=b[c];if(q.to===a.from){a=b.indexOf(q);b.splice(a,1);break}}}}return this};C.prototype.hasNode=function(a){return this._nodes.has(a)};C.prototype.hasEdge=function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=this._edges.get(a);for(var c=0,d=a.length;c<d;c++)if(a[c].to===b)return!0}return!1};C.prototype.clear=function(){this._nodes.clear();
this._edges.clear();return this};var ab=function(a){this.index=void 0===a?-1:a},bb=function(){};bb.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.distanceTo(a.position)};var Jb=function(){};Jb.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.squaredDistanceTo(a.position)};var Kb=function(){};Kb.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.manhattanDistanceTo(a.position)};var Lb=function(){};Lb.calculate=function(){return 0};
var U=function(a){a=void 0===a?n:a;this.data=[];this.length=0;this.compare=a};U.prototype.push=function(a){this.data.push(a);this.length++;this._up(this.length-1)};U.prototype.pop=function(){if(0===this.length)return null;var a=this.data[0];this.length--;0<this.length&&(this.data[0]=this.data[this.length],this._down(0));this.data.pop();return a};U.prototype.peek=function(){return this.data[0]||null};U.prototype._up=function(a){for(var b=this.data,c=this.compare,d=b[a];0<a;){var q=a-1>>1,h=b[q];if(0<=
c(d,h))break;b[a]=h;a=q}b[a]=d};U.prototype._down=function(a){for(var b=this.data,c=this.compare,d=b[a],q=this.length>>1;a<q;){var h=(a<<1)+1,e=h+1,f=b[h];e<this.length&&0>c(b[e],f)&&(h=e,f=b[e]);if(0<=c(f,d))break;b[a]=f;a=h}b[a]=d};var ia=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this.heuristic=bb;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};ia.prototype.search=function(){var a=[],b=new U(p);
for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,a);for(var d=0,q=a.length;d<q;d++){var h=a[d],e=(this._cost.get(c)||0)+h.cost,f=this.heuristic.calculate(this.graph,h.to,this.target);f=e+f;if(!1===this._searchFrontier.has(h.to)||e<this._cost.get(h.to))this._cost.set(h.to,e),this._searchFrontier.set(h.to,
h),b.push({cost:f,index:h.to})}}}this.found=!1;return this};ia.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,a.unshift(b);return a};ia.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};ia.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear();return this};
var pa=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};pa.prototype.search=function(){var a=[],b=[],c=new aa(this.source,this.source);a.push(c);for(this._visited.add(this.source);0<a.length;){var d=a.shift();this._route.set(d.to,d.from);d!==c&&this._spanningTree.add(d);if(d.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(d.to,b);d=0;for(var q=
b.length;d<q;d++){var h=b[d];!1===this._visited.has(h.to)&&(a.push(h),this._visited.add(h.to))}}this.found=!1;return this};pa.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};pa.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};pa.prototype.clear=function(){this.found=!1;this._route.clear();this._visited.clear();this._spanningTree.clear();
return this};var qa=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};qa.prototype.search=function(){var a=[],b=[],c=new aa(this.source,this.source);for(a.push(c);0<a.length;){var d=a.pop();this._route.set(d.to,d.from);this._visited.add(d.to);d!==c&&this._spanningTree.add(d);if(d.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(d.to,b);d=0;for(var q=
b.length;d<q;d++){var h=b[d];!1===this._visited.has(h.to)&&a.push(h)}}this.found=!1;return this};qa.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};qa.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};qa.prototype.clear=function(){this.found=!1;this._route.clear();this._visited.clear();this._spanningTree.clear();return this};
var ra=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};ra.prototype.search=function(){var a=[],b=new U(m);for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,
a);for(var d=0,q=a.length;d<q;d++){var h=a[d],e=(this._cost.get(c)||0)+h.cost;if(!1===this._searchFrontier.has(h.to)||e<this._cost.get(h.to))this._cost.set(h.to,e),this._searchFrontier.set(h.to,h),b.push({cost:e,index:h.to})}}}this.found=!1;return this};ra.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,a.unshift(b);return a};ra.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};
ra.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear();return this};var Mb=new e,Ca=new e,M=function(a,b){a=void 0===a?new e:a;b=void 0===b?new e:b;this.from=a;this.to=b};M.prototype.set=function(a,b){this.from=a;this.to=b;return this};M.prototype.copy=function(a){this.from.copy(a.from);this.to.copy(a.to);return this};M.prototype.clone=function(){return(new this.constructor).copy(this)};M.prototype.delta=function(a){return a.subVectors(this.to,
this.from)};M.prototype.at=function(a,b){return this.delta(b).multiplyScalar(a).add(this.from)};M.prototype.closestPointToPoint=function(a,b,c){a=this.closestPointToPointParameter(a,b);return this.at(a,c)};M.prototype.closestPointToPointParameter=function(a,b){b=void 0===b?!0:b;Mb.subVectors(a,this.from);Ca.subVectors(this.to,this.from);a=Ca.dot(Ca);a=Ca.dot(Mb)/a;b&&(a=D.clamp(a,0,1));return a};M.prototype.equals=function(a){return a.from.equals(this.from)&&a.to.equals(this.to)};var Nb=new e,oc=
new e,Q=function(a,b){this.normal=a=void 0===a?new e(0,0,1):a;this.constant=void 0===b?0:b};Q.prototype.set=function(a,b){this.normal=a;this.constant=b;return this};Q.prototype.copy=function(a){this.normal.copy(a.normal);this.constant=a.constant;return this};Q.prototype.clone=function(){return(new this.constructor).copy(this)};Q.prototype.distanceToPoint=function(a){return this.normal.dot(a)+this.constant};Q.prototype.fromNormalAndCoplanarPoint=function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);
return this};Q.prototype.fromCoplanarPoints=function(a,b,c){Nb.subVectors(c,b).cross(oc.subVectors(a,b)).normalize();this.fromNormalAndCoplanarPoint(Nb,a);return this};Q.prototype.equals=function(a){return a.normal.equals(this.normal)&&a.constant===this.constant};var V=new e,cb=new e,Da=new e,db=new e,G=function(a,b){a=void 0===a?new e:a;b=void 0===b?new e:b;this.origin=a;this.direction=b};G.prototype.set=function(a,b){this.origin=a;this.direction=b;return this};G.prototype.copy=function(a){this.origin.copy(a.origin);
this.direction.copy(a.direction);return this};G.prototype.clone=function(){return(new this.constructor).copy(this)};G.prototype.at=function(a,b){return b.copy(this.direction).multiplyScalar(a).add(this.origin)};G.prototype.intersectBoundingSphere=function(a,b){V.subVectors(a.center,this.origin);var c=V.dot(this.direction),d=V.dot(V)-c*c;a=a.radius*a.radius;if(d>a)return null;a=Math.sqrt(a-d);d=c-a;c+=a;return 0>d&&0>c?null:0>d?this.at(c,b):this.at(d,b)};G.prototype.intersectAABB=function(a,b){var c=
1/this.direction.x;var d=1/this.direction.y;var q=1/this.direction.z,h=this.origin;if(0<=c){var e=(a.min.x-h.x)*c;c*=a.max.x-h.x}else e=(a.max.x-h.x)*c,c*=a.min.x-h.x;if(0<=d){var f=(a.min.y-h.y)*d;d*=a.max.y-h.y}else f=(a.max.y-h.y)*d,d*=a.min.y-h.y;if(e>d||f>c)return null;if(f>e||e!==e)e=f;if(d<c||c!==c)c=d;0<=q?(f=(a.min.z-h.z)*q,a=(a.max.z-h.z)*q):(f=(a.max.z-h.z)*q,a=(a.min.z-h.z)*q);if(e>a||f>c)return null;if(f>e||e!==e)e=f;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=e?e:c,b)};G.prototype.intersectTriangle=
function(a,b,c){var d=a.a,q=a.c;cb.subVectors(a.b,d);Da.subVectors(q,d);db.crossVectors(cb,Da);a=this.direction.dot(db);if(0<a){if(b)return null;b=1}else if(0>a)b=-1,a=-a;else return null;V.subVectors(this.origin,d);d=b*this.direction.dot(Da.crossVectors(V,Da));if(0>d)return null;q=b*this.direction.dot(cb.cross(V));if(0>q||d+q>a)return null;d=-b*V.dot(db);return 0>d?null:this.at(d/a,c)};G.prototype.applyMatrix4=function(a){this.origin.applyMatrix4(a);this.direction.transformDirection(a);return this};
G.prototype.equals=function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)};var Ea=function(a,b,c){return aa.call(this,void 0===a?-1:a,void 0===b?-1:b,void 0===c?0:c)||this};$jscomp.inherits(Ea,aa);var Fa=function(a,b,c){a=void 0===a?-1:a;b=void 0===b?new e:b;c=void 0===c?{}:c;a=ab.call(this,a)||this;a.position=b;a.userData=c;return a};$jscomp.inherits(Fa,ab);var Ob=function(){};Ob.createGridLayout=function(a,b){var c=new C;c.digraph=!0;var d=a/2;a/=b;for(var q=0,h=0;h<=
b;h++)for(var f=h*a-d,g=0;g<=b;g++){var l=new e(g*a-d,0,f);l=new Fa(q,l);c.addNode(l);q++}b=c.getNodeCount();d=Math.pow(a+a/2,2);for(a=0;a<b;a++)for(q=c.getNode(a),h=0;h<b;h++)a!==h&&(f=c.getNode(h).position.squaredDistanceTo(q.position),f<=d&&(f=new Ea(a,h,Math.sqrt(f)),c.addEdge(f)));return c};var Ga=function(){this.portalEdges=[]};Ga.prototype.push=function(a,b){this.portalEdges.push({left:a,right:b});return this};Ga.prototype.generate=function(){var a=this.portalEdges,b=[],c=0,d=0;var q=a[0].left;
var e=a[0].left;var f=a[0].right;b.push(q);var g=1;for(var l=a.length;g<l;g++){var m=a[g].left,n=a[g].right;if(0>=D.area(q,f,n))if(q===f||0<D.area(q,e,n))f=n,d=g;else{b.push(e);q=e;g=c;f=e=q;d=c=g;continue}0<=D.area(q,e,m)&&(q===e||0>D.area(q,f,m)?(e=m,c=g):(b.push(f),q=f,g=d,f=e=q,d=c=g))}0!==b.length&&b[b.length-1]===a[a.length-1].left||b.push(a[a.length-1].left);return b};var ja=function(a){this.vertex=a=void 0===a?new e:a;this.polygon=this.twin=this.prev=this.next=null;this.nodeIndex=-1};ja.prototype.from=
function(){return this.vertex};ja.prototype.to=function(){return this.next?this.next.vertex:null};ja.prototype.length=function(){var a=this.from(),b=this.to();return null!==b?a.distanceTo(b):-1};ja.prototype.squaredLength=function(){var a=this.from(),b=this.to();return null!==b?a.squaredDistanceTo(b):-1};var eb=new e,Pb=new e,fb=new e,gb=new e,sa=new e,ta=new M,H=function(){this.graph=new C;this.graph.digraph=!0;this.regions=[];this.spatialIndex=null;this.epsilonCoplanarTest=.001;this.epsilonContainsTest=
1};H.prototype.fromPolygons=function(a){this.clear();for(var b=[],c=[],d=0,e=a.length;d<e;d++){var h=a[d],f=h.edge;do b.push(f),f=f.next;while(f!==h.edge);this.regions.push(h)}a=0;for(d=b.length;a<d;a++)if(e=b[a],null===e.twin)for(h=a+1,f=b.length;h<f;h++){var l=b[h];if(e.from().equals(l.to())&&e.to().equals(l.from())){e.twin=l;l.twin=e;h=e.squaredLength();c.push({cost:h,edge:e});break}}c.sort(g);this._buildRegions(c);this._buildNodeIndices();this._buildGraph();return this};H.prototype.clear=function(){this.graph.clear();
this.regions.length=0;this.spatialIndex=null;return this};H.prototype.getClosestRegion=function(a){for(var b=this.regions,c=null,d=Infinity,e=0,h=b.length;e<h;e++){var f=b[e],g=a.squaredDistanceTo(f.centroid);g<d&&(d=g,c=f)}return c};H.prototype.getRandomRegion=function(){var a=this.regions,b=Math.floor(Math.random()*a.length);b===a.length&&(b=a.length-1);return a[b]};H.prototype.getRegionForPoint=function(a,b){b=void 0===b?.001:b;if(null!==this.spatialIndex){var c=this.spatialIndex.getIndexForPosition(a);
c=this.spatialIndex.cells[c].entries}else c=this.regions;for(var d=0,e=c.length;d<e;d++){var h=c[d];if(!0===h.contains(a,b))return h}return null};H.prototype.findPath=function(a,b){var c=this.graph,d=[],q=this.getRegionForPoint(a,this.epsilonContainsTest),h=this.getRegionForPoint(b,this.epsilonContainsTest);if(null===q||null===h)null===q&&(q=this.getClosestRegion(a)),null===h&&(h=this.getClosestRegion(b));if(q===h)d.push((new e).copy(a)),d.push((new e).copy(b));else if(q=this.regions.indexOf(q),h=
this.regions.indexOf(h),c=new ia(c,q,h),c.search(),!0===c.found){c=c.getPath();h=new Ga;h.push(a,a);a={left:null,right:null};q=0;for(var f=c.length-1;q<f;q++)this.regions[c[q]].getPortalEdgeTo(this.regions[c[q+1]],a),h.push(a.left,a.right);h.push(b,b);d.push.apply(d,$jscomp.arrayFromIterable(h.generate()))}return d};H.prototype.clampMovement=function(a,b,c,d){var k=this.getRegionForPoint(c,this.epsilonContainsTest);if(null===k){if(null===a)throw Error("YUKA.NavMesh.clampMovement(): No current region available.");
k=null;var e=Infinity,f=a.edge;do{if(null===f.twin){ta.set(f.vertex,f.next.vertex);var g=ta.closestPointToPointParameter(b);ta.at(g,eb);g=eb.squaredDistanceTo(b);g<e&&(e=g,k=f,Pb.copy(eb))}f=f.next}while(f!==a.edge);fb.subVectors(k.next.vertex,k.vertex).normalize();c=gb.subVectors(c,b).length();gb.divideScalar(c);e=fb.dot(gb);sa.copy(Pb).add(fb.multiplyScalar(e*c));ta.set(k.vertex,k.next.vertex);k=ta.closestPointToPointParameter(sa,!1);if(0<=k&&1>=k)d.copy(sa);else{k=this.getRegionForPoint(sa,this.epsilonContainsTest);
if(null!==k)return d.copy(sa),k;d.copy(b)}return a}return k};H.prototype.updateSpatialIndex=function(){if(null!==this.spatialIndex){this.spatialIndex.makeEmpty();for(var a=this.regions,b=0,c=a.length;b<c;b++)this.spatialIndex.addPolygon(a[b])}return this};H.prototype._buildRegions=function(a){for(var b=this.regions,c,d,e,h,f=0,g=a.length;f<g;f++){var l=a[f],m=l.edge;c=m.prev;d=m.next;e=m.twin.prev;h=m.twin.next;m.prev.next=m.twin.next;m.next.prev=m.twin.prev;m.twin.prev.next=m.next;m.twin.next.prev=
m.prev;var n=m.polygon;n.edge=m.prev;if(!0===n.convex()&&!0===n.coplanar(this.epsilonCoplanarTest)){c=n.edge;do c.polygon=n,c=c.next;while(c!==n.edge);l=b.indexOf(l.edge.twin.polygon);b.splice(l,1)}else c.next=m,d.prev=m,e.next=m.twin,h.prev=m.twin,n.edge=m}a=0;for(g=b.length;a<g;a++)b[a].computeCentroid()};H.prototype._buildNodeIndices=function(){for(var a=this.regions,b=new Map,c=0,d=0,e=a.length;d<e;d++){var h=a[d],f=h.edge;do{if(null!==f.twin&&null===f.nodeIndex){for(var g=-1,l=f.from(),m=$jscomp.makeIterator(b.entries()),
n=m.next();!n.done;n=m.next()){var p=$jscomp.makeIterator(n.value);n=p.next().value;p=p.next().value;if(!0===l.equals(p)){g=n;break}}-1===g&&(g=c++,b.set(g,l));f.nodeIndex=g;f.twin.next.nodeIndex=g}f=f.next}while(f!==h.edge)}};H.prototype._buildGraph=function(){for(var a=this.graph,b=this.regions,c=[],d=0,e=b.length;d<e;d++){var h=b[d],f=[];c.push(f);var g=h.edge;do null!==g.twin&&(f.push(this.regions.indexOf(g.twin.polygon)),!1===a.hasNode(this.regions.indexOf(g.polygon))&&a.addNode(new Fa(this.regions.indexOf(g.polygon),
g.polygon.centroid))),g=g.next;while(g!==h.edge)}b=0;for(d=c.length;b<d;b++)for(e=c[b],h=b,f=0,g=e.length;f<g;f++){var l=e[f];if(h!==l&&!1===a.hasEdge(h,l)){var m=a.getNode(h),n=a.getNode(l);m=m.position.distanceTo(n.position);a.addEdge(new Ea(h,l,m))}}return this};var N=function(){this.centroid=new e;this.edge=null;this.plane=new Q};N.prototype.fromContour=function(a){var b=[];if(3>a.length)return x.error("YUKA.Polygon: Unable to create polygon from contour. It needs at least three points."),this;
for(var c=0,d=a.length;c<d;c++){var e=new ja(a[c]);b.push(e)}c=0;for(d=b.length;c<d;c++){if(0===c){e=b[c];var h=b[d-1];var f=b[c+1]}else c===d-1?(e=b[c],h=b[c-1],f=b[0]):(e=b[c],h=b[c-1],f=b[c+1]);e.prev=h;e.next=f;e.polygon=this}this.edge=b[0];this.plane.fromCoplanarPoints(a[0],a[1],a[2]);return this};N.prototype.computeCentroid=function(){var a=this.centroid,b=this.edge,c=0;a.set(0,0,0);do a.add(b.from()),c++,b=b.next;while(b!==this.edge);a.divideScalar(c);return this};N.prototype.contains=function(a,
b){b=void 0===b?.001:b;var c=this.plane,d=this.edge;do{var e=d.from(),f=d.to();if(!1===0<=D.area(e,f,a))return!1;d=d.next}while(d!==this.edge);a=c.distanceToPoint(a);return Math.abs(a)>b?!1:!0};N.prototype.convex=function(){var a=this.edge;do{var b=a.from(),c=a.to(),d=a.next.to();if(!1===0<=D.area(b,c,d))return!1;a=a.next}while(a!==this.edge);return!0};N.prototype.coplanar=function(a){a=void 0===a?.001:a;var b=this.plane,c=this.edge;do{var d=b.distanceToPoint(c.from());if(Math.abs(d)>a)return!1;c=
c.next}while(c!==this.edge);return!0};N.prototype.getContour=function(a){var b=this.edge;a.length=0;do a.push(b.vertex),b=b.next;while(b!==this.edge);return a};N.prototype.getPortalEdgeTo=function(a,b){var c=this.edge;do{if(null!==c.twin&&c.twin.polygon===a)return b.left=c.vertex,b.right=c.next.vertex,b;c=c.next}while(c!==this.edge);b.left=null;b.right=null;return b};var Qb=function(){};Qb.prototype.load=function(a,b){return new Promise(function(c,d){fetch(a).then(function(a){if(200<=a.status&&300>
a.status)return a.arrayBuffer();var b=Error(a.statusText||a.status);b.response=a;return Promise.reject(b)}).then(function(c){var d=new O,e=new TextDecoder;"glTF"===e.decode(new Uint8Array(c,0,4))?(d.parseBinary(c),c=d.extensions.get("BINARY").content):c=e.decode(new Uint8Array(c));c=JSON.parse(c);if(void 0===c.asset||2>c.asset.version[0])throw Error("YUKA.NavMeshLoader: Unsupported asset version.");e=a.lastIndexOf("/");e=-1===e?"./":a.substr(0,e+1);return d.parse(c,e,b)}).then(function(a){c(a)}).catch(function(a){x.error("YUKA.NavMeshLoader: Unable to load navigation mesh.",
a);d(a)})})};var O=function(){this.path=this.json=null;this.cache=new Map;this.extensions=new Map};O.prototype.parse=function(a,b,c){var d=this;this.json=a;this.path=b;return this.getDependency("mesh",0).then(function(a){a=d.parseGeometry(a);var b=new H;c&&c.epsilonCoplanarTest&&(b.epsilonCoplanarTest=c.epsilonCoplanarTest);return b.fromPolygons(a)})};O.prototype.parseGeometry=function(a){var b=a.index,c=a.position;a=[];for(var d=[],f=0,h=c.length;f<h;f+=3){var g=new e;g.x=c[f+0];g.y=c[f+1];g.z=c[f+
2];a.push(g)}if(b)for(c=0,h=b.length;c<h;c+=3)f=[a[b[c+0]],a[b[c+1]],a[b[c+2]]],f=(new N).fromContour(f),d.push(f);else for(b=0,h=a.length;b<h;b+=3)c=[a[b+0],a[b+1],a[b+2]],c=(new N).fromContour(c),d.push(c);return d};O.prototype.getDependencies=function(a){var b=this,c=this.cache,d=c.get(a);d||(d=Promise.all((this.json[a+("mesh"===a?"es":"s")]||[]).map(function(c,d){return b.getDependency(a,d)})),c.set(a,d));return d};O.prototype.getDependency=function(a,b){var c=this.cache,d=a+":"+b,e=c.get(d);
if(void 0===e){switch(a){case "accessor":e=this.loadAccessor(b);break;case "buffer":e=this.loadBuffer(b);break;case "bufferView":e=this.loadBufferView(b);break;case "mesh":e=this.loadMesh(b);break;default:throw Error("Unknown type: "+a);}c.set(d,e)}return e};O.prototype.loadBuffer=function(a){var b=this,c=this.json.buffers[a];return void 0===c.uri&&0===a?Promise.resolve(this.extensions.get("BINARY").body):new Promise(function(a,d){var e=J(c.uri,b.path);fetch(e).then(function(a){return a.arrayBuffer()}).then(function(b){a(b)}).catch(function(a){x.error("YUKA.NavMeshLoader: Unable to load buffer.",
a);d(a)})})};O.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var c=b.byteOffset||0;return a.slice(c,c+(b.byteLength||0))})};O.prototype.loadAccessor=function(a){var b=this.json.accessors[a];return this.getDependency("bufferView",b.bufferView).then(function(a){return new pc[b.componentType](a,b.byteOffset||0,b.count*qc[b.type])})};O.prototype.loadMesh=function(a){var b=this.json.meshes[a];return this.getDependencies("accessor").then(function(a){var c=
b.primitives[0];if(4!==c.mode)throw Error("YUKA.NavMeshLoader: Invalid geometry format. Please ensure to represent your geometry as triangles.");return{index:a[c.indices],position:a[c.attributes.POSITION],normal:a[c.attributes.NORMAL]}})};O.prototype.parseBinary=function(a){for(var b=new DataView(a,12),c=0,d=new TextDecoder,e=null,f=null;c<b.byteLength;){var g=b.getUint32(c,!0);c+=4;var l=b.getUint32(c,!0);c+=4;l===Rb.JSON?(e=new Uint8Array(a,12+c,g),e=d.decode(e)):l===Rb.BIN&&(f=12+c,f=a.slice(f,
f+g));c+=g}this.extensions.set("BINARY",{content:e,body:f})};var qc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Rb={JSON:1313821514,BIN:5130562},ba=function(a){this.aabb=a=void 0===a?new z:a;this.entries=[]};ba.prototype.add=function(a){this.entries.push(a);return this};ba.prototype.remove=function(a){a=this.entries.indexOf(a);this.entries.splice(a,1);return this};ba.prototype.makeEmpty=
function(){this.entries.length=0;return this};ba.prototype.empty=function(){return 0===this.entries.length};ba.prototype.intersects=function(a){return this.aabb.intersectsAABB(a)};var Ha=new e,ua=new z,Sb=[],W=function(a,b,c,d,f,h){this.cells=[];this.width=a;this.height=b;this.depth=c;this.cellsX=d;this.cellsY=f;this.cellsZ=h;this._halfWidth=a/2;this._halfHeight=b/2;this._halfDepth=c/2;this._min=new e(-this._halfWidth,-this._halfHeight,-this._halfDepth);this._max=new e(this._halfWidth,this._halfHeight,
this._halfDepth);a/=d;b/=f;c/=h;for(var k=0;k<d;k++)for(var g=k*a-this._halfWidth,l=0;l<f;l++)for(var m=l*b-this._halfHeight,q=0;q<h;q++){var n=q*c-this._halfDepth,p=new e,t=new e;p.set(g,m,n);t.x=p.x+a;t.y=p.y+b;t.z=p.z+c;n=new z(p,t);n=new ba(n);this.cells.push(n)}};W.prototype.updateEntity=function(a,b){b=void 0===b?-1:b;var c=this.getIndexForPosition(a.position);b!==c&&(this.addEntityToPartition(a,c),-1!==b&&this.removeEntityFromPartition(a,b));return c};W.prototype.addEntityToPartition=function(a,
b){this.cells[b].add(a);return this};W.prototype.removeEntityFromPartition=function(a,b){this.cells[b].remove(a);return this};W.prototype.getIndexForPosition=function(a){Ha.copy(a).clamp(this._min,this._max);a=Math.abs(Math.floor(this.cellsX*(Ha.x+this._halfWidth)/this.width));var b=Math.abs(Math.floor(this.cellsY*(Ha.y+this._halfHeight)/this.height)),c=Math.abs(Math.floor(this.cellsZ*(Ha.z+this._halfDepth)/this.depth));a===this.cellsX&&(a=this.cellsX-1);b===this.cellsY&&(b=this.cellsY-1);c===this.cellsZ&&
(c=this.cellsZ-1);return a*this.cellsY*this.cellsZ+b*this.cellsZ+c};W.prototype.query=function(a,b,c){var d=this.cells;c.length=0;ua.min.copy(a).subScalar(b);ua.max.copy(a).addScalar(b);a=0;for(b=d.length;a<b;a++){var e=d[a];!1===e.empty()&&!0===e.intersects(ua)&&c.push.apply(c,$jscomp.arrayFromIterable(e.entries))}return c};W.prototype.makeEmpty=function(){for(var a=this.cells,b=0,c=a.length;b<c;b++)a[b].makeEmpty();return this};W.prototype.addPolygon=function(a){var b=this.cells;a.getContour(Sb);
ua.fromPoints(Sb);for(var c=0,d=b.length;c<d;c++){var e=b[c];!0===e.intersects(ua)&&e.add(a)}return this};var Tb=new E,X={a:new e,b:new e,c:new e},Ub=new e,Ia=new G,Vb=new w,hb=function(a){a=void 0===a?new Ya:a;var b=A.call(this)||this;b.geometry=a;return b};$jscomp.inherits(hb,A);hb.prototype.intersectRay=function(a,b){var c=this.geometry,d=c.aabb;Tb.copy(c.boundingSphere).applyMatrix4(this.worldMatrix);if(null!==a.intersectBoundingSphere(Tb,Ub)&&(Vb.getInverse(this.worldMatrix),Ia.copy(a).applyMatrix4(Vb),
null!==Ia.intersectAABB(d,Ub))){a=c.vertices;var e=c.indices;if(null===e)for(e=0,d=a.length;e<d;e+=9){if(X.a.set(a[e],a[e+1],a[e+2]),X.b.set(a[e+3],a[e+4],a[e+5]),X.c.set(a[e+6],a[e+7],a[e+8]),null!==Ia.intersectTriangle(X,c.backfaceCulling,b))return b.applyMatrix4(this.worldMatrix),b}else{var f=0;for(d=e.length;f<d;f+=3){var g=e[f],l=e[f+1],m=e[f+2];X.a.set(a[3*g],a[3*g+1],a[3*g+2]);X.b.set(a[3*l],a[3*l+1],a[3*l+2]);X.c.set(a[3*m],a[3*m+1],a[3*m+2]);if(null!==Ia.intersectTriangle(X,c.backfaceCulling,
b))return b.applyMatrix4(this.worldMatrix),b}}}return null};var Ja=new e,Wb=new e,ib=new G,Xb=new e,Ka=function(a){this.owner=void 0===a?null:a;this.obstacles=[]};Ka.prototype.addObstacle=function(a){this.obstacles.push(a);return this};Ka.prototype.removeObstacle=function(a){a=this.obstacles.indexOf(a);this.obstacles.splice(a,1);return this};Ka.prototype.visible=function(a){var b=this.owner,c=this.obstacles;Ja.subVectors(a,b.position);a=Ja.length();if(a>b.visualRange)return!1;b.getDirection(Wb);if(Wb.angleTo(Ja)>
.5*b.fieldOfView)return!1;ib.origin.copy(b.position);ib.direction.copy(Ja).divideScalar(a||1);for(var d=0,e=c.length;d<e;d++)if(null!==c[d].intersectRay(ib,Xb)&&Xb.squaredDistanceTo(b.position)<=a*a)return!1;return!0};var ca=function(){this.loop=!1;this._waypoints=[];this._index=0};ca.prototype.add=function(a){this._waypoints.push(a);return this};ca.prototype.clear=function(){this._index=this._waypoints.length=0;return this};ca.prototype.current=function(){return this._waypoints[this._index]};ca.prototype.finished=
function(){var a=this._waypoints.length-1;return!0===this.loop?!1:this._index===a};ca.prototype.advance=function(){this._index++;this._index===this._waypoints.length&&(!0===this.loop?this._index=0:this._index--);return this};var Yb=function(a){this.count=void 0===a?10:a;this._history=[];for(a=this._slot=0;a<this.count;a++)this._history[a]=new e};Yb.prototype.calculate=function(a,b){b.set(0,0,0);this._slot===this.count&&(this._slot=0);this._history[this._slot].copy(a);this._slot++;for(a=0;a<this.count;a++)b.add(this._history[a]);
b.divideScalar(this.count);return b};var u=function(){this.active=!0;this.weigth=1};u.prototype.calculate=function(){};var La=new e,da=function(a){this.vehicle=a;this.behaviors=[];this._steeringForce=new e};da.prototype.add=function(a){this.behaviors.push(a);return this};da.prototype.remove=function(a){a=this.behaviors.indexOf(a);this.behaviors.splice(a,1);return this};da.prototype.calculate=function(a,b){this._calculateByOrder(a);return b.copy(this._steeringForce)};da.prototype._accumulate=function(a){var b=
this._steeringForce.length();b=this.vehicle.maxForce-b;if(0>=b)return!1;a.length()>b&&a.normalize().multiplyScalar(b);this._steeringForce.add(a);return!0};da.prototype._calculateByOrder=function(a){var b=this.behaviors;this._steeringForce.set(0,0,0);for(var c=0,d=b.length;c<d;c++){var e=b[c];if(!0===e.active&&(La.set(0,0,0),e.calculate(this.vehicle,La,a),La.multiplyScalar(e.weigth),!1===this._accumulate(La)))break}};var Zb=new e,Ma=new e,$b=new e,va=new e,ac=new e,jb=function(){var a=Z.call(this)||
this;a.mass=1;a.maxForce=100;a.steering=new da(a);a.smoother=null;return a};$jscomp.inherits(jb,Z);jb.prototype.update=function(a){this.steering.calculate(a,Zb);$b.copy(Zb).divideScalar(this.mass);this.velocity.add($b.multiplyScalar(a));this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));Ma.copy(this.velocity).multiplyScalar(a);va.copy(this.position).add(Ma);!0===this.updateOrientation&&null===this.smoother&&1e-8<this.getSpeedSquared()&&
this.lookAt(va);this.position.copy(va);!0===this.updateOrientation&&null!==this.smoother&&(this.smoother.calculate(this.velocity,ac),Ma.copy(ac).multiplyScalar(a),va.copy(this.position).add(Ma),this.lookAt(va));return this};var Na=new e,Oa=new e,kb=function(){return u.call(this)||this};$jscomp.inherits(kb,u);kb.prototype.calculate=function(a,b){Na.set(0,0,0);for(var c=a.neighbors,d=0,e=c.length;d<e;d++)c[d].getDirection(Oa),Na.add(Oa);0<c.length&&(Na.divideScalar(c.length),a.getDirection(Oa),b.subVectors(Na,
Oa));return b};var bc=new e,lb=new e,wa=function(a,b){a=void 0===a?new e:a;b=void 0===b?3:b;var c=u.call(this)||this;c.target=a;c.deceleration=b;return c};$jscomp.inherits(wa,u);wa.prototype.calculate=function(a,b){var c=this.deceleration;lb.subVectors(this.target,a.position);var d=lb.length();0<d&&(c=Math.min(d/c,a.maxSpeed),bc.copy(lb).multiplyScalar(c/d),b.subVectors(bc,a.velocity));return b};var mb=new e,ka=function(a){a=void 0===a?new e:a;var b=u.call(this)||this;b.target=a;return b};$jscomp.inherits(ka,
u);ka.prototype.calculate=function(a,b){mb.subVectors(this.target,a.position).normalize();mb.multiplyScalar(a.maxSpeed);return b.subVectors(mb,a.velocity)};var Pa=new e,nb=function(){var a=u.call(this)||this;a._seek=new ka;return a};$jscomp.inherits(nb,u);nb.prototype.calculate=function(a,b){Pa.set(0,0,0);for(var c=a.neighbors,d=0,e=c.length;d<e;d++)Pa.add(c[d].position);0<c.length&&(Pa.divideScalar(c.length),this._seek.target=Pa,this._seek.calculate(a,b),b.normalize());return b};var xa=new e,Qa=
function(a,b){a=void 0===a?new e:a;b=void 0===b?10:b;var c=u.call(this)||this;c.target=a;c.panicDistance=b;return c};$jscomp.inherits(Qa,u);Qa.prototype.calculate=function(a,b){var c=this.target;a.position.squaredDistanceTo(c)<=this.panicDistance*this.panicDistance&&(xa.subVectors(a.position,c).normalize(),0===xa.squaredLength()&&xa.set(0,0,1),xa.multiplyScalar(a.maxSpeed),b.subVectors(xa,a.velocity));return b};var cc=new e,dc=new e,ec=new e,ob=function(a,b,c){a=void 0===a?null:a;b=void 0===b?10:
b;c=void 0===c?1:c;var d=u.call(this)||this;d.pursuer=a;d.panicDistance=b;d.predictionFactor=c;d._flee=new Qa;return d};$jscomp.inherits(ob,u);ob.prototype.calculate=function(a,b){var c=this.pursuer;cc.subVectors(c.position,a.position);var d=cc.length()/(a.maxSpeed+c.getSpeed());d*=this.predictionFactor;dc.copy(c.velocity).multiplyScalar(d);ec.addVectors(c.position,dc);this._flee.target=ec;this._flee.panicDistance=this.panicDistance;this._flee.calculate(a,b);return b};var pb=function(a,b){a=void 0===
a?new ca:a;b=void 0===b?1:b;var c=u.call(this)||this;c.path=a;c.nextWaypointDistance=b;c._arrive=new wa;c._seek=new ka;return c};$jscomp.inherits(pb,u);pb.prototype.calculate=function(a,b){var c=this.path;c.current().squaredDistanceTo(a.position)<this.nextWaypointDistance*this.nextWaypointDistance&&c.advance();var d=c.current();!0===c.finished()?(this._arrive.target=d,this._arrive.calculate(a,b)):(this._seek.target=d,this._seek.calculate(a,b));return b};var Ra=new e,Sa=new e,fc=new e,gc=new e,qb=
function(a,b,c){a=void 0===a?null:a;b=void 0===b?null:b;c=void 0===c?3:c;var d=u.call(this)||this;d.entity1=a;d.entity2=b;d.deceleration=c;d._arrive=new wa;return d};$jscomp.inherits(qb,u);qb.prototype.calculate=function(a,b){var c=this.entity1,d=this.entity2;Ra.addVectors(c.position,d.position).multiplyScalar(.5);var e=a.position.distanceTo(Ra)/a.maxSpeed;Sa.copy(c.velocity).multiplyScalar(e);fc.addVectors(c.position,Sa);Sa.copy(d.velocity).multiplyScalar(e);gc.addVectors(d.position,Sa);Ra.addVectors(fc,
gc).multiplyScalar(.5);this._arrive.deceleration=this.deceleration;this._arrive.target=Ra;this._arrive.calculate(a,b);return b};var hc=new w,la=new e,Ta=new e,rb=new e,sb=new E,rc=new G(new e(0,0,0),new e(0,0,1)),tb=function(a){a=void 0===a?[]:a;var b=u.call(this)||this;b.obstacles=a;b.brakingWeight=.2;b.dBoxMinLength=4;return b};$jscomp.inherits(tb,u);tb.prototype.calculate=function(a,b){var c=this.obstacles,d=null,e=Infinity,f=this.dBoxMinLength+a.getSpeed()/a.maxSpeed*this.dBoxMinLength;hc.getInverse(a.matrix);
for(var g=0,l=c.length;g<l;g++){var m=c[g];if(m!==a&&(la.copy(m.position).applyMatrix4(hc),0<la.z&&Math.abs(la.z)<f)){var n=m.boundingRadius+a.boundingRadius;Math.abs(la.x)<n&&(sb.center.copy(la),sb.radius=n,rc.intersectBoundingSphere(sb,rb),rb.z<e&&(e=rb.z,d=m,Ta.copy(la)))}}null!==d&&(b.x=(d.boundingRadius-Ta.x)*(1+(f-Ta.z)/f),b.z=(d.boundingRadius-Ta.z)*this.brakingWeight,b.applyRotation(a.rotation));return b};var ub=new e,vb=new e,ic=new e,jc=new e,kc=new e,wb=function(a,b){a=void 0===a?null:
a;b=void 0===b?1:b;var c=u.call(this)||this;c.evader=a;c.predictionFactor=b;c._seek=new ka;return c};$jscomp.inherits(wb,u);wb.prototype.calculate=function(a,b){var c=this.evader;ub.subVectors(c.position,a.position);a.getDirection(vb);c.getDirection(ic);var d=0<ub.dot(vb),e=-.95>vb.dot(ic);if(!0===d&&!0===e)return this._seek.target=c.position,this._seek.calculate(a,b),b;d=ub.length()/(a.maxSpeed+c.getSpeed());d*=this.predictionFactor;jc.copy(c.velocity).multiplyScalar(d);kc.addVectors(c.position,
jc);this._seek.target=kc;this._seek.calculate(a,b);return b};var Ua=new e,xb=function(){return u.call(this)||this};$jscomp.inherits(xb,u);xb.prototype.calculate=function(a,b){for(var c=a.neighbors,d=0,e=c.length;d<e;d++){Ua.subVectors(a.position,c[d].position);var f=Ua.length();0===f&&(f=.0001);Ua.normalize().divideScalar(f);b.add(Ua)}return b};var ya=new e,yb=new e,zb=function(a,b,c){a=void 0===a?1:a;b=void 0===b?5:b;c=void 0===c?5:c;var d=u.call(this)||this;d.radius=a;d.distance=b;d.jitter=c;d._targetLocal=
new e;a=d.radius;b=d._targetLocal;c=Math.random()*Math.PI*2;b.x=a*Math.cos(c);b.z=a*Math.sin(c);return d};$jscomp.inherits(zb,u);zb.prototype.calculate=function(a,b,c){c*=this.jitter;yb.x=D.randFloat(-1,1)*c;yb.z=D.randFloat(-1,1)*c;this._targetLocal.add(yb);this._targetLocal.normalize();this._targetLocal.multiplyScalar(this.radius);ya.copy(this._targetLocal);ya.z+=this.distance;ya.applyMatrix4(a.worldMatrix);b.subVectors(ya,a.position);return b};var za=function(){};za.prototype.touching=function(){return!1};
var lc=new E,Aa=function(a,b){a=void 0===a?new e:a;b=void 0===b?new e:b;this._aabb=new z(a,b);return this};$jscomp.inherits(Aa,za);Aa.prototype.fromPositionAndSize=function(a,b){this._aabb.fromCenterAndSize(a,b);return this};Aa.prototype.touching=function(a){lc.set(a.position,a.boundingRadius);return this._aabb.intersectsBoundingSphere(lc)};$jscomp.global.Object.defineProperties(Aa.prototype,{min:{configurable:!0,enumerable:!0,get:function(){return this._aabb.min},set:function(a){this._aabb.min=a}},
max:{configurable:!0,enumerable:!0,get:function(){return this._aabb.max},set:function(a){this._aabb.max=a}}});var mc=new E,Va=function(a,b){a=void 0===a?new e:a;this._boundingSphere=new E(a,void 0===b?0:b);return this};$jscomp.inherits(Va,za);Va.prototype.touching=function(a){mc.set(a.position,a.boundingRadius);return this._boundingSphere.intersectsBoundingSphere(mc)};$jscomp.global.Object.defineProperties(Va.prototype,{position:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.center},
set:function(a){this._boundingSphere.center=a}},radius:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.radius},set:function(a){this._boundingSphere.radius=a}}});var Wa=function(a){a=void 0===a?new za:a;this.active=!0;this.region=a};Wa.prototype.check=function(a){!0===this.active&&!0===this.region.touching(a)&&this.execute(a);return this};Wa.prototype.execute=function(){};Wa.prototype.update=function(){};d.EntityManager=F;d.EventDispatcher=ea;d.GameEntity=A;d.Logger=x;d.MeshGeometry=
Ya;d.MessageDispatcher=I;d.MovingEntity=Z;d.Regulator=Ib;d.Time=fa;d.Telegram=l;d.State=ha;d.StateMachine=K;d.CompositeGoal=L;d.Goal=t;d.GoalEvaluator=$a;d.Think=T;d.Edge=aa;d.Graph=C;d.Node=ab;d.PriorityQueue=U;d.AStar=ia;d.BFS=pa;d.DFS=qa;d.Dijkstra=ra;d.AABB=z;d.BoundingSphere=E;d.LineSegment=M;d.MathUtils=D;d.Matrix3=y;d.Matrix4=w;d.Plane=Q;d.Quaternion=v;d.Ray=G;d.Vector3=e;d.NavEdge=Ea;d.NavNode=Fa;d.GraphUtils=Ob;d.Corridor=Ga;d.HalfEdge=ja;d.NavMesh=H;d.NavMeshLoader=Qb;d.Polygon=N;d.Cell=
ba;d.CellSpacePartitioning=W;d.Obstacle=hb;d.Vision=Ka;d.Path=ca;d.Smoother=Yb;d.SteeringBehavior=u;d.SteeringManager=da;d.Vehicle=jb;d.AlignmentBehavior=kb;d.ArriveBehavior=wa;d.CohesionBehavior=nb;d.EvadeBehavior=ob;d.FleeBehavior=Qa;d.FollowPathBehavior=pb;d.InterposeBehavior=qb;d.ObstacleAvoidanceBehavior=tb;d.PursuitBehavior=wb;d.SeekBehavior=ka;d.SeparationBehavior=xb;d.WanderBehavior=zb;d.RectangularTriggerRegion=Aa;d.SphericalTriggerRegion=Va;d.TriggerRegion=za;d.Trigger=Wa;d.HeuristicPolicyEuclid=
bb;d.HeuristicPolicyEuclidSquared=Jb;d.HeuristicPolicyManhatten=Kb;d.HeuristicPolicyDijkstra=Lb;d.WorldUp=ma;Object.defineProperty(d,"__esModule",{value:!0})});
