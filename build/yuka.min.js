/*

 The MIT License

 Copyright Â© 2019 Yuka authors

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(d){var h=0;return function(){return h<d.length?{done:!1,value:d[h++]}:{done:!0}}};$jscomp.arrayIterator=function(d){return{next:$jscomp.arrayIteratorImpl(d)}};$jscomp.makeIterator=function(d){var h="undefined"!=typeof Symbol&&Symbol.iterator&&d[Symbol.iterator];return h?h.call(d):$jscomp.arrayIterator(d)};$jscomp.arrayFromIterator=function(d){for(var h,g=[];!(h=d.next()).done;)g.push(h.value);return g};
$jscomp.arrayFromIterable=function(d){return d instanceof Array?d:$jscomp.arrayFromIterator($jscomp.makeIterator(d))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(d){var h=function(){};h.prototype=d;return new h};$jscomp.underscoreProtoCanBeSet=function(){var d={a:!0},h={};try{return h.__proto__=d,h.a}catch(g){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(d,h){d.__proto__=h;if(d.__proto__!==h)throw new TypeError(d+" is not extensible");return d}:null;
$jscomp.inherits=function(d,h){d.prototype=$jscomp.objectCreate(h.prototype);d.prototype.constructor=d;if($jscomp.setPrototypeOf){var g=$jscomp.setPrototypeOf;g(d,h)}else for(g in h)if("prototype"!=g)if(Object.defineProperties){var q=Object.getOwnPropertyDescriptor(h,g);q&&Object.defineProperty(d,g,q)}else d[g]=h[g];d.superClass_=h.prototype};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,h,g){d!=Array.prototype&&d!=Object.prototype&&(d[h]=g.value)};$jscomp.polyfill=function(d,h,g,q){if(h){g=$jscomp.global;d=d.split(".");for(q=0;q<d.length-1;q++){var m=d[q];m in g||(g[m]={});g=g[m]}d=d[d.length-1];q=g[d];h=h(q);h!=q&&null!=h&&$jscomp.defineProperty(g,d,{configurable:!0,writable:!0,value:h})}};
$jscomp.polyfill("Number.EPSILON",function(d){return Math.pow(2,-52)},"es6","es3");$jscomp.polyfill("Math.sign",function(d){return d?d:function(d){d=Number(d);return 0===d||isNaN(d)?d:0<d?1:-1}},"es6","es3");$jscomp.checkEs6ConformanceViaProxy=function(){try{var d={},h=Object.create(new $jscomp.global.Proxy(d,{get:function(g,q,m){return g==d&&"q"==q&&m==h}}));return!0===h.q}catch(g){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;
$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(d,h){this.$jscomp$symbol$id_=d;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:h})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function d(g){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(g||"")+"_"+h++,g)}var h=0;return d}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.asyncIterator;d||(d=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.owns=function(d,h){return Object.prototype.hasOwnProperty.call(d,h)};
$jscomp.polyfill("WeakMap",function(d){function h(){if(!d||!Object.seal)return!1;try{var y=Object.seal({}),h=Object.seal({}),g=new d([[y,2],[h,3]]);if(2!=g.get(y)||3!=g.get(h))return!1;g.delete(y);g.set(h,4);return!g.has(y)&&4==g.get(h)}catch(A){return!1}}function g(){}function q(d){if(!$jscomp.owns(d,u)){var y=new g;$jscomp.defineProperty(d,u,{value:y})}}function m(d){var y=Object[d];y&&(Object[d]=function(d){if(d instanceof g)return d;q(d);return y(d)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&
$jscomp.ES6_CONFORMANCE)return d}else if(h())return d;var u="$jscomp_hidden_"+Math.random();m("freeze");m("preventExtensions");m("seal");var l=0,ma=function(d){this.id_=(l+=Math.random()+1).toString();if(d){d=$jscomp.makeIterator(d);for(var y;!(y=d.next()).done;)y=y.value,this.set(y[0],y[1])}};ma.prototype.set=function(d,g){q(d);if(!$jscomp.owns(d,u))throw Error("WeakMap key fail: "+d);d[u][this.id_]=g;return this};ma.prototype.get=function(d){return $jscomp.owns(d,u)?d[u][this.id_]:void 0};ma.prototype.has=
function(d){return $jscomp.owns(d,u)&&$jscomp.owns(d[u],this.id_)};ma.prototype.delete=function(d){return $jscomp.owns(d,u)&&$jscomp.owns(d[u],this.id_)?delete d[u][this.id_]:!1};return ma},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(d){function h(){if($jscomp.ASSUME_NO_NATIVE_MAP||!d||"function"!=typeof d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var y=Object.seal({x:4}),g=new d($jscomp.makeIterator([[y,"s"]]));if("s"!=g.get(y)||1!=g.size||g.get({x:4})||g.set({x:4},"t")!=g||2!=g.size)return!1;var h=g.entries(),l=h.next();if(l.done||l.value[0]!=y||"s"!=l.value[1])return!1;l=h.next();return l.done||4!=l.value[0].x||"t"!=l.value[1]||!h.next().done?!1:!0}catch(ob){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(h())return d;$jscomp.initSymbolIterator();var g=new WeakMap,q=function(d){this.data_={};this.head_=l();this.size=0;if(d){d=$jscomp.makeIterator(d);for(var g;!(g=d.next()).done;)g=g.value,this.set(g[0],g[1])}};q.prototype.set=function(d,g){d=0===d?0:d;var h=m(this,d);h.list||(h.list=this.data_[h.id]=[]);h.entry?h.entry.value=g:(h.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:d,
value:g},h.list.push(h.entry),this.head_.previous.next=h.entry,this.head_.previous=h.entry,this.size++);return this};q.prototype.delete=function(d){d=m(this,d);return d.entry&&d.list?(d.list.splice(d.index,1),d.list.length||delete this.data_[d.id],d.entry.previous.next=d.entry.next,d.entry.next.previous=d.entry.previous,d.entry.head=null,this.size--,!0):!1};q.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=l();this.size=0};q.prototype.has=function(d){return!!m(this,d).entry};
q.prototype.get=function(d){return(d=m(this,d).entry)&&d.value};q.prototype.entries=function(){return u(this,function(d){return[d.key,d.value]})};q.prototype.keys=function(){return u(this,function(d){return d.key})};q.prototype.values=function(){return u(this,function(d){return d.value})};q.prototype.forEach=function(d,g){for(var h=this.entries(),l;!(l=h.next()).done;)l=l.value,d.call(g,l[1],l[0],this)};q.prototype[Symbol.iterator]=q.prototype.entries;var m=function(d,h){var l=h&&typeof h;"object"==
l||"function"==l?g.has(h)?l=g.get(h):(l=""+ ++ma,g.set(h,l)):l="p_"+h;var q=d.data_[l];if(q&&$jscomp.owns(d.data_,l))for(d=0;d<q.length;d++){var m=q[d];if(h!==h&&m.key!==m.key||h===m.key)return{id:l,list:q,index:d,entry:m}}return{id:l,list:q,index:-1,entry:void 0}},u=function(d,h){var g=d.head_;return $jscomp.iteratorPrototype(function(){if(g){for(;g.head!=d.head_;)g=g.previous;for(;g.next!=g.head;)return g=g.next,{done:!1,value:h(g)};g=null}return{done:!0,value:void 0}})},l=function(){var d={};return d.previous=
d.next=d.head=d},ma=0;return q},"es6","es3");$jscomp.iteratorFromArray=function(d,h){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var g=0,q={next:function(){if(g<d.length){var m=g++;return{value:h(m,d[m]),done:!1}}q.next=function(){return{done:!0,value:void 0}};return q.next()}};q[Symbol.iterator]=function(){return q};return q};$jscomp.polyfill("Array.prototype.values",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,g){return g})}},"es8","es3");
$jscomp.polyfill("Array.from",function(d){return d?d:function(d,g,q){g=null!=g?g:function(d){return d};var h=[],u="undefined"!=typeof Symbol&&Symbol.iterator&&d[Symbol.iterator];if("function"==typeof u){d=u.call(d);for(var l=0;!(u=d.next()).done;)h.push(g.call(q,u.value,l++))}else for(u=d.length,l=0;l<u;l++)h.push(g.call(q,d[l],l));return h}},"es6","es3");
$jscomp.polyfill("Array.prototype.entries",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,g){return[d,g]})}},"es6","es3");
$jscomp.polyfill("Set",function(d){function h(){if($jscomp.ASSUME_NO_NATIVE_SET||!d||"function"!=typeof d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var g=Object.seal({x:4}),h=new d($jscomp.makeIterator([g]));if(!h.has(g)||1!=h.size||h.add(g)!=h||1!=h.size||h.add({x:4})!=h||2!=h.size)return!1;var u=h.entries(),l=u.next();if(l.done||l.value[0]!=g||l.value[1]!=g)return!1;l=u.next();return l.done||l.value[0]==g||4!=l.value[0].x||l.value[1]!=l.value[0]?!1:u.next().done}catch(ma){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(h())return d;$jscomp.initSymbolIterator();var g=function(d){this.map_=new Map;if(d){d=$jscomp.makeIterator(d);for(var g;!(g=d.next()).done;)this.add(g.value)}this.size=this.map_.size};g.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};g.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};g.prototype.clear=function(){this.map_.clear();
this.size=0};g.prototype.has=function(d){return this.map_.has(d)};g.prototype.entries=function(){return this.map_.entries()};g.prototype.values=function(){return this.map_.values()};g.prototype.keys=g.prototype.values;g.prototype[Symbol.iterator]=g.prototype.values;g.prototype.forEach=function(d,g){var h=this;this.map_.forEach(function(l){return d.call(g,l,l,h)})};return g},"es6","es3");
$jscomp.polyfill("Object.is",function(d){return d?d:function(d,g){return d===g?0!==d||1/d===1/g:d!==d&&g!==g}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(d){return d?d:function(d,g){var h=this;h instanceof String&&(h=String(h));var m=h.length;g=g||0;for(0>g&&(g=Math.max(g+m,0));g<m;g++){var u=h[g];if(u===d||Object.is(u,d))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(d,h,g){if(null==d)throw new TypeError("The 'this' value for String.prototype."+g+" must not be null or undefined");if(h instanceof RegExp)throw new TypeError("First argument to String.prototype."+g+" must not be a regular expression");return d+""};$jscomp.polyfill("String.prototype.includes",function(d){return d?d:function(d,g){return-1!==$jscomp.checkStringArgs(this,d,"includes").indexOf(d,g||0)}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(d){function h(){this.batch_=null}function g(d){return d instanceof m?d:new m(function(g,h){g(d)})}if(d&&!$jscomp.FORCE_POLYFILL_PROMISE)return d;h.prototype.asyncExecute=function(d){if(null==this.batch_){this.batch_=[];var g=this;this.asyncExecuteFunction(function(){g.executeBatch_()})}this.batch_.push(d)};var q=$jscomp.global.setTimeout;h.prototype.asyncExecuteFunction=function(d){q(d,0)};h.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var d=
this.batch_;this.batch_=[];for(var g=0;g<d.length;++g){var h=d[g];d[g]=null;try{h()}catch(nb){this.asyncThrow_(nb)}}}this.batch_=null};h.prototype.asyncThrow_=function(d){this.asyncExecuteFunction(function(){throw d;})};var m=function(d){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var g=this.createResolveAndReject_();try{d(g.resolve,g.reject)}catch(y){g.reject(y)}};m.prototype.createResolveAndReject_=function(){function d(d){return function(l){h||(h=!0,d.call(g,l))}}var g=this,h=
!1;return{resolve:d(this.resolveTo_),reject:d(this.reject_)}};m.prototype.resolveTo_=function(d){if(d===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(d instanceof m)this.settleSameAsPromise_(d);else{a:switch(typeof d){case "object":var g=null!=d;break a;case "function":g=!0;break a;default:g=!1}g?this.resolveToNonPromiseObj_(d):this.fulfill_(d)}};m.prototype.resolveToNonPromiseObj_=function(d){var g=void 0;try{g=d.then}catch(y){this.reject_(y);return}"function"==typeof g?
this.settleSameAsThenable_(g,d):this.fulfill_(d)};m.prototype.reject_=function(d){this.settle_(2,d)};m.prototype.fulfill_=function(d){this.settle_(1,d)};m.prototype.settle_=function(d,g){if(0!=this.state_)throw Error("Cannot settle("+d+", "+g+"): Promise already settled in state"+this.state_);this.state_=d;this.result_=g;this.executeOnSettledCallbacks_()};m.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var d=0;d<this.onSettledCallbacks_.length;++d)u.asyncExecute(this.onSettledCallbacks_[d]);
this.onSettledCallbacks_=null}};var u=new h;m.prototype.settleSameAsPromise_=function(d){var g=this.createResolveAndReject_();d.callWhenSettled_(g.resolve,g.reject)};m.prototype.settleSameAsThenable_=function(d,g){var h=this.createResolveAndReject_();try{d.call(g,h.resolve,h.reject)}catch(nb){h.reject(nb)}};m.prototype.then=function(d,g){function h(d,g){return"function"==typeof d?function(g){try{l(d(g))}catch(Ga){q(Ga)}}:g}var l,q,A=new m(function(d,g){l=d;q=g});this.callWhenSettled_(h(d,l),h(g,q));
return A};m.prototype.catch=function(d){return this.then(void 0,d)};m.prototype.callWhenSettled_=function(d,g){function h(){switch(l.state_){case 1:d(l.result_);break;case 2:g(l.result_);break;default:throw Error("Unexpected state: "+l.state_);}}var l=this;null==this.onSettledCallbacks_?u.asyncExecute(h):this.onSettledCallbacks_.push(h)};m.resolve=g;m.reject=function(d){return new m(function(g,h){h(d)})};m.race=function(d){return new m(function(h,l){for(var q=$jscomp.makeIterator(d),m=q.next();!m.done;m=
q.next())g(m.value).callWhenSettled_(h,l)})};m.all=function(d){var h=$jscomp.makeIterator(d),l=h.next();return l.done?g([]):new m(function(d,m){function q(g){return function(h){u[g]=h;y--;0==y&&d(u)}}var u=[],y=0;do u.push(void 0),y++,g(l.value).callWhenSettled_(q(u.length-1),m),l=h.next();while(!l.done)})};return m},"es6","es3");
(function(d,h){"object"===typeof exports&&"undefined"!==typeof module?h(exports):"function"===typeof define&&define.amd?define(["exports"],h):(d=d||self,h(d.YUKA={}))})(this,function(d){function h(a){for(var b=[],c=0,e=a.length;c<e;c++)b.push(a[c].uuid);return b}function g(){!0===this.detectPageVisibility&&!1===document.hidden&&(this.currentTime=this.now())}function q(a,b,c){return 1/Math.sqrt(2*Math.PI*c)*Math.exp(-Math.pow(a-b,2)/(2*c))}function m(a,b){return a<b?-1:a>b?1:0}function u(a,b){return a.cost<
b.cost?-1:a.cost>b.cost?1:0}function l(a,b){return a.cost<b.cost?-1:a.cost>b.cost?1:0}function ma(a,b){return a.cost<b.cost?1:a.cost>b.cost?-1:0}function y(a,b){return"string"!==typeof a||""===a?"":/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:b+a}function nb(a){for(var b=this.tasks;0<a.timeRemaining()&&0<b.length;)b[0].execute(),b.shift();0<b.length?(this._taskHandle=requestIdleCallback(this._handler,this.options),this._active=!0):(this._taskHandle=0,this._active=!1)}
var Ua=function(a,b,c,e,n){this.sender=a;this.receiver=b;this.message=c;this.delay=e;this.data=n};Ua.prototype.toJSON=function(){return{type:this.constructor.name,sender:this.sender?this.sender.uuid:null,receiver:this.receiver?this.receiver.uuid:null,message:this.message,delay:this.delay,data:this.data}};Ua.prototype.fromJSON=function(a){this.sender=a.sender;this.receiver=a.receiver;this.message=a.message;this.delay=a.delay;this.data=a.data;return this};Ua.prototype.resolveReferences=function(a){this.sender=
a.get(this.sender);this.receiver=a.get(this.receiver);return this};var A=function(){};A.setLevel=function(a){ob=a};A.log=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];ob<=A.LEVEL.LOG&&console.log.apply(console,$jscomp.arrayFromIterable(b))};A.warn=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];ob<=A.LEVEL.WARN&&console.warn.apply(console,$jscomp.arrayFromIterable(b))};A.error=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];
ob<=A.LEVEL.ERROR&&console.error.apply(console,$jscomp.arrayFromIterable(b))};A.LEVEL=Object.freeze({LOG:0,WARN:1,ERROR:2,SILENT:3});var ob=A.LEVEL.WARN,sa=function(){this.delayedTelegrams=[]};sa.prototype.deliver=function(a){var b=a.receiver;!1===b.handleMessage(a)&&A.warn("YUKA.MessageDispatcher: Message not handled by receiver: %o",b);return this};sa.prototype.dispatch=function(a,b,c,e,n){a=new Ua(a,b,c,e,n);0>=e?this.deliver(a):this.delayedTelegrams.push(a);return this};sa.prototype.dispatchDelayedMessages=
function(a){for(var b=this.delayedTelegrams.length;b--;){var c=this.delayedTelegrams[b];c.delay-=a;0>=c.delay&&(this.deliver(c),this.delayedTelegrams.pop())}return this};sa.prototype.clear=function(){this.delayedTelegrams.length=0;return this};sa.prototype.toJSON=function(){for(var a={type:this.constructor.name,delayedTelegrams:[]},b=0,c=this.delayedTelegrams.length;b<c;b++)a.delayedTelegrams.push(this.delayedTelegrams[b].toJSON());return a};sa.prototype.fromJSON=function(a){this.clear();a=a.delayedTelegrams;
for(var b=0,c=a.length;b<c;b++){var e=a[b];e=(new Ua).fromJSON(e);this.delayedTelegrams.push(e)}return this};sa.prototype.resolveReferences=function(a){for(var b=this.delayedTelegrams,c=0,e=b.length;c<e;c++)b[c].resolveReferences(a);return this};for(var Q=[],Ga=0;256>Ga;Ga++)Q[Ga]=(16>Ga?"0":"")+Ga.toString(16);var I=function(){};I.clamp=function(a,b,c){return Math.max(b,Math.min(c,a))};I.randInt=function(a,b){return a+Math.floor(Math.random()*(b-a+1))};I.randFloat=function(a,b){return a+Math.random()*
(b-a)};I.area=function(a,b,c){return(c.x-a.x)*(b.z-a.z)-(b.x-a.x)*(c.z-a.z)};I.generateUUID=function(){var a=4294967295*Math.random()|0,b=4294967295*Math.random()|0,c=4294967295*Math.random()|0,e=4294967295*Math.random()|0;return(Q[a&255]+Q[a>>8&255]+Q[a>>16&255]+Q[a>>24&255]+"-"+Q[b&255]+Q[b>>8&255]+"-"+Q[b>>16&15|64]+Q[b>>24&255]+"-"+Q[c&63|128]+Q[c>>8&255]+"-"+Q[c>>16&255]+Q[c>>24&255]+Q[e&255]+Q[e>>8&255]+Q[e>>16&255]+Q[e>>24&255]).toUpperCase()};var f=function(a,b,c){this.x=void 0===a?0:a;this.y=
void 0===b?0:b;this.z=void 0===c?0:c};f.prototype.set=function(a,b,c){this.x=a;this.y=b;this.z=c;return this};f.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};f.prototype.clone=function(){return(new this.constructor).copy(this)};f.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};f.prototype.addScalar=function(a){this.x+=a;this.y+=a;this.z+=a;return this};f.prototype.addVectors=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this};
f.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};f.prototype.subScalar=function(a){this.x-=a;this.y-=a;this.z-=a;return this};f.prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this};f.prototype.multiply=function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this};f.prototype.multiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};f.prototype.multiplyVectors=function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this};
f.prototype.divide=function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this};f.prototype.divideScalar=function(a){this.x/=a;this.y/=a;this.z/=a;return this};f.prototype.divideVectors=function(a,b){this.x=a.x/b.x;this.y=a.y/b.y;this.z=a.z/b.z;return this};f.prototype.reflect=function(a){return this.sub(Zd.copy(a).multiplyScalar(2*this.dot(a)))};f.prototype.clamp=function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));
return this};f.prototype.min=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this};f.prototype.max=function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this};f.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};f.prototype.cross=function(a){var b=this.x,c=this.y,e=this.z;this.x=c*a.z-e*a.y;this.y=e*a.x-b*a.z;this.z=b*a.y-c*a.x;return this};f.prototype.crossVectors=function(a,b){var c=
a.x,e=a.y;a=a.z;var n=b.x,d=b.y;b=b.z;this.x=e*b-a*d;this.y=a*n-c*b;this.z=c*d-e*n;return this};f.prototype.angleTo=function(a){a=this.dot(a)/Math.sqrt(this.squaredLength()*a.squaredLength());return Math.acos(I.clamp(a,-1,1))};f.prototype.length=function(){return Math.sqrt(this.squaredLength())};f.prototype.squaredLength=function(){return this.dot(this)};f.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)};f.prototype.distanceTo=function(a){return Math.sqrt(this.squaredDistanceTo(a))};
f.prototype.squaredDistanceTo=function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a};f.prototype.manhattanDistanceTo=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)};f.prototype.normalize=function(){return this.divideScalar(this.length()||1)};f.prototype.applyMatrix4=function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;var n=1/(a[3]*b+a[7]*c+a[11]*e+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*e+a[12])*n;this.y=(a[1]*b+a[5]*c+a[9]*e+a[13])*n;this.z=(a[2]*
b+a[6]*c+a[10]*e+a[14])*n;return this};f.prototype.applyRotation=function(a){var b=this.x,c=this.y,e=this.z,n=a.x,d=a.y,k=a.z;a=a.w;var pb=a*b+d*e-k*c,f=a*c+k*b-n*e,g=a*e+n*c-d*b;b=-n*b-d*c-k*e;this.x=pb*a+b*-n+f*-k-g*-d;this.y=f*a+b*-d+g*-n-pb*-k;this.z=g*a+b*-k+pb*-d-f*-n;return this};f.prototype.extractPositionFromMatrix=function(a){a=a.elements;this.x=a[12];this.y=a[13];this.z=a[14];return this};f.prototype.transformDirection=function(a){var b=this.x,c=this.y,e=this.z;a=a.elements;this.x=a[0]*
b+a[4]*c+a[8]*e;this.y=a[1]*b+a[5]*c+a[9]*e;this.z=a[2]*b+a[6]*c+a[10]*e;return this.normalize()};f.prototype.fromMatrix3Column=function(a,b){return this.fromArray(a.elements,3*b)};f.prototype.fromMatrix4Column=function(a,b){return this.fromArray(a.elements,4*b)};f.prototype.fromSpherical=function(a,b,c){var e=Math.sin(b)*a;this.x=e*Math.sin(c);this.y=Math.cos(b)*a;this.z=e*Math.cos(c);return this};f.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];return this};
f.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a};f.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z};var Zd=new f,mc=new f(0,1,0),Zc=new f,qb=new f,$c=new f,ad=new f,nc=[2,2,1],oc=[1,0,0],B=function(){this.elements=[1,0,0,0,1,0,0,0,1]};B.prototype.set=function(a,b,c,e,n,d,k,pb,f){var p=this.elements;p[0]=a;p[3]=b;p[6]=c;p[1]=e;p[4]=n;p[7]=d;p[2]=k;p[5]=pb;p[8]=f;return this};B.prototype.copy=function(a){var b=this.elements;
a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this};B.prototype.clone=function(){return(new this.constructor).copy(this)};B.prototype.identity=function(){this.set(1,0,0,0,1,0,0,0,1);return this};B.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};B.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};B.prototype.multiplyMatrices=function(a,b){var c=a.elements,e=b.elements;b=this.elements;a=c[0];var n=
c[3],d=c[6],k=c[1],f=c[4],g=c[7],h=c[2],r=c[5];c=c[8];var l=e[0],m=e[3],q=e[6],t=e[1],pc=e[4],qc=e[7],v=e[2],u=e[5];e=e[8];b[0]=a*l+n*t+d*v;b[3]=a*m+n*pc+d*u;b[6]=a*q+n*qc+d*e;b[1]=k*l+f*t+g*v;b[4]=k*m+f*pc+g*u;b[7]=k*q+f*qc+g*e;b[2]=h*l+r*t+c*v;b[5]=h*m+r*pc+c*u;b[8]=h*q+r*qc+c*e;return this};B.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this};B.prototype.extractBasis=function(a,b,c){a.fromMatrix3Column(this,
0);b.fromMatrix3Column(this,1);c.fromMatrix3Column(this,2);return this};B.prototype.makeBasis=function(a,b,c){this.set(a.x,b.x,c.x,a.y,b.y,c.y,a.z,b.z,c.z);return this};B.prototype.lookAt=function(a,b,c){Zc.crossVectors(c,a).normalize();qb.crossVectors(mc,b).normalize();0===qb.squaredLength()&&(ad.copy(b).addScalar(Number.EPSILON),qb.crossVectors(mc,ad).normalize());$c.crossVectors(b,qb).normalize();Va.makeBasis(qb,$c,b);Jb.makeBasis(Zc,c,a);this.multiplyMatrices(Va,Jb.transpose());return this};B.prototype.transpose=
function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this};B.prototype.getElementIndex=function(a,b){return 3*a+b};B.prototype.frobeniusNorm=function(){for(var a=this.elements,b=0,c=0;9>c;c++)b+=a[c]*a[c];return Math.sqrt(b)};B.prototype.offDiagonalFrobeniusNorm=function(){for(var a=this.elements,b=0,c=0;3>c;c++){var e=a[this.getElementIndex(nc[c],oc[c])];b+=2*e*e}return Math.sqrt(b)};B.prototype.eigenDecomposition=function(a){var b=0,c=
0;a.unitary.identity();a.diagonal.copy(this);for(var e=a.unitary,n=a.diagonal,d=Number.EPSILON*n.frobeniusNorm();10>c&&n.offDiagonalFrobeniusNorm()>d;)n.shurDecomposition(Va),Jb.copy(Va).transpose(),n.multiply(Va),n.premultiply(Jb),e.multiply(Va),2<++b&&(c++,b=0);return a};B.prototype.shurDecomposition=function(a){for(var b=0,c=1,e=this.elements,n=0;3>n;n++){var d=Math.abs(e[this.getElementIndex(nc[n],oc[n])]);d>b&&(b=d,c=n)}n=1;d=0;b=oc[c];c=nc[c];Math.abs(e[this.getElementIndex(c,b)])>Number.EPSILON&&
(n=e[this.getElementIndex(c,c)],d=e[this.getElementIndex(b,b)],e=e[this.getElementIndex(c,b)],e=(n-d)/2/e,e=0>e?-1/(-e+Math.sqrt(1+e*e)):1/(e+Math.sqrt(1+e*e)),n=1/Math.sqrt(1+e*e),d=e*n);a.identity();a.elements[this.getElementIndex(b,b)]=n;a.elements[this.getElementIndex(c,c)]=n;a.elements[this.getElementIndex(c,b)]=d;a.elements[this.getElementIndex(b,c)]=-d;return a};B.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,e=a.y,n=a.z,d=a.w,k=c+c,f=e+e,g=n+n;a=c*k;var h=c*f;c*=g;var r=e*
f;e*=g;n*=g;k*=d;f*=d;d*=g;b[0]=1-(r+n);b[3]=h-d;b[6]=c+f;b[1]=h+d;b[4]=1-(a+n);b[7]=e-k;b[2]=c-f;b[5]=e+k;b[8]=1-(a+r);return this};B.prototype.fromMatrix4=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return this};B.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,e=0;9>e;e++)c[e]=a[e+b];return this};B.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=this.elements;a[b+0]=c[0];
a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a};B.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var c=0;9>c;c++)if(b[c]!==a[c])return!1;return!0};var Va=new B,Jb=new B,Kb=new B,rc=new f,C=function(a,b,c,e){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c;this.w=void 0===e?1:e};C.prototype.set=function(a,b,c,e){this.x=a;this.y=b;this.z=c;this.w=e;return this};C.prototype.copy=function(a){this.x=a.x;this.y=
a.y;this.z=a.z;this.w=a.w;return this};C.prototype.clone=function(){return(new this.constructor).copy(this)};C.prototype.inverse=function(){return this.conjugate().normalize()};C.prototype.conjugate=function(){this.x*=-1;this.y*=-1;this.z*=-1;return this};C.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w};C.prototype.length=function(){return Math.sqrt(this.squaredLength())};C.prototype.squaredLength=function(){return this.dot(this)};C.prototype.normalize=function(){var a=
this.length();0===a?(this.z=this.y=this.x=0,this.w=1):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this};C.prototype.multiply=function(a){return this.multiplyQuaternions(this,a)};C.prototype.premultiply=function(a){return this.multiplyQuaternions(a,this)};C.prototype.multiplyQuaternions=function(a,b){var c=a.x,e=a.y,n=a.z;a=a.w;var d=b.x,k=b.y,f=b.z;b=b.w;this.x=c*b+a*d+e*f-n*k;this.y=e*b+a*k+n*d-c*f;this.z=n*b+a*f+c*k-e*d;this.w=a*b-c*d-e*k-n*f;return this};C.prototype.angleTo=function(a){return 2*
Math.acos(Math.abs(I.clamp(this.dot(a),-1,1)))};C.prototype.rotateTo=function(a,b,c){c=void 0===c?1E-4:c;var e=this.angleTo(a);if(e<c)return!0;this.slerp(a,Math.min(1,b/e));return!1};C.prototype.lookAt=function(a,b,c){Kb.lookAt(a,b,c);this.fromMatrix3(Kb)};C.prototype.slerp=function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this.x,e=this.y,n=this.z,d=this.w,k=d*a.w+c*a.x+e*a.y+n*a.z;0>k?(this.w=-a.w,this.x=-a.x,this.y=-a.y,this.z=-a.z,k=-k):this.copy(a);if(1<=k)return this.w=d,
this.x=c,this.y=e,this.z=n,this;a=Math.sqrt(1-k*k);if(.001>Math.abs(a))return this.w=.5*(d+this.w),this.x=.5*(c+this.x),this.y=.5*(e+this.y),this.z=.5*(n+this.z),this;var f=Math.atan2(a,k);k=Math.sin((1-b)*f)/a;b=Math.sin(b*f)/a;this.w=d*k+this.w*b;this.x=c*k+this.x*b;this.y=e*k+this.y*b;this.z=n*k+this.z*b;return this};C.prototype.extractRotationFromMatrix=function(a){var b=Kb.elements,c=a.elements,e=1/rc.fromMatrix4Column(a,0).length(),n=1/rc.fromMatrix4Column(a,1).length();a=1/rc.fromMatrix4Column(a,
2).length();b[0]=c[0]*e;b[1]=c[1]*e;b[2]=c[2]*e;b[3]=c[4]*n;b[4]=c[5]*n;b[5]=c[6]*n;b[6]=c[8]*a;b[7]=c[9]*a;b[8]=c[10]*a;this.fromMatrix3(Kb);return this};C.prototype.fromEuler=function(a,b,c){var e=Math.cos(b/2),n=Math.cos(a/2),d=Math.cos(c/2);b=Math.sin(b/2);a=Math.sin(a/2);c=Math.sin(c/2);this.w=e*n*d+b*a*c;this.x=e*a*d+b*n*c;this.y=b*n*d-e*a*c;this.z=e*n*c-b*a*d;return this};C.prototype.toEuler=function(a){var b=-2*(this.y*this.z-this.x*this.w);.9999<Math.abs(b)?(a.x=.5*Math.PI*b,a.y=Math.atan2(this.x*
this.z+this.w*this.y,.5-this.x*this.x-this.y*this.y),a.z=0):(a.x=Math.asin(b),a.y=Math.atan2(this.x*this.z+this.w*this.y,.5-this.x*this.x-this.y*this.y),a.z=Math.atan2(this.x*this.y+this.w*this.z,.5-this.x*this.x-this.z*this.z));return a};C.prototype.fromMatrix3=function(a){var b=a.elements,c=b[0];a=b[3];var e=b[6],n=b[1],d=b[4],k=b[7],f=b[2],g=b[5];b=b[8];var h=c+d+b;0<h?(c=.5/Math.sqrt(h+1),this.w=.25/c,this.x=(g-k)*c,this.y=(e-f)*c,this.z=(n-a)*c):c>d&&c>b?(c=2*Math.sqrt(1+c-d-b),this.w=(g-k)/
c,this.x=.25*c,this.y=(a+n)/c,this.z=(e+f)/c):d>b?(c=2*Math.sqrt(1+d-c-b),this.w=(e-f)/c,this.x=(a+n)/c,this.y=.25*c,this.z=(k+g)/c):(c=2*Math.sqrt(1+b-c-d),this.w=(n-a)/c,this.x=(e+f)/c,this.y=(k+g)/c,this.z=.25*c);return this};C.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this};C.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a};C.prototype.equals=function(a){return a.x===
this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w};var x=function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};x.prototype.set=function(a,b,c,e,n,d,k,f,g,h,r,l,m,q,t,v){var p=this.elements;p[0]=a;p[4]=b;p[8]=c;p[12]=e;p[1]=n;p[5]=d;p[9]=k;p[13]=f;p[2]=g;p[6]=h;p[10]=r;p[14]=l;p[3]=m;p[7]=q;p[11]=t;p[15]=v;return this};x.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=
a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this};x.prototype.clone=function(){return(new this.constructor).copy(this)};x.prototype.identity=function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};x.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};x.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};x.prototype.multiplyMatrices=function(a,b){var c=a.elements,e=b.elements;b=this.elements;a=c[0];var n=c[4],d=c[8],k=c[12],f=c[1],g=c[5],
h=c[9],r=c[13],l=c[2],m=c[6],q=c[10],t=c[14],v=c[3],u=c[7],w=c[11];c=c[15];var A=e[0],z=e[4],B=e[8],y=e[12],C=e[1],x=e[5],D=e[9],E=e[13],F=e[2],G=e[6],H=e[10],I=e[14],J=e[3],K=e[7],L=e[11];e=e[15];b[0]=a*A+n*C+d*F+k*J;b[4]=a*z+n*x+d*G+k*K;b[8]=a*B+n*D+d*H+k*L;b[12]=a*y+n*E+d*I+k*e;b[1]=f*A+g*C+h*F+r*J;b[5]=f*z+g*x+h*G+r*K;b[9]=f*B+g*D+h*H+r*L;b[13]=f*y+g*E+h*I+r*e;b[2]=l*A+m*C+q*F+t*J;b[6]=l*z+m*x+q*G+t*K;b[10]=l*B+m*D+q*H+t*L;b[14]=l*y+m*E+q*I+t*e;b[3]=v*A+u*C+w*F+c*J;b[7]=v*z+u*x+w*G+c*K;b[11]=
v*B+u*D+w*H+c*L;b[15]=v*y+u*E+w*I+c*e;return this};x.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this};x.prototype.extractBasis=function(a,b,c){a.fromMatrix4Column(this,0);b.fromMatrix4Column(this,1);c.fromMatrix4Column(this,2);return this};x.prototype.makeBasis=function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this};
x.prototype.compose=function(a,b,c){this.fromQuaternion(b);this.scale(c);this.setPosition(a);return this};x.prototype.scale=function(a){var b=this.elements,c=a.x,e=a.y;a=a.z;b[0]*=c;b[4]*=e;b[8]*=a;b[1]*=c;b[5]*=e;b[9]*=a;b[2]*=c;b[6]*=e;b[10]*=a;b[3]*=c;b[7]*=e;b[11]*=a;return this};x.prototype.setPosition=function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this};x.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=
a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this};x.prototype.getInverse=function(a){var b=this.elements,c=a.elements,e=b[0],n=b[1],d=b[2],k=b[3],f=b[4],g=b[5],h=b[6],r=b[7],l=b[8],m=b[9],q=b[10],t=b[11],v=b[12],u=b[13],w=b[14];b=b[15];var z=m*w*r-u*q*r+u*h*t-g*w*t-m*h*b+g*q*b,B=v*q*r-l*w*r-v*h*t+f*w*t+l*h*b-f*q*b,y=l*u*r-v*m*r+v*g*t-f*u*t-l*g*b+f*m*b,C=v*m*h-l*u*h-v*g*q+f*u*q+l*g*w-f*m*w,x=e*z+n*B+d*y+k*C;if(0===x)return A.warn("YUKA.Matrix4: .getInverse() can not invert matrix, determinant is 0."),
this.identity();x=1/x;c[0]=z*x;c[1]=(u*q*k-m*w*k-u*d*t+n*w*t+m*d*b-n*q*b)*x;c[2]=(g*w*k-u*h*k+u*d*r-n*w*r-g*d*b+n*h*b)*x;c[3]=(m*h*k-g*q*k-m*d*r+n*q*r+g*d*t-n*h*t)*x;c[4]=B*x;c[5]=(l*w*k-v*q*k+v*d*t-e*w*t-l*d*b+e*q*b)*x;c[6]=(v*h*k-f*w*k-v*d*r+e*w*r+f*d*b-e*h*b)*x;c[7]=(f*q*k-l*h*k+l*d*r-e*q*r-f*d*t+e*h*t)*x;c[8]=y*x;c[9]=(v*m*k-l*u*k-v*n*t+e*u*t+l*n*b-e*m*b)*x;c[10]=(f*u*k-v*g*k+v*n*r-e*u*r-f*n*b+e*g*b)*x;c[11]=(l*g*k-f*m*k-l*n*r+e*m*r+f*n*t-e*g*t)*x;c[12]=C*x;c[13]=(l*u*d-v*m*d+v*n*q-e*u*q-l*n*
w+e*m*w)*x;c[14]=(v*g*d-f*u*d-v*n*h+e*u*h+f*n*w-e*g*w)*x;c[15]=(f*m*d-l*g*d+l*n*h-e*m*h-f*n*q+e*g*q)*x;return a};x.prototype.getMaxScale=function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))};x.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,e=a.y,n=a.z,d=a.w,k=c+c,f=e+e,g=n+n;a=c*k;var h=c*f;c*=g;var r=e*f;e*=g;n*=g;k*=d;f*=d;d*=g;b[0]=1-(r+n);b[4]=h-d;b[8]=c+f;b[1]=h+d;b[5]=1-(a+n);b[9]=
e-k;b[2]=c-f;b[6]=e+k;b[10]=1-(a+r);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this};x.prototype.fromMatrix3=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=0;b[4]=a[3];b[5]=a[4];b[6]=a[5];b[7]=0;b[8]=a[6];b[9]=a[7];b[10]=a[8];b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this};x.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,e=0;16>e;e++)c[e]=a[e+b];return this};x.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=
this.elements;a[b+0]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a};x.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0};var bd=new C,Lb=new f,cd=new C,E=function(){this.name="";this.active=!0;this.children=[];this.parent=null;this.neighbors=[];this.neighborhoodRadius=1;this.updateNeighborhood=
!1;this.position=new f;this.rotation=new C;this.scale=new f(1,1,1);this.forward=new f(0,0,1);this.up=new f(0,1,0);this.boundingRadius=0;this.maxTurnRate=Math.PI;this.canAcitivateTrigger=!0;this.worldMatrix=new x;this.manager=null;this._localMatrix=new x;this._cache={position:new f,rotation:new C,scale:new f(1,1,1)};this._renderComponentCallback=this._renderComponent=null;this._started=!1;this._uuid=null};E.prototype.start=function(){};E.prototype.update=function(){};E.prototype.add=function(a){null!==
a.parent&&a.parent.remove(a);this.children.push(a);a.parent=this;return this};E.prototype.remove=function(a){var b=this.children.indexOf(a);this.children.splice(b,1);a.parent=null;return this};E.prototype.getDirection=function(a){return a.copy(this.forward).applyRotation(this.rotation).normalize()};E.prototype.lookAt=function(a){Lb.subVectors(a,this.position).normalize();this.rotation.lookAt(this.forward,Lb,this.up);return this};E.prototype.rotateTo=function(a,b,c){c=void 0===c?1E-4:c;Lb.subVectors(a,
this.position).normalize();bd.lookAt(this.forward,Lb,this.up);return this.rotation.rotateTo(bd,this.maxTurnRate*b,c)};E.prototype.getWorldDirection=function(a){cd.extractRotationFromMatrix(this.worldMatrix);return a.copy(this.forward).applyRotation(cd).normalize()};E.prototype.getWorldPosition=function(a){return a.extractPositionFromMatrix(this.worldMatrix)};E.prototype.updateWorldMatrix=function(a,b){b=void 0===b?!1:b;var c=this.parent,e=this.children;!0===(void 0===a?!1:a)&&null!==c&&c.updateWorldMatrix(!0);
this._updateMatrix();null===c?this.worldMatrix.copy(this._localMatrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this._localMatrix);if(!0===b)for(a=0,b=e.length;a<b;a++)e[a].updateWorldMatrix(!1,!0);return this};E.prototype.setRenderComponent=function(a,b){this._renderComponent=a;this._renderComponentCallback=b;return this};E.prototype.handleMessage=function(){return!1};E.prototype.lineOfSightTest=function(){return null};E.prototype.sendMessage=function(a,b,c,e){null!==this.manager?
this.manager.sendMessage(this,a,b,void 0===c?0:c,void 0===e?null:e):A.error("YUKA.GameEntity: The game entity must be added to a manager in order to send a message.");return this};E.prototype.toJSON=function(){return{type:this.constructor.name,uuid:this.uuid,name:this.name,active:this.active,children:h(this.children),parent:null!==this.parent?this.parent.uuid:null,neighbors:h(this.neighbors),neighborhoodRadius:this.neighborhoodRadius,updateNeighborhood:this.updateNeighborhood,position:this.position.toArray([]),
rotation:this.rotation.toArray([]),scale:this.scale.toArray([]),forward:this.forward.toArray([]),up:this.up.toArray([]),boundingRadius:this.boundingRadius,maxTurnRate:this.maxTurnRate,worldMatrix:this.worldMatrix.toArray([]),_localMatrix:this._localMatrix.toArray([]),_cache:{position:this._cache.position.toArray([]),rotation:this._cache.rotation.toArray([]),scale:this._cache.scale.toArray([])},_started:this._started}};E.prototype.fromJSON=function(a){this.uuid=a.uuid;this.name=a.name;this.active=
a.active;this.neighborhoodRadius=a.neighborhoodRadius;this.updateNeighborhood=a.updateNeighborhood;this.position.fromArray(a.position);this.rotation.fromArray(a.rotation);this.scale.fromArray(a.scale);this.forward.fromArray(a.forward);this.up.fromArray(a.up);this.boundingRadius=a.boundingRadius;this.maxTurnRate=a.maxTurnRate;this.worldMatrix.fromArray(a.worldMatrix);this.children=a.children.slice();this.neighbors=a.neighbors.slice();this.parent=a.parent;this._localMatrix.fromArray(a._localMatrix);
this._cache.position.fromArray(a._cache.position);this._cache.rotation.fromArray(a._cache.rotation);this._cache.scale.fromArray(a._cache.scale);this._started=a._started;return this};E.prototype.resolveReferences=function(a){for(var b=this.neighbors,c=0,e=b.length;c<e;c++)b[c]=a.get(b[c]);b=this.children;c=0;for(e=b.length;c<e;c++)b[c]=a.get(b[c]);this.parent=a.get(this.parent)||null;return this};E.prototype._updateMatrix=function(){var a=this._cache;if(a.position.equals(this.position)&&a.rotation.equals(this.rotation)&&
a.scale.equals(this.scale))return this;this._localMatrix.compose(this.position,this.rotation,this.scale);a.position.copy(this.position);a.rotation.copy(this.rotation);a.scale.copy(this.scale);return this};$jscomp.global.Object.defineProperties(E.prototype,{uuid:{configurable:!0,enumerable:!0,get:function(){null===this._uuid&&(this._uuid=I.generateUUID());return this._uuid},set:function(a){this._uuid=a}}});var dd=new f,sc=new f,Z=function(){var a=E.call(this)||this;a.velocity=new f;a.maxSpeed=1;a.updateOrientation=
!0;return a};$jscomp.inherits(Z,E);Z.prototype.update=function(a){this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));dd.copy(this.velocity).multiplyScalar(a);sc.copy(this.position).add(dd);this.updateOrientation&&1E-8<this.getSpeedSquared()&&this.lookAt(sc);this.position.copy(sc);return this};Z.prototype.getSpeed=function(){return this.velocity.length()};Z.prototype.getSpeedSquared=function(){return this.velocity.squaredLength()};
Z.prototype.toJSON=function(){var a=E.prototype.toJSON.call(this);a.velocity=this.velocity.toArray([]);a.maxSpeed=this.maxSpeed;a.updateOrientation=this.updateOrientation;return a};Z.prototype.fromJSON=function(a){E.prototype.fromJSON.call(this,a);this.velocity.fromArray(a.velocity);this.maxSpeed=a.maxSpeed;this.updateOrientation=a.updateOrientation;return this};var t=function(){this.active=!0;this.weight=1};t.prototype.calculate=function(){};t.prototype.toJSON=function(){return{type:this.constructor.name,
active:this.active,weight:this.weight}};t.prototype.fromJSON=function(a){this.active=a.active;this.weight=a.weight;return this};t.prototype.resolveReferences=function(){};var Mb=new f,Nb=new f,Ob=function(){return t.call(this)||this};$jscomp.inherits(Ob,t);Ob.prototype.calculate=function(a,b){Mb.set(0,0,0);for(var c=a.neighbors,e=0,n=c.length;e<n;e++)c[e].getDirection(Nb),Mb.add(Nb);0<c.length&&(Mb.divideScalar(c.length),a.getDirection(Nb),b.subVectors(Mb,Nb));return b};var tc=new f,uc=new f,ta=function(a,
b,c){a=void 0===a?new f:a;b=void 0===b?3:b;c=void 0===c?0:c;var e=t.call(this)||this;e.target=a;e.deceleration=b;e.tolerance=c;return e};$jscomp.inherits(ta,t);ta.prototype.calculate=function(a,b){var c=this.deceleration;uc.subVectors(this.target,a.position);var e=uc.length();e>this.tolerance?(c=Math.min(e/c,a.maxSpeed),tc.copy(uc).multiplyScalar(c/e)):tc.set(0,0,0);return b.subVectors(tc,a.velocity)};ta.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);a.target=this.target.toArray([]);
a.deceleration=this.deceleration;return a};ta.prototype.fromJSON=function(a){t.prototype.fromJSON.call(this,a);this.target.fromArray(a.target);this.deceleration=a.deceleration;return this};var vc=new f,na=function(a){a=void 0===a?new f:a;var b=t.call(this)||this;b.target=a;return b};$jscomp.inherits(na,t);na.prototype.calculate=function(a,b){vc.subVectors(this.target,a.position).normalize();vc.multiplyScalar(a.maxSpeed);return b.subVectors(vc,a.velocity)};na.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);
a.target=this.target.toArray([]);return a};na.prototype.fromJSON=function(a){t.prototype.fromJSON.call(this,a);this.target.fromArray(a.target);return this};var Pb=new f,Qb=function(){var a=t.call(this)||this;a._seek=new na;return a};$jscomp.inherits(Qb,t);Qb.prototype.calculate=function(a,b){Pb.set(0,0,0);for(var c=a.neighbors,e=0,n=c.length;e<n;e++)Pb.add(c[e].position);0<c.length&&(Pb.divideScalar(c.length),this._seek.target=Pb,this._seek.calculate(a,b),b.normalize());return b};var rb=new f,Ha=
function(a,b){a=void 0===a?new f:a;b=void 0===b?10:b;var c=t.call(this)||this;c.target=a;c.panicDistance=b;return c};$jscomp.inherits(Ha,t);Ha.prototype.calculate=function(a,b){var c=this.target;a.position.squaredDistanceTo(c)<=this.panicDistance*this.panicDistance&&(rb.subVectors(a.position,c).normalize(),0===rb.squaredLength()&&rb.set(0,0,1),rb.multiplyScalar(a.maxSpeed),b.subVectors(rb,a.velocity));return b};Ha.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);a.target=this.target.toArray([]);
a.panicDistance=this.panicDistance;return a};Ha.prototype.fromJSON=function(a){t.prototype.fromJSON.call(this,a);this.target.fromArray(a.target);this.panicDistance=a.panicDistance;return this};var ed=new f,fd=new f,gd=new f,Ia=function(a,b,c){a=void 0===a?null:a;b=void 0===b?10:b;c=void 0===c?1:c;var e=t.call(this)||this;e.pursuer=a;e.panicDistance=b;e.predictionFactor=c;e._flee=new Ha;return e};$jscomp.inherits(Ia,t);Ia.prototype.calculate=function(a,b){var c=this.pursuer;ed.subVectors(c.position,
a.position);var e=ed.length()/(a.maxSpeed+c.getSpeed());e*=this.predictionFactor;fd.copy(c.velocity).multiplyScalar(e);gd.addVectors(c.position,fd);this._flee.target=gd;this._flee.panicDistance=this.panicDistance;this._flee.calculate(a,b);return b};Ia.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);a.pursuer=this.pursuer?this.pursuer.uuid:null;a.panicDistance=this.panicDistance;a.predictionFactor=this.predictionFactor;return a};Ia.prototype.fromJSON=function(a){t.prototype.fromJSON.call(this,
a);this.pursuer=a.pursuer;this.panicDistance=a.panicDistance;this.predictionFactor=a.predictionFactor;return this};Ia.prototype.resolveReferences=function(a){this.pursuer=a.get(this.pursuer)||null};var oa=function(){this.loop=!1;this._waypoints=[];this._index=0};oa.prototype.add=function(a){this._waypoints.push(a);return this};oa.prototype.clear=function(){this._index=this._waypoints.length=0;return this};oa.prototype.current=function(){return this._waypoints[this._index]};oa.prototype.finished=function(){var a=
this._waypoints.length-1;return!0===this.loop?!1:this._index===a};oa.prototype.advance=function(){this._index++;this._index===this._waypoints.length&&(!0===this.loop?this._index=0:this._index--);return this};oa.prototype.toJSON=function(){for(var a={type:this.constructor.name,loop:this.loop,_waypoints:[],_index:this._index},b=this._waypoints,c=0,e=b.length;c<e;c++)a._waypoints.push(b[c].toArray([]));return a};oa.prototype.fromJSON=function(a){this.loop=a.loop;this._index=a._index;a=a._waypoints;for(var b=
0,c=a.length;b<c;b++){var e=a[b];this._waypoints.push((new f).fromArray(e))}return this};var Wa=function(a,b){a=void 0===a?new oa:a;b=void 0===b?1:b;var c=t.call(this)||this;c.path=a;c.nextWaypointDistance=b;c._arrive=new ta;c._seek=new na;return c};$jscomp.inherits(Wa,t);Wa.prototype.calculate=function(a,b){var c=this.path;c.current().squaredDistanceTo(a.position)<this.nextWaypointDistance*this.nextWaypointDistance&&c.advance();var e=c.current();!0===c.finished()?(this._arrive.target=e,this._arrive.calculate(a,
b)):(this._seek.target=e,this._seek.calculate(a,b));return b};Wa.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);a.path=this.path.toJSON();a.nextWaypointDistance=this.nextWaypointDistance;return a};Wa.prototype.fromJSON=function(a){t.prototype.fromJSON.call(this,a);this.path.fromJSON(a.path);this.nextWaypointDistance=a.nextWaypointDistance;return this};var Rb=new f,Sb=new f,hd=new f,id=new f,Ja=function(a,b,c){a=void 0===a?null:a;b=void 0===b?null:b;c=void 0===c?3:c;var e=t.call(this)||
this;e.entity1=a;e.entity2=b;e.deceleration=c;e._arrive=new ta;return e};$jscomp.inherits(Ja,t);Ja.prototype.calculate=function(a,b){var c=this.entity1,e=this.entity2;Rb.addVectors(c.position,e.position).multiplyScalar(.5);var n=a.position.distanceTo(Rb)/a.maxSpeed;Sb.copy(c.velocity).multiplyScalar(n);hd.addVectors(c.position,Sb);Sb.copy(e.velocity).multiplyScalar(n);id.addVectors(e.position,Sb);Rb.addVectors(hd,id).multiplyScalar(.5);this._arrive.deceleration=this.deceleration;this._arrive.target=
Rb;this._arrive.calculate(a,b);return b};Ja.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);a.entity1=this.entity1?this.entity1.uuid:null;a.entity2=this.entity2?this.entity2.uuid:null;a.deceleration=this.deceleration;return a};Ja.prototype.fromJSON=function(a){t.prototype.fromJSON.call(this,a);this.entity1=a.entity1;this.entity2=a.entity2;this.deceleration=a.deceleration;return this};Ja.prototype.resolveReferences=function(a){this.entity1=a.get(this.entity1)||null;this.entity2=a.get(this.entity2)||
null};var ba=new f,sb=new f,ya=new f,ua=[new f,new f,new f,new f,new f,new f,new f,new f],D=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.min=a;this.max=b};D.prototype.set=function(a,b){this.min=a;this.max=b;return this};D.prototype.copy=function(a){this.min.copy(a.min);this.max.copy(a.max);return this};D.prototype.clone=function(){return(new this.constructor).copy(this)};D.prototype.clampPoint=function(a,b){b.copy(a).clamp(this.min,this.max);return b};D.prototype.containsPoint=function(a){return a.x<
this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0};D.prototype.expand=function(a){this.min.min(a);this.max.max(a);return this};D.prototype.getCenter=function(a){return a.addVectors(this.min,this.max).multiplyScalar(.5)};D.prototype.getSize=function(a){return a.subVectors(this.max,this.min)};D.prototype.intersectsAABB=function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?
!1:!0};D.prototype.intersectsBoundingSphere=function(a){this.clampPoint(a.center,ba);return ba.squaredDistanceTo(a.center)<=a.radius*a.radius};D.prototype.intersectsPlane=function(a){var b=a.normal;this.getCenter(sb);ya.subVectors(this.max,sb);b=ya.x*Math.abs(b.x)+ya.y*Math.abs(b.y)+ya.z*Math.abs(b.z);a=a.distanceToPoint(sb);return Math.abs(a)<=b};D.prototype.getNormalFromSurfacePoint=function(a,b){b.set(0,0,0);var c=Infinity;this.getCenter(sb);this.getSize(ya);ba.copy(a).sub(sb);a=Math.abs(ya.x-
Math.abs(ba.x));a<c&&(c=a,b.set(1*Math.sign(ba.x),0,0));a=Math.abs(ya.y-Math.abs(ba.y));a<c&&(c=a,b.set(0,1*Math.sign(ba.y),0));a=Math.abs(ya.z-Math.abs(ba.z));a<c&&b.set(0,0,1*Math.sign(ba.z));return b};D.prototype.fromCenterAndSize=function(a,b){ba.copy(b).multiplyScalar(.5);this.min.copy(a).sub(ba);this.max.copy(a).add(ba);return this};D.prototype.fromPoints=function(a){this.min.set(Infinity,Infinity,Infinity);this.max.set(-Infinity,-Infinity,-Infinity);for(var b=0,c=a.length;b<c;b++)this.expand(a[b]);
return this};D.prototype.applyMatrix4=function(a){var b=this.min,c=this.max;ua[0].set(b.x,b.y,b.z).applyMatrix4(a);ua[1].set(b.x,b.y,c.z).applyMatrix4(a);ua[2].set(b.x,c.y,b.z).applyMatrix4(a);ua[3].set(b.x,c.y,c.z).applyMatrix4(a);ua[4].set(c.x,b.y,b.z).applyMatrix4(a);ua[5].set(c.x,b.y,c.z).applyMatrix4(a);ua[6].set(c.x,c.y,b.z).applyMatrix4(a);ua[7].set(c.x,c.y,c.z).applyMatrix4(a);return this.fromPoints(ua)};D.prototype.equals=function(a){return a.min.equals(this.min)&&a.max.equals(this.max)};
D.prototype.toJSON=function(){return{type:this.constructor.name,min:this.min.toArray([]),max:this.max.toArray([])}};D.prototype.fromJSON=function(a){this.min.fromArray(a.min);this.max.fromArray(a.max);return this};var wc=new D,M=function(a,b){this.center=a=void 0===a?new f:a;this.radius=void 0===b?0:b};M.prototype.set=function(a,b){this.center=a;this.radius=b;return this};M.prototype.copy=function(a){this.center.copy(a.center);this.radius=a.radius;return this};M.prototype.clone=function(){return(new this.constructor).copy(this)};
M.prototype.clampPoint=function(a,b){b.copy(a);this.center.squaredDistanceTo(a)>this.radius*this.radius&&(b.sub(this.center).normalize(),b.multiplyScalar(this.radius).add(this.center));return b};M.prototype.containsPoint=function(a){return a.squaredDistanceTo(this.center)<=this.radius*this.radius};M.prototype.intersectsBoundingSphere=function(a){var b=this.radius+a.radius;return a.center.squaredDistanceTo(this.center)<=b*b};M.prototype.intersectsPlane=function(a){return Math.abs(a.distanceToPoint(this.center))<=
this.radius};M.prototype.getNormalFromSurfacePoint=function(a,b){return b.subVectors(a,this.center).normalize()};M.prototype.fromPoints=function(a){wc.fromPoints(a);wc.getCenter(this.center);this.radius=this.center.distanceTo(wc.max);return this};M.prototype.applyMatrix4=function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScale();return this};M.prototype.equals=function(a){return a.center.equals(this.center)&&a.radius===this.radius};M.prototype.toJSON=function(){return{type:this.constructor.name,
center:this.center.toArray([]),radius:this.radius}};M.prototype.fromJSON=function(a){this.center.fromArray(a.center);this.radius=a.radius;return this};var ca=new f,xc=new f,Tb=new f,yc=new f,jd=new f,Ub=new x,$d=new x,kd=new D,K=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.origin=a;this.direction=b};K.prototype.set=function(a,b){this.origin=a;this.direction=b;return this};K.prototype.copy=function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this};K.prototype.clone=
function(){return(new this.constructor).copy(this)};K.prototype.at=function(a,b){return b.copy(this.direction).multiplyScalar(a).add(this.origin)};K.prototype.intersectBoundingSphere=function(a,b){ca.subVectors(a.center,this.origin);var c=ca.dot(this.direction),e=ca.dot(ca)-c*c;a=a.radius*a.radius;if(e>a)return null;a=Math.sqrt(a-e);e=c-a;c+=a;return 0>e&&0>c?null:0>e?this.at(c,b):this.at(e,b)};K.prototype.intersectsBoundingSphere=function(a){var b=new f,c=b.subVectors(a.center,this.origin).dot(this.direction);
0>c?b=this.origin.squaredDistanceTo(a.center):(b.copy(this.direction).multiplyScalar(c).add(this.origin),b=b.squaredDistanceTo(a.center));return b<=a.radius*a.radius};K.prototype.intersectAABB=function(a,b){var c=1/this.direction.x;var e=1/this.direction.y;var n=1/this.direction.z,d=this.origin;if(0<=c){var k=(a.min.x-d.x)*c;c*=a.max.x-d.x}else k=(a.max.x-d.x)*c,c*=a.min.x-d.x;if(0<=e){var f=(a.min.y-d.y)*e;e*=a.max.y-d.y}else f=(a.max.y-d.y)*e,e*=a.min.y-d.y;if(k>e||f>c)return null;if(f>k||k!==k)k=
f;if(e<c||c!==c)c=e;0<=n?(f=(a.min.z-d.z)*n,a=(a.max.z-d.z)*n):(f=(a.max.z-d.z)*n,a=(a.min.z-d.z)*n);if(k>a||f>c)return null;if(f>k||k!==k)k=f;if(a<c||c!==c)c=a;return 0>c?null:this.at(0<=k?k:c,b)};K.prototype.intersectsAABB=function(a){return null!==this.intersectAABB(a,ca)};K.prototype.intersectPlane=function(a,b){var c=a.normal.dot(this.direction);if(0===c)if(0===a.distanceToPoint(this.origin))a=0;else return null;else a=-(this.origin.dot(a.normal)+a.constant)/c;return 0<=a?this.at(a,b):null};
K.prototype.intersectsPlane=function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1};K.prototype.intersectOBB=function(a,b){a.getSize(jd);kd.fromCenterAndSize(ca.set(0,0,0),jd);Ub.fromMatrix3(a.rotation);Ub.setPosition(a.center);ld.copy(this).applyMatrix4(Ub.getInverse($d));return ld.intersectAABB(kd,b)?b.applyMatrix4(Ub):null};K.prototype.intersectsOBB=function(a){return null!==this.intersectOBB(a,ca)};K.prototype.intersectConvexHull=function(a,b){a=
a.faces;for(var c=-Infinity,e=Infinity,d=0,p=a.length;d<p;d++){var k=a[d].plane,f=k.distanceToPoint(this.origin);k=k.normal.dot(this.direction);if(0<f&&0<=k)return null;f=0!==k?-f/k:0;if(!(0>=f)&&(0<k?e=Math.min(f,e):c=Math.max(f,c),c>e))return null}-Infinity!==c?this.at(c,b):this.at(e,b);return b};K.prototype.intersectsConvexHull=function(a){return null!==this.intersectConvexHull(a,ca)};K.prototype.intersectTriangle=function(a,b,c){var e=a.a,d=a.c;xc.subVectors(a.b,e);Tb.subVectors(d,e);yc.crossVectors(xc,
Tb);a=this.direction.dot(yc);if(0<a){if(b)return null;b=1}else if(0>a)b=-1,a=-a;else return null;ca.subVectors(this.origin,e);e=b*this.direction.dot(Tb.crossVectors(ca,Tb));if(0>e)return null;d=b*this.direction.dot(xc.cross(ca));if(0>d||e+d>a)return null;e=-b*ca.dot(yc);return 0>e?null:this.at(e/a,c)};K.prototype.applyMatrix4=function(a){this.origin.applyMatrix4(a);this.direction.transformDirection(a);return this};K.prototype.equals=function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)};
var ld=new K,md=new x,Xa=new f,Vb=new f,zc=new f,Ac=new M,ae=new K(new f(0,0,0),new f(0,0,1)),Ka=function(a){a=void 0===a?[]:a;var b=t.call(this)||this;b.obstacles=a;b.brakingWeight=.2;b.dBoxMinLength=4;return b};$jscomp.inherits(Ka,t);Ka.prototype.calculate=function(a,b){var c=this.obstacles,e=null,d=Infinity,p=this.dBoxMinLength+a.getSpeed()/a.maxSpeed*this.dBoxMinLength;a.worldMatrix.getInverse(md);for(var k=0,f=c.length;k<f;k++){var g=c[k];if(g!==a&&(Xa.copy(g.position).applyMatrix4(md),0<Xa.z&&
Math.abs(Xa.z)<p)){var h=g.boundingRadius+a.boundingRadius;Math.abs(Xa.x)<h&&(Ac.center.copy(Xa),Ac.radius=h,ae.intersectBoundingSphere(Ac,zc),zc.z<d&&(d=zc.z,e=g,Vb.copy(Xa)))}}null!==e&&(b.x=(e.boundingRadius-Vb.x)*(1+(p-Vb.z)/p),b.z=(e.boundingRadius-Vb.z)*this.brakingWeight,b.applyRotation(a.rotation));return b};Ka.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);a.obstacles=[];a.brakingWeight=this.brakingWeight;a.dBoxMinLength=this.dBoxMinLength;for(var b=0,c=this.obstacles.length;b<
c;b++)a.obstacles.push(this.obstacles[b].uuid);return a};Ka.prototype.fromJSON=function(a){t.prototype.fromJSON.call(this,a);this.obstacles=a.obstacles;this.brakingWeight=a.brakingWeight;this.dBoxMinLength=a.dBoxMinLength;return this};Ka.prototype.resolveReferences=function(a){for(var b=this.obstacles,c=0,e=b.length;c<e;c++)b[c]=a.get(b[c])};var Bc=new f,nd=new f,od=new f,pd=new f,La=function(a,b){a=void 0===a?null:a;b=void 0===b?new f:b;var c=t.call(this)||this;c.leader=a;c.offset=b;c._arrive=new ta;
c._arrive.deceleration=1.5;return c};$jscomp.inherits(La,t);La.prototype.calculate=function(a,b){var c=this.leader;Bc.copy(this.offset).applyMatrix4(c.worldMatrix);nd.subVectors(Bc,a.position);var e=nd.length()/(a.maxSpeed+c.getSpeed());od.copy(c.velocity).multiplyScalar(e);pd.addVectors(Bc,od);this._arrive.target=pd;this._arrive.calculate(a,b);return b};La.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);a.leader=this.leader?this.leader.uuid:null;a.offset=this.offset;return a};La.prototype.fromJSON=
function(a){t.prototype.fromJSON.call(this,a);this.leader=a.leader;this.offset=a.offset;return this};La.prototype.resolveReferences=function(a){this.leader=a.get(this.leader)||null};var Cc=new f,Dc=new f,qd=new f,rd=new f,sd=new f,Ma=function(a,b){a=void 0===a?null:a;b=void 0===b?1:b;var c=t.call(this)||this;c.evader=a;c.predictionFactor=b;c._seek=new na;return c};$jscomp.inherits(Ma,t);Ma.prototype.calculate=function(a,b){var c=this.evader;Cc.subVectors(c.position,a.position);a.getDirection(Dc);
c.getDirection(qd);var e=0<Cc.dot(Dc),d=-.95>Dc.dot(qd);if(!0===e&&!0===d)return this._seek.target=c.position,this._seek.calculate(a,b),b;e=Cc.length()/(a.maxSpeed+c.getSpeed());e*=this.predictionFactor;rd.copy(c.velocity).multiplyScalar(e);sd.addVectors(c.position,rd);this._seek.target=sd;this._seek.calculate(a,b);return b};Ma.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);a.evader=this.evader?this.evader.uuid:null;a.predictionFactor=this.predictionFactor;return a};Ma.prototype.fromJSON=
function(a){t.prototype.fromJSON.call(this,a);this.evader=a.evader;this.predictionFactor=a.predictionFactor;return this};Ma.prototype.resolveReferences=function(a){this.evader=a.get(this.evader)||null};var Wb=new f,Xb=function(){return t.call(this)||this};$jscomp.inherits(Xb,t);Xb.prototype.calculate=function(a,b){for(var c=a.neighbors,e=0,d=c.length;e<d;e++){Wb.subVectors(a.position,c[e].position);var p=Wb.length();0===p&&(p=1E-4);Wb.normalize().divideScalar(p);b.add(Wb)}return b};var tb=new f,Ec=
new f,Ya=function(a,b,c){a=void 0===a?1:a;b=void 0===b?5:b;c=void 0===c?5:c;var e=t.call(this)||this;e.radius=a;e.distance=b;e.jitter=c;e._targetLocal=new f;a=e.radius;b=e._targetLocal;c=Math.random()*Math.PI*2;b.x=a*Math.cos(c);b.z=a*Math.sin(c);return e};$jscomp.inherits(Ya,t);Ya.prototype.calculate=function(a,b,c){c*=this.jitter;Ec.x=I.randFloat(-1,1)*c;Ec.z=I.randFloat(-1,1)*c;this._targetLocal.add(Ec);this._targetLocal.normalize();this._targetLocal.multiplyScalar(this.radius);tb.copy(this._targetLocal);
tb.z+=this.distance;tb.applyMatrix4(a.worldMatrix);b.subVectors(tb,a.position);return b};Ya.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);a.radius=this.radius;a.distance=this.distance;a.jitter=this.jitter;a._targetLocal=this._targetLocal.toArray([]);return a};Ya.prototype.fromJSON=function(a){t.prototype.fromJSON.call(this,a);this.radius=a.radius;this.distance=a.distance;this.jitter=a.jitter;this._targetLocal.fromArray(a._targetLocal);return this};var Yb=new f,aa=function(a){this.vehicle=
a;this.behaviors=[];this._steeringForce=new f;this._typesMap=new Map};aa.prototype.add=function(a){this.behaviors.push(a);return this};aa.prototype.remove=function(a){a=this.behaviors.indexOf(a);this.behaviors.splice(a,1);return this};aa.prototype.clear=function(){this.behaviors.length=0;return this};aa.prototype.calculate=function(a,b){this._calculateByOrder(a);return b.copy(this._steeringForce)};aa.prototype._accumulate=function(a){var b=this._steeringForce.length();b=this.vehicle.maxForce-b;if(0>=
b)return!1;a.length()>b&&a.normalize().multiplyScalar(b);this._steeringForce.add(a);return!0};aa.prototype._calculateByOrder=function(a){var b=this.behaviors;this._steeringForce.set(0,0,0);for(var c=0,e=b.length;c<e;c++){var d=b[c];if(!0===d.active&&(Yb.set(0,0,0),d.calculate(this.vehicle,Yb,a),Yb.multiplyScalar(d.weight),!1===this._accumulate(Yb)))break}};aa.prototype.toJSON=function(){for(var a={type:"SteeringManager",behaviors:[]},b=this.behaviors,c=0,e=b.length;c<e;c++)a.behaviors.push(b[c].toJSON());
return a};aa.prototype.fromJSON=function(a){this.clear();a=a.behaviors;for(var b=0,c=a.length;b<c;b++){var e=a[b],d=e.type;switch(d){case "SteeringBehavior":e=(new t).fromJSON(e);break;case "AlignmentBehavior":e=(new Ob).fromJSON(e);break;case "ArriveBehavior":e=(new ta).fromJSON(e);break;case "CohesionBehavior":e=(new Qb).fromJSON(e);break;case "EvadeBehavior":e=(new Ia).fromJSON(e);break;case "FleeBehavior":e=(new Ha).fromJSON(e);break;case "FollowPathBehavior":e=(new Wa).fromJSON(e);break;case "InterposeBehavior":e=
(new Ja).fromJSON(e);break;case "ObstacleAvoidanceBehavior":e=(new Ka).fromJSON(e);break;case "OffsetPursuitBehavior":e=(new La).fromJSON(e);break;case "PursuitBehavior":e=(new Ma).fromJSON(e);break;case "SeekBehavior":e=(new na).fromJSON(e);break;case "SeparationBehavior":e=(new Xb).fromJSON(e);break;case "WanderBehavior":e=(new Ya).fromJSON(e);break;default:var p=this._typesMap.get(d);if(void 0!==p)e=(new p).fromJSON(e);else{A.warn("YUKA.SteeringManager: Unsupported steering behavior type:",d);
continue}}this.add(e)}return this};aa.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};aa.prototype.resolveReferences=function(a){for(var b=this.behaviors,c=0,e=b.length;c<e;c++)b[c].resolveReferences(a);return this};var ub=function(a){this.count=void 0===a?10:a;this._history=[];for(a=this._slot=0;a<this.count;a++)this._history[a]=new f};ub.prototype.calculate=function(a,b){b.set(0,0,0);this._slot===this.count&&(this._slot=0);this._history[this._slot].copy(a);this._slot++;
for(a=0;a<this.count;a++)b.add(this._history[a]);b.divideScalar(this.count);return b};ub.prototype.toJSON=function(){for(var a={type:this.constructor.name,count:this.count,_history:[],_slot:this._slot},b=this._history,c=0,e=b.length;c<e;c++)a._history.push(b[c].toArray([]));return a};ub.prototype.fromJSON=function(a){this.count=a.count;this._slot=a._slot;a=a._history;for(var b=this._history.length=0,c=a.length;b<c;b++){var e=a[b];this._history.push((new f).fromArray(e))}return this};var td=new f,
Zb=new f,ud=new f,vb=new f,vd=new f,Na=function(){var a=Z.call(this)||this;a.mass=1;a.maxForce=100;a.steering=new aa(a);a.smoother=null;return a};$jscomp.inherits(Na,Z);Na.prototype.update=function(a){this.steering.calculate(a,td);ud.copy(td).divideScalar(this.mass);this.velocity.add(ud.multiplyScalar(a));this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));Zb.copy(this.velocity).multiplyScalar(a);vb.copy(this.position).add(Zb);
!0===this.updateOrientation&&null===this.smoother&&1E-8<this.getSpeedSquared()&&this.lookAt(vb);this.position.copy(vb);!0===this.updateOrientation&&null!==this.smoother&&(this.smoother.calculate(this.velocity,vd),Zb.copy(vd).multiplyScalar(a),vb.copy(this.position).add(Zb),this.lookAt(vb));return this};Na.prototype.toJSON=function(){var a=Z.prototype.toJSON.call(this);a.mass=this.mass;a.maxForce=this.maxForce;a.steering=this.steering.toJSON();a.smoother=this.smoother?this.smoother.toJSON():null;return a};
Na.prototype.fromJSON=function(a){Z.prototype.fromJSON.call(this,a);this.mass=a.mass;this.maxForce=a.maxForce;this.steering=(new aa(this)).fromJSON(a.steering);this.smoother=a.smoother?(new ub).fromJSON(a.smoother):null;return this};Na.prototype.resolveReferences=function(a){Z.prototype.resolveReferences.call(this,a);this.steering.resolveReferences(a)};var da=function(){};da.prototype.touching=function(){return!1};da.prototype.toJSON=function(){return{type:this.constructor.name}};da.prototype.fromJSON=
function(){return this};var wd=new M,za=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this._aabb=new D(a,b);return this};$jscomp.inherits(za,da);za.prototype.fromPositionAndSize=function(a,b){this._aabb.fromCenterAndSize(a,b);return this};za.prototype.touching=function(a){wd.set(a.position,a.boundingRadius);return this._aabb.intersectsBoundingSphere(wd)};za.prototype.toJSON=function(){var a=da.prototype.toJSON.call(this);a._aabb=this._aabb.toJSON();return a};za.prototype.fromJSON=function(a){da.prototype.fromJSON.call(this,
a);this._aabb.fromJSON(a._aabb);return this};$jscomp.global.Object.defineProperties(za.prototype,{min:{configurable:!0,enumerable:!0,get:function(){return this._aabb.min},set:function(a){this._aabb.min=a}},max:{configurable:!0,enumerable:!0,get:function(){return this._aabb.max},set:function(a){this._aabb.max=a}}});var xd=new M,Oa=function(a,b){a=void 0===a?new f:a;this._boundingSphere=new M(a,void 0===b?0:b);return this};$jscomp.inherits(Oa,da);Oa.prototype.touching=function(a){xd.set(a.position,
a.boundingRadius);return this._boundingSphere.intersectsBoundingSphere(xd)};Oa.prototype.toJSON=function(){var a=da.prototype.toJSON.call(this);a._boundingSphere=this._boundingSphere.toJSON();return a};Oa.prototype.fromJSON=function(a){da.prototype.fromJSON.call(this,a);this._boundingSphere.fromJSON(a._boundingSphere);return this};$jscomp.global.Object.defineProperties(Oa.prototype,{position:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.center},set:function(a){this._boundingSphere.center=
a}},radius:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.radius},set:function(a){this._boundingSphere.radius=a}}});var Aa=function(a){a=void 0===a?new da:a;this.active=!0;this.region=a;this._typesMap=new Map};Aa.prototype.check=function(a){!0===this.active&&!0===this.region.touching(a)&&this.execute(a);return this};Aa.prototype.execute=function(){};Aa.prototype.update=function(){};Aa.prototype.toJSON=function(){return{type:this.constructor.name,active:this.active,region:this.region.toJSON()}};
Aa.prototype.fromJSON=function(a){this.active=a.active;a=a.region;var b=a.type;switch(b){case "TriggerRegion":this.region=(new da).fromJSON(a);break;case "RectangularTriggerRegion":this.region=(new za).fromJSON(a);break;case "SphericalTriggerRegion":this.region=(new Oa).fromJSON(a);break;default:b=this._typesMap.get(b),void 0!==b?this.region=(new b).fromJSON(a):A.warn("YUKA.Trigger: Unsupported trigger region type:",a.type)}return this};Aa.prototype.registerType=function(a,b){this._typesMap.set(a,
b);return this};var Za=[],U=function(){this.entities=[];this.triggers=[];this.spatialIndex=null;this._indexMap=new Map;this._typesMap=new Map;this._messageDispatcher=new sa};U.prototype.add=function(a){this.entities.push(a);a.manager=this;return this};U.prototype.remove=function(a){var b=this.entities.indexOf(a);this.entities.splice(b,1);a.manager=null;return this};U.prototype.addTrigger=function(a){this.triggers.push(a);return this};U.prototype.removeTrigger=function(a){a=this.triggers.indexOf(a);
this.triggers.splice(a,1);return this};U.prototype.clear=function(){this.entities.length=0;this.triggers.length=0;this._messageDispatcher.clear();return this};U.prototype.getEntityByName=function(a){for(var b=this.entities,c=0,e=b.length;c<e;c++){var d=b[c];if(d.name===a)return d}return null};U.prototype.update=function(a){for(var b=this.entities,c=this.triggers,e=b.length-1;0<=e;e--)this.updateEntity(b[e],a);for(b=c.length-1;0<=b;b--)this.updateTrigger(c[b],a);this._messageDispatcher.dispatchDelayedMessages(a);
return this};U.prototype.updateEntity=function(a,b){if(!0===a.active){this.updateNeighborhood(a);!1===a._started&&(a.start(),a._started=!0);a.update(b);a.updateWorldMatrix();for(var c=a.children,e=c.length-1;0<=e;e--)this.updateEntity(c[e],b);null!==this.spatialIndex&&(b=this._indexMap.get(a)||-1,b=this.spatialIndex.updateEntity(a,b),this._indexMap.set(a,b));b=a._renderComponent;c=a._renderComponentCallback;null!==b&&null!==c&&c(a,b)}return this};U.prototype.updateNeighborhood=function(a){if(!0===
a.updateNeighborhood){a.neighbors.length=0;null!==this.spatialIndex?this.spatialIndex.query(a.position,a.neighborhoodRadius,Za):(Za.length=0,Za.push.apply(Za,$jscomp.arrayFromIterable(this.entities)));for(var b=a.neighborhoodRadius*a.neighborhoodRadius,c=0,e=Za.length;c<e;c++){var d=Za[c];a!==d&&!0===d.active&&a.position.squaredDistanceTo(d.position)<=b&&a.neighbors.push(d)}}return this};U.prototype.updateTrigger=function(a,b){if(!0===a.active){a.update(b);b=this.entities;for(var c=b.length-1;0<=
c;c--){var e=b[c];!0===e.active&&e.canAcitivateTrigger&&a.check(e)}}return this};U.prototype.sendMessage=function(a,b,c,e,d){this._messageDispatcher.dispatch(a,b,c,e,d);return this};U.prototype.toJSON=function(){function a(c){b.entities.push(c.toJSON());for(var e=0,d=c.children.length;e<d;e++)a(c.children[e])}for(var b={type:this.constructor.name,entities:[],triggers:[],_messageDispatcher:this._messageDispatcher.toJSON()},c=0,e=this.entities.length;c<e;c++)a(this.entities[c]);c=0;for(e=this.triggers.length;c<
e;c++)b.triggers.push(this.triggers[c].toJSON());return b};U.prototype.fromJSON=function(a){this.clear();var b=a.entities,c=a.triggers;a=a._messageDispatcher;for(var e=new Map,d=0,p=b.length;d<p;d++){var k=b[d],f=k.type;switch(f){case "GameEntity":k=(new E).fromJSON(k);break;case "MovingEntity":k=(new Z).fromJSON(k);break;case "Vehicle":k=(new Na).fromJSON(k);break;default:var g=this._typesMap.get(f);if(void 0!==g)k=(new g).fromJSON(k);else{A.warn("YUKA.EntityManager: Unsupported entity type:",f);
continue}}e.set(k.uuid,k);null===k.parent&&this.add(k)}b=$jscomp.makeIterator(e.values());for(d=b.next();!d.done;d=b.next())d.value.resolveReferences(e);e=0;for(b=c.length;e<b;e++){d=c[e];p=d.type;if("Trigger"===p)d=(new Aa).fromJSON(d);else if(k=this._typesMap.get(p),void 0!==k)d=(new k).fromJSON(d);else{A.warn("YUKA.EntityManager: Unsupported trigger type:",p);continue}this.addTrigger(d)}this._messageDispatcher.fromJSON(a);return this};U.prototype.registerType=function(a,b){this._typesMap.set(a,
b);return this};var wb=function(){this._events=new Map};wb.prototype.addEventListener=function(a,b){var c=this._events;!1===c.has(a)&&c.set(a,[]);a=c.get(a);-1===a.indexOf(b)&&a.push(b)};wb.prototype.removeEventListener=function(a,b){a=this._events.get(a);void 0!==a&&(b=a.indexOf(b),-1!==b&&a.splice(b,1))};wb.prototype.hasEventListener=function(a,b){a=this._events.get(a);return void 0!==a&&-1!==a.indexOf(b)};wb.prototype.dispatchEvent=function(a){var b=this._events.get(a.type);if(void 0!==b){a.target=
this;for(var c=0,e=b.length;c<e;c++)b[c].call(this,a)}};var $a=new f,Fc=new f,$b=new f,V=function(a,b){this.normal=a=void 0===a?new f(0,0,1):a;this.constant=void 0===b?0:b};V.prototype.set=function(a,b){this.normal=a;this.constant=b;return this};V.prototype.copy=function(a){this.normal.copy(a.normal);this.constant=a.constant;return this};V.prototype.clone=function(){return(new this.constructor).copy(this)};V.prototype.distanceToPoint=function(a){return this.normal.dot(a)+this.constant};V.prototype.fromNormalAndCoplanarPoint=
function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this};V.prototype.fromCoplanarPoints=function(a,b,c){$a.subVectors(c,b).cross(Fc.subVectors(a,b)).normalize();this.fromNormalAndCoplanarPoint($a,a);return this};V.prototype.intersectPlane=function(a,b){$b.crossVectors(this.normal,a.normal);var c=$b.dot($b);if(0===c)return null;$a.copy(a.normal).multiplyScalar(this.constant);Fc.copy(this.normal).multiplyScalar(a.constant);b.crossVectors($a.sub(Fc),$b).divideScalar(c);return b};
V.prototype.intersectsPlane=function(a){a=this.normal.dot(a.normal);return 1!==Math.abs(a)};V.prototype.projectPoint=function(a,b){$a.copy(this.normal).multiplyScalar(this.distanceToPoint(a));b.subVectors(a,$a);return b};V.prototype.equals=function(a){return a.normal.equals(this.normal)&&a.constant===this.constant};var yd=new M,N={a:new f,b:new f,c:new f},ab=new K,zd=new V,Ad=new x,Gc=new f,Hc=new f,Ic=new f,Jc=new f,xb=function(a,b){this.vertices=a=void 0===a?new Float32Array:a;this.indices=void 0===
b?null:b;this.backfaceCulling=!0;this.aabb=new D;this.boundingSphere=new M;this.computeBoundingVolume()};xb.prototype.computeBoundingVolume=function(){var a=this.vertices,b=new f,c=this.aabb,e=this.boundingSphere;c.min.set(Infinity,Infinity,Infinity);c.max.set(-Infinity,-Infinity,-Infinity);for(var d=0,p=a.length;d<p;d+=3)b.x=a[d],b.y=a[d+1],b.z=a[d+2],c.expand(b);c.getCenter(e.center);e.radius=e.center.distanceTo(c.max);return this};xb.prototype.intersectRay=function(a,b,c,e,d){d=void 0===d?null:
d;yd.copy(this.boundingSphere).applyMatrix4(b);if(a.intersectsBoundingSphere(yd)&&(b.getInverse(Ad),ab.copy(a).applyMatrix4(Ad),ab.intersectsAABB(this.aabb))){a=this.vertices;var n=this.indices,k=Infinity,f=!1;if(null===n){n=0;for(var g=a.length;n<g;n+=9)if(N.a.set(a[n],a[n+1],a[n+2]),N.b.set(a[n+3],a[n+4],a[n+5]),N.c.set(a[n+6],a[n+7],a[n+8]),null!==ab.intersectTriangle(N,this.backfaceCulling,e))if(c){var h=e.squaredDistanceTo(ab.origin);h<k&&(k=h,Gc.copy(e),Hc.copy(N.a),Ic.copy(N.b),Jc.copy(N.c),
f=!0)}else{f=!0;break}}else for(g=0,h=n.length;g<h;g+=3){var r=n[g],l=n[g+1],m=n[g+2];N.a.set(a[3*r],a[3*r+1],a[3*r+2]);N.b.set(a[3*l],a[3*l+1],a[3*l+2]);N.c.set(a[3*m],a[3*m+1],a[3*m+2]);if(null!==ab.intersectTriangle(N,this.backfaceCulling,e))if(c)r=e.squaredDistanceTo(ab.origin),r<k&&(k=r,Gc.copy(e),Hc.copy(N.a),Ic.copy(N.b),Jc.copy(N.c),f=!0);else{f=!0;break}}if(f)return c&&(e.copy(Gc),N.a.copy(Hc),N.b.copy(Ic),N.c.copy(Jc)),e.applyMatrix4(b),null!==d&&(zd.fromCoplanarPoints(N.a,N.b,N.c),d.copy(zd.normal),
d.transformDirection(b)),e}return null};xb.prototype.toJSON=function(){var a={type:this.constructor.name};a.indices={type:this.indices?this.indices.constructor.name:"null",data:this.indices?Array.from(this.indices):null};a.vertices=Array.from(this.vertices);a.backfaceCulling=this.backfaceCulling;a.aabb=this.aabb.toJSON();a.boundingSphere=this.boundingSphere.toJSON();return a};xb.prototype.fromJSON=function(a){this.aabb=(new D).fromJSON(a.aabb);this.boundingSphere=(new M).fromJSON(a.boundingSphere);
this.backfaceCulling=a.backfaceCulling;this.vertices=new Float32Array(a.vertices);switch(a.indices.type){case "Uint16Array":this.indices=new Uint16Array(a.indices.data);break;case "Uint32Array":this.indices=new Uint32Array(a.indices.data);break;case "null":this.indices=null}return this};var bb=function(){this.previousTime=this.startTime=0;this.currentTime=this.now();this.detectPageVisibility=!0;"undefined"!==typeof document&&void 0!==document.hidden&&(this._pageVisibilityHandler=g.bind(this),document.addEventListener("visibilitychange",
this._pageVisibilityHandler,!1))};bb.prototype.getDelta=function(){return(this.currentTime-this.previousTime)/1E3};bb.prototype.getElapsed=function(){return(this.currentTime-this.startTime)/1E3};bb.prototype.update=function(){this.previousTime=this.currentTime;this.currentTime=this.now();return this};bb.prototype.now=function(){return("undefined"===typeof performance?Date:performance).now()};var Bd=function(a){this.updateFrequency=void 0===a?0:a;this._time=new bb;this._nextUpdateTime=0};Bd.prototype.ready=
function(){this._time.update();return this._time.currentTime>=this._nextUpdateTime?(this._nextUpdateTime=this._time.currentTime+1E3/this.updateFrequency,!0):!1};var va=function(){};va.prototype.enter=function(){};va.prototype.execute=function(){};va.prototype.exit=function(){};va.prototype.toJSON=function(){};va.prototype.fromJSON=function(){};va.prototype.resolveReferences=function(){};va.prototype.onMessage=function(){return!1};var W=function(a){this.owner=void 0===a?null:a;this.globalState=this.previousState=
this.currentState=null;this.states=new Map;this._typesMap=new Map};W.prototype.update=function(){null!==this.globalState&&this.globalState.execute(this.owner);null!==this.currentState&&this.currentState.execute(this.owner);return this};W.prototype.add=function(a,b){b instanceof va?this.states.set(a,b):A.warn('YUKA.StateMachine: .add() needs a parameter of type "YUKA.State".');return this};W.prototype.remove=function(a){this.states.delete(a);return this};W.prototype.get=function(a){return this.states.get(a)};
W.prototype.changeTo=function(a){a=this.get(a);this._change(a);return this};W.prototype.revert=function(){this._change(this.previousState);return this};W.prototype.in=function(a){return this.get(a)===this.currentState};W.prototype.handleMessage=function(a){return null!==this.currentState&&!0===this.currentState.onMessage(this.owner,a)||null!==this.globalState&&!0===this.globalState.onMessage(this.owner,a)?!0:!1};W.prototype.toJSON=function(){for(var a={owner:this.owner.uuid,currentState:null,previousState:null,
globalState:null,states:[]},b=new Map,c=$jscomp.makeIterator(this.states),e=c.next();!e.done;e=c.next()){var d=$jscomp.makeIterator(e.value);e=d.next().value;d=d.next().value;a.states.push({type:d.constructor.name,id:e,state:d.toJSON()});b.set(d,e)}a.currentState=b.get(this.currentState)||null;a.previousState=b.get(this.previousState)||null;a.globalState=b.get(this.globalState)||null;return a};W.prototype.fromJSON=function(a){this.owner=a.owner;for(var b=a.states,c=0,e=b.length;c<e;c++){var d=b[c],
p=d.type,k=this._typesMap.get(p);void 0!==k?(p=d.id,d=(new k).fromJSON(d.state),this.add(p,d)):A.warn("YUKA.StateMachine: Unsupported state type:",p)}this.currentState=null!==a.currentState?this.get(a.currentState)||null:null;this.previousState=null!==a.previousState?this.get(a.previousState)||null:null;this.globalState=null!==a.globalState?this.get(a.globalState)||null:null;return this};W.prototype.resolveReferences=function(a){this.owner=a.get(this.owner)||null;for(var b=$jscomp.makeIterator(this.states.values()),
c=b.next();!c.done;c=b.next())c.value.resolveReferences(a);return this};W.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};W.prototype._change=function(a){this.previousState=this.currentState;this.currentState.exit(this.owner);this.currentState=a;this.currentState.enter(this.owner)};var wa=function(){};wa.prototype.clearDegreeOfMembership=function(){};wa.prototype.getDegreeOfMembership=function(){};wa.prototype.updateDegreeOfMembership=function(){};wa.prototype.toJSON=function(){return{type:this.constructor.name}};
var S=function(a){this.terms=a=void 0===a?[]:a;return this};$jscomp.inherits(S,wa);S.prototype.clearDegreeOfMembership=function(){for(var a=this.terms,b=0,c=a.length;b<c;b++)a[b].clearDegreeOfMembership();return this};S.prototype.updateDegreeOfMembership=function(a){for(var b=this.terms,c=0,e=b.length;c<e;c++)b[c].updateDegreeOfMembership(a);return this};S.prototype.toJSON=function(){var a=wa.prototype.toJSON.call(this);a.terms=[];for(var b=0,c=this.terms.length;b<c;b++){var e=this.terms[b];e instanceof
S?a.terms.push(e.toJSON()):a.terms.push(e.uuid)}return a};var ac=function(){var a=Array.from(arguments);return S.call(this,a)||this};$jscomp.inherits(ac,S);ac.prototype.getDegreeOfMembership=function(){for(var a=this.terms,b=Infinity,c=0,e=a.length;c<e;c++){var d=a[c].getDegreeOfMembership();d<b&&(b=d)}return b};var cb=function(a){a=void 0===a?null:a;return S.call(this,null!==a?[a]:[])||this};$jscomp.inherits(cb,S);cb.prototype.clearDegreeOfMembership=function(){this.terms[0].clearDegreeOfMembership();
return this};cb.prototype.getDegreeOfMembership=function(){var a=this.terms[0].getDegreeOfMembership();return Math.sqrt(a)};cb.prototype.updateDegreeOfMembership=function(a){this.terms[0].updateDegreeOfMembership(Math.sqrt(a));return this};var bc=function(){var a=Array.from(arguments);return S.call(this,a)||this};$jscomp.inherits(bc,S);bc.prototype.getDegreeOfMembership=function(){for(var a=this.terms,b=-Infinity,c=0,e=a.length;c<e;c++){var d=a[c].getDegreeOfMembership();d>b&&(b=d)}return b};var db=
function(a){a=void 0===a?null:a;return S.call(this,null!==a?[a]:[])||this};$jscomp.inherits(db,S);db.prototype.clearDegreeOfMembership=function(){this.terms[0].clearDegreeOfMembership();return this};db.prototype.getDegreeOfMembership=function(){var a=this.terms[0].getDegreeOfMembership();return a*a};db.prototype.updateDegreeOfMembership=function(a){this.terms[0].updateDegreeOfMembership(a*a);return this};var w=function(a){this.degreeOfMembership=0;this.representativeValue=void 0===a?0:a;this.right=
this.left=0;this._uuid=null;return this};$jscomp.inherits(w,wa);w.prototype.computeDegreeOfMembership=function(){};w.prototype.clearDegreeOfMembership=function(){this.degreeOfMembership=0;return this};w.prototype.getDegreeOfMembership=function(){return this.degreeOfMembership};w.prototype.updateDegreeOfMembership=function(a){a>this.degreeOfMembership&&(this.degreeOfMembership=a);return this};w.prototype.toJSON=function(){var a=wa.prototype.toJSON.call(this);a.degreeOfMembership=this.degreeOfMembership;
a.representativeValue=this.representativeValue;a.left=this.left;a.right=this.right;a.uuid=this.uuid;return a};w.prototype.fromJSON=function(a){this.degreeOfMembership=a.degreeOfMembership;this.representativeValue=a.representativeValue;this.left=a.left;this.right=a.right;this.uuid=a.uuid;return this};$jscomp.global.Object.defineProperties(w.prototype,{uuid:{configurable:!0,enumerable:!0,get:function(){null===this._uuid&&(this._uuid=I.generateUUID());return this._uuid},set:function(a){this._uuid=a}}});
var yb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=w.call(this,(b+a)/2)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(yb,w);yb.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.right;return a>=this.left&&a<=b?1:a>b&&a<=c?a>=(b+c)/2?2*Math.pow((a-c)/(b-c),2):1-2*Math.pow((a-b)/(b-c),2):0};yb.prototype.toJSON=function(){var a=w.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};yb.prototype.fromJSON=function(a){w.prototype.fromJSON.call(this,
a);this.midpoint=a.midpoint;return this};var eb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=w.call(this,(b+a)/2)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(eb,w);eb.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.right;return a>=this.left&&a<=b?1:a>b&&a<=c?1/(c-b)*(c-a):0};eb.prototype.toJSON=function(){var a=w.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};eb.prototype.fromJSON=function(a){w.prototype.fromJSON.call(this,
a);this.midpoint=a.midpoint;return this};var fb=function(a,b,c,e){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;e=void 0===e?0:e;var d=w.call(this,b)||this;d.left=a;d.midpoint=b;d.right=c;d.standardDeviation=e;d._cache={};return d};$jscomp.inherits(fb,w);fb.prototype.computeDegreeOfMembership=function(a){this._updateCache();return a>=this.right||a<=this.left?0:q(a,this.midpoint,this._cache.variance)/this._cache.normalizationFactor};fb.prototype.toJSON=function(){var a=w.prototype.toJSON.call(this);
a.midpoint=this.midpoint;a.standardDeviation=this.standardDeviation;return a};fb.prototype.fromJSON=function(a){w.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;this.standardDeviation=a.standardDeviation;return this};fb.prototype._updateCache=function(){var a=this._cache,b=this.midpoint,c=this.standardDeviation;if(b!==a.midpoint||c!==a.standardDeviation){var e=c*c;a.midpoint=b;a.standardDeviation=c;a.variance=e;a.normalizationFactor=q(b,b,e)}return this};var zb=function(a,b,c){a=void 0===
a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=w.call(this,(b+c)/2)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(zb,w);zb.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.left,e=this.right;return a>=c&&a<=b?a<=(c+b)/2?2*Math.pow((a-c)/(b-c),2):1-2*Math.pow((a-b)/(b-c),2):a>b&&a<=e?1:0};zb.prototype.toJSON=function(){var a=w.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};zb.prototype.fromJSON=function(a){w.prototype.fromJSON.call(this,a);
this.midpoint=a.midpoint;return this};var gb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=w.call(this,(b+c)/2)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(gb,w);gb.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.left,e=this.right;return a>=c&&a<=b?1/(b-c)*(a-c):a>b&&a<=e?1:0};gb.prototype.toJSON=function(){var a=w.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};gb.prototype.fromJSON=function(a){w.prototype.fromJSON.call(this,
a);this.midpoint=a.midpoint;return this};var hb=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=w.call(this,b)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(hb,w);hb.prototype.computeDegreeOfMembership=function(a){var b=this.right;return a>=this.left&&a<=b?1:0};hb.prototype.toJSON=function(){var a=w.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};hb.prototype.fromJSON=function(a){w.prototype.fromJSON.call(this,a);this.midpoint=a.midpoint;
return this};var ib=function(a,b,c){a=void 0===a?0:a;b=void 0===b?0:b;c=void 0===c?0:c;var e=w.call(this,b)||this;e.left=a;e.midpoint=b;e.right=c;return e};$jscomp.inherits(ib,w);ib.prototype.computeDegreeOfMembership=function(a){var b=this.midpoint,c=this.left,e=this.right;return a>=c&&a<=b?1/(b-c)*(a-c):a>b&&a<=e?1/(e-b)*(e-a):0};ib.prototype.toJSON=function(){var a=w.prototype.toJSON.call(this);a.midpoint=this.midpoint;return a};ib.prototype.fromJSON=function(a){w.prototype.fromJSON.call(this,
a);this.midpoint=a.midpoint;return this};var jb=function(a,b){this.antecedent=void 0===a?null:a;this.consequence=void 0===b?null:b};jb.prototype.initConsequence=function(){this.consequence.clearDegreeOfMembership();return this};jb.prototype.evaluate=function(){this.consequence.updateDegreeOfMembership(this.antecedent.getDegreeOfMembership());return this};jb.prototype.toJSON=function(){var a={},b=this.antecedent,c=this.consequence;a.type=this.constructor.name;a.antecedent=b instanceof S?b.toJSON():
b.uuid;a.consequence=c instanceof S?c.toJSON():c.uuid;return a};jb.prototype.fromJSON=function(a,b){function c(a){if("string"===typeof a)return b.get(a)||null;var e=a.type;switch(e){case "FuzzyAND":e=new ac;break;case "FuzzyOR":e=new bc;break;case "FuzzyVERY":e=new db;break;case "FuzzyFAIRLY":e=new cb;break;default:A.error("YUKA.FuzzyRule: Unsupported operator type:",e);return}a=a.terms;for(var d=0,k=a.length;d<k;d++)e.terms.push(c(a[d]));return e}this.antecedent=c(a.antecedent);this.consequence=
c(a.consequence);return this};var xa=function(){this.fuzzySets=[];this.minRange=Infinity;this.maxRange=-Infinity};xa.prototype.add=function(a){this.fuzzySets.push(a);a.left<this.minRange&&(this.minRange=a.left);a.right>this.maxRange&&(this.maxRange=a.right);return this};xa.prototype.remove=function(a){var b=this.fuzzySets;a=b.indexOf(a);b.splice(a,1);this.minRange=Infinity;this.maxRange=-Infinity;a=0;for(var c=b.length;a<c;a++){var e=b[a];e.left<this.minRange&&(this.minRange=e.left);e.right>this.maxRange&&
(this.maxRange=e.right)}return this};xa.prototype.fuzzify=function(a){if(a<this.minRange||a>this.maxRange)A.warn("YUKA.FuzzyVariable: Value for fuzzification out of range.");else{for(var b=this.fuzzySets,c=0,e=b.length;c<e;c++){var d=b[c];d.degreeOfMembership=d.computeDegreeOfMembership(a)}return this}};xa.prototype.defuzzifyMaxAv=function(){for(var a=this.fuzzySets,b=0,c=0,e=0,d=a.length;e<d;e++){var p=a[e];b+=p.degreeOfMembership;c+=p.representativeValue*p.degreeOfMembership}return 0===b?0:c/b};
xa.prototype.defuzzifyCentroid=function(a){a=void 0===a?10:a;for(var b=this.fuzzySets,c=(this.maxRange-this.minRange)/a,e=0,d=0,p=1;p<=a;p++)for(var k=this.minRange+p*c,f=0,g=b.length;f<g;f++){var h=b[f];h=Math.min(h.degreeOfMembership,h.computeDegreeOfMembership(k));e+=h;d+=k*h}return 0===e?0:d/e};xa.prototype.toJSON=function(){for(var a={type:this.constructor.name,fuzzySets:[],minRange:this.minRange.toString(),maxRange:this.maxRange.toString()},b=0,c=this.fuzzySets.length;b<c;b++)a.fuzzySets.push(this.fuzzySets[b].toJSON());
return a};xa.prototype.fromJSON=function(a){this.minRange=parseFloat(a.minRange);this.maxRange=parseFloat(a.maxRange);for(var b=0,c=a.fuzzySets.length;b<c;b++){var e=a.fuzzySets[b];switch(e.type){case "LeftShoulderFuzzySet":this.fuzzySets.push((new eb).fromJSON(e));break;case "RightShoulderFuzzySet":this.fuzzySets.push((new gb).fromJSON(e));break;case "SingletonFuzzySet":this.fuzzySets.push((new hb).fromJSON(e));break;case "TriangularFuzzySet":this.fuzzySets.push((new ib).fromJSON(e));break;default:A.error("YUKA.FuzzyVariable: Unsupported fuzzy set type:",
e.type)}}return this};var X=function(){this.rules=[];this.flvs=new Map};X.prototype.addFLV=function(a,b){this.flvs.set(a,b);return this};X.prototype.removeFLV=function(a){this.flvs.delete(a);return this};X.prototype.addRule=function(a){this.rules.push(a);return this};X.prototype.removeRule=function(a){var b=this.rules;a=b.indexOf(a);b.splice(a,1);return this};X.prototype.fuzzify=function(a,b){this.flvs.get(a).fuzzify(b);return this};X.prototype.defuzzify=function(a,b){b=void 0===b?X.DEFUZ_TYPE.MAXAV:
b;var c=this.flvs,e=this.rules;this._initConsequences();for(var d=0,p=e.length;d<p;d++)e[d].evaluate();a=c.get(a);switch(b){case X.DEFUZ_TYPE.MAXAV:b=a.defuzzifyMaxAv();break;case X.DEFUZ_TYPE.CENTROID:b=a.defuzzifyCentroid();break;default:A.warn("YUKA.FuzzyModule: Unknown defuzzification method:",b),b=a.defuzzifyMaxAv()}return b};X.prototype._initConsequences=function(){for(var a=this.rules,b=0,c=a.length;b<c;b++)a[b].initConsequence();return this};X.prototype.toJSON=function(){for(var a={rules:[],
flvs:[]},b=this.rules,c=0,e=b.length;c<e;c++)a.rules.push(b[c].toJSON());b=$jscomp.makeIterator(this.flvs);for(c=b.next();!c.done;c=b.next())e=$jscomp.makeIterator(c.value),c=e.next().value,e=e.next().value,a.flvs.push({name:c,flv:e.toJSON()});return a};X.prototype.fromJSON=function(a){for(var b=new Map,c=a.flvs,e=0,d=c.length;e<d;e++){var p=c[e],k=p.name;p=(new xa).fromJSON(p.flv);this.addFLV(k,p);k=$jscomp.makeIterator(p.fuzzySets);for(p=k.next();!p.done;p=k.next())p=p.value,b.set(p.uuid,p)}a=a.rules;
c=0;for(e=a.length;c<e;c++)d=a[c],d=(new jb).fromJSON(d,b),this.addRule(d);return this};X.DEFUZ_TYPE=Object.freeze({MAXAV:0,CENTROID:1});var z=function(a){this.owner=void 0===a?null:a;this.status=z.STATUS.INACTIVE};z.prototype.activate=function(){};z.prototype.execute=function(){};z.prototype.terminate=function(){};z.prototype.handleMessage=function(){return!1};z.prototype.active=function(){return this.status===z.STATUS.ACTIVE};z.prototype.inactive=function(){return this.status===z.STATUS.INACTIVE};
z.prototype.completed=function(){return this.status===z.STATUS.COMPLETED};z.prototype.failed=function(){return this.status===z.STATUS.FAILED};z.prototype.replanIfFailed=function(){!0===this.failed()&&(this.status=z.STATUS.INACTIVE);return this};z.prototype.activateIfInactive=function(){!0===this.inactive()&&(this.status=z.STATUS.ACTIVE,this.activate());return this};z.prototype.toJSON=function(){return{type:this.constructor.name,owner:this.owner.uuid,status:this.status}};z.prototype.fromJSON=function(a){this.owner=
a.owner;this.status=a.status;return this};z.prototype.resolveReferences=function(a){this.owner=a.get(this.owner)||null;return this};z.STATUS=Object.freeze({ACTIVE:"active",INACTIVE:"inactive",COMPLETED:"completed",FAILED:"failed"});var T=function(a){a=z.call(this,void 0===a?null:a)||this;a.subgoals=[];return a};$jscomp.inherits(T,z);T.prototype.addSubgoal=function(a){this.subgoals.unshift(a);return this};T.prototype.removeSubgoal=function(a){a=this.subgoals.indexOf(a);this.subgoals.splice(a,1);return this};
T.prototype.clearSubgoals=function(){for(var a=this.subgoals,b=0,c=a.length;b<c;b++)a[b].terminate();a.length=0;return this};T.prototype.currentSubgoal=function(){var a=this.subgoals.length;return 0<a?this.subgoals[a-1]:null};T.prototype.executeSubgoals=function(){for(var a=this.subgoals,b=a.length-1;0<=b;b--){var c=a[b];if(!0===c.completed()||!0===c.failed())c instanceof T&&c.clearSubgoals(),c.terminate(),a.pop();else break}b=this.currentSubgoal();return null!==b?(b.activateIfInactive(),b.execute(),
!0===b.completed()&&1<a.length?z.STATUS.ACTIVE:b.status):z.STATUS.COMPLETED};T.prototype.hasSubgoals=function(){return 0<this.subgoals.length};T.prototype.handleMessage=function(a){var b=this.currentSubgoal();return null!==b?b.handleMessage(a):!1};T.prototype.toJSON=function(){var a=z.prototype.toJSON.call(this);a.subgoals=[];for(var b=0,c=this.subgoals.length;b<c;b++)a.subgoals.push(this.subgoals[b].toJSON());return a};T.prototype.resolveReferences=function(a){z.prototype.resolveReferences.call(this,
a);for(var b=0,c=this.subgoals.length;b<c;b++)this.subgoals[b].resolveReferences(a);return this};var Ab=function(a){this.characterBias=void 0===a?1:a};Ab.prototype.calculateDesirability=function(){return 0};Ab.prototype.setGoal=function(){};Ab.prototype.toJSON=function(){return{type:this.constructor.name,characterBias:this.characterBias}};Ab.prototype.fromJSON=function(a){this.characterBias=a.characterBias;return this};var ja=function(a){a=T.call(this,void 0===a?null:a)||this;a.evaluators=[];a._typesMap=
new Map;return a};$jscomp.inherits(ja,T);ja.prototype.activate=function(){this.arbitrate()};ja.prototype.execute=function(){this.activateIfInactive();var a=this.executeSubgoals();if(a===z.STATUS.COMPLETED||a===z.STATUS.FAILED)this.status=z.STATUS.INACTIVE};ja.prototype.terminate=function(){this.clearSubgoals()};ja.prototype.addEvaluator=function(a){this.evaluators.push(a);return this};ja.prototype.removeEvaluator=function(a){a=this.evaluators.indexOf(a);this.evaluators.splice(a,1);return this};ja.prototype.arbitrate=
function(){for(var a=this.evaluators,b=-1,c=null,e=0,d=a.length;e<d;e++){var p=a[e],k=p.calculateDesirability(this.owner);k*=p.characterBias;k>=b&&(b=k,c=p)}null!==c?c.setGoal(this.owner):A.error("YUKA.Think: Unable to determine goal evaluator for game entity:",this.owner);return this};ja.prototype.toJSON=function(){var a=T.prototype.toJSON.call(this);a.evaluators=[];for(var b=0,c=this.evaluators.length;b<c;b++)a.evaluators.push(this.evaluators[b].toJSON());return a};ja.prototype.fromJSON=function(a){function b(a){var e=
a.type,d=c.get(e);if(void 0!==d){e=(new d).fromJSON(a);a=a.subgoals;if(void 0!==a){d=0;for(var n=a.length;d<n;d++){var p=b(a[d]);p&&e.subgoals.push(p)}}return e}A.warn("YUKA.Think: Unsupported goal evaluator type:",e)}T.prototype.fromJSON.call(this,a);var c=this._typesMap;this.evaluators.length=0;this.terminate();for(var e=0,d=a.evaluators.length;e<d;e++){var p=a.evaluators[e],k=p.type,f=c.get(k);void 0!==f?(p=(new f).fromJSON(p),this.evaluators.push(p)):A.warn("YUKA.Think: Unsupported goal evaluator type:",
k)}e=0;for(d=a.subgoals.length;e<d;e++)(p=b(a.subgoals[e]))&&this.subgoals.push(p);return this};ja.prototype.registerType=function(a,b){this._typesMap.set(a,b);return this};var pa=function(a,b,c){this.from=void 0===a?-1:a;this.to=void 0===b?-1:b;this.cost=void 0===c?0:c};pa.prototype.copy=function(a){this.from=a.from;this.to=a.to;this.cost=a.cost;return this};pa.prototype.clone=function(){return(new this.constructor).copy(this)};pa.prototype.toJSON=function(){return{type:this.constructor.name,from:this.from,
to:this.to,cost:this.cost}};pa.prototype.fromJSON=function(a){this.from=a.from;this.to=a.to;this.cost=a.cost;return this};var kb=function(a){this.index=void 0===a?-1:a};kb.prototype.toJSON=function(){return{type:this.constructor.name,index:this.index}};kb.prototype.fromJSON=function(a){this.index=a.index;return this};var P=function(){this.digraph=!1;this._nodes=new Map;this._edges=new Map};P.prototype.addNode=function(a){var b=a.index;this._nodes.set(b,a);this._edges.set(b,[]);return this};P.prototype.addEdge=
function(a){var b=this._edges.get(a.from);b.push(a);if(!1===this.digraph){var c=a.clone();c.from=a.to;c.to=a.from;b=this._edges.get(a.to);b.push(c)}return this};P.prototype.getNode=function(a){return this._nodes.get(a)||null};P.prototype.getEdge=function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=this._edges.get(a);for(var c=0,e=a.length;c<e;c++){var d=a[c];if(d.to===b)return d}}return null};P.prototype.getNodes=function(a){a.length=0;a.push.apply(a,$jscomp.arrayFromIterable(this._nodes.values()));
return a};P.prototype.getEdgesOfNode=function(a,b){a=this._edges.get(a);void 0!==a&&(b.length=0,b.push.apply(b,$jscomp.arrayFromIterable(a)));return b};P.prototype.getNodeCount=function(){return this._nodes.size};P.prototype.getEdgeCount=function(){for(var a=0,b=$jscomp.makeIterator(this._edges.values()),c=b.next();!c.done;c=b.next())a+=c.value.length;return a};P.prototype.removeNode=function(a){this._nodes.delete(a.index);if(!1===this.digraph){var b=this._edges.get(a.index);b=$jscomp.makeIterator(b);
for(var c=b.next();!c.done;c=b.next()){c=this._edges.get(c.value.to);for(var e=c.length-1;0<=e;e--){var d=c[e];if(d.to===a.index){e=c.indexOf(d);c.splice(e,1);break}}}}else for(b=$jscomp.makeIterator(this._edges.values()),c=b.next();!c.done;c=b.next())for(c=c.value,e=c.length-1;0<=e;e--)d=c[e],this.hasNode(d.to)&&this.hasNode(d.from)||(d=c.indexOf(d),c.splice(d,1));this._edges.delete(a.index);return this};P.prototype.removeEdge=function(a){var b=this._edges.get(a.from);if(void 0!==b){var c=b.indexOf(a);
b.splice(c,1);if(!1===this.digraph){b=this._edges.get(a.to);c=0;for(var e=b.length;c<e;c++){var d=b[c];if(d.to===a.from){a=b.indexOf(d);b.splice(a,1);break}}}}return this};P.prototype.hasNode=function(a){return this._nodes.has(a)};P.prototype.hasEdge=function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=this._edges.get(a);for(var c=0,e=a.length;c<e;c++)if(a[c].to===b)return!0}return!1};P.prototype.clear=function(){this._nodes.clear();this._edges.clear();return this};P.prototype.toJSON=function(){for(var a=
{type:this.constructor.name,digraph:this.digraph},b=[],c=[],e=$jscomp.makeIterator(this._nodes.entries()),d=e.next();!d.done;d=e.next()){d=$jscomp.makeIterator(d.value);var p=d.next().value;d=d.next().value;var k=[];this.getEdgesOfNode(p,k);p=0;for(var f=k.length;p<f;p++)b.push(k[p].toJSON());c.push(d.toJSON())}a._edges=b;a._nodes=c;return a};P.prototype.fromJSON=function(a){this.digraph=a.digraph;for(var b=0,c=a._nodes.length;b<c;b++)this.addNode((new kb).fromJSON(a._nodes[b]));b=0;for(c=a._edges.length;b<
c;b++)this.addEdge((new pa).fromJSON(a._edges[b]));return this};var Kc=function(){};Kc.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.distanceTo(a.position)};var Cd=function(){};Cd.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.squaredDistanceTo(a.position)};var Dd=function(){};Dd.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.manhattanDistanceTo(a.position)};var Ed=function(){};Ed.calculate=function(){return 0};var Ba=
function(a){a=void 0===a?m:a;this.data=[];this.length=0;this.compare=a};Ba.prototype.push=function(a){this.data.push(a);this.length++;this._up(this.length-1)};Ba.prototype.pop=function(){if(0===this.length)return null;var a=this.data[0];this.length--;0<this.length&&(this.data[0]=this.data[this.length],this._down(0));this.data.pop();return a};Ba.prototype.peek=function(){return this.data[0]||null};Ba.prototype._up=function(a){for(var b=this.data,c=this.compare,e=b[a];0<a;){var d=a-1>>1,p=b[d];if(0<=
c(e,p))break;b[a]=p;a=d}b[a]=e};Ba.prototype._down=function(a){for(var b=this.data,c=this.compare,e=b[a],d=this.length>>1;a<d;){var p=(a<<1)+1,f=p+1,g=b[p];f<this.length&&0>c(b[f],g)&&(p=f,g=b[f]);if(0<=c(g,e))break;b[a]=g;a=p}b[a]=e};var lb=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this.heuristic=Kc;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};lb.prototype.search=function(){var a=[],b=new Ba(u);
for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,a);for(var e=0,d=a.length;e<d;e++){var f=a[e],k=(this._cost.get(c)||0)+f.cost,g=this.heuristic.calculate(this.graph,f.to,this.target);g=k+g;if(!1===this._searchFrontier.has(f.to)||k<this._cost.get(f.to))this._cost.set(f.to,k),this._searchFrontier.set(f.to,
f),b.push({cost:g,index:f.to})}}}this.found=!1;return this};lb.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,a.unshift(b);return a};lb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};lb.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear();return this};
var Bb=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};Bb.prototype.search=function(){var a=[],b=[],c=new pa(this.source,this.source);a.push(c);for(this._visited.add(this.source);0<a.length;){var e=a.shift();this._route.set(e.to,e.from);e!==c&&this._spanningTree.add(e);if(e.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(e.to,b);e=0;for(var d=
b.length;e<d;e++){var f=b[e];!1===this._visited.has(f.to)&&(a.push(f),this._visited.add(f.to))}}this.found=!1;return this};Bb.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};Bb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};Bb.prototype.clear=function(){this.found=!1;this._route.clear();this._visited.clear();this._spanningTree.clear();
return this};var Cb=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};Cb.prototype.search=function(){var a=[],b=[],c=new pa(this.source,this.source);for(a.push(c);0<a.length;){var e=a.pop();this._route.set(e.to,e.from);this._visited.add(e.to);e!==c&&this._spanningTree.add(e);if(e.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(e.to,b);e=0;for(var d=
b.length;e<d;e++){var f=b[e];!1===this._visited.has(f.to)&&a.push(f)}}this.found=!1;return this};Cb.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};Cb.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};Cb.prototype.clear=function(){this.found=!1;this._route.clear();this._visited.clear();this._spanningTree.clear();return this};
var Db=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};Db.prototype.search=function(){var a=[],b=new Ba(l);for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,
a);for(var e=0,d=a.length;e<d;e++){var f=a[e],k=(this._cost.get(c)||0)+f.cost;if(!1===this._searchFrontier.has(f.to)||k<this._cost.get(f.to))this._cost.set(f.to,k),this._searchFrontier.set(f.to,f),b.push({cost:k,index:f.to})}}}this.found=!1;return this};Db.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,a.unshift(b);return a};Db.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};
Db.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear();return this};var Fd=new f,cc=new f,ea=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.from=a;this.to=b};ea.prototype.set=function(a,b){this.from=a;this.to=b;return this};ea.prototype.copy=function(a){this.from.copy(a.from);this.to.copy(a.to);return this};ea.prototype.clone=function(){return(new this.constructor).copy(this)};ea.prototype.delta=function(a){return a.subVectors(this.to,
this.from)};ea.prototype.at=function(a,b){return this.delta(b).multiplyScalar(a).add(this.from)};ea.prototype.closestPointToPoint=function(a,b,c){a=this.closestPointToPointParameter(a,b);return this.at(a,c)};ea.prototype.closestPointToPointParameter=function(a,b){b=void 0===b?!0:b;Fd.subVectors(a,this.from);cc.subVectors(this.to,this.from);a=cc.dot(cc);a=cc.dot(Fd)/a;b&&(a=I.clamp(a,0,1));return a};ea.prototype.equals=function(a){return a.from.equals(this.from)&&a.to.equals(this.to)};var dc=new f,
Gd=new f,Lc=new f,Mc=new f,Nc=new f,Oc=new f,Hd=new f,Ca=function(){};Ca.prototype.intersects=function(a,b){return this._checkFaceDirections(a,b)||this._checkFaceDirections(b,a)||this._checkEdgeDirections(a,b)?!1:!0};Ca.prototype._checkFaceDirections=function(a,b){a=a.faces;for(var c=0,e=a.length;c<e;c++){var d=a[c].plane;Gd.copy(d.normal).multiplyScalar(-1);var f=this._getSupportVertex(b,Gd);if(0<d.distanceToPoint(f))return!0}return!1};Ca.prototype._checkEdgeDirections=function(a,b){var c=a.edges;
b=b.edges;for(var e=0,d=c.length;e<d;e++)for(var f=c[e],k=0,g=b.length;k<g;k++){var h=b[k];f.getDirection(Lc);h.getDirection(Mc);if(this._minkowskiFace(f,Lc,h,Mc)&&0<this._distanceBetweenEdges(f,Lc,h,Mc,a))return!0}return!1};Ca.prototype._getSupportVertex=function(a,b){var c=-Infinity,e=null;a=a.vertices;for(var d=0,f=a.length;d<f;d++){var k=a[d],g=k.dot(b);g>c&&(c=g,e=k)}return e};Ca.prototype._minkowskiFace=function(a,b,c,e){var d=a.polygon.plane.normal;a=a.twin.polygon.plane.normal;Nc.copy(c.polygon.plane.normal);
Oc.copy(c.twin.polygon.plane.normal);Nc.multiplyScalar(-1);Oc.multiplyScalar(-1);c=Nc.dot(b);b=Oc.dot(b);d=d.dot(e);e=a.dot(e);return 0>c*b&&0>d*e&&0<c*e};Ca.prototype._distanceBetweenEdges=function(a,b,c,e,d){if(1===Math.abs(b.dot(e)))return-Infinity;dc.crossVectors(b,e).normalize();0>dc.dot(Hd.subVectors(a.vertex,d.centroid))&&dc.multiplyScalar(-1);return dc.dot(Hd.subVectors(c.vertex,a.vertex))};var Da=function(a){this.vertex=a=void 0===a?new f:a;this.polygon=this.twin=this.prev=this.next=null};
Da.prototype.tail=function(){return this.prev?this.prev.vertex:null};Da.prototype.head=function(){return this.vertex};Da.prototype.length=function(){var a=this.tail(),b=this.head();return null!==a?a.distanceTo(b):-1};Da.prototype.squaredLength=function(){var a=this.tail(),b=this.head();return null!==a?a.squaredDistanceTo(b):-1};Da.prototype.linkOpponent=function(a){this.twin=a;a.twin=this;return this};Da.prototype.getDirection=function(a){return a.subVectors(this.vertex,this.prev.vertex).normalize()};
var O=function(){this.centroid=new f;this.edge=null;this.plane=new V};O.prototype.fromContour=function(a){var b=[];if(3>a.length)return A.error("YUKA.Polygon: Unable to create polygon from contour. It needs at least three points."),this;for(var c=0,e=a.length;c<e;c++){var d=new Da(a[c]);b.push(d)}c=0;for(e=b.length;c<e;c++){if(0===c){d=b[c];var f=b[e-1];var k=b[c+1]}else c===e-1?(d=b[c],f=b[c-1],k=b[0]):(d=b[c],f=b[c-1],k=b[c+1]);d.prev=f;d.next=k;d.polygon=this}this.edge=b[0];this.plane.fromCoplanarPoints(a[0],
a[1],a[2]);return this};O.prototype.computeCentroid=function(){var a=this.centroid,b=this.edge,c=0;a.set(0,0,0);do a.add(b.vertex),c++,b=b.next;while(b!==this.edge);a.divideScalar(c);return this};O.prototype.contains=function(a,b){b=void 0===b?.001:b;var c=this.plane,e=this.edge;do{var d=e.tail(),f=e.head();if(!1===0<=I.area(d,f,a))return!1;e=e.next}while(e!==this.edge);a=c.distanceToPoint(a);return Math.abs(a)>b?!1:!0};O.prototype.convex=function(a){a=void 0===a?!0:a;var b=this.edge;do{var c=b.tail(),
e=b.head(),d=b.next.head();if(a){if(!1===0<=I.area(c,e,d))return!1}else if(!1===0<=I.area(d,e,c))return!1;b=b.next}while(b!==this.edge);return!0};O.prototype.coplanar=function(a){a=void 0===a?.001:a;var b=this.plane,c=this.edge;do{var e=b.distanceToPoint(c.vertex);if(Math.abs(e)>a)return!1;c=c.next}while(c!==this.edge);return!0};O.prototype.distanceToPoint=function(a){return this.plane.distanceToPoint(a)};O.prototype.getContour=function(a){var b=this.edge;a.length=0;do a.push(b.vertex),b=b.next;while(b!==
this.edge);return a};O.prototype.getPortalEdgeTo=function(a,b){var c=this.edge;do{if(null!==c.twin&&c.twin.polygon===a)return b.left=c.prev.vertex,b.right=c.vertex,b;c=c.next}while(c!==this.edge);b.left=null;b.right=null;return b};var Ea=function(){this.faces=[];this.edges=[];this.vertices=[];this.centroid=new f};Ea.prototype.computeCentroid=function(){var a=this.centroid,b=this.faces;a.set(0,0,0);for(var c=0,e=b.length;c<e;c++)a.add(b[c].centroid);a.divideScalar(b.length);return this};Ea.prototype.computeUniqueVertices=
function(){var a=this.faces,b=this.vertices;b.length=0;for(var c=new Set,e=0,d=a.length;e<d;e++){var f=a[e],k=f.edge;do c.add(k.vertex),k=k.next;while(k!==f.edge)}b.push.apply(b,$jscomp.arrayFromIterable(c));return this};Ea.prototype.computeUniqueEdges=function(){for(var a=this.faces,b=this.edges,c=b.length=0,e=a.length;c<e;c++){var d=a[c],f=d.edge;do!1===b.includes(f.twin)&&b.push(f),f=f.next;while(f!==d.edge)}return this};Ea.prototype.fromAABB=function(a){this.faces.length=0;this.vertices.length=
0;var b=a.min,c=a.max,e=[new f(c.x,c.y,c.z),new f(c.x,c.y,b.z),new f(c.x,b.y,c.z),new f(c.x,b.y,b.z),new f(b.x,c.y,c.z),new f(b.x,c.y,b.z),new f(b.x,b.y,c.z),new f(b.x,b.y,b.z)];this.vertices.push.apply(this.vertices,$jscomp.arrayFromIterable(e));b=(new O).fromContour([e[4],e[0],e[1],e[5]]);c=(new O).fromContour([e[2],e[3],e[1],e[0]]);var d=(new O).fromContour([e[6],e[2],e[0],e[4]]),p=(new O).fromContour([e[3],e[7],e[5],e[1]]),k=(new O).fromContour([e[3],e[2],e[6],e[7]]);e=(new O).fromContour([e[7],
e[6],e[4],e[5]]);b.edge.linkOpponent(e.edge.prev);b.edge.next.linkOpponent(d.edge.prev);b.edge.next.next.linkOpponent(c.edge.prev);b.edge.prev.linkOpponent(p.edge.prev);k.edge.linkOpponent(p.edge.next);k.edge.next.linkOpponent(c.edge.next);k.edge.next.next.linkOpponent(d.edge.next);k.edge.prev.linkOpponent(e.edge.next);e.edge.linkOpponent(p.edge.next.next);p.edge.linkOpponent(c.edge.next.next);c.edge.linkOpponent(d.edge.next.next);d.edge.linkOpponent(e.edge.next.next);this.faces.push(b,c,d,p,k,e);
b.computeCentroid();c.computeCentroid();d.computeCentroid();p.computeCentroid();k.computeCentroid();e.computeCentroid();a.getCenter(this.centroid);this.computeUniqueEdges();return this};var Id=new ea,ec=new V,Jd=new f,be=new f(0,1,0),Kd=new Ca,Eb,L=function(){var a=Ea.call(this)||this;a._tolerance=-1;a._vertices=[];a._assigned=new fa;a._unassigned=new fa;a._newFaces=[];return a};$jscomp.inherits(L,Ea);L.prototype.containsPoint=function(a){for(var b=this.faces,c=0,e=b.length;c<e;c++)if(b[c].distanceToPoint(a)>
this._tolerance)return!1;return!0};L.prototype.intersectsAABB=function(a){if(void 0===Eb)Eb=(new Ea).fromAABB(a);else{var b=a.min,c=a.max,e=Eb.vertices;e[0].set(c.x,c.y,c.z);e[1].set(c.x,c.y,b.z);e[2].set(c.x,b.y,c.z);e[3].set(c.x,b.y,b.z);e[4].set(b.x,c.y,c.z);e[5].set(b.x,c.y,b.z);e[6].set(b.x,b.y,c.z);e[7].set(b.x,b.y,b.z);a.getCenter(Eb.centroid)}return Kd.intersects(this,Eb)};L.prototype.intersectsConvexHull=function(a){return Kd.intersects(this,a)};L.prototype.fromPoints=function(a){if(4>a.length)return A.error("YUKA.ConvexHull: The given points array needs at least four points."),
this;for(var b=0,c=a.length;b<c;b++)this._vertices.push(new Ld(a[b]));this._generate();return this};L.prototype._addAdjoiningFace=function(a,b){a=new ha(a.point,b.prev.vertex,b.vertex);this.faces.push(a);a.getEdge(-1).linkOpponent(b.twin);return a.getEdge(0)};L.prototype._addNewFaces=function(a,b){this._newFaces=[];for(var c=null,e=null,d=0,f=b.length;d<f;d++){var k=this._addAdjoiningFace(a,b[d]);null===c?c=k:k.next.linkOpponent(e);this._newFaces.push(k.polygon);e=k}c.next.linkOpponent(e);return this};
L.prototype._addVertexToFace=function(a,b){a.face=b;null===b.outside?(this._assigned.append(a),b.outside=a):this._assigned.insertAfter(b.outside,a);return this};L.prototype._addVertexToHull=function(a){var b=[];this._unassigned.clear();this._computeHorizon(a.point,null,a.face,b);this._addNewFaces(a,b);this._resolveUnassignedPoints(this._newFaces);return this};L.prototype._reset=function(){this._vertices.length=0;this._assigned.clear();this._unassigned.clear();this._newFaces.length=0;return this};
L.prototype._computeInitialHull=function(){var a=this._vertices;var b=this._computeExtremes();var c=b.min,e=b.max;var d=e.x.point.x-c.x.point.x;b=c.x;var f=e.x;var k=e.y.point.y-c.y.point.y;k>d&&(b=c.y,f=e.y,d=k);k=e.z.point.z-c.z.point.z;k>d&&(b=c.z,f=e.z);d=-Infinity;Id.set(b.point,f.point);c=0;for(e=a.length;c<e;c++){var g=a[c];if(g!==b&&g!==f&&(Id.closestPointToPoint(g.point,!0,Jd),k=Jd.squaredDistanceTo(g.point),k>d)){d=k;var h=g}}d=-Infinity;ec.fromCoplanarPoints(b.point,f.point,h.point);c=
0;for(e=a.length;c<e;c++)if(g=a[c],g!==b&&g!==f&&g!==h&&(k=Math.abs(ec.distanceToPoint(g.point)),k>d)){d=k;var l=g}if(0===ec.distanceToPoint(l.point))throw"ERROR: YUKA.ConvexHull: All extreme points lie in a single plane. Unable to compute convex hull.";c=this.faces;0>ec.distanceToPoint(l.point)?(c.push(new ha(b.point,f.point,h.point),new ha(l.point,f.point,b.point),new ha(l.point,h.point,f.point),new ha(l.point,b.point,h.point)),c[1].getEdge(2).linkOpponent(c[0].getEdge(1)),c[2].getEdge(2).linkOpponent(c[0].getEdge(2)),
c[3].getEdge(2).linkOpponent(c[0].getEdge(0)),c[1].getEdge(1).linkOpponent(c[2].getEdge(0)),c[2].getEdge(1).linkOpponent(c[3].getEdge(0)),c[3].getEdge(1).linkOpponent(c[1].getEdge(0))):(c.push(new ha(b.point,h.point,f.point),new ha(l.point,b.point,f.point),new ha(l.point,f.point,h.point),new ha(l.point,h.point,b.point)),c[1].getEdge(2).linkOpponent(c[0].getEdge(0)),c[2].getEdge(2).linkOpponent(c[0].getEdge(2)),c[3].getEdge(2).linkOpponent(c[0].getEdge(1)),c[1].getEdge(0).linkOpponent(c[2].getEdge(1)),
c[2].getEdge(0).linkOpponent(c[3].getEdge(1)),c[3].getEdge(0).linkOpponent(c[1].getEdge(1)));e=0;for(g=a.length;e<g;e++){var r=a[e];if(r!==b&&r!==f&&r!==h&&r!==l){d=this._tolerance;for(var m=null,q=0;4>q;q++)k=c[q].distanceToPoint(r.point),k>d&&(d=k,m=c[q]);null!==m&&this._addVertexToFace(r,m)}}return this};L.prototype._computeExtremes=function(){for(var a=new f(Infinity,Infinity,Infinity),b=new f(-Infinity,-Infinity,-Infinity),c={x:null,y:null,z:null},e={x:null,y:null,z:null},d=0,g=this._vertices.length;d<
g;d++){var k=this._vertices[d],h=k.point;h.x<a.x&&(a.x=h.x,c.x=k);h.y<a.y&&(a.y=h.y,c.y=k);h.z<a.z&&(a.z=h.z,c.z=k);h.x>b.x&&(b.x=h.x,e.x=k);h.y>b.y&&(b.y=h.y,e.y=k);h.z>b.z&&(b.z=h.z,e.z=k)}this._tolerance=3*Number.EPSILON*(Math.max(Math.abs(a.x),Math.abs(b.x))+Math.max(Math.abs(a.y),Math.abs(b.y))+Math.max(Math.abs(a.z),Math.abs(b.z)));return{min:c,max:e}};L.prototype._computeHorizon=function(a,b,c,e){if(c.outside){var d=c.outside;this._removeAllVerticesFromFace(c);this._unassigned.appendChain(d)}c.active=
!1;c=null===b?b=c.getEdge(0):b.next;do{d=c.twin;var f=d.polygon;f.active&&(f.distanceToPoint(a)>this._tolerance?this._computeHorizon(a,d,f,e):e.push(c));c=c.next}while(c!==b);return this};L.prototype._generate=function(){this.faces.length=0;this._computeInitialHull();for(var a;a=this._nextVertexToAdd();)this._addVertexToHull(a);this._updateFaces();this._mergeFaces();this._reset();return this};L.prototype._mergeFaces=function(){var a=this.faces,b=this.edges;this.computeUniqueEdges();b.sort(function(a,
b){return b.length()-a.length()});for(var c=0,e=b.length;c<e;c++){var d=b[c],f=d;var k=f.prev;var g=f.next;var h=f.twin.prev;var l=f.twin.next;f.prev.next=f.twin.next;f.next.prev=f.twin.prev;f.twin.prev.next=f.next;f.twin.next.prev=f.prev;var r=f.polygon;r.edge=f.prev;var m=0<=r.plane.normal.dot(be);if(!0===r.convex(m)&&!0===r.coplanar(this._tolerance)){k=r.edge;do k.polygon=r,k=k.next;while(k!==r.edge);d=a.indexOf(d.twin.polygon);a.splice(d,1)}else k.next=f,g.prev=f,h.next=f.twin,l.prev=f.twin,r.edge=
f}b=0;for(c=a.length;b<c;b++)a[b].computeCentroid();this.computeCentroid();this.computeUniqueEdges();this.computeUniqueVertices();return this};L.prototype._nextVertexToAdd=function(){var a=null;if(!1===this._assigned.empty()){var b=0,c=this._assigned.first(),e=c.face;do{var d=e.distanceToPoint(c.point);d>b&&(b=d,a=c);c=c.next}while(null!==c&&c.face===e)}return a};L.prototype._updateFaces=function(){for(var a=this.faces,b=[],c=0,e=a.length;c<e;c++){var d=a[c];d.active&&b.push(d)}this.faces.length=
0;this.faces.push.apply(this.faces,$jscomp.arrayFromIterable(b));return this};L.prototype._removeAllVerticesFromFace=function(a){if(null!==a.outside){var b=a.outside;b.face=null;for(var c=a.outside;null!==c.next&&c.next.face===a;)c=c.next,c.face=null;a.outside=null;this._assigned.removeChain(b,c)}return this};L.prototype._removeVertexFromFace=function(a,b){a.face=null;a===b.outside&&(b.outside=null!==a.next&&a.next.face===b?a.next:null);this._assigned.remove(a);return this};L.prototype._resolveUnassignedPoints=
function(a){if(!1===this._unassigned.empty()){var b=this._unassigned.first();do{for(var c=b.next,e=this._tolerance,d=null,f=0,k=a.length;f<k;f++){var g=a[f];if(g.active){var h=g.distanceToPoint(b.point);h>e&&(e=h,d=g)}}null!==d&&this._addVertexToFace(b,d);b=c}while(null!==b)}return this};var ha=function(a,b,c){a=void 0===a?new f:a;b=void 0===b?new f:b;c=void 0===c?new f:c;var e=O.call(this)||this;e.outside=null;e.active=!0;e.fromContour([a,b,c]);e.computeCentroid();return e};$jscomp.inherits(ha,O);
ha.prototype.getEdge=function(a){for(var b=this.edge;0<a;)b=b.next,a--;for(;0>a;)b=b.prev,a++;return b};var Ld=function(a){this.point=a=void 0===a?new f:a;this.face=this.next=this.prev=null},fa=function(){this.tail=this.head=null};fa.prototype.first=function(){return this.head};fa.prototype.last=function(){return this.tail};fa.prototype.clear=function(){this.head=this.tail=null;return this};fa.prototype.insertAfter=function(a,b){b.prev=a;b.next=a.next;b.next?b.next.prev=b:this.tail=b;a.next=b;return this};
fa.prototype.append=function(a){null===this.head?this.head=a:this.tail.next=a;a.prev=this.tail;a.next=null;this.tail=a;return this};fa.prototype.appendChain=function(a){null===this.head?this.head=a:this.tail.next=a;for(a.prev=this.tail;null!==a.next;)a=a.next;this.tail=a;return this};fa.prototype.remove=function(a){null===a.prev?this.head=a.next:a.prev.next=a.next;null===a.next?this.tail=a.prev:a.next.prev=a.prev;a.prev=null;a.next=null;return this};fa.prototype.removeChain=function(a,b){null===a.prev?
this.head=b.next:a.prev.next=b.next;null===b.next?this.tail=a.prev:b.next.prev=a.prev;a.prev=null;b.next=null;return this};fa.prototype.empty=function(){return null===this.head};var Md={unitary:new B,diagonal:new B},Nd=null,Pa=[new f,new f,new f],F=[],Od=null,fc=[new f,new f,new f],G=[],J=[[],[],[]],v=[[],[],[]],H=[],Qa=new f,Ra=new f,Sa=new f,ia=new f,Pd=new f,R=function(a,b,c){a=void 0===a?new f:a;b=void 0===b?new f:b;c=void 0===c?new B:c;this.center=a;this.halfSizes=b;this.rotation=c};R.prototype.set=
function(a,b,c){this.center=a;this.halfSizes=b;this.rotation=c;return this};R.prototype.copy=function(a){this.center.copy(a.center);this.halfSizes.copy(a.halfSizes);this.rotation.copy(a.rotation);return this};R.prototype.clone=function(){return(new this.constructor).copy(this)};R.prototype.getSize=function(a){return a.copy(this.halfSizes).multiplyScalar(2)};R.prototype.clampPoint=function(a,b){var c=this.halfSizes;ia.subVectors(a,this.center);this.rotation.extractBasis(Qa,Ra,Sa);b.copy(this.center);
a=I.clamp(ia.dot(Qa),-c.x,c.x);b.add(Qa.multiplyScalar(a));a=I.clamp(ia.dot(Ra),-c.y,c.y);b.add(Ra.multiplyScalar(a));c=I.clamp(ia.dot(Sa),-c.z,c.z);b.add(Sa.multiplyScalar(c));return b};R.prototype.containsPoint=function(a){ia.subVectors(a,this.center);this.rotation.extractBasis(Qa,Ra,Sa);return Math.abs(ia.dot(Qa))<=this.halfSizes.x&&Math.abs(ia.dot(Ra))<=this.halfSizes.y&&Math.abs(ia.dot(Sa))<=this.halfSizes.z};R.prototype.intersectsAABB=function(a){return this.intersectsOBB(ce.fromAABB(a))};R.prototype.intersectsBoundingSphere=
function(a){this.clampPoint(a.center,Pd);return Pd.squaredDistanceTo(a.center)<=a.radius*a.radius};R.prototype.intersectsOBB=function(a,b){b=void 0===b?Number.EPSILON:b;Nd=this.center;F[0]=this.halfSizes.x;F[1]=this.halfSizes.y;F[2]=this.halfSizes.z;this.rotation.extractBasis(Pa[0],Pa[1],Pa[2]);Od=a.center;G[0]=a.halfSizes.x;G[1]=a.halfSizes.y;G[2]=a.halfSizes.z;a.rotation.extractBasis(fc[0],fc[1],fc[2]);for(a=0;3>a;a++)for(var c=0;3>c;c++)J[a][c]=Pa[a].dot(fc[c]);ia.subVectors(Od,Nd);H[0]=ia.dot(Pa[0]);
H[1]=ia.dot(Pa[1]);H[2]=ia.dot(Pa[2]);for(a=0;3>a;a++)for(c=0;3>c;c++)v[a][c]=Math.abs(J[a][c])+b;for(c=0;3>c;c++)if(b=F[c],a=G[0]*v[c][0]+G[1]*v[c][1]+G[2]*v[c][2],Math.abs(H[c])>b+a)return!1;for(c=0;3>c;c++)if(b=F[0]*v[0][c]+F[1]*v[1][c]+F[2]*v[2][c],a=G[c],Math.abs(H[0]*J[0][c]+H[1]*J[1][c]+H[2]*J[2][c])>b+a)return!1;b=F[1]*v[2][0]+F[2]*v[1][0];a=G[1]*v[0][2]+G[2]*v[0][1];if(Math.abs(H[2]*J[1][0]-H[1]*J[2][0])>b+a)return!1;b=F[1]*v[2][1]+F[2]*v[1][1];a=G[0]*v[0][2]+G[2]*v[0][0];if(Math.abs(H[2]*
J[1][1]-H[1]*J[2][1])>b+a)return!1;b=F[1]*v[2][2]+F[2]*v[1][2];a=G[0]*v[0][1]+G[1]*v[0][0];if(Math.abs(H[2]*J[1][2]-H[1]*J[2][2])>b+a)return!1;b=F[0]*v[2][0]+F[2]*v[0][0];a=G[1]*v[1][2]+G[2]*v[1][1];if(Math.abs(H[0]*J[2][0]-H[2]*J[0][0])>b+a)return!1;b=F[0]*v[2][1]+F[2]*v[0][1];a=G[0]*v[1][2]+G[2]*v[1][0];if(Math.abs(H[0]*J[2][1]-H[2]*J[0][1])>b+a)return!1;b=F[0]*v[2][2]+F[2]*v[0][2];a=G[0]*v[1][1]+G[1]*v[1][0];if(Math.abs(H[0]*J[2][2]-H[2]*J[0][2])>b+a)return!1;b=F[0]*v[1][0]+F[1]*v[0][0];a=G[1]*
v[2][2]+G[2]*v[2][1];if(Math.abs(H[1]*J[0][0]-H[0]*J[1][0])>b+a)return!1;b=F[0]*v[1][1]+F[1]*v[0][1];a=G[0]*v[2][2]+G[2]*v[2][0];if(Math.abs(H[1]*J[0][1]-H[0]*J[1][1])>b+a)return!1;b=F[0]*v[1][2]+F[1]*v[0][2];a=G[0]*v[2][1]+G[1]*v[2][0];return Math.abs(H[1]*J[0][2]-H[0]*J[1][2])>b+a?!1:!0};R.prototype.intersectsPlane=function(a){this.rotation.extractBasis(Qa,Ra,Sa);var b=this.halfSizes.x*Math.abs(a.normal.dot(Qa))+this.halfSizes.y*Math.abs(a.normal.dot(Ra))+this.halfSizes.z*Math.abs(a.normal.dot(Sa));
a=a.normal.dot(this.center)-a.constant;return Math.abs(a)<=b};R.prototype.fromAABB=function(a){a.getCenter(this.center);a.getSize(this.halfSizes).multiplyScalar(.5);this.rotation.identity();return this};R.prototype.fromPoints=function(a){for(var b=(new L).fromPoints(a).faces,c=[],e=[],d=0,g=b.length;d<g;d++){var k=b[d],h=k.edge;c.length=0;do c.push(h),h=h.next;while(h!==k.edge);k=1;for(h=c.length-2;k<=h;k++){var l=c[0].vertex,m=c[k+0].vertex,r=c[k+1].vertex;e.push(l.x,l.y,l.z);e.push(m.x,m.y,m.z);
e.push(r.x,r.y,r.z)}}l=new f;m=new f;r=new f;for(var q=new f,t=new f,v=new f,u=new f,w=new f,x=0,z=b=c=d=g=k=h=0,A=e.length;z<A;z+=9){l.fromArray(e,z);m.fromArray(e,z+3);r.fromArray(e,z+6);u.set(0,0,0);u.add(l).add(m).add(r).divideScalar(3);q.subVectors(m,l);t.subVectors(r,l);var y=v.crossVectors(q,t).length()/2;w.add(v.copy(u).multiplyScalar(y));x+=y;b+=y/12*(9*u.x*u.x+l.x*l.x+m.x*m.x+r.x*r.x);c+=y/12*(9*u.x*u.y+l.x*l.y+m.x*m.y+r.x*r.y);d+=y/12*(9*u.x*u.z+l.x*l.z+m.x*m.z+r.x*r.z);g+=y/12*(9*u.y*
u.y+l.y*l.y+m.y*m.y+r.y*r.y);k+=y/12*(9*u.y*u.z+l.y*l.z+m.y*m.z+r.y*r.z);h+=y/12*(9*u.z*u.z+l.z*l.z+m.z*m.z+r.z*r.z)}w.divideScalar(x);b=b/x-w.x*w.x;c=c/x-w.x*w.y;d=d/x-w.x*w.z;g=g/x-w.y*w.y;k=k/x-w.y*w.z;h=h/x-w.z*w.z;e=new B;e.elements[0]=b;e.elements[1]=c;e.elements[2]=d;e.elements[3]=c;e.elements[4]=g;e.elements[5]=k;e.elements[6]=d;e.elements[7]=k;e.elements[8]=h;e.eigenDecomposition(Md);e=Md.unitary;b=new f;c=new f;d=new f;e.extractBasis(b,c,d);h=k=g=-Infinity;r=m=l=Infinity;q=0;for(t=a.length;q<
t;q++)v=a[q],g=Math.max(b.dot(v),g),k=Math.max(c.dot(v),k),h=Math.max(d.dot(v),h),l=Math.min(b.dot(v),l),m=Math.min(c.dot(v),m),r=Math.min(d.dot(v),r);b.multiplyScalar(.5*(l+g));c.multiplyScalar(.5*(m+k));d.multiplyScalar(.5*(r+h));this.center.add(b).add(c).add(d);this.halfSizes.x=g-l;this.halfSizes.y=k-m;this.halfSizes.z=h-r;this.halfSizes.multiplyScalar(.5);this.rotation.copy(e);return this};R.prototype.equals=function(a){return a.center.equals(this.center)&&a.halfSizes.equals(this.halfSizes)&&
a.rotation.equals(this.rotation)};R.prototype.toJSON=function(){return{type:this.constructor.name,center:this.center.toArray([]),halfSizes:this.halfSizes.toArray([]),rotation:this.rotation.toArray([])}};R.prototype.fromJSON=function(a){this.center.fromArray(a.center);this.halfSizes.fromArray(a.halfSizes);this.rotation.fromArray(a.rotation);return this};var ce=new R,gc=function(a,b,c){return pa.call(this,void 0===a?-1:a,void 0===b?-1:b,void 0===c?0:c)||this};$jscomp.inherits(gc,pa);var hc=function(a,
b,c){a=void 0===a?-1:a;b=void 0===b?new f:b;c=void 0===c?{}:c;a=kb.call(this,a)||this;a.position=b;a.userData=c;return a};$jscomp.inherits(hc,kb);var Qd=function(){};Qd.createGridLayout=function(a,b){var c=new P;c.digraph=!0;var e=a/2;a/=b;for(var d=0,g=0;g<=b;g++)for(var k=g*a-e,h=0;h<=b;h++){var l=new f(h*a-e,0,k);l=new hc(d,l);c.addNode(l);d++}b=c.getNodeCount();e=Math.pow(a+a/2,2);for(a=0;a<b;a++)for(d=c.getNode(a),g=0;g<b;g++)a!==g&&(k=c.getNode(g).position.squaredDistanceTo(d.position),k<=e&&
(k=new gc(a,g,Math.sqrt(k)),c.addEdge(k)));return c};var ic=function(){this.portalEdges=[]};ic.prototype.push=function(a,b){this.portalEdges.push({left:a,right:b});return this};ic.prototype.generate=function(){var a=this.portalEdges,b=[],c=0,e=0;var d=a[0].left;var f=a[0].left;var k=a[0].right;b.push(d);var g=1;for(var h=a.length;g<h;g++){var l=a[g].left,m=a[g].right;if(0>=I.area(d,k,m))if(d===k||0<I.area(d,f,m))k=m,e=g;else{b.push(f);d=f;g=c;k=f=d;e=c=g;continue}0<=I.area(d,f,l)&&(d===f||0>I.area(d,
k,l)?(f=l,c=g):(b.push(k),d=k,g=e,k=f=d,e=c=g))}0!==b.length&&b[b.length-1]===a[a.length-1].left||b.push(a[a.length-1].left);return b};var Fa=function(){this._nodeMap=new Map};Fa.prototype.init=function(a){var b=a.graph,c=[];this.clear();b.getNodes(c);b=0;for(var e=c.length;b<e;b++)for(var d=c[b],f=0,g=c.length;f<g;f++){for(var h=c[f],l=a.findPath(d.position,h.position),m=0,r=0,q=l.length-1;r<q;r++)m+=l[r].distanceTo(l[r+1]);this.set(d.index,h.index,m)}return this};Fa.prototype.clear=function(){this._nodeMap.clear();
return this};Fa.prototype.set=function(a,b,c){var e=this._nodeMap;!1===e.has(a)&&e.set(a,new Map);e.get(a).set(b,c);return this};Fa.prototype.get=function(a,b){return this._nodeMap.get(a).get(b)};Fa.prototype.size=function(){return this._nodeMap.size};Fa.prototype.toJSON=function(){for(var a={nodes:[]},b=$jscomp.makeIterator(this._nodeMap.entries()),c=b.next();!c.done;c=b.next()){var e=$jscomp.makeIterator(c.value);c=e.next().value;e=e.next().value;a.nodes.push({index:c,costs:Array.from(e)})}return a};
Fa.prototype.fromJSON=function(a){a=a.nodes;for(var b=0,c=a.length;b<c;b++){var e=a[b],d=e.index;e=new Map(e.costs);this._nodeMap.set(d,e)}return this};var Pc=new f,Qc=new f,Rc=new f,Fb=new f,Gb=new ea,Sc=[],Tc={edge:null,closestPoint:new f},Y=function(){this.graph=new P;this.graph.digraph=!0;this.regions=[];this.spatialIndex=null;this.epsilonCoplanarTest=.001;this.epsilonContainsTest=1;this._borderEdges=[]};Y.prototype.fromPolygons=function(a){this.clear();for(var b=[],c=[],e=0,d=a.length;e<d;e++){var f=
a[e],g=f.edge;do b.push(g),g=g.next;while(g!==f.edge);this.regions.push(f)}a=0;for(e=b.length;a<e;a++)if(d=b[a],null===d.twin)for(f=a+1,g=b.length;f<g;f++){var h=b[f];if(d.tail().equals(h.head())&&d.head().equals(h.tail())){d.linkOpponent(h);f=d.squaredLength();c.push({cost:f,edge:d});break}}c.sort(ma);this._buildRegions(c);this._buildGraph();return this};Y.prototype.clear=function(){this.graph.clear();this.regions.length=0;this.spatialIndex=null;return this};Y.prototype.getClosestRegion=function(a){for(var b=
this.regions,c=null,e=Infinity,d=0,f=b.length;d<f;d++){var g=b[d],h=a.squaredDistanceTo(g.centroid);h<e&&(e=h,c=g)}return c};Y.prototype.getRandomRegion=function(){var a=this.regions,b=Math.floor(Math.random()*a.length);b===a.length&&(b=a.length-1);return a[b]};Y.prototype.getRegionForPoint=function(a,b){b=void 0===b?.001:b;if(null!==this.spatialIndex){var c=this.spatialIndex.getIndexForPosition(a);c=this.spatialIndex.cells[c].entries}else c=this.regions;for(var e=0,d=c.length;e<d;e++){var f=c[e];
if(!0===f.contains(a,b))return f}return null};Y.prototype.getNodeIndex=function(a){return this.regions.indexOf(a)};Y.prototype.findPath=function(a,b){var c=this.graph,e=[],d=this.getRegionForPoint(a,this.epsilonContainsTest),g=this.getRegionForPoint(b,this.epsilonContainsTest);if(null===d||null===g)null===d&&(d=this.getClosestRegion(a)),null===g&&(g=this.getClosestRegion(b));if(d===g)e.push((new f).copy(a)),e.push((new f).copy(b));else if(d=this.getNodeIndex(d),g=this.getNodeIndex(g),c=new lb(c,d,
g),c.search(),!0===c.found){c=c.getPath();g=new ic;g.push(a,a);a={left:null,right:null};d=0;for(var k=c.length-1;d<k;d++)this.regions[c[d]].getPortalEdgeTo(this.regions[c[d+1]],a),g.push(a.left,a.right);g.push(b,b);e.push.apply(e,$jscomp.arrayFromIterable(g.generate()))}return e};Y.prototype.clampMovement=function(a,b,c,e){var d=this.getRegionForPoint(c,this.epsilonContainsTest);if(null===d){if(null===a)throw Error("YUKA.NavMesh.clampMovement(): No current region available.");this._getClosestBorderEdge(b,
Tc);d=Tc.edge;var f=Tc.closestPoint;d.getDirection(Qc);c=Rc.subVectors(c,b).length();var g=0;0!==c&&(Rc.divideScalar(c),g=Qc.dot(Rc));Fb.copy(f).add(Qc.multiplyScalar(g*c));Gb.set(d.prev.vertex,d.vertex);d=Gb.closestPointToPointParameter(Fb,!1);if(0<=d&&1>=d)e.copy(Fb);else{d=this.getRegionForPoint(Fb,this.epsilonContainsTest);if(null!==d)return e.copy(Fb),d;e.copy(b)}return a}return d};Y.prototype.updateSpatialIndex=function(){if(null!==this.spatialIndex){this.spatialIndex.makeEmpty();for(var a=
this.regions,b=0,c=a.length;b<c;b++)this.spatialIndex.addPolygon(a[b])}return this};Y.prototype._buildRegions=function(a){for(var b=this.regions,c,e,d,f,g=0,h=a.length;g<h;g++){var l=a[g],m=l.edge;c=m.prev;e=m.next;d=m.twin.prev;f=m.twin.next;m.prev.next=m.twin.next;m.next.prev=m.twin.prev;m.twin.prev.next=m.next;m.twin.next.prev=m.prev;var r=m.polygon;r.edge=m.prev;if(!0===r.convex()&&!0===r.coplanar(this.epsilonCoplanarTest)){c=r.edge;do c.polygon=r,c=c.next;while(c!==r.edge);l=b.indexOf(l.edge.twin.polygon);
b.splice(l,1)}else c.next=m,e.prev=m,d.next=m.twin,f.prev=m.twin,r.edge=m}a=0;for(g=b.length;a<g;a++){h=b[a];h.computeCentroid();l=h.edge;do null===l.twin&&this._borderEdges.push(l),l=l.next;while(l!==h.edge)}};Y.prototype._buildGraph=function(){for(var a=this.graph,b=this.regions,c=[],d=0,f=b.length;d<f;d++){var g=b[d],k=[];c.push(k);var h=g.edge;do{if(null!==h.twin){var l=this.getNodeIndex(h.twin.polygon);k.push(l);!1===a.hasNode(this.getNodeIndex(h.polygon))&&(l=new hc(this.getNodeIndex(h.polygon),
h.polygon.centroid),a.addNode(l))}h=h.next}while(h!==g.edge)}b=0;for(d=c.length;b<d;b++)for(f=c[b],g=b,k=0,h=f.length;k<h;k++)if(l=f[k],g!==l&&!1===a.hasEdge(g,l)){var m=a.getNode(g),r=a.getNode(l);m=m.position.distanceTo(r.position);a.addEdge(new gc(g,l,m))}return this};Y.prototype._getClosestBorderEdge=function(a,b){var c=Infinity;if(null!==this.spatialIndex){Sc.length=0;var d=this.spatialIndex.getIndexForPosition(a);d=this.spatialIndex.cells[d].entries;for(var f=0,g=d.length;f<g;f++){var k=d[f],
h=k.edge;do null===h.twin&&Sc.push(h),h=h.next;while(h!==k.edge)}d=Sc}else d=this._borderEdges;f=0;for(g=d.length;f<g;f++)k=d[f],Gb.set(k.prev.vertex,k.vertex),h=Gb.closestPointToPointParameter(a),Gb.at(h,Pc),h=Pc.squaredDistanceTo(a),h<c&&(c=h,b.edge=k,b.closestPoint.copy(Pc));return this};var Rd=function(){};Rd.prototype.load=function(a,b){return new Promise(function(c,d){fetch(a).then(function(a){if(200<=a.status&&300>a.status)return a.arrayBuffer();var b=Error(a.statusText||a.status);b.response=
a;return Promise.reject(b)}).then(function(c){var d=new qa,e=new TextDecoder;"glTF"===e.decode(new Uint8Array(c,0,4))?(d.parseBinary(c),c=d.extensions.get("BINARY").content):c=e.decode(new Uint8Array(c));c=JSON.parse(c);if(void 0===c.asset||2>c.asset.version[0])throw Error("YUKA.NavMeshLoader: Unsupported asset version.");e=a.lastIndexOf("/");e=-1===e?"./":a.substr(0,e+1);return d.parse(c,e,b)}).then(function(a){c(a)}).catch(function(a){A.error("YUKA.NavMeshLoader: Unable to load navigation mesh.",
a);d(a)})})};var qa=function(){this.path=this.json=null;this.cache=new Map;this.extensions=new Map};qa.prototype.parse=function(a,b,c){var d=this;this.json=a;this.path=b;return this.getDependency("mesh",0).then(function(a){a=d.parseGeometry(a);var b=new Y;c&&c.epsilonCoplanarTest&&(b.epsilonCoplanarTest=c.epsilonCoplanarTest);return b.fromPolygons(a)})};qa.prototype.parseGeometry=function(a){var b=a.index,c=a.position;a=[];for(var d=[],g=0,h=c.length;g<h;g+=3){var k=new f;k.x=c[g+0];k.y=c[g+1];k.z=
c[g+2];a.push(k)}if(b)for(c=0,g=b.length;c<g;c+=3)h=[a[b[c+0]],a[b[c+1]],a[b[c+2]]],h=(new O).fromContour(h),d.push(h);else for(b=0,c=a.length;b<c;b+=3)g=[a[b+0],a[b+1],a[b+2]],g=(new O).fromContour(g),d.push(g);return d};qa.prototype.getDependencies=function(a){var b=this,c=this.cache,d=c.get(a);d||(d=Promise.all((this.json[a+("mesh"===a?"es":"s")]||[]).map(function(c,d){return b.getDependency(a,d)})),c.set(a,d));return d};qa.prototype.getDependency=function(a,b){var c=this.cache,d=a+":"+b,f=c.get(d);
if(void 0===f){switch(a){case "accessor":f=this.loadAccessor(b);break;case "buffer":f=this.loadBuffer(b);break;case "bufferView":f=this.loadBufferView(b);break;case "mesh":f=this.loadMesh(b);break;default:throw Error("Unknown type: "+a);}c.set(d,f)}return f};qa.prototype.loadBuffer=function(a){var b=this,c=this.json.buffers[a];return void 0===c.uri&&0===a?Promise.resolve(this.extensions.get("BINARY").body):new Promise(function(a,d){var e=y(c.uri,b.path);fetch(e).then(function(a){return a.arrayBuffer()}).then(function(b){a(b)}).catch(function(a){A.error("YUKA.NavMeshLoader: Unable to load buffer.",
a);d(a)})})};qa.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var c=b.byteOffset||0;return a.slice(c,c+(b.byteLength||0))})};qa.prototype.loadAccessor=function(a){var b=this.json.accessors[a];return this.getDependency("bufferView",b.bufferView).then(function(a){return new de[b.componentType](a,b.byteOffset||0,b.count*ee[b.type])})};qa.prototype.loadMesh=function(a){var b=this.json.meshes[a];return this.getDependencies("accessor").then(function(a){var c=
b.primitives[0];if(4!==c.mode)throw Error("YUKA.NavMeshLoader: Invalid geometry format. Please ensure to represent your geometry as triangles.");return{index:a[c.indices],position:a[c.attributes.POSITION],normal:a[c.attributes.NORMAL]}})};qa.prototype.parseBinary=function(a){for(var b=new DataView(a,12),c=0,d=new TextDecoder,f=null,g=null;c<b.byteLength;){var h=b.getUint32(c,!0);c+=4;var l=b.getUint32(c,!0);c+=4;l===Sd.JSON?(f=new Uint8Array(a,12+c,h),f=d.decode(f)):l===Sd.BIN&&(g=12+c,g=a.slice(g,
g+h));c+=h}this.extensions.set("BINARY",{content:f,body:g})};var ee={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},de={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Sd={JSON:1313821514,BIN:5130562},ka=function(a){this.aabb=a=void 0===a?new D:a;this.entries=[]};ka.prototype.add=function(a){this.entries.push(a);return this};ka.prototype.remove=function(a){a=this.entries.indexOf(a);this.entries.splice(a,1);return this};ka.prototype.makeEmpty=
function(){this.entries.length=0;return this};ka.prototype.empty=function(){return 0===this.entries.length};ka.prototype.intersects=function(a){return this.aabb.intersectsAABB(a)};ka.prototype.toJSON=function(){for(var a={type:this.constructor.name,aabb:this.aabb.toJSON(),entries:[]},b=this.entries,c=0,d=b.length;c<d;c++)a.entries.push(b[c].uuid);return a};ka.prototype.fromJSON=function(a){this.aabb.fromJSON(a.aabb);this.entries=a.entries.slice();return this};ka.prototype.resolveReferences=function(a){for(var b=
this.entries,c=0,d=b.length;c<d;c++)b[c]=a.get(b[c]);return this};var jc=new f,Hb=new D,Td=[],la=function(a,b,c,d,g,h){this.cells=[];this.width=a;this.height=b;this.depth=c;this.cellsX=d;this.cellsY=g;this.cellsZ=h;this._halfWidth=this.width/2;this._halfHeight=this.height/2;this._halfDepth=this.depth/2;this._min=new f(-this._halfWidth,-this._halfHeight,-this._halfDepth);this._max=new f(this._halfWidth,this._halfHeight,this._halfDepth);a=this.width/this.cellsX;b=this.height/this.cellsY;c=this.depth/
this.cellsZ;for(d=0;d<this.cellsX;d++)for(g=d*a-this._halfWidth,h=0;h<this.cellsY;h++)for(var e=h*b-this._halfHeight,l=0;l<this.cellsZ;l++){var n=l*c-this._halfDepth,m=new f,p=new f;m.set(g,e,n);p.x=m.x+a;p.y=m.y+b;p.z=m.z+c;n=new D(m,p);n=new ka(n);this.cells.push(n)}};la.prototype.updateEntity=function(a,b){b=void 0===b?-1:b;var c=this.getIndexForPosition(a.position);b!==c&&(this.addEntityToPartition(a,c),-1!==b&&this.removeEntityFromPartition(a,b));return c};la.prototype.addEntityToPartition=function(a,
b){this.cells[b].add(a);return this};la.prototype.removeEntityFromPartition=function(a,b){this.cells[b].remove(a);return this};la.prototype.getIndexForPosition=function(a){jc.copy(a).clamp(this._min,this._max);a=Math.abs(Math.floor(this.cellsX*(jc.x+this._halfWidth)/this.width));var b=Math.abs(Math.floor(this.cellsY*(jc.y+this._halfHeight)/this.height)),c=Math.abs(Math.floor(this.cellsZ*(jc.z+this._halfDepth)/this.depth));a===this.cellsX&&(a=this.cellsX-1);b===this.cellsY&&(b=this.cellsY-1);c===this.cellsZ&&
(c=this.cellsZ-1);return a*this.cellsY*this.cellsZ+b*this.cellsZ+c};la.prototype.query=function(a,b,c){var d=this.cells;c.length=0;Hb.min.copy(a).subScalar(b);Hb.max.copy(a).addScalar(b);a=0;for(b=d.length;a<b;a++){var f=d[a];!1===f.empty()&&!0===f.intersects(Hb)&&c.push.apply(c,$jscomp.arrayFromIterable(f.entries))}return c};la.prototype.makeEmpty=function(){for(var a=this.cells,b=0,c=a.length;b<c;b++)a[b].makeEmpty();return this};la.prototype.addPolygon=function(a){var b=this.cells;a.getContour(Td);
Hb.fromPoints(Td);for(var c=0,d=b.length;c<d;c++){var f=b[c];!0===f.intersects(Hb)&&f.add(a)}return this};la.prototype.toJSON=function(){for(var a={type:this.constructor.name,cells:[],width:this.width,height:this.height,depth:this.depth,cellsX:this.cellsX,cellsY:this.cellsY,cellsZ:this.cellsZ,_halfWidth:this._halfWidth,_halfHeight:this._halfHeight,_halfDepth:this._halfDepth,_min:this._min.toArray([]),_max:this._max.toArray([])},b=0,c=this.cells.length;b<c;b++)a.cells.push(this.cells[b].toJSON());
return a};la.prototype.fromJSON=function(a){this.cells.length=0;this.width=a.width;this.height=a.height;this.depth=a.depth;this.cellsX=a.cellsX;this.cellsY=a.cellsY;this.cellsZ=a.cellsZ;this._halfWidth=a._halfWidth;this._halfDepth=this._halfHeight=a._halfHeight;this._min.fromArray(a._min);this._max.fromArray(a._max);for(var b=0,c=a.cells.length;b<c;b++)this.cells.push((new ka).fromJSON(a.cells[b]));return this};la.prototype.resolveReferences=function(a){for(var b=0,c=this.cells.length;b<c;b++)this.cells[b].resolveReferences(a)};
var mb=function(a){this.entity=void 0===a?null:a;this.timeLastSensed=this.timeBecameVisible=-Infinity;this.lastSensedPosition=new f;this.visible=!1};mb.prototype.toJSON=function(){return{type:this.constructor.name,entity:this.entity.uuid,timeBecameVisible:this.timeBecameVisible.toString(),timeLastSensed:this.timeLastSensed.toString(),lastSensedPosition:this.lastSensedPosition.toArray([]),visible:this.visible}};mb.prototype.fromJSON=function(a){this.entity=a.entity;this.timeBecameVisible=parseFloat(a.timeBecameVisible);
this.timeLastSensed=parseFloat(a.timeLastSensed);this.lastSensedPosition.fromArray(a.lastSensedPosition);this.visible=a.visible;return this};mb.prototype.resolveReferences=function(a){this.entity=a.get(this.entity)||null;return this};var ra=function(a){this.owner=void 0===a?null:a;this.records=[];this.recordsMap=new Map;this.memorySpan=1};ra.prototype.getRecord=function(a){return this.recordsMap.get(a)};ra.prototype.createRecord=function(a){var b=new mb(a);this.records.push(b);this.recordsMap.set(a,
b);return this};ra.prototype.deleteRecord=function(a){var b=this.getRecord(a);b=this.records.indexOf(b);this.records.splice(b,1);this.recordsMap.delete(a);return this};ra.prototype.hasRecord=function(a){return this.recordsMap.has(a)};ra.prototype.clear=function(){this.records.length=0;this.recordsMap.clear();return this};ra.prototype.getValidMemoryRecords=function(a,b){for(var c=this.records,d=b.length=0,f=c.length;d<f;d++){var g=c[d];a-g.timeLastSensed<=this.memorySpan&&b.push(g)}return b};ra.prototype.toJSON=
function(){for(var a={type:this.constructor.name,owner:this.owner.uuid,records:[],memorySpan:this.memorySpan},b=this.records,c=0,d=b.length;c<d;c++)a.records.push(b[c].toJSON());return a};ra.prototype.fromJSON=function(a){this.owner=a.owner;this.memorySpan=a.memorySpan;a=a.records;for(var b=0,c=a.length;b<c;b++){var d=a[b];d=(new mb).fromJSON(d);this.records.push(d)}return this};ra.prototype.resolveReferences=function(a){this.owner=a.get(this.owner)||null;for(var b=this.records,c=0,d=b.length;c<d;c++){var f=
b[c];f.resolveReferences(a);this.recordsMap.set(f.entity,f)}return this};var kc=new f,Ud=new f,Uc=new K,Vd=new f,lc=new f,Ta=function(a){this.owner=void 0===a?null:a;this.fieldOfView=Math.PI;this.range=Infinity;this.obstacles=[]};Ta.prototype.addObstacle=function(a){this.obstacles.push(a);return this};Ta.prototype.removeObstacle=function(a){a=this.obstacles.indexOf(a);this.obstacles.splice(a,1);return this};Ta.prototype.visible=function(a){var b=this.owner,c=this.obstacles;b.getWorldPosition(lc);
kc.subVectors(a,lc);a=kc.length();if(a>this.range)return!1;b.getWorldDirection(Ud);if(Ud.angleTo(kc)>.5*this.fieldOfView)return!1;Uc.origin.copy(lc);Uc.direction.copy(kc).divideScalar(a||1);b=0;for(var d=c.length;b<d;b++)if(null!==c[b].lineOfSightTest(Uc,Vd)&&Vd.squaredDistanceTo(lc)<=a*a)return!1;return!0};Ta.prototype.toJSON=function(){for(var a={type:this.constructor.name,owner:this.owner.uuid,fieldOfView:this.fieldOfView,range:this.range.toString(),obstacles:[]},b=0,c=this.obstacles.length;b<
c;b++)a.obstacles.push(this.obstacles[b].uuid);return a};Ta.prototype.fromJSON=function(a){this.owner=a.owner;this.fieldOfView=a.fieldOfView;this.range=parseFloat(a.range);for(var b=0,c=a.obstacles.length;b<c;b++)this.obstacles.push(a.obstacles[b]);return this};Ta.prototype.resolveReferences=function(a){this.owner=a.get(this.owner)||null;for(var b=this.obstacles,c=0,d=b.length;c<d;c++)b[c]=a.get(b[c]);return this};var Wd=new f,Vc=new f,Wc=new f,Xc=new ea,Xd=new f,Ib=function(a,b,c){a=void 0===a?new oa:
a;b=void 0===b?.1:b;c=void 0===c?1:c;var d=t.call(this)||this;d.path=a;d.radius=b;d.predictionFactor=c;d._seek=new na;return d};$jscomp.inherits(Ib,t);Ib.prototype.calculate=function(a,b){var c=this.path;Wd.copy(a.velocity).multiplyScalar(this.predictionFactor);Vc.addVectors(a.position,Wd);var d=Infinity,f=c._waypoints.length;f=!0===c.loop?f:f-1;for(var g=0;g<f;g++){Xc.from=c._waypoints[g];Xc.to=!0===c.loop&&g===f-1?c._waypoints[0]:c._waypoints[g+1];Xc.closestPointToPoint(Vc,!0,Wc);var h=Vc.squaredDistanceTo(Wc);
h<d&&(d=h,Xd.copy(Wc))}d>this.radius*this.radius&&1<c._waypoints.length&&(this._seek.target=Xd,this._seek.calculate(a,b));return b};Ib.prototype.toJSON=function(){var a=t.prototype.toJSON.call(this);a.path=this.path.toJSON();a.radius=this.radius;a.predictionFactor=this.predictionFactor;return a};Ib.prototype.fromJSON=function(a){t.prototype.fromJSON.call(this,a);this.path.fromJSON(a.path);this.radius=a.radius;this.predictionFactor=a.predictionFactor;return this};var Yd=function(){};Yd.prototype.execute=
function(){};var Yc=function(){this.tasks=[];this.options={timeout:1E3};this._active=!1;this._handler=nb.bind(this);this._taskHandle=0};Yc.prototype.enqueue=function(a){this.tasks.push(a);return this};Yc.prototype.update=function(){0<this.tasks.length?!1===this._active&&(this._taskHandle=requestIdleCallback(this._handler,this.options),this._active=!0):this._active=!1;return this};d.AABB=D;d.AStar=lb;d.AlignmentBehavior=Ob;d.ArriveBehavior=ta;d.BFS=Bb;d.BoundingSphere=M;d.CHFace=ha;d.CHVertex=Ld;d.CHVertexList=
fa;d.Cell=ka;d.CellSpacePartitioning=la;d.CohesionBehavior=Qb;d.CompositeGoal=T;d.ConvexHull=L;d.Corridor=ic;d.CostTable=Fa;d.DFS=Cb;d.Dijkstra=Db;d.Edge=pa;d.EntityManager=U;d.EvadeBehavior=Ia;d.EventDispatcher=wb;d.FleeBehavior=Ha;d.FollowPathBehavior=Wa;d.FuzzyAND=ac;d.FuzzyCompositeTerm=S;d.FuzzyFAIRLY=cb;d.FuzzyModule=X;d.FuzzyOR=bc;d.FuzzyRule=jb;d.FuzzySet=w;d.FuzzyTerm=wa;d.FuzzyVERY=db;d.FuzzyVariable=xa;d.GameEntity=E;d.Goal=z;d.GoalEvaluator=Ab;d.Graph=P;d.GraphUtils=Qd;d.HalfEdge=Da;d.HeuristicPolicyDijkstra=
Ed;d.HeuristicPolicyEuclid=Kc;d.HeuristicPolicyEuclidSquared=Cd;d.HeuristicPolicyManhattan=Dd;d.InterposeBehavior=Ja;d.LeftSCurveFuzzySet=yb;d.LeftShoulderFuzzySet=eb;d.LineSegment=ea;d.Logger=A;d.MathUtils=I;d.Matrix3=B;d.Matrix4=x;d.MemoryRecord=mb;d.MemorySystem=ra;d.MeshGeometry=xb;d.MessageDispatcher=sa;d.MovingEntity=Z;d.NavEdge=gc;d.NavMesh=Y;d.NavMeshLoader=Rd;d.NavNode=hc;d.Node=kb;d.NormalDistFuzzySet=fb;d.OBB=R;d.ObstacleAvoidanceBehavior=Ka;d.OffsetPursuitBehavior=La;d.OnPathBehavior=
Ib;d.Path=oa;d.Plane=V;d.Polygon=O;d.Polyhedron=Ea;d.PriorityQueue=Ba;d.PursuitBehavior=Ma;d.Quaternion=C;d.Ray=K;d.RectangularTriggerRegion=za;d.Regulator=Bd;d.RightSCurveFuzzySet=zb;d.RightShoulderFuzzySet=gb;d.SAT=Ca;d.SeekBehavior=na;d.SeparationBehavior=Xb;d.SingletonFuzzySet=hb;d.Smoother=ub;d.SphericalTriggerRegion=Oa;d.State=va;d.StateMachine=W;d.SteeringBehavior=t;d.SteeringManager=aa;d.Task=Yd;d.TaskQueue=Yc;d.Telegram=Ua;d.Think=ja;d.Time=bb;d.TriangularFuzzySet=ib;d.Trigger=Aa;d.TriggerRegion=
da;d.Vector3=f;d.Vehicle=Na;d.Vision=Ta;d.WanderBehavior=Ya;d.WorldUp=mc;Object.defineProperty(d,"__esModule",{value:!0})});
