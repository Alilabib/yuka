var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,e,l){c!=Array.prototype&&c!=Object.prototype&&(c[e]=l.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var c=0;return function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+c++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var e=0;return $jscomp.iteratorPrototype(function(){return e<c.length?{done:!1,value:c[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=c[Symbol.iterator];return e?e.call(c):$jscomp.arrayIterator(c)};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(c){var e=function(){};e.prototype=c;return new e};
$jscomp.underscoreProtoCanBeSet=function(){var c={a:!0},e={};try{return e.__proto__=c,e.a}catch(l){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(c,e){c.__proto__=e;if(c.__proto__!==e)throw new TypeError(c+" is not extensible");return c}:null;
$jscomp.inherits=function(c,e){c.prototype=$jscomp.objectCreate(e.prototype);c.prototype.constructor=c;if($jscomp.setPrototypeOf){var l=$jscomp.setPrototypeOf;l(c,e)}else for(l in e)if("prototype"!=l)if(Object.defineProperties){var p=Object.getOwnPropertyDescriptor(e,l);p&&Object.defineProperty(c,l,p)}else c[l]=e[l];c.superClass_=e.prototype};$jscomp.arrayFromIterator=function(c){for(var e,l=[];!(e=c.next()).done;)l.push(e.value);return l};
$jscomp.arrayFromIterable=function(c){return c instanceof Array?c:$jscomp.arrayFromIterator($jscomp.makeIterator(c))};$jscomp.checkEs6ConformanceViaProxy=function(){try{var c={},e=Object.create(new $jscomp.global.Proxy(c,{get:function(l,p,g){return l==c&&"q"==p&&g==e}}));return!0===e.q}catch(l){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.owns=function(c,e){return Object.prototype.hasOwnProperty.call(c,e)};$jscomp.polyfill=function(c,e,l,p){if(e){l=$jscomp.global;c=c.split(".");for(p=0;p<c.length-1;p++){var g=c[p];g in l||(l[g]={});l=l[g]}c=c[c.length-1];p=l[c];e=e(p);e!=p&&null!=e&&$jscomp.defineProperty(l,c,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("WeakMap",function(c){function e(){if(!c||!Object.seal)return!1;try{var v=Object.seal({}),h=Object.seal({}),k=new c([[v,2],[h,3]]);if(2!=k.get(v)||3!=k.get(h))return!1;k.delete(v);k.set(h,4);return!k.has(v)&&4==k.get(h)}catch(C){return!1}}function l(c){$jscomp.owns(c,g)||$jscomp.defineProperty(c,g,{value:{}})}function p(c){var h=Object[c];h&&(Object[c]=function(c){l(c);return h(c)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(c&&$jscomp.ES6_CONFORMANCE)return c}else if(e())return c;
var g="$jscomp_hidden_"+Math.random();p("freeze");p("preventExtensions");p("seal");var G=0,k=function(c){this.id_=(G+=Math.random()+1).toString();if(c){$jscomp.initSymbol();$jscomp.initSymbolIterator();c=$jscomp.makeIterator(c);for(var h;!(h=c.next()).done;)h=h.value,this.set(h[0],h[1])}};k.prototype.set=function(c,h){l(c);if(!$jscomp.owns(c,g))throw Error("WeakMap key fail: "+c);c[g][this.id_]=h;return this};k.prototype.get=function(c){return $jscomp.owns(c,g)?c[g][this.id_]:void 0};k.prototype.has=
function(c){return $jscomp.owns(c,g)&&$jscomp.owns(c[g],this.id_)};k.prototype.delete=function(c){return $jscomp.owns(c,g)&&$jscomp.owns(c[g],this.id_)?delete c[g][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(c){function e(){if($jscomp.ASSUME_NO_NATIVE_MAP||!c||"function"!=typeof c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var h=Object.seal({x:4}),k=new c($jscomp.makeIterator([[h,"s"]]));if("s"!=k.get(h)||1!=k.size||k.get({x:4})||k.set({x:4},"t")!=k||2!=k.size)return!1;var e=k.entries(),g=e.next();if(g.done||g.value[0]!=h||"s"!=g.value[1])return!1;g=e.next();return g.done||4!=g.value[0].x||"t"!=g.value[1]||!e.next().done?!1:!0}catch(f){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(c&&$jscomp.ES6_CONFORMANCE)return c}else if(e())return c;$jscomp.initSymbol();$jscomp.initSymbolIterator();var l=new WeakMap,p=function(c){this.data_={};this.head_=k();this.size=0;if(c){c=$jscomp.makeIterator(c);for(var h;!(h=c.next()).done;)h=h.value,this.set(h[0],h[1])}};p.prototype.set=function(c,k){c=0===c?0:c;var h=g(this,c);h.list||(h.list=this.data_[h.id]=[]);h.entry?h.entry.value=k:(h.entry={next:this.head_,previous:this.head_.previous,head:this.head_,
key:c,value:k},h.list.push(h.entry),this.head_.previous.next=h.entry,this.head_.previous=h.entry,this.size++);return this};p.prototype.delete=function(c){c=g(this,c);return c.entry&&c.list?(c.list.splice(c.index,1),c.list.length||delete this.data_[c.id],c.entry.previous.next=c.entry.next,c.entry.next.previous=c.entry.previous,c.entry.head=null,this.size--,!0):!1};p.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=k();this.size=0};p.prototype.has=function(c){return!!g(this,c).entry};
p.prototype.get=function(c){return(c=g(this,c).entry)&&c.value};p.prototype.entries=function(){return G(this,function(c){return[c.key,c.value]})};p.prototype.keys=function(){return G(this,function(c){return c.key})};p.prototype.values=function(){return G(this,function(c){return c.value})};p.prototype.forEach=function(c,k){for(var h=this.entries(),e;!(e=h.next()).done;)e=e.value,c.call(k,e[1],e[0],this)};p.prototype[Symbol.iterator]=p.prototype.entries;var g=function(c,k){var e=k&&typeof k;"object"==
e||"function"==e?l.has(k)?e=l.get(k):(e=""+ ++v,l.set(k,e)):e="p_"+k;var h=c.data_[e];if(h&&$jscomp.owns(c.data_,e))for(c=0;c<h.length;c++){var f=h[c];if(k!==k&&f.key!==f.key||k===f.key)return{id:e,list:h,index:c,entry:f}}return{id:e,list:h,index:-1,entry:void 0}},G=function(c,k){var e=c.head_;return $jscomp.iteratorPrototype(function(){if(e){for(;e.head!=c.head_;)e=e.previous;for(;e.next!=e.head;)return e=e.next,{done:!1,value:k(e)};e=null}return{done:!0,value:void 0}})},k=function(){var c={};return c.previous=
c.next=c.head=c},v=0;return p},"es6","es3");
$jscomp.polyfill("Set",function(c){function e(){if($jscomp.ASSUME_NO_NATIVE_SET||!c||"function"!=typeof c||!c.prototype.entries||"function"!=typeof Object.seal)return!1;try{var e=Object.seal({x:4}),g=new c($jscomp.makeIterator([e]));if(!g.has(e)||1!=g.size||g.add(e)!=g||1!=g.size||g.add({x:4})!=g||2!=g.size)return!1;var l=g.entries(),k=l.next();if(k.done||k.value[0]!=e||k.value[1]!=e)return!1;k=l.next();return k.done||k.value[0]==e||4!=k.value[0].x||k.value[1]!=k.value[0]?!1:l.next().done}catch(v){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(c&&$jscomp.ES6_CONFORMANCE)return c}else if(e())return c;$jscomp.initSymbol();$jscomp.initSymbolIterator();var l=function(c){this.map_=new Map;if(c){c=$jscomp.makeIterator(c);for(var e;!(e=c.next()).done;)this.add(e.value)}this.size=this.map_.size};l.prototype.add=function(c){c=0===c?0:c;this.map_.set(c,c);this.size=this.map_.size;return this};l.prototype.delete=function(c){c=this.map_.delete(c);this.size=this.map_.size;return c};l.prototype.clear=
function(){this.map_.clear();this.size=0};l.prototype.has=function(c){return this.map_.has(c)};l.prototype.entries=function(){return this.map_.entries()};l.prototype.values=function(){return this.map_.values()};l.prototype.keys=l.prototype.values;l.prototype[Symbol.iterator]=l.prototype.values;l.prototype.forEach=function(c,e){var g=this;this.map_.forEach(function(k){return c.call(e,k,k,g)})};return l},"es6","es3");
$jscomp.iteratorFromArray=function(c,e){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var l=0,p={next:function(){if(l<c.length){var g=l++;return{value:e(g,c[g]),done:!1}}p.next=function(){return{done:!0,value:void 0}};return p.next()}};p[Symbol.iterator]=function(){return p};return p};$jscomp.polyfill("Array.prototype.values",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,l){return l})}},"es8","es3");
$jscomp.polyfill("Number.EPSILON",function(c){return Math.pow(2,-52)},"es6","es3");$jscomp.polyfill("Array.prototype.entries",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(c,l){return[c,l]})}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(c){function e(){this.batch_=null}function l(c){return c instanceof g?c:new g(function(e,k){e(c)})}if(c&&!$jscomp.FORCE_POLYFILL_PROMISE)return c;e.prototype.asyncExecute=function(c){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(c);return this};e.prototype.asyncExecuteBatch_=function(){var c=this;this.asyncExecuteFunction(function(){c.executeBatch_()})};var p=$jscomp.global.setTimeout;e.prototype.asyncExecuteFunction=function(c){p(c,
0)};e.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var c=this.batch_;this.batch_=[];for(var e=0;e<c.length;++e){var h=c[e];c[e]=null;try{h()}catch(F){this.asyncThrow_(F)}}}this.batch_=null};e.prototype.asyncThrow_=function(c){this.asyncExecuteFunction(function(){throw c;})};var g=function(c){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var e=this.createResolveAndReject_();try{c(e.resolve,e.reject)}catch(h){e.reject(h)}};g.prototype.createResolveAndReject_=
function(){function c(c){return function(k){h||(h=!0,c.call(e,k))}}var e=this,h=!1;return{resolve:c(this.resolveTo_),reject:c(this.reject_)}};g.prototype.resolveTo_=function(c){if(c===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(c instanceof g)this.settleSameAsPromise_(c);else{a:switch(typeof c){case "object":var e=null!=c;break a;case "function":e=!0;break a;default:e=!1}e?this.resolveToNonPromiseObj_(c):this.fulfill_(c)}};g.prototype.resolveToNonPromiseObj_=function(c){var e=
void 0;try{e=c.then}catch(h){this.reject_(h);return}"function"==typeof e?this.settleSameAsThenable_(e,c):this.fulfill_(c)};g.prototype.reject_=function(c){this.settle_(2,c)};g.prototype.fulfill_=function(c){this.settle_(1,c)};g.prototype.settle_=function(c,e){if(0!=this.state_)throw Error("Cannot settle("+c+", "+e+"): Promise already settled in state"+this.state_);this.state_=c;this.result_=e;this.executeOnSettledCallbacks_()};g.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var c=
0;c<this.onSettledCallbacks_.length;++c)G.asyncExecute(this.onSettledCallbacks_[c]);this.onSettledCallbacks_=null}};var G=new e;g.prototype.settleSameAsPromise_=function(c){var e=this.createResolveAndReject_();c.callWhenSettled_(e.resolve,e.reject)};g.prototype.settleSameAsThenable_=function(c,e){var h=this.createResolveAndReject_();try{c.call(e,h.resolve,h.reject)}catch(F){h.reject(F)}};g.prototype.then=function(c,e){function h(c,e){return"function"==typeof c?function(e){try{k(c(e))}catch(S){l(S)}}:
e}var k,l,p=new g(function(c,e){k=c;l=e});this.callWhenSettled_(h(c,k),h(e,l));return p};g.prototype.catch=function(c){return this.then(void 0,c)};g.prototype.callWhenSettled_=function(c,e){function h(){switch(g.state_){case 1:c(g.result_);break;case 2:e(g.result_);break;default:throw Error("Unexpected state: "+g.state_);}}var g=this;null==this.onSettledCallbacks_?G.asyncExecute(h):this.onSettledCallbacks_.push(h)};g.resolve=l;g.reject=function(c){return new g(function(e,g){g(c)})};g.race=function(c){return new g(function(e,
g){for(var h=$jscomp.makeIterator(c),k=h.next();!k.done;k=h.next())l(k.value).callWhenSettled_(e,g)})};g.all=function(c){var e=$jscomp.makeIterator(c),h=e.next();return h.done?l([]):new g(function(c,g){function k(e){return function(g){f[e]=g;p--;0==p&&c(f)}}var f=[],p=0;do f.push(void 0),p++,l(h.value).callWhenSettled_(k(f.length-1),g),h=e.next();while(!h.done)})};return g},"es6","es3");
$jscomp.polyfill("Math.sign",function(c){return c?c:function(c){c=Number(c);return 0===c||isNaN(c)?c:0<c?1:-1}},"es6","es3");
(function(c,e){"object"===typeof exports&&"undefined"!==typeof module?e(exports):"function"===typeof define&&define.amd?define(["exports"],e):e(c.YUKA={})})(this,function(c){function e(a,b){return a<b?-1:a>b?1:0}function l(a,b){return a.cost<b.cost?-1:a.cost>b.cost?1:0}function p(a,b){return a.cost<b.cost?1:a.cost>b.cost?-1:0}function g(a,b){return"string"!==typeof a||""===a?"":/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:b+a}function G(a,b){return a.cost<b.cost?-1:
a.cost>b.cost?1:0}var k=function(a,b,d,n,c){this.sender=a;this.receiver=b;this.message=d;this.delay=n;this.data=c},v=function(){};v.setLevel=function(a){h=a};v.log=function(a){for(var b=[],d=0;d<arguments.length;++d)b[d-0]=arguments[d];h<=v.LEVEL.LOG&&console.log.apply(console,$jscomp.arrayFromIterable(b))};v.warn=function(a){for(var b=[],d=0;d<arguments.length;++d)b[d-0]=arguments[d];h<=v.LEVEL.WARN&&console.warn.apply(console,$jscomp.arrayFromIterable(b))};v.error=function(a){for(var b=[],d=0;d<
arguments.length;++d)b[d-0]=arguments[d];h<=v.LEVEL.ERROR&&console.error.apply(console,$jscomp.arrayFromIterable(b))};v.LEVEL=Object.freeze({LOG:0,WARN:1,ERROR:2,SILENT:3});var h=v.LEVEL.WARN,F=function(){this.delayedTelegrams=[]};F.prototype.deliver=function(a){var b=a.receiver;!1===b.handleMessage(a)&&v.warn("YUKA.MessageDispatcher: Message not handled by receiver: %o",b)};F.prototype.dispatch=function(a,b,d,n,c){a=new k(a,b,d,n,c);0>=n?this.deliver(a):this.delayedTelegrams.push(a)};F.prototype.dispatchDelayedMessages=
function(a){for(var b=this.delayedTelegrams.length;b--;){var d=this.delayedTelegrams[b];d.delay-=a;0>=d.delay&&(this.deliver(d),this.delayedTelegrams.pop())}};F.prototype.clear=function(){this.delayedTelegrams.length=0};var C=function(){this.entities=new Map;this.triggers=new Set;this._started=new Set;this.messageDispatcher=new F};C.prototype.add=function(a){this.entities.set(a.id,a);a.manager=this;return this};C.prototype.remove=function(a){this.entities.delete(a.id);this._started.delete(a);a.manager=
null;return this};C.prototype.addTrigger=function(a){this.triggers.add(a);return this};C.prototype.removeTrigger=function(a){this.triggers.delete(a);return this};C.prototype.clear=function(){this.entities.clear();this.triggers.clear();this._started.clear();this.messageDispatcher.clear()};C.prototype.getEntityById=function(a){return this.entities.get(a)||null};C.prototype.getEntityByName=function(a){for(var b=$jscomp.makeIterator(this.entities.values()),d=b.next();!d.done;d=b.next())if(d=d.value,d.name===
a)return d;return null};C.prototype.update=function(a){for(var b=$jscomp.makeIterator(this.entities.values()),d=b.next();!d.done;d=b.next())d=d.value,!0===d.active&&(!1===this._started.has(d)&&(d.start(),this._started.add(d)),d.update(a),d.updateMatrix());b=$jscomp.makeIterator(this.triggers.values());for(d=b.next();!d.done;d=b.next()){var n=d.value;if(!0===n.active){n.update(a);var c=$jscomp.makeIterator(this.entities.values());for(d=c.next();!d.done;d=c.next())d=d.value,!0===d.active&&n.check(d)}}this.messageDispatcher.dispatchDelayedMessages(a)};
C.prototype.sendMessage=function(a,b,d,n,c){this.messageDispatcher.dispatch(a,b,d,n,c)};var Y={clamp:function(a,b,d){return Math.max(b,Math.min(d,a))},randFloat:function(a,b){return a+Math.random()*(b-a)}},f=function(a,b,d){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===d?0:d};f.prototype.set=function(a,b,d){this.x=a;this.y=b;this.z=d;return this};f.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};f.prototype.clone=function(){return(new this.constructor).copy(this)};
f.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};f.prototype.addScalar=function(a){this.x+=a;this.y+=a;this.z+=a;return this};f.prototype.addVectors=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this};f.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};f.prototype.subScalar=function(a){this.x-=a;this.y-=a;this.z-=a;return this};f.prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this};f.prototype.multiply=
function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this};f.prototype.multiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};f.prototype.multiplyVectors=function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this};f.prototype.divide=function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this};f.prototype.divideScalar=function(a){this.x/=a;this.y/=a;this.z/=a;return this};f.prototype.divideVectors=function(a,b){this.x=a.x/b.x;this.y=a.y/b.y;this.z=a.z/b.z;return this};
f.prototype.clamp=function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this};f.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};f.prototype.cross=function(a){var b=this.x,d=this.y,n=this.z;this.x=d*a.z-n*a.y;this.y=n*a.x-b*a.z;this.z=b*a.y-d*a.x;return this};f.prototype.crossVectors=function(a,b){var d=a.x,n=a.y;a=a.z;var c=b.x,q=b.y;b=b.z;this.x=n*b-a*q;this.y=a*c-d*b;this.z=d*q-n*c;return this};
f.prototype.angleTo=function(a){a=this.dot(a)/Math.sqrt(this.squaredLength()*a.squaredLength());return Math.acos(Y.clamp(a,-1,1))};f.prototype.length=function(){return Math.sqrt(this.squaredLength())};f.prototype.squaredLength=function(){return this.dot(this)};f.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)};f.prototype.distanceTo=function(a){return Math.sqrt(this.squaredDistanceTo(a))};f.prototype.squaredDistanceTo=function(a){var b=this.x-a.x,d=this.y-
a.y;a=this.z-a.z;return b*b+d*d+a*a};f.prototype.manhattanDistanceTo=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)};f.prototype.normalize=function(){return this.divideScalar(this.length()||1)};f.prototype.applyMatrix4=function(a){var b=this.x,d=this.y,n=this.z;a=a.elements;var c=1/(a[3]*b+a[7]*d+a[11]*n+a[15]);this.x=(a[0]*b+a[4]*d+a[8]*n+a[12])*c;this.y=(a[1]*b+a[5]*d+a[9]*n+a[13])*c;this.z=(a[2]*b+a[6]*d+a[10]*n+a[14])*c;return this};f.prototype.applyRotation=
function(a){var b=this.x,d=this.y,n=this.z,c=a.x,q=a.y,L=a.z;a=a.w;var e=a*b+q*n-L*d,f=a*d+L*b-c*n,g=a*n+c*d-q*b;b=-c*b-q*d-L*n;this.x=e*a+b*-c+f*-L-g*-q;this.y=f*a+b*-q+g*-c-e*-L;this.z=g*a+b*-L+e*-q-f*-c;return this};f.prototype.fromMatrix3Column=function(a,b){return this.fromArray(a.elements,3*b)};f.prototype.fromMatrix4Column=function(a,b){return this.fromArray(a.elements,4*b)};f.prototype.fromSpherical=function(a,b,d){var n=Math.sin(b)*a;this.x=n*Math.sin(d);this.y=Math.cos(b)*a;this.z=n*Math.cos(d);
return this};f.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];return this};f.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a};f.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z};var Da=new f(0,1,0),$a=new f,S=new f,ab=new f,bb=new f,x=function(){this.elements=[1,0,0,0,1,0,0,0,1]};x.prototype.set=function(a,b,d,n,c,q,L,e,f){var m=this.elements;m[0]=a;m[3]=b;m[6]=d;m[1]=n;m[4]=
c;m[7]=q;m[2]=L;m[5]=e;m[8]=f;return this};x.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this};x.prototype.clone=function(){return(new this.constructor).copy(this)};x.prototype.identity=function(){this.set(1,0,0,0,1,0,0,0,1);return this};x.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};x.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};x.prototype.multiplyMatrices=
function(a,b){var d=a.elements,n=b.elements;b=this.elements;a=d[0];var c=d[3],q=d[6],L=d[1],e=d[4],f=d[7],g=d[2],h=d[5];d=d[8];var k=n[0],l=n[3],p=n[6],Ea=n[1],w=n[4],N=n[7],v=n[2],r=n[5];n=n[8];b[0]=a*k+c*Ea+q*v;b[3]=a*l+c*w+q*r;b[6]=a*p+c*N+q*n;b[1]=L*k+e*Ea+f*v;b[4]=L*l+e*w+f*r;b[7]=L*p+e*N+f*n;b[2]=g*k+h*Ea+d*v;b[5]=g*l+h*w+d*r;b[8]=g*p+h*N+d*n;return this};x.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this};
x.prototype.extractBasis=function(a,b,d){a.fromMatrix3Column(this,0);b.fromMatrix3Column(this,1);d.fromMatrix3Column(this,2);return this};x.prototype.makeBasis=function(a,b,d){this.set(a.x,b.x,d.x,a.y,b.y,d.y,a.z,b.z,d.z);return this};x.prototype.lookAt=function(a,b,d){$a.crossVectors(d,a).normalize();S.crossVectors(Da,b).normalize();0===S.squaredLength()&&(bb.copy(b).addScalar(Number.EPSILON),S.crossVectors(Da,bb).normalize());ab.crossVectors(b,S).normalize();cb.makeBasis(S,ab,b);db.makeBasis($a,
d,a);this.multiplyMatrices(cb,db.transpose())};x.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this};x.prototype.fromQuaternion=function(a){var b=this.elements,d=a.x,n=a.y,c=a.z,q=a.w,e=d+d,f=n+n,g=c+c;a=d*e;var h=d*f;d*=g;var k=n*f;n*=g;c*=g;e*=q;f*=q;q*=g;b[0]=1-(k+c);b[3]=h-q;b[6]=d+f;b[1]=h+q;b[4]=1-(a+c);b[7]=n-e;b[2]=d-f;b[5]=n+e;b[8]=1-(a+k);return this};x.prototype.fromArray=function(a,b){b=void 0===b?
0:b;for(var d=this.elements,n=0;9>n;n++)d[n]=a[n+b];return this};x.prototype.toArray=function(a,b){b=void 0===b?0:b;var d=this.elements;a[b+0]=d[0];a[b+1]=d[1];a[b+2]=d[2];a[b+3]=d[3];a[b+4]=d[4];a[b+5]=d[5];a[b+6]=d[6];a[b+7]=d[7];a[b+8]=d[8];return a};x.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var d=0;9>d;d++)if(b[d]!==a[d])return!1;return!0};var cb=new x,db=new x,eb=new x,t=function(a,b,d,n){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===d?0:d;this.w=void 0===
n?1:n};t.prototype.set=function(a,b,d,n){this.x=a;this.y=b;this.z=d;this.w=n;return this};t.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};t.prototype.clone=function(){return(new this.constructor).copy(this)};t.prototype.inverse=function(){return this.conjugate().normalize()};t.prototype.conjugate=function(){this.x*=-1;this.y*=-1;this.z*=-1;return this};t.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w};t.prototype.length=function(){return Math.sqrt(this.squaredLength())};
t.prototype.squaredLength=function(){return this.dot(this)};t.prototype.normalize=function(){var a=this.length();0===a?(this.z=this.y=this.x=0,this.w=1):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this};t.prototype.multiply=function(a){return this.multiplyQuaternions(this,a)};t.prototype.premultiply=function(a){return this.multiplyQuaternions(a,this)};t.prototype.multiplyQuaternions=function(a,b){var d=a.x,n=a.y,c=a.z;a=a.w;var q=b.x,e=b.y,f=b.z;b=b.w;this.x=d*b+a*q+n*f-c*e;this.y=n*b+
a*e+c*q-d*f;this.z=c*b+a*f+d*e-n*q;this.w=a*b-d*q-n*e-c*f;return this};t.prototype.angleTo=function(a){return 2*Math.acos(Math.abs(Y.clamp(this.dot(a),-1,1)))};t.prototype.rotateTo=function(a,b){var d=this.angleTo(a);if(0===d)return this;this.slerp(a,Math.min(1,b/d));return this};t.prototype.lookAt=function(a,b,d){eb.lookAt(a,b,d);this.fromMatrix3(eb)};t.prototype.slerp=function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var d=this.x,n=this.y,c=this.z,q=this.w,e=q*a.w+d*a.x+n*a.y+c*a.z;
0>e?(this.w=-a.w,this.x=-a.x,this.y=-a.y,this.z=-a.z,e=-e):this.copy(a);if(1<=e)return this.w=q,this.x=d,this.y=n,this.z=c,this;a=Math.sqrt(1-e*e);if(.001>Math.abs(a))return this.w=.5*(q+this.w),this.x=.5*(d+this.x),this.y=.5*(n+this.y),this.z=.5*(c+this.z),this;var f=Math.atan2(a,e);e=Math.sin((1-b)*f)/a;b=Math.sin(b*f)/a;this.w=q*e+this.w*b;this.x=d*e+this.x*b;this.y=n*e+this.y*b;this.z=c*e+this.z*b;return this};t.prototype.fromEuler=function(a,b,d){var n=Math.cos(a/2),c=Math.cos(b/2),q=Math.cos(d/
2);a=Math.sin(a/2);b=Math.sin(b/2);d=Math.sin(d/2);this.x=a*c*q+n*b*d;this.y=n*b*q-a*c*d;this.z=n*c*d+a*b*q;this.w=n*c*q-a*b*d;return this};t.prototype.fromMatrix3=function(a){var b=a.elements,d=b[0];a=b[3];var n=b[6],c=b[1],q=b[4],e=b[7],f=b[2],g=b[5];b=b[8];var h=d+q+b;0<h?(d=.5/Math.sqrt(h+1),this.w=.25/d,this.x=(g-e)*d,this.y=(n-f)*d,this.z=(c-a)*d):d>q&&d>b?(d=2*Math.sqrt(1+d-q-b),this.w=(g-e)/d,this.x=.25*d,this.y=(a+c)/d,this.z=(n+f)/d):q>b?(d=2*Math.sqrt(1+q-d-b),this.w=(n-f)/d,this.x=(a+
c)/d,this.y=.25*d,this.z=(e+g)/d):(d=2*Math.sqrt(1+b-d-q),this.w=(c-a)/d,this.x=(n+f)/d,this.y=(e+g)/d,this.z=.25*d);return this};t.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this};t.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a};t.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w};var u=function(){this.elements=[1,0,0,
0,0,1,0,0,0,0,1,0,0,0,0,1]};u.prototype.set=function(a,b,d,n,c,q,e,f,g,h,k,l,p,v,r,w){var m=this.elements;m[0]=a;m[4]=b;m[8]=d;m[12]=n;m[1]=c;m[5]=q;m[9]=e;m[13]=f;m[2]=g;m[6]=h;m[10]=k;m[14]=l;m[3]=p;m[7]=v;m[11]=r;m[15]=w;return this};u.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this};u.prototype.clone=
function(){return(new this.constructor).copy(this)};u.prototype.identity=function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};u.prototype.extractBasis=function(a,b,d){a.fromMatrix4Column(this,0);b.fromMatrix4Column(this,1);d.fromMatrix4Column(this,2);return this};u.prototype.makeBasis=function(a,b,d){this.set(a.x,b.x,d.x,0,a.y,b.y,d.y,0,a.z,b.z,d.z,0,0,0,0,1);return this};u.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};u.prototype.premultiply=function(a){return this.multiplyMatrices(a,
this)};u.prototype.multiplyMatrices=function(a,b){var d=a.elements,c=b.elements;b=this.elements;a=d[0];var m=d[4],q=d[8],e=d[12],f=d[1],g=d[5],h=d[9],k=d[13],l=d[2],p=d[6],v=d[10],r=d[14],w=d[3],N=d[7],t=d[11];d=d[15];var u=c[0],x=c[4],y=c[8],z=c[12],A=c[1],B=c[5],C=c[9],D=c[13],E=c[2],F=c[6],G=c[10],H=c[14],I=c[3],J=c[7],K=c[11];c=c[15];b[0]=a*u+m*A+q*E+e*I;b[4]=a*x+m*B+q*F+e*J;b[8]=a*y+m*C+q*G+e*K;b[12]=a*z+m*D+q*H+e*c;b[1]=f*u+g*A+h*E+k*I;b[5]=f*x+g*B+h*F+k*J;b[9]=f*y+g*C+h*G+k*K;b[13]=f*z+g*D+
h*H+k*c;b[2]=l*u+p*A+v*E+r*I;b[6]=l*x+p*B+v*F+r*J;b[10]=l*y+p*C+v*G+r*K;b[14]=l*z+p*D+v*H+r*c;b[3]=w*u+N*A+t*E+d*I;b[7]=w*x+N*B+t*F+d*J;b[11]=w*y+N*C+t*G+d*K;b[15]=w*z+N*D+t*H+d*c;return this};u.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this};u.prototype.compose=function(a,b,d){this.fromQuaternion(b);this.scale(d);this.setPosition(a);return this};
u.prototype.scale=function(a){var b=this.elements,d=a.x,c=a.y;a=a.z;b[0]*=d;b[4]*=c;b[8]*=a;b[1]*=d;b[5]*=c;b[9]*=a;b[2]*=d;b[6]*=c;b[10]*=a;b[3]*=d;b[7]*=c;b[11]*=a;return this};u.prototype.setPosition=function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this};u.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this};u.prototype.getInverse=
function(a){var b=this.elements,d=a.elements;a=d[0];var c=d[1],m=d[2],q=d[3],e=d[4],f=d[5],g=d[6],h=d[7],k=d[8],l=d[9],p=d[10],r=d[11],t=d[12],w=d[13],u=d[14];d=d[15];var x=l*u*h-w*p*h+w*g*r-f*u*r-l*g*d+f*p*d,y=t*p*h-k*u*h-t*g*r+e*u*r+k*g*d-e*p*d,A=k*w*h-t*l*h+t*f*r-e*w*r-k*f*d+e*l*d,B=t*l*g-k*w*g-t*f*p+e*w*p+k*f*u-e*l*u,z=a*x+c*y+m*A+q*B;if(0===z)return v.warn("YUKA.Matrix4: .getInverse() can not invert matrix, determinant is 0."),this.identity();z=1/z;b[0]=x*z;b[1]=(w*p*q-l*u*q-w*m*r+c*u*r+l*m*
d-c*p*d)*z;b[2]=(f*u*q-w*g*q+w*m*h-c*u*h-f*m*d+c*g*d)*z;b[3]=(l*g*q-f*p*q-l*m*h+c*p*h+f*m*r-c*g*r)*z;b[4]=y*z;b[5]=(k*u*q-t*p*q+t*m*r-a*u*r-k*m*d+a*p*d)*z;b[6]=(t*g*q-e*u*q-t*m*h+a*u*h+e*m*d-a*g*d)*z;b[7]=(e*p*q-k*g*q+k*m*h-a*p*h-e*m*r+a*g*r)*z;b[8]=A*z;b[9]=(t*l*q-k*w*q-t*c*r+a*w*r+k*c*d-a*l*d)*z;b[10]=(e*w*q-t*f*q+t*c*h-a*w*h-e*c*d+a*f*d)*z;b[11]=(k*f*q-e*l*q-k*c*h+a*l*h+e*c*r-a*f*r)*z;b[12]=B*z;b[13]=(k*w*m-t*l*m+t*c*p-a*w*p-k*c*u+a*l*u)*z;b[14]=(t*f*m-e*w*m-t*c*g+a*w*g+e*c*u-a*f*u)*z;b[15]=(e*
l*m-k*f*m+k*c*g-a*l*g-e*c*p+a*f*p)*z;return this};u.prototype.fromQuaternion=function(a){var b=this.elements,d=a.x,c=a.y,m=a.z,e=a.w,f=d+d,g=c+c,h=m+m;a=d*f;var k=d*g;d*=h;var l=c*g;c*=h;m*=h;f*=e;g*=e;e*=h;b[0]=1-(l+m);b[4]=k-e;b[8]=d+g;b[1]=k+e;b[5]=1-(a+m);b[9]=c-f;b[2]=d-g;b[6]=c+f;b[10]=1-(a+l);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this};u.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var d=this.elements,c=0;16>c;c++)d[c]=a[c+b];return this};u.prototype.toArray=
function(a,b){b=void 0===b?0:b;var d=this.elements;a[b+0]=d[0];a[b+1]=d[1];a[b+2]=d[2];a[b+3]=d[3];a[b+4]=d[4];a[b+5]=d[5];a[b+6]=d[6];a[b+7]=d[7];a[b+8]=d[8];a[b+9]=d[9];a[b+10]=d[10];a[b+11]=d[11];a[b+12]=d[12];a[b+13]=d[13];a[b+14]=d[14];a[b+15]=d[15];return a};u.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var d=0;16>d;d++)if(b[d]!==a[d])return!1;return!0};var Hb=0,fb=new t,ra=new f,D=function(){this.id=Hb++;this.name="";this.active=!0;this.position=new f;this.rotation=new t;
this.scale=new f(1,1,1);this.forward=new f(0,0,1);this.up=new f(0,1,0);this.boundingRadius=0;this.maxTurnRate=Math.PI;this.matrix=new u;this.manager=null};D.prototype.start=function(){};D.prototype.update=function(){};D.prototype.getDirection=function(a){return a.copy(this.forward).applyRotation(this.rotation).normalize()};D.prototype.lookAt=function(a){ra.subVectors(a,this.position).normalize();this.rotation.lookAt(this.forward,ra,this.up);return this};D.prototype.rotateTo=function(a,b){ra.subVectors(a,
this.position).normalize();fb.lookAt(this.forward,ra,this.up);this.rotation.rotateTo(fb,this.maxTurnRate*b);return this};D.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.rotation,this.scale)};D.prototype.handleMessage=function(){return!1};D.prototype.sendMessage=function(a,b,d,c){null!==this.manager?this.manager.sendMessage(this,a,b,void 0===d?0:d,void 0===c?null:c):v.error("YUKA.GameEntity: The game entity must be added to a manager in order to send a message.")};var gb=
new f,Fa=new f,T=function(){var a=D.call(this)||this;a.velocity=new f;a.maxSpeed=1;a.updateOrientation=!0;return a};$jscomp.inherits(T,D);T.prototype.update=function(a){this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));gb.copy(this.velocity).multiplyScalar(a);Fa.copy(this.position).add(gb);this.updateOrientation&&1e-8<this.getSpeedSquared()&&this.lookAt(Fa);this.position.copy(Fa)};T.prototype.getSpeed=function(){return this.velocity.length()};
T.prototype.getSpeedSquared=function(){return this.velocity.squaredLength()};var Z=function(){this.currentTime=this.previousTime=this.startTime=0};Z.prototype.getDelta=function(){return(this.currentTime-this.previousTime)/1E3};Z.prototype.getElapsed=function(){return(this.currentTime-this.startTime)/1E3};Z.prototype.update=function(){this.previousTime=this.currentTime;this.currentTime=this.now();return this};Z.prototype.now=function(){return("undefined"===typeof performance?Date:performance).now()};
var hb=function(a){this.updateFrequency=void 0===a?0:a;this._time=new Z;this._nextUpdateTime=0};hb.prototype.ready=function(){this._time.update();return this._time.currentTime>=this._nextUpdateTime?(this._nextUpdateTime=this._time.currentTime+1E3/this.updateFrequency,!0):!1};var Ga=function(a){this.index=void 0===a?-1:a},U=function(a,b,d){this.from=void 0===a?-1:a;this.to=void 0===b?-1:b;this.cost=void 0===d?0:d};U.prototype.copy=function(a){this.from=a.from;this.to=a.to;this.cost=a.cost;return this};
U.prototype.clone=function(){return(new this.constructor).copy(this)};var A=function(){this.digraph=!1;this._nodes=new Map;this._edges=new Map};A.prototype.addNode=function(a){var b=a.index;this._nodes.set(b,a);this._edges.set(b,new Set);return this};A.prototype.addEdge=function(a){var b=this._edges.get(a.from);b.add(a);if(!1===this.digraph){var d=a.clone();d.from=a.to;d.to=a.from;b=this._edges.get(a.to);b.add(d)}return this};A.prototype.getNode=function(a){return this._nodes.get(a)||null};A.prototype.getEdge=
function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=this._edges.get(a);a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())if(d=d.value,d.to===b)return d}return null};A.prototype.getNodes=function(a){a.length=0;a.push.apply(a,$jscomp.arrayFromIterable(this._nodes.values()));return this};A.prototype.getEdgesOfNode=function(a,b){a=this._edges.get(a);void 0!==a&&(b.length=0,b.push.apply(b,$jscomp.arrayFromIterable(a)));return this};A.prototype.getNodeCount=function(){return this._nodes.size};
A.prototype.getEdgeCount=function(){for(var a=0,b=$jscomp.makeIterator(this._edges.values()),d=b.next();!d.done;d=b.next())a+=d.value.size;return a};A.prototype.removeNode=function(a){this._nodes.delete(a.index);if(!1===this.digraph){var b=this._edges.get(a.index);b=$jscomp.makeIterator(b);for(var d=b.next();!d.done;d=b.next()){d=this._edges.get(d.value.to);for(var c=$jscomp.makeIterator(d),m=c.next();!m.done;m=c.next())if(m=m.value,m.to===a.index){d.delete(m);break}}}else for(b=$jscomp.makeIterator(this._edges.values()),
d=b.next();!d.done;d=b.next())for(c=d.value,m=$jscomp.makeIterator(c),d=m.next();!d.done;d=m.next())d=d.value,this.hasNode(d.to)&&this.hasNode(d.from)||c.delete(d);this._edges.delete(a.index);return this};A.prototype.removeEdge=function(a){var b=this._edges.get(a.from);if(void 0!==b&&(b.delete(a),!1===this.digraph)){b=this._edges.get(a.to);for(var d=$jscomp.makeIterator(b),c=d.next();!c.done;c=d.next())if(c=c.value,c.to===a.from){b.delete(c);break}}return this};A.prototype.hasNode=function(a){return this._nodes.has(a)};
A.prototype.hasEdge=function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=this._edges.get(a);a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())if(d.value.to===b)return!0}return!1};A.prototype.clear=function(){this._nodes.clear();this._edges.clear();return this};var sa=function(a,b,d){a=void 0===a?-1:a;b=void 0===b?new f:b;d=void 0===d?{}:d;a=Ga.call(this,a)||this;a.position=b;a.userData=d;return a};$jscomp.inherits(sa,Ga);var ta=function(a,b,d){return U.call(this,void 0===a?-1:a,void 0===
b?-1:b,void 0===d?0:d)||this};$jscomp.inherits(ta,U);var ib=function(){};ib.createGridLayout=function(a,b){var d=new A;d.digraph=!0;var c=a/2;a/=b;for(var m=0,e=0;e<=b;e++)for(var g=e*a-c,h=0;h<=b;h++){var k=new f(h*a-c,0,g);k=new sa(m,k);d.addNode(k);m++}b=d.getNodeCount();c=Math.pow(a+a/2,2);for(a=0;a<b;a++)for(m=d.getNode(a),e=0;e<b;e++)a!==e&&(g=d.getNode(e).position.squaredDistanceTo(m.position),g<=c&&(g=new ta(a,e,Math.sqrt(g)),d.addEdge(g)));return d};var Ha=function(){};Ha.calculate=function(a,
b,d){b=a.getNode(b);a=a.getNode(d);return b.position.distanceTo(a.position)};var jb=function(){};jb.calculate=function(a,b,d){b=a.getNode(b);a=a.getNode(d);return b.position.squaredDistanceTo(a.position)};var kb=function(){};kb.calculate=function(a,b,d){b=a.getNode(b);a=a.getNode(d);return b.position.manhattanDistanceTo(a.position)};var lb=function(){};lb.calculate=function(){return 0};var O=function(a){a=void 0===a?e:a;this.data=[];this.length=0;this.compare=a};O.prototype.push=function(a){this.data.push(a);
this.length++;this._up(this.length-1)};O.prototype.pop=function(){if(0===this.length)return null;var a=this.data[0];this.length--;0<this.length&&(this.data[0]=this.data[this.length],this._down(0));this.data.pop();return a};O.prototype.peek=function(){return this.data[0]||null};O.prototype._up=function(a){for(var b=this.data,d=this.compare,c=b[a];0<a;){var m=a-1>>1,e=b[m];if(0<=d(c,e))break;b[a]=e;a=m}b[a]=c};O.prototype._down=function(a){for(var b=this.data,d=this.compare,c=b[a],m=this.length>>1;a<
m;){var e=(a<<1)+1,f=e+1,g=b[e];f<this.length&&0>d(b[f],g)&&(e=f,g=b[f]);if(0<=d(g,c))break;b[a]=g;a=e}b[a]=c};var aa=function(a){this.vertex=a=void 0===a?new f:a;this.polygon=this.twin=this.prev=this.next=null;this.nodeIndex=-1};aa.prototype.from=function(){return this.vertex};aa.prototype.to=function(){return this.next?this.next.vertex:null};aa.prototype.length=function(){var a=this.from(),b=this.to();return null!==b?a.distanceTo(b):-1};aa.prototype.squaredLength=function(){var a=this.from(),b=
this.to();return null!==b?a.squaredDistanceTo(b):-1};var ba=function(a,b,d){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===d?-1:d;this.heuristic=Ha;this.found=!1;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};ba.prototype.search=function(){var a=[],b=new O(l);for(b.push({cost:0,index:this.source});0<b.length;){var d=b.pop().index;if(!this._shortestPathTree.has(d)){!0===this._searchFrontier.has(d)&&this._shortestPathTree.set(d,this._searchFrontier.get(d));
if(d===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(d,a);for(var c=$jscomp.makeIterator(a),m=c.next();!m.done;m=c.next()){m=m.value;var e=(this._cost.get(d)||0)+m.cost,f=this.heuristic.calculate(this.graph,m.to,this.target);f=e+f;if(!1===this._searchFrontier.has(m.to)||e<this._cost.get(m.to))this._cost.set(m.to,e),this._searchFrontier.set(m.to,m),b.push({cost:f,index:m.to})}}}this.found=!1;return this};ba.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;
var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,a.unshift(b);return a};ba.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};ba.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear()};var mb=new f,ua=new f,H=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.from=a;this.to=b};H.prototype.set=function(a,b){this.from=a;this.to=
b;return this};H.prototype.copy=function(a){this.from.copy(a.from);this.to.copy(a.to);return this};H.prototype.clone=function(){return(new this.constructor).copy(this)};H.prototype.delta=function(a){return a.subVectors(this.to,this.from)};H.prototype.at=function(a,b){return this.delta(b).multiplyScalar(a).add(this.from)};H.prototype.closestPointToPoint=function(a,b,d){a=this.closestPointToPointParameter(a,b);return this.at(a,d)};H.prototype.closestPointToPointParameter=function(a,b){mb.subVectors(a,
this.from);ua.subVectors(this.to,this.from);a=ua.dot(ua);a=ua.dot(mb)/a;b&&(a=Y.clamp(a,0,1));return a};H.prototype.equals=function(a){return a.from.equals(this.from)&&a.to.equals(this.to)};var Ia=new f,nb=new f,Ja=new f,Ka=new f,fa=new f,ha=new H,B=function(){this.graph=new A;this.graph.digraph=!0;this.regions=new Set};B.prototype.fromPolygons=function(a){this.clear();var b=[],d=[];a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){c=c.value;var m=c.edge;do b.push(m),m=m.next;while(m!==
c.edge);this.regions.add(c)}a=$jscomp.makeIterator(b);for(c=a.next();!c.done;c=a.next())if(c=c.value,null===c.twin){m=$jscomp.makeIterator(b);for(var e=m.next();!e.done;e=m.next())if(e=e.value,c.from().equals(e.to())&&c.to().equals(e.from())){c.twin=e;e.twin=c;m=c.squaredLength();d.push({cost:m,edge:c});break}}d.sort(p);this._buildRegions(d);this._buildNodeIndices();this._buildGraph();return this};B.prototype.clear=function(){this.graph.clear();this.regions.clear();return this};B.prototype.getClosestNodeIndex=
function(a){var b=null,d=Infinity,c=[];this.graph.getNodes(c);c=$jscomp.makeIterator(c);for(var m=c.next();!m.done;m=c.next()){m=m.value;var e=a.squaredDistanceTo(m.position);e<d&&(d=e,b=m.index)}return b};B.prototype.getClosestNodeIndexInRegion=function(a,b,d){var c=null,e=Infinity,f=b.edge;do{if(f.twin||f.prev.twin){var g=a.squaredDistanceTo(f.from());d&&(g+=d.squaredDistanceTo(f.from()));g<e&&(e=g,c=f.twin?f.nodeIndex:f.prev.twin.nodeIndex)}f=f.next}while(f!==b.edge);return c};B.prototype.getClosestRegion=
function(a){for(var b=null,d=Infinity,c=$jscomp.makeIterator(this.regions),e=c.next();!e.done;e=c.next()){e=e.value;var f=a.squaredDistanceTo(e.centroid);f<d&&(d=f,b=e)}return b};B.prototype.getRegionForPoint=function(a,b){b=void 0===b?.001:b;for(var d=$jscomp.makeIterator(this.regions),c=d.next();!c.done;c=d.next())if(c=c.value,!0===c.contains(a,b))return c;return null};B.prototype.findPath=function(a,b){var d=this.graph,c=this.getRegionForPoint(a),e=this.getRegionForPoint(b),g=[];if(null===c||null===
e)null===c&&(c=this.getClosestRegion(a)),null===e&&(e=this.getClosestRegion(b));if(c===e)g.push((new f).copy(a)),g.push((new f).copy(b));else{var h=this.getClosestNodeIndexInRegion(a,c,b),k=this.getClosestNodeIndexInRegion(b,e,a);h=new ba(d,h,k);h.search();if(!0===h.found){h=h.getPath();k=h.length;for(var l=0,p=h.length;l<p;l++){var r=d.getNode(h[l]);if(!1===c.contains(r.position)){k=l;break}}h.splice(0,k-1);h.reverse();k=h.length;c=0;for(p=h.length;c<p;c++)if(l=d.getNode(h[c]),!1===e.contains(l.position)){k=
c;break}h.splice(0,k-1);h.reverse();g.push((new f).copy(a));a=$jscomp.makeIterator(h);for(e=a.next();!e.done;e=a.next())e=d.getNode(e.value),g.push((new f).copy(e.position));g.push((new f).copy(b))}}return g};B.prototype.clampMovement=function(a,b,d,c){var e=this.getRegionForPoint(d);if(null===e){if(null===a)throw Error("YUKA.NavMesh.clampMovement(): No current region available.");e=null;var n=Infinity,f=a.edge;do{if(null===f.twin){ha.set(f.vertex,f.next.vertex);var g=ha.closestPointToPointParameter(b);
ha.at(g,Ia);g=Ia.squaredDistanceTo(b);g<n&&(n=g,e=f,nb.copy(Ia))}f=f.next}while(f!==a.edge);Ja.subVectors(e.next.vertex,e.vertex).normalize();d=Ka.subVectors(d,b).length();Ka.divideScalar(d);n=Ja.dot(Ka);fa.copy(nb).add(Ja.multiplyScalar(n*d));ha.set(e.vertex,e.next.vertex);e=ha.closestPointToPointParameter(fa);if(0<=e&&1>=e)c.copy(fa);else{e=this.getRegionForPoint(fa);if(null!==e)return c.copy(fa),e;c.copy(b)}return a}return e};B.prototype._buildRegions=function(a){var b=this.regions;a=$jscomp.makeIterator(a);
for(var d=a.next();!d.done;d=a.next()){d=d.value;var c=d.edge;var e=c.prev;var f=c.next;var g=c.twin.prev;var h=c.twin.next;c.prev.next=c.twin.next;c.next.prev=c.twin.prev;c.twin.prev.next=c.next;c.twin.next.prev=c.prev;var k=c.polygon;k.edge=c.prev;if(!0===k.convex()){e=k.edge;do e.polygon=k,e=e.next;while(e!==k.edge);b.delete(d.edge.twin.polygon)}else e.next=c,f.prev=c,g.next=c.twin,h.prev=c.twin,k.edge=c}b=$jscomp.makeIterator(b);for(a=b.next();!a.done;a=b.next())a.value.computeCentroid()};B.prototype._buildNodeIndices=
function(){var a=this.regions,b=new Map,d=0;a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){c=c.value;var e=c.edge;do{if(null!==e.twin){for(var f=-1,g=e.from(),h=$jscomp.makeIterator(b.entries()),k=h.next();!k.done;k=h.next()){var l=$jscomp.makeIterator(k.value);k=l.next().value;l=l.next().value;if(!0===g.equals(l)){f=k;break}}-1===f&&(f=d++,b.set(f,g));e.nodeIndex=f;e.twin.next.nodeIndex=f}e=e.next}while(e!==c.edge)}};B.prototype._buildGraph=function(){var a=this.graph,b=this.regions,
d=new Set;b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next()){c=c.value;var e=[];d.add(e);var f=c.edge;do null!==f.twin&&(e.push(f.nodeIndex,f.twin.nodeIndex),!1===a.hasNode(f.nodeIndex)&&a.addNode(new sa(f.nodeIndex,f.from()))),f=f.next;while(f!==c.edge)}d=$jscomp.makeIterator(d);for(b=d.next();!b.done;b=d.next())for(b=b.value,c=$jscomp.makeIterator(b),e=c.next();!e.done;e=c.next()){e=e.value;f=$jscomp.makeIterator(b);for(var g=f.next();!g.done;g=f.next())if(g=g.value,e!==g&&!1===a.hasEdge(e,
g)){var h=a.getNode(e),k=a.getNode(g);h=h.position.distanceTo(k.position);a.addEdge(new ta(e,g,h))}}return this};var V=function(){this.centroid=new f;this.edge=null};V.prototype.fromContour=function(a){var b=[];if(3>a.length)return v.error("YUKA.Polygon: Unable to create polygon from contour. It needs at least three points."),this;for(var d=0,c=a.length;d<c;d++){var e=new aa(a[d]);b.push(e)}a=0;for(c=b.length;a<c;a++){if(0===a){d=b[a];e=b[c-1];var f=b[a+1]}else a===c-1?(d=b[a],e=b[a-1],f=b[0]):(d=
b[a],e=b[a-1],f=b[a+1]);d.prev=e;d.next=f;d.polygon=this}this.edge=b[0];return this};V.prototype.computeCentroid=function(){var a=this.centroid,b=this.edge,d=0;a.set(0,0,0);do a.add(b.from()),d++,b=b.next;while(b!==this.edge);a.divideScalar(d);return this};V.prototype.contains=function(a,b){b=void 0===b?.001:b;var d=this.edge,c=-Infinity,e=Infinity;do{var f=d.from(),g=d.to();if(!1===0<=(a.x-f.x)*(g.z-f.z)-(g.x-f.x)*(a.z-f.z))return!1;f.y>c&&(c=f.y);f.y<e&&(e=f.y);d=d.next}while(d!==this.edge);return a.y<=
c+b&&a.y>=e-b};V.prototype.convex=function(){var a=this.edge;do{var b=a.from(),d=a.to(),c=a.next.to();if(!1===0<=(c.x-b.x)*(d.z-b.z)-(d.x-b.x)*(c.z-b.z))return!1;a=a.next}while(a!==this.edge);return!0};var ob=function(){};ob.prototype.load=function(a){return new Promise(function(b,d){fetch(a).then(function(a){if(200<=a.status&&300>a.status)return a.arrayBuffer();var b=Error(a.statusText||a.status);b.response=a;return Promise.reject(b)}).then(function(b){var d=new I,c=new TextDecoder;"glTF"===c.decode(new Uint8Array(b,
0,4))?(d.parseBinary(b),b=d.extensions.get("BINARY").content):b=c.decode(new Uint8Array(b));b=JSON.parse(b);if(void 0===b.asset||2>b.asset.version[0])throw Error("YUKA.NavMeshLoader: Unsupported asset version.");c=a.lastIndexOf("/");c=-1===c?"./":a.substr(0,c+1);return d.parse(b,c)}).then(function(a){b(a)}).catch(function(a){v.error("YUKA.NavMeshLoader: Unable to load navigation mesh.",a);d(a)})})};var I=function(){this.path=this.json=null;this.cache=new Map;this.extensions=new Map};I.prototype.parse=
function(a,b){var d=this;this.json=a;this.path=b;return this.getDependency("mesh",0).then(function(a){a=d.parseGeometry(a);return(new B).fromPolygons(a)})};I.prototype.parseGeometry=function(a){var b=a.index,d=a.position;a=[];for(var c=[],e=0,g=d.length;e<g;e+=3){var h=new f;h.x=d[e+0];h.y=d[e+1];h.z=d[e+2];a.push(h)}if(b)for(d=0,g=b.length;d<g;d+=3)e=[a[b[d+0]],a[b[d+1]],a[b[d+2]]],e=(new V).fromContour(e),c.push(e);else for(b=0,g=a.length;b<g;b+=3)d=[a[b+0],a[b+1],a[b+2]],d=(new V).fromContour(d),
c.push(d);return c};I.prototype.getDependencies=function(a){var b=this,c=this.cache,e=c.get(a);e||(e=Promise.all((this.json[a+("mesh"===a?"es":"s")]||[]).map(function(c,d){return b.getDependency(a,d)})),c.set(a,e));return e};I.prototype.getDependency=function(a,b){var c=this.cache,e=a+":"+b,f=c.get(e);if(void 0===f){switch(a){case "accessor":f=this.loadAccessor(b);break;case "buffer":f=this.loadBuffer(b);break;case "bufferView":f=this.loadBufferView(b);break;case "mesh":f=this.loadMesh(b);break;default:throw Error("Unknown type: "+
a);}c.set(e,f)}return f};I.prototype.loadBuffer=function(a){var b=this,c=this.json.buffers[a];return void 0===c.uri&&0===a?Promise.resolve(this.extensions.get("BINARY").body):new Promise(function(a,d){var e=g(c.uri,b.path);fetch(e).then(function(a){return a.arrayBuffer()}).then(function(b){a(b)}).catch(function(a){v.error("YUKA.NavMeshLoader: Unable to load buffer.",a);d(a)})})};I.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var c=
b.byteOffset||0;return a.slice(c,c+(b.byteLength||0))})};I.prototype.loadAccessor=function(a){var b=this.json.accessors[a];return this.getDependency("bufferView",b.bufferView).then(function(a){return new Ib[b.componentType](a,b.byteOffset||0,b.count*Jb[b.type])})};I.prototype.loadMesh=function(a){var b=this.json.meshes[a];return this.getDependencies("accessor").then(function(a){var c=b.primitives[0];if(4!==c.mode)throw Error("YUKA.NavMeshLoader: Invalid geometry format. Please ensure to represent your geometry as triangles.");
return{index:a[c.indices],position:a[c.attributes.POSITION],normal:a[c.attributes.NORMAL]}})};I.prototype.parseBinary=function(a){for(var b=new DataView(a,12),c=0,e=new TextDecoder,f=null,g=null;c<b.byteLength;){var h=b.getUint32(c,!0);c+=4;var k=b.getUint32(c,!0);c+=4;k===pb.JSON?(f=new Uint8Array(a,12+c,h),f=e.decode(f)):k===pb.BIN&&(g=12+c,g=a.slice(g,g+h));c+=h}this.extensions.set("BINARY",{content:f,body:g})};var Jb={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ib={5120:Int8Array,5121:Uint8Array,
5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},pb={JSON:1313821514,BIN:5130562},ia=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};ia.prototype.search=function(){var a=[],b=[],c=new U(this.source,this.source);for(a.push(c);0<a.length;){var e=a.pop();this._route.set(e.to,e.from);this._visited.add(e.to);e!==c&&this._spanningTree.add(e);if(e.to===
this.target)return this.found=!0,this;this.graph.getEdgesOfNode(e.to,b);e=$jscomp.makeIterator(b);for(var f=e.next();!f.done;f=e.next())f=f.value,!1===this._visited.has(f.to)&&a.push(f)}this.found=!1;return this};ia.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};ia.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};ia.prototype.clear=
function(){this.found=!1;this._route.clear();this._visited.clear();this._spanningTree.clear()};var ja=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};ja.prototype.search=function(){var a=[],b=[],c=new U(this.source,this.source);a.push(c);for(this._visited.add(this.source);0<a.length;){var e=a.shift();this._route.set(e.to,e.from);e!==c&&this._spanningTree.add(e);
if(e.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(e.to,b);e=$jscomp.makeIterator(b);for(var f=e.next();!f.done;f=e.next())f=f.value,!1===this._visited.has(f.to)&&(a.push(f),this._visited.add(f.to))}this.found=!1;return this};ja.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);return a};ja.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};
ja.prototype.clear=function(){this.found=!1;this._route.clear();this._visited.clear();this._spanningTree.clear()};var ka=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};ka.prototype.search=function(){var a=[],b=new O(G);for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&
this._shortestPathTree.set(c,this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,a);for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next()){f=f.value;var g=(this._cost.get(c)||0)+f.cost;if(!1===this._searchFrontier.has(f.to)||g<this._cost.get(f.to))this._cost.set(f.to,g),this._searchFrontier.set(f.to,f),b.push({cost:g,index:f.to})}}}this.found=!1;return this};ka.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;
var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,a.unshift(b);return a};ka.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};ka.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear()};var W=function(){this.loop=!1;this._waypoints=[];this._index=0};W.prototype.add=function(a){this._waypoints.push(a);return this};W.prototype.clear=function(){this._index=
this._waypoints.length=0;return this};W.prototype.finished=function(){var a=this._waypoints.length-1;return!0===this.loop?!1:this._index===a};W.prototype.advance=function(){this._index++;this._index===this._waypoints.length&&(!0===this.loop?this._index=0:this._index--);return this};W.prototype.current=function(){return this._waypoints[this._index]};var y=function(){this.active=!0;this.weigth=1};y.prototype.calculate=function(){};var va=new f,X=function(a){this.vehicle=a;this.behaviors=[];this._steeringForce=
new f};X.prototype.add=function(a){this.behaviors.push(a);return this};X.prototype.remove=function(a){a=this.behaviors.indexOf(a);this.behaviors.splice(a,1);return this};X.prototype.calculate=function(a,b){this._calculateByOrder(a);return b.copy(this._steeringForce)};X.prototype._accumulate=function(a){var b=this._steeringForce.length();b=this.vehicle.maxForce-b;if(0>=b)return!1;a.length()>b&&a.normalize().multiplyScalar(b);this._steeringForce.add(a);return!0};X.prototype._calculateByOrder=function(a){this._steeringForce.set(0,
0,0);for(var b=$jscomp.makeIterator(this.behaviors),c=b.next();!c.done&&(c=c.value,!0!==c.active||(va.set(0,0,0),c.calculate(this.vehicle,va,a),va.multiplyScalar(c.weigth),!1!==this._accumulate(va)));c=b.next());};var qb=new f,rb=new f,sb=new f,La=new f,Ma=function(){var a=T.call(this)||this;a.mass=1;a.maxForce=100;a.steering=new X(a);return a};$jscomp.inherits(Ma,T);Ma.prototype.update=function(a){this.steering.calculate(a,qb);sb.copy(qb).divideScalar(this.mass);this.velocity.add(sb.multiplyScalar(a));
this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));rb.copy(this.velocity).multiplyScalar(a);La.copy(this.position).add(rb);this.updateOrientation&&1e-8<this.getSpeedSquared()&&this.lookAt(La);this.position.copy(La)};var tb=new f,Na=new f,la=function(a,b){a=void 0===a?new f:a;b=void 0===b?3:b;var c=y.call(this)||this;c.target=a;c.deceleration=b;return c};$jscomp.inherits(la,y);la.prototype.calculate=function(a,b){var c=this.deceleration;
Na.subVectors(this.target,a.position);var e=Na.length();0<e&&(c=Math.min(e/c,a.maxSpeed),tb.copy(Na).multiplyScalar(c/e),b.subVectors(tb,a.velocity))};var ma=new f,wa=function(a,b){a=void 0===a?new f:a;b=void 0===b?10:b;var c=y.call(this)||this;c.target=a;c.panicDistance=b;return c};$jscomp.inherits(wa,y);wa.prototype.calculate=function(a,b){var c=this.target;a.position.squaredDistanceTo(c)<=this.panicDistance*this.panicDistance&&(ma.subVectors(a.position,c).normalize(),0===ma.squaredLength()&&ma.set(0,
0,1),ma.multiplyScalar(a.maxSpeed),b.subVectors(ma,a.velocity))};var ub=new f,vb=new f,wb=new f,Oa=function(a,b,c){a=void 0===a?null:a;b=void 0===b?10:b;c=void 0===c?1:c;var d=y.call(this)||this;d.pursuer=a;d.panicDistance=b;d.predictionFactor=c;d._flee=new wa;return d};$jscomp.inherits(Oa,y);Oa.prototype.calculate=function(a,b){var c=this.pursuer;ub.subVectors(c.position,a.position);var e=ub.length()/(a.maxSpeed+c.getSpeed());e*=this.predictionFactor;vb.copy(c.velocity).multiplyScalar(e);wb.addVectors(c.position,
vb);this._flee.target=wb;this._flee.panicDistance=this.panicDistance;this._flee.calculate(a,b)};var Pa=new f,ca=function(a){a=void 0===a?new f:a;var b=y.call(this)||this;b.target=a;return b};$jscomp.inherits(ca,y);ca.prototype.calculate=function(a,b){Pa.subVectors(this.target,a.position).normalize();Pa.multiplyScalar(a.maxSpeed);b.subVectors(Pa,a.velocity)};var Qa=function(a,b){a=void 0===a?new W:a;b=void 0===b?1:b;var c=y.call(this)||this;c.path=a;c.nextWaypointDistance=b;c._arrive=new la;c._seek=
new ca;return c};$jscomp.inherits(Qa,y);Qa.prototype.calculate=function(a,b){var c=this.path;c.current().squaredDistanceTo(a.position)<this.nextWaypointDistance*this.nextWaypointDistance&&c.advance();var e=c.current();!0===c.finished()?(this._arrive.target=e,this._arrive.calculate(a,b)):(this._seek.target=e,this._seek.calculate(a,b))};var xa=new f,ya=new f,xb=new f,yb=new f,Ra=function(a,b,c){a=void 0===a?null:a;b=void 0===b?null:b;c=void 0===c?3:c;var d=y.call(this)||this;d.entity1=a;d.entity2=b;
d.deceleration=c;d._arrive=new la;return d};$jscomp.inherits(Ra,y);Ra.prototype.calculate=function(a,b){var c=this.entity1,e=this.entity2;xa.addVectors(c.position,e.position).multiplyScalar(.5);var f=a.position.distanceTo(xa)/a.maxSpeed;ya.copy(c.velocity).multiplyScalar(f);xb.addVectors(c.position,ya);ya.copy(e.velocity).multiplyScalar(f);yb.addVectors(e.position,ya);xa.addVectors(xb,yb).multiplyScalar(.5);this._arrive.deceleration=this.deceleration;this._arrive.target=xa;this._arrive.calculate(a,
b)};var E=function(a,b){this.center=a=void 0===a?new f:a;this.radius=void 0===b?0:b};E.prototype.set=function(a,b){this.center=a;this.radius=b;return this};E.prototype.copy=function(a){this.center.copy(a.center);this.radius=a.radius;return this};E.prototype.clone=function(){return(new this.constructor).copy(this)};E.prototype.containsPoint=function(a){return a.squaredDistanceTo(this.center)<=this.radius*this.radius};E.prototype.intersectsBoundingSphere=function(a){var b=this.radius+a.radius;return a.center.squaredDistanceTo(this.center)<=
b*b};E.prototype.equals=function(a){return a.center.equals(this.center)&&a.radius===this.radius};var za=new f,P=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.origin=a;this.direction=b};P.prototype.set=function(a,b){this.origin=a;this.direction=b;return this};P.prototype.copy=function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this};P.prototype.clone=function(){return(new this.constructor).copy(this)};P.prototype.at=function(a,b){return b.copy(this.direction).multiplyScalar(a).add(this.origin)};
P.prototype.intersectSphere=function(a,b){za.subVectors(a.center,this.origin);var c=za.dot(this.direction),e=za.dot(za)-c*c;a=a.radius*a.radius;if(e>a)return null;a=Math.sqrt(a-e);e=c-a;c+=a;return 0>e&&0>c?null:0>e?this.at(c,b):this.at(e,b)};P.prototype.equals=function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)};var zb=new u,da=new f,Sa=new f,Ta=new f,Ab=new E,Kb=new P(new f(0,0,0),new f(0,0,1)),Ua=function(a){a=void 0===a?null:a;var b=y.call(this)||this;b.entityManager=
a;b.weigth=3;b.dBoxMinLength=5;b._waypoint=null;b._seek=new ca;return b};$jscomp.inherits(Ua,y);Ua.prototype.calculate=function(a,b){var c=null,e=Infinity,f=this.entityManager.entities.values(),g=this.dBoxMinLength+a.getSpeed()/a.maxSpeed*this.dBoxMinLength;zb.getInverse(a.matrix);f=$jscomp.makeIterator(f);for(var h=f.next();!h.done;h=f.next())if(h=h.value,h!==a&&(da.copy(h.position).applyMatrix4(zb),0<da.z&&Math.abs(da.z)<g)){var k=h.boundingRadius+a.boundingRadius;Math.abs(da.x)<k&&(Ab.set(da,k),
Kb.intersectSphere(Ab,Ta),Ta.z<e&&(e=Ta.z,c=h,Sa.copy(da)))}null!==c&&(this._waypoint=Sa.clone(),this._waypoint.x-=(c.boundingRadius+a.boundingRadius)*Math.sign(Sa.x),this._waypoint.applyMatrix4(a.matrix));null!==this._waypoint&&(1>this._waypoint.squaredDistanceTo(a.position)?this._waypoint=null:(this._seek.target=this._waypoint,this._seek.calculate(a,b)))};var Va=new f,Wa=new f,Bb=new f,Cb=new f,Db=new f,Xa=function(a,b){a=void 0===a?null:a;b=void 0===b?1:b;var c=y.call(this)||this;c.evader=a;c.predictionFactor=
b;c._seek=new ca;return c};$jscomp.inherits(Xa,y);Xa.prototype.calculate=function(a,b){var c=this.evader;Va.subVectors(c.position,a.position);a.getDirection(Wa);c.getDirection(Bb);var e=0<Va.dot(Wa),f=-.95>Wa.dot(Bb);!0===e&&!0===f?this._seek.target=c.position:(e=Va.length()/(a.maxSpeed+c.getSpeed()),e*=this.predictionFactor,Cb.copy(c.velocity).multiplyScalar(e),Db.addVectors(c.position,Cb),this._seek.target=Db);this._seek.calculate(a,b)};var na=new f,Ya=new f,Aa=function(a,b,c){a=void 0===a?1:a;
b=void 0===b?5:b;c=void 0===c?5:c;var d=y.call(this)||this;d.radius=a;d.distance=b;d.jitter=c;d._targetLocal=new f;d._setup();return d};$jscomp.inherits(Aa,y);Aa.prototype.calculate=function(a,b,c){c*=this.jitter;Ya.x=Y.randFloat(-1,1)*c;Ya.z=Y.randFloat(-1,1)*c;this._targetLocal.add(Ya);this._targetLocal.normalize();this._targetLocal.multiplyScalar(this.radius);na.copy(this._targetLocal);na.z+=this.distance;na.applyMatrix4(a.matrix);b.subVectors(na,a.position)};Aa.prototype._setup=function(){var a=
Math.random()*Math.PI*2;this._targetLocal.x=this.radius*Math.cos(a);this._targetLocal.z=this.radius*Math.sin(a)};var oa=function(){};oa.prototype.touching=function(){return!1};var pa=new f,J=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this.min=a;this.max=b};J.prototype.set=function(a,b){this.min=a;this.max=b;return this};J.prototype.copy=function(a){this.min.copy(a.min);this.max.copy(a.max);return this};J.prototype.clone=function(){return(new this.constructor).copy(this)};J.prototype.clampPoint=
function(a,b){b.copy(a).clamp(this.min,this.max);return this};J.prototype.containsPoint=function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0};J.prototype.intersectsBoundingSphere=function(a){this.clampPoint(a.center,pa);return pa.squaredDistanceTo(a.center)<=a.radius*a.radius};J.prototype.fromCenterAndSize=function(a,b){pa.copy(b).multiplyScalar(.5);this.min.copy(a).sub(pa);this.max.copy(a).add(pa);return this};J.prototype.equals=
function(a){return a.min.equals(this.min)&&a.max.equals(this.max)};var Eb=new E,qa=function(a,b){a=void 0===a?new f:a;b=void 0===b?new f:b;this._aabb=new J(a,b);return this};$jscomp.inherits(qa,oa);qa.prototype.fromPositionAndSize=function(a,b){this._aabb.fromCenterAndSize(a,b);return this};qa.prototype.touching=function(a){Eb.set(a.position,a.boundingRadius);return this._aabb.intersectsBoundingSphere(Eb)};$jscomp.global.Object.defineProperties(qa.prototype,{min:{configurable:!0,enumerable:!0,get:function(){return this._aabb.min},
set:function(a){this._aabb.min=a}},max:{configurable:!0,enumerable:!0,get:function(){return this._aabb.max},set:function(a){this._aabb.max=a}}});var Fb=new E,Ba=function(a,b){a=void 0===a?new f:a;this._boundingSphere=new E(a,void 0===b?0:b);return this};$jscomp.inherits(Ba,oa);Ba.prototype.touching=function(a){Fb.set(a.position,a.boundingRadius);return this._boundingSphere.intersectsBoundingSphere(Fb)};$jscomp.global.Object.defineProperties(Ba.prototype,{position:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.center},
set:function(a){this._boundingSphere.center=a}},radius:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.radius},set:function(a){this._boundingSphere.radius=a}}});var Ca=function(a){a=void 0===a?new oa:a;this.active=!0;this.region=a};Ca.prototype.check=function(a){!0===this.active&&!0===this.region.touching(a)&&this.execute(a)};Ca.prototype.execute=function(){};Ca.prototype.update=function(){};var ea=function(){};ea.prototype.enter=function(){};ea.prototype.execute=function(){};
ea.prototype.exit=function(){};ea.prototype.onMessage=function(){return!1};var K=function(a){this.owner=a;this.globalState=this.previousState=this.currentState=null;this.states=new Map};K.prototype.update=function(){null!==this.globalState&&this.globalState.execute(this.owner);null!==this.currentState&&this.currentState.execute(this.owner)};K.prototype.add=function(a,b){b instanceof ea?this.states.set(a,b):v.warn('YUKA.StateMachine: .add() needs a parameter of type "YUKA.State".')};K.prototype.remove=
function(a){this.states.delete(a)};K.prototype.get=function(a){return this.states.get(a)};K.prototype.changeTo=function(a){a=this.get(a);this._change(a)};K.prototype.revert=function(){this._change(this.previousState)};K.prototype.in=function(a){return this.get(a)===this.currentState};K.prototype.handleMessage=function(a){return null!==this.currentState&&!0===this.currentState.onMessage(this.owner,a)||null!==this.globalState&&!0===this.globalState.onMessage(this.owner,a)?!0:!1};K.prototype._change=
function(a){this.previousState=this.currentState;this.currentState.exit(this.owner);this.currentState=a;this.currentState.enter(this.owner)};var r=function(a){this.owner=void 0===a?null:a;this.status=r.STATUS.INACTIVE};r.prototype.addSubgoal=function(){v.warn("YUKA.Goal: Unable to add goal to atomic goals.")};r.prototype.activate=function(){};r.prototype.execute=function(){};r.prototype.terminate=function(){};r.prototype.handleMessage=function(){return!1};r.prototype.active=function(){return this.status===
r.STATUS.ACTIVE};r.prototype.inactive=function(){return this.status===r.STATUS.INACTIVE};r.prototype.completed=function(){return this.status===r.STATUS.COMPLETED};r.prototype.failed=function(){return this.status===r.STATUS.FAILED};r.prototype.replanIfFailed=function(){!0===this.failed()&&(this.status=r.STATUS.INACTIVE);return this};r.prototype.activateIfInactive=function(){!0===this.inactive()&&(this.activate(),this.status=r.STATUS.ACTIVE);return this};r.STATUS=Object.freeze({ACTIVE:"active",INACTIVE:"inactive",
COMPLETED:"completed",FAILED:"failed"});var M=function(a){a=r.call(this,void 0===a?null:a)||this;a.subgoals=[];return a};$jscomp.inherits(M,r);M.prototype.addSubgoal=function(a){this.subgoals.push(a);return this};M.prototype.clearSubgoals=function(){for(var a=this.subgoals,b=$jscomp.makeIterator(a),c=b.next();!c.done;c=b.next())c.value.terminate();a.length=0;return this};M.prototype.currentSubgoal=function(){var a=this.subgoals.length;return 0<a?this.subgoals[a-1]:null};M.prototype.executeSubgoals=
function(){for(var a=this.subgoals,b=a.length-1;0<=b;b--){var c=a[b];if(!0===c.completed()||!0===c.failed())c.terminate(),a.pop();else break}b=this.currentSubgoal();return null!==b?(b.activateIfInactive(),b.execute(),!0===b.completed()&&1<a.length?r.STATUS.ACTIVE:b.status):r.STATUS.COMPLETED};M.prototype.hasSubgoals=function(){return 0<this.subgoals.length};M.prototype.handleMessage=function(a){var b=this.currentSubgoal();return null!==b?b.handleMessage(a):!1};var Za=function(a){this.characterBias=
void 0===a?1:a};Za.prototype.calculateDesirability=function(){return 0};Za.prototype.setGoal=function(){};var Q=function(a){a=M.call(this,void 0===a?null:a)||this;a.evaluators=new Set;return a};$jscomp.inherits(Q,M);Q.prototype.activate=function(){this.arbitrate()};Q.prototype.execute=function(){this.activateIfInactive();var a=this.executeSubgoals();if(a===r.STATUS.COMPLETED||a===r.STATUS.FAILED)this.status=r.STATUS.INACTIVE};Q.prototype.terminate=function(){this.clearSubgoals()};Q.prototype.addEvaluator=
function(a){this.evaluators.add(a);return this};Q.prototype.removeEvaluator=function(a){this.evaluators.delete(a);return this};Q.prototype.arbitrate=function(){for(var a=-1,b=null,c=$jscomp.makeIterator(this.evaluators),e=c.next();!e.done;e=c.next()){e=e.value;var f=e.calculateDesirability(this.owner);f*=e.characterBias;f>=a&&(a=f,b=e)}null!==b?b.setGoal(this.owner):v.error("YUKA.Think: Unable to determine goal evaluator for game entity:",this.owner);return this};var Gb=new f,Lb=new f,R=function(a,
b){this.normal=a=void 0===a?new f(0,0,1):a;this.constant=void 0===b?0:b};R.prototype.set=function(a,b){this.normal=a;this.constant=b;return this};R.prototype.copy=function(a){this.normal.copy(a.normal);this.constant=a.constant;return this};R.prototype.clone=function(){return(new this.constructor).copy(this)};R.prototype.distanceToPoint=function(a){return this.normal.dot(a)+this.constant};R.prototype.fromNormalAndCoplanarPoint=function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this};
R.prototype.fromCoplanarPoints=function(a,b,c){Gb.subVectors(c,b).cross(Lb.subVectors(a,b)).normalize();this.fromNormalAndCoplanarPoint(Gb,a);return this};R.prototype.equals=function(a){return a.normal.equals(this.normal)&&a.constant===this.constant};c.EntityManager=C;c.GameEntity=D;c.Logger=v;c.MessageDispatcher=F;c.MovingEntity=T;c.Regulator=hb;c.Telegram=k;c.Time=Z;c.Node=Ga;c.Edge=U;c.Graph=A;c.GraphUtils=ib;c.PriorityQueue=O;c.NavNode=sa;c.NavEdge=ta;c.HalfEdge=aa;c.NavMesh=B;c.NavMeshLoader=
ob;c.Polygon=V;c.DFS=ia;c.BFS=ja;c.Dijkstra=ka;c.AStar=ba;c.Path=W;c.SteeringBehavior=y;c.SteeringManager=X;c.Vehicle=Ma;c.ArriveBehavior=la;c.EvadeBehavior=Oa;c.FleeBehavior=wa;c.FollowPathBehavior=Qa;c.InterposeBehavior=Ra;c.ObstacleAvoidanceBehavior=Ua;c.PursuitBehavior=Xa;c.SeekBehavior=ca;c.WanderBehavior=Aa;c.RectangularTriggerRegion=qa;c.SphericalTriggerRegion=Ba;c.TriggerRegion=oa;c.Trigger=Ca;c.State=ea;c.StateMachine=K;c.Goal=r;c.CompositeGoal=M;c.GoalEvaluator=Za;c.Think=Q;c.AABB=J;c.BoundingSphere=
E;c.LineSegment=H;c.Math=Y;c.Matrix3=x;c.Matrix4=u;c.Plane=R;c.Quaternion=t;c.Ray=P;c.Vector3=f;c.HeuristicPolicyEuclid=Ha;c.HeuristicPolicyEuclidSquared=jb;c.HeuristicPolicyManhatten=kb;c.HeuristicPolicyDijkstra=lb;c.WorldUp=Da;Object.defineProperty(c,"__esModule",{value:!0})});
