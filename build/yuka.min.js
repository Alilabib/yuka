var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,n,p){d!=Array.prototype&&d!=Object.prototype&&(d[n]=p.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var d=0;return function(n){return $jscomp.SYMBOL_PREFIX+(n||"")+d++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(d){var n=0;return $jscomp.iteratorPrototype(function(){return n<d.length?{done:!1,value:d[n++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.makeIterator=function(d){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var n=d[Symbol.iterator];return n?n.call(d):$jscomp.arrayIterator(d)};$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(d){var n=function(){};n.prototype=d;return new n};
$jscomp.underscoreProtoCanBeSet=function(){var d={a:!0},n={};try{return n.__proto__=d,n.a}catch(p){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(d,n){d.__proto__=n;if(d.__proto__!==n)throw new TypeError(d+" is not extensible");return d}:null;
$jscomp.inherits=function(d,n){d.prototype=$jscomp.objectCreate(n.prototype);d.prototype.constructor=d;if($jscomp.setPrototypeOf){var p=$jscomp.setPrototypeOf;p(d,n)}else for(p in n)if("prototype"!=p)if(Object.defineProperties){var q=Object.getOwnPropertyDescriptor(n,p);q&&Object.defineProperty(d,p,q)}else d[p]=n[p];d.superClass_=n.prototype};$jscomp.arrayFromIterator=function(d){for(var n,p=[];!(n=d.next()).done;)p.push(n.value);return p};
$jscomp.arrayFromIterable=function(d){return d instanceof Array?d:$jscomp.arrayFromIterator($jscomp.makeIterator(d))};$jscomp.checkEs6ConformanceViaProxy=function(){try{var d={},n=Object.create(new $jscomp.global.Proxy(d,{get:function(p,q,k){return p==d&&"q"==q&&k==n}}));return!0===n.q}catch(p){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();
$jscomp.owns=function(d,n){return Object.prototype.hasOwnProperty.call(d,n)};$jscomp.polyfill=function(d,n,p,q){if(n){p=$jscomp.global;d=d.split(".");for(q=0;q<d.length-1;q++){var k=d[q];k in p||(p[k]={});p=p[k]}d=d[d.length-1];q=p[d];n=n(q);n!=q&&null!=n&&$jscomp.defineProperty(p,d,{configurable:!0,writable:!0,value:n})}};
$jscomp.polyfill("WeakMap",function(d){function n(){if(!d||!Object.seal)return!1;try{var v=Object.seal({}),l=Object.seal({}),m=new d([[v,2],[l,3]]);if(2!=m.get(v)||3!=m.get(l))return!1;m.delete(v);m.set(l,4);return!m.has(v)&&4==m.get(l)}catch(W){return!1}}function p(d){$jscomp.owns(d,k)||$jscomp.defineProperty(d,k,{value:{}})}function q(d){var l=Object[d];l&&(Object[d]=function(d){p(d);return l(d)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(n())return d;
var k="$jscomp_hidden_"+Math.random();q("freeze");q("preventExtensions");q("seal");var M=0,m=function(d){this.id_=(M+=Math.random()+1).toString();if(d){$jscomp.initSymbol();$jscomp.initSymbolIterator();d=$jscomp.makeIterator(d);for(var l;!(l=d.next()).done;)l=l.value,this.set(l[0],l[1])}};m.prototype.set=function(d,l){p(d);if(!$jscomp.owns(d,k))throw Error("WeakMap key fail: "+d);d[k][this.id_]=l;return this};m.prototype.get=function(d){return $jscomp.owns(d,k)?d[k][this.id_]:void 0};m.prototype.has=
function(d){return $jscomp.owns(d,k)&&$jscomp.owns(d[k],this.id_)};m.prototype.delete=function(d){return $jscomp.owns(d,k)&&$jscomp.owns(d[k],this.id_)?delete d[k][this.id_]:!1};return m},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(d){function n(){if($jscomp.ASSUME_NO_NATIVE_MAP||!d||"function"!=typeof d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var l=Object.seal({x:4}),m=new d($jscomp.makeIterator([[l,"s"]]));if("s"!=m.get(l)||1!=m.size||m.get({x:4})||m.set({x:4},"t")!=m||2!=m.size)return!1;var k=m.entries(),v=k.next();if(v.done||v.value[0]!=l||"s"!=v.value[1])return!1;v=k.next();return v.done||4!=v.value[0].x||"t"!=v.value[1]||!k.next().done?!1:!0}catch(X){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(n())return d;$jscomp.initSymbol();$jscomp.initSymbolIterator();var p=new WeakMap,q=function(d){this.data_={};this.head_=m();this.size=0;if(d){d=$jscomp.makeIterator(d);for(var l;!(l=d.next()).done;)l=l.value,this.set(l[0],l[1])}};q.prototype.set=function(d,m){d=0===d?0:d;var l=k(this,d);l.list||(l.list=this.data_[l.id]=[]);l.entry?l.entry.value=m:(l.entry={next:this.head_,previous:this.head_.previous,head:this.head_,
key:d,value:m},l.list.push(l.entry),this.head_.previous.next=l.entry,this.head_.previous=l.entry,this.size++);return this};q.prototype.delete=function(d){d=k(this,d);return d.entry&&d.list?(d.list.splice(d.index,1),d.list.length||delete this.data_[d.id],d.entry.previous.next=d.entry.next,d.entry.next.previous=d.entry.previous,d.entry.head=null,this.size--,!0):!1};q.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=m();this.size=0};q.prototype.has=function(d){return!!k(this,d).entry};
q.prototype.get=function(d){return(d=k(this,d).entry)&&d.value};q.prototype.entries=function(){return M(this,function(d){return[d.key,d.value]})};q.prototype.keys=function(){return M(this,function(d){return d.key})};q.prototype.values=function(){return M(this,function(d){return d.value})};q.prototype.forEach=function(d,m){for(var l=this.entries(),v;!(v=l.next()).done;)v=v.value,d.call(m,v[1],v[0],this)};q.prototype[Symbol.iterator]=q.prototype.entries;var k=function(d,m){var l=m&&typeof m;"object"==
l||"function"==l?p.has(m)?l=p.get(m):(l=""+ ++v,p.set(m,l)):l="p_"+m;var k=d.data_[l];if(k&&$jscomp.owns(d.data_,l))for(d=0;d<k.length;d++){var q=k[d];if(m!==m&&q.key!==q.key||m===q.key)return{id:l,list:k,index:d,entry:q}}return{id:l,list:k,index:-1,entry:void 0}},M=function(d,m){var l=d.head_;return $jscomp.iteratorPrototype(function(){if(l){for(;l.head!=d.head_;)l=l.previous;for(;l.next!=l.head;)return l=l.next,{done:!1,value:m(l)};l=null}return{done:!0,value:void 0}})},m=function(){var d={};return d.previous=
d.next=d.head=d},v=0;return q},"es6","es3");
$jscomp.polyfill("Set",function(d){function n(){if($jscomp.ASSUME_NO_NATIVE_SET||!d||"function"!=typeof d||!d.prototype.entries||"function"!=typeof Object.seal)return!1;try{var q=Object.seal({x:4}),k=new d($jscomp.makeIterator([q]));if(!k.has(q)||1!=k.size||k.add(q)!=k||1!=k.size||k.add({x:4})!=k||2!=k.size)return!1;var n=k.entries(),m=n.next();if(m.done||m.value[0]!=q||m.value[1]!=q)return!1;m=n.next();return m.done||m.value[0]==q||4!=m.value[0].x||m.value[1]!=m.value[0]?!1:n.next().done}catch(v){return!1}}
if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(d&&$jscomp.ES6_CONFORMANCE)return d}else if(n())return d;$jscomp.initSymbol();$jscomp.initSymbolIterator();var p=function(d){this.map_=new Map;if(d){d=$jscomp.makeIterator(d);for(var k;!(k=d.next()).done;)this.add(k.value)}this.size=this.map_.size};p.prototype.add=function(d){d=0===d?0:d;this.map_.set(d,d);this.size=this.map_.size;return this};p.prototype.delete=function(d){d=this.map_.delete(d);this.size=this.map_.size;return d};p.prototype.clear=
function(){this.map_.clear();this.size=0};p.prototype.has=function(d){return this.map_.has(d)};p.prototype.entries=function(){return this.map_.entries()};p.prototype.values=function(){return this.map_.values()};p.prototype.keys=p.prototype.values;p.prototype[Symbol.iterator]=p.prototype.values;p.prototype.forEach=function(d,k){var n=this;this.map_.forEach(function(m){return d.call(k,m,m,n)})};return p},"es6","es3");$jscomp.polyfill("Number.EPSILON",function(d){return Math.pow(2,-52)},"es6","es3");
$jscomp.iteratorFromArray=function(d,n){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var p=0,q={next:function(){if(p<d.length){var k=p++;return{value:n(k,d[k]),done:!1}}q.next=function(){return{done:!0,value:void 0}};return q.next()}};q[Symbol.iterator]=function(){return q};return q};$jscomp.polyfill("Array.prototype.values",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,p){return p})}},"es8","es3");
$jscomp.polyfill("Array.prototype.entries",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(d,p){return[d,p]})}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(d){function n(){this.batch_=null}function p(d){return d instanceof k?d:new k(function(m,l){m(d)})}if(d&&!$jscomp.FORCE_POLYFILL_PROMISE)return d;n.prototype.asyncExecute=function(d){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(d);return this};n.prototype.asyncExecuteBatch_=function(){var d=this;this.asyncExecuteFunction(function(){d.executeBatch_()})};var q=$jscomp.global.setTimeout;n.prototype.asyncExecuteFunction=function(d){q(d,
0)};n.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var d=this.batch_;this.batch_=[];for(var v=0;v<d.length;++v){var l=d[v];d[v]=null;try{l()}catch(K){this.asyncThrow_(K)}}}this.batch_=null};n.prototype.asyncThrow_=function(d){this.asyncExecuteFunction(function(){throw d;})};var k=function(d){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var m=this.createResolveAndReject_();try{d(m.resolve,m.reject)}catch(l){m.reject(l)}};k.prototype.createResolveAndReject_=
function(){function d(d){return function(m){l||(l=!0,d.call(k,m))}}var k=this,l=!1;return{resolve:d(this.resolveTo_),reject:d(this.reject_)}};k.prototype.resolveTo_=function(d){if(d===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(d instanceof k)this.settleSameAsPromise_(d);else{a:switch(typeof d){case "object":var m=null!=d;break a;case "function":m=!0;break a;default:m=!1}m?this.resolveToNonPromiseObj_(d):this.fulfill_(d)}};k.prototype.resolveToNonPromiseObj_=function(d){var m=
void 0;try{m=d.then}catch(l){this.reject_(l);return}"function"==typeof m?this.settleSameAsThenable_(m,d):this.fulfill_(d)};k.prototype.reject_=function(d){this.settle_(2,d)};k.prototype.fulfill_=function(d){this.settle_(1,d)};k.prototype.settle_=function(d,k){if(0!=this.state_)throw Error("Cannot settle("+d+", "+k+"): Promise already settled in state"+this.state_);this.state_=d;this.result_=k;this.executeOnSettledCallbacks_()};k.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var d=
0;d<this.onSettledCallbacks_.length;++d)M.asyncExecute(this.onSettledCallbacks_[d]);this.onSettledCallbacks_=null}};var M=new n;k.prototype.settleSameAsPromise_=function(d){var m=this.createResolveAndReject_();d.callWhenSettled_(m.resolve,m.reject)};k.prototype.settleSameAsThenable_=function(d,k){var l=this.createResolveAndReject_();try{d.call(k,l.resolve,l.reject)}catch(K){l.reject(K)}};k.prototype.then=function(d,n){function l(d,e){return"function"==typeof d?function(e){try{m(d(e))}catch(Ba){p(Ba)}}:
e}var m,p,v=new k(function(d,e){m=d;p=e});this.callWhenSettled_(l(d,m),l(n,p));return v};k.prototype.catch=function(d){return this.then(void 0,d)};k.prototype.callWhenSettled_=function(d,k){function l(){switch(m.state_){case 1:d(m.result_);break;case 2:k(m.result_);break;default:throw Error("Unexpected state: "+m.state_);}}var m=this;null==this.onSettledCallbacks_?M.asyncExecute(l):this.onSettledCallbacks_.push(l)};k.resolve=p;k.reject=function(d){return new k(function(m,l){l(d)})};k.race=function(d){return new k(function(m,
l){for(var k=$jscomp.makeIterator(d),n=k.next();!n.done;n=k.next())p(n.value).callWhenSettled_(m,l)})};k.all=function(d){var m=$jscomp.makeIterator(d),l=m.next();return l.done?p([]):new k(function(d,k){function n(l){return function(k){q[l]=k;e--;0==e&&d(q)}}var q=[],e=0;do q.push(void 0),e++,p(l.value).callWhenSettled_(n(q.length-1),k),l=m.next();while(!l.done)})};return k},"es6","es3");
(function(d,n){"object"===typeof exports&&"undefined"!==typeof module?n(exports):"function"===typeof define&&define.amd?define(["exports"],n):n(d.YUKA={})})(this,function(d){function n(a,b){return a<b?-1:a>b?1:0}function p(a,b){return a.cost<b.cost?-1:a.cost>b.cost?1:0}function q(a,b){return a.cost<b.cost?1:a.cost>b.cost?-1:0}function k(a,b){return"string"!==typeof a||""===a?"":/^(https?:)?\/\//i.test(a)||/^data:.*,.*$/i.test(a)||/^blob:.*$/i.test(a)?a:b+a}function M(a,b){return a.cost<b.cost?-1:
a.cost>b.cost?1:0}var m=function(a,b,c,g,d){this.sender=a;this.receiver=b;this.message=c;this.delay=g;this.data=d},v=function(){};v.setLevel=function(a){l=a};v.log=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];l<=v.LEVEL.LOG&&console.log.apply(console,$jscomp.arrayFromIterable(b))};v.warn=function(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];l<=v.LEVEL.WARN&&console.warn.apply(console,$jscomp.arrayFromIterable(b))};v.error=function(a){for(var b=[],c=0;c<
arguments.length;++c)b[c-0]=arguments[c];l<=v.LEVEL.ERROR&&console.error.apply(console,$jscomp.arrayFromIterable(b))};v.LEVEL=Object.freeze({LOG:0,WARN:1,ERROR:2,SILENT:3});var l=v.LEVEL.WARN,K=function(){this.delayedTelegrams=[]};K.prototype.deliver=function(a){var b=a.receiver;!1===b.handleMessage(a)&&v.warn("YUKA.MessageDispatcher: Message not handled by receiver: %o",b)};K.prototype.dispatch=function(a,b,c,g,d){a=new m(a,b,c,g,d);0>=g?this.deliver(a):this.delayedTelegrams.push(a)};K.prototype.dispatchDelayedMessages=
function(a){for(var b=this.delayedTelegrams.length;b--;){var c=this.delayedTelegrams[b];c.delay-=a;0>=c.delay&&(this.deliver(c),this.delayedTelegrams.pop())}};K.prototype.clear=function(){this.delayedTelegrams.length=0};var W=[],I=function(){this.entities=[];this.triggers=[];this.spatialIndex=null;this._entityMap=new Map;this._indexMap=new Map;this._started=new Set;this._messageDispatcher=new K};I.prototype.add=function(a){this.entities.push(a);this._entityMap.set(a.id,a);a.manager=this;return this};
I.prototype.remove=function(a){var b=this.entities.indexOf(a);this.entities.splice(b,1);this._entityMap.delete(a.id);this._started.delete(a);a.manager=null;return this};I.prototype.addTrigger=function(a){this.triggers.push(a);return this};I.prototype.removeTrigger=function(a){a=this.triggers.indexOf(a);this.triggers.splice(a,1);return this};I.prototype.clear=function(){this.entities.length=0;this.triggers.length=0;this._entityMap.clear();this._started.clear();this._messageDispatcher.clear()};I.prototype.getEntityById=
function(a){return this._entityMap.get(a)||null};I.prototype.getEntityByName=function(a){for(var b=this.entities,c=0,g=b.length;c<g;c++){var d=b[c];if(d.name===a)return d}return null};I.prototype.update=function(a){for(var b=this.entities,c=this.triggers,g=0,d=b.length;g<d;g++)this.updateEntity(b[g],a);b=0;for(d=c.length;b<d;b++)this.updateTrigger(c[b],a);this._messageDispatcher.dispatchDelayedMessages(a)};I.prototype.updateEntity=function(a,b){if(!0===a.active){this.updateNeighborhood(a);!1===this._started.has(a)&&
(a.start(),this._started.add(a));a.update(b);a.updateWorldMatrix();b=a.children;for(var c=0,g=b.length;c<g;c++)this.updateEntity(b[c]);null!==this.spatialIndex&&(b=this._indexMap.get(a)||-1,b=this.spatialIndex.updateEntity(a,b),this._indexMap.set(a,b))}};I.prototype.updateNeighborhood=function(a){if(!0===a.updateNeighborhood){a.neighbors.length=0;null!==this.spatialIndex?this.spatialIndex.query(a.position,a.neighborhoodRadius,W):(W.length=0,W.push.apply(W,$jscomp.arrayFromIterable(this.entities)));
for(var b=a.neighborhoodRadius*a.neighborhoodRadius,c=0,g=W.length;c<g;c++){var d=W[c];a!==d&&!0===d.active&&a.position.squaredDistanceTo(d.position)<=b&&a.neighbors.push(d)}}};I.prototype.updateTrigger=function(a,b){if(!0===a.active){a.update(b);b=this.entities;for(var c=0,g=b.length;c<g;c++){var d=b[c];!0===d.active&&a.check(d)}}};I.prototype.sendMessage=function(a,b,c,g,d){this._messageDispatcher.dispatch(a,b,c,g,d)};var X={clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},randFloat:function(a,
b){return a+Math.random()*(b-a)}},e=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c};e.prototype.set=function(a,b,c){this.x=a;this.y=b;this.z=c;return this};e.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};e.prototype.clone=function(){return(new this.constructor).copy(this)};e.prototype.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};e.prototype.addScalar=function(a){this.x+=a;this.y+=a;this.z+=a;return this};e.prototype.addVectors=
function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this};e.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};e.prototype.subScalar=function(a){this.x-=a;this.y-=a;this.z-=a;return this};e.prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this};e.prototype.multiply=function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this};e.prototype.multiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};e.prototype.multiplyVectors=
function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this};e.prototype.divide=function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this};e.prototype.divideScalar=function(a){this.x/=a;this.y/=a;this.z/=a;return this};e.prototype.divideVectors=function(a,b){this.x=a.x/b.x;this.y=a.y/b.y;this.z=a.z/b.z;return this};e.prototype.clamp=function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this};
e.prototype.min=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this};e.prototype.max=function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this};e.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};e.prototype.cross=function(a){var b=this.x,c=this.y,g=this.z;this.x=c*a.z-g*a.y;this.y=g*a.x-b*a.z;this.z=b*a.y-c*a.x;return this};e.prototype.crossVectors=function(a,b){var c=a.x,g=
a.y;a=a.z;var d=b.x,f=b.y;b=b.z;this.x=g*b-a*f;this.y=a*d-c*b;this.z=c*f-g*d;return this};e.prototype.angleTo=function(a){a=this.dot(a)/Math.sqrt(this.squaredLength()*a.squaredLength());return Math.acos(X.clamp(a,-1,1))};e.prototype.length=function(){return Math.sqrt(this.squaredLength())};e.prototype.squaredLength=function(){return this.dot(this)};e.prototype.manhattanLength=function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)};e.prototype.distanceTo=function(a){return Math.sqrt(this.squaredDistanceTo(a))};
e.prototype.squaredDistanceTo=function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a};e.prototype.manhattanDistanceTo=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)};e.prototype.normalize=function(){return this.divideScalar(this.length()||1)};e.prototype.applyMatrix4=function(a){var b=this.x,c=this.y,g=this.z;a=a.elements;var d=1/(a[3]*b+a[7]*c+a[11]*g+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*g+a[12])*d;this.y=(a[1]*b+a[5]*c+a[9]*g+a[13])*d;this.z=(a[2]*
b+a[6]*c+a[10]*g+a[14])*d;return this};e.prototype.applyRotation=function(a){var b=this.x,c=this.y,g=this.z,d=a.x,f=a.y,h=a.z;a=a.w;var u=a*b+f*g-h*c,e=a*c+h*b-d*g,L=a*g+d*c-f*b;b=-d*b-f*c-h*g;this.x=u*a+b*-d+e*-h-L*-f;this.y=e*a+b*-f+L*-d-u*-h;this.z=L*a+b*-h+u*-f-e*-d;return this};e.prototype.fromMatrix3Column=function(a,b){return this.fromArray(a.elements,3*b)};e.prototype.fromMatrix4Column=function(a,b){return this.fromArray(a.elements,4*b)};e.prototype.fromSpherical=function(a,b,c){var g=Math.sin(b)*
a;this.x=g*Math.sin(c);this.y=Math.cos(b)*a;this.z=g*Math.cos(c);return this};e.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];return this};e.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a};e.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z};var Va=new e(0,1,0),Ba=new e,ma=new e,tb=new e,ub=new e,C=function(){this.elements=[1,0,0,0,1,0,0,0,1]};C.prototype.set=function(a,b,
c,g,d,f,h,u,e){var t=this.elements;t[0]=a;t[3]=b;t[6]=c;t[1]=g;t[4]=d;t[7]=f;t[2]=h;t[5]=u;t[8]=e;return this};C.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this};C.prototype.clone=function(){return(new this.constructor).copy(this)};C.prototype.identity=function(){this.set(1,0,0,0,1,0,0,0,1);return this};C.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};C.prototype.premultiply=
function(a){return this.multiplyMatrices(a,this)};C.prototype.multiplyMatrices=function(a,b){var c=a.elements,g=b.elements;b=this.elements;a=c[0];var d=c[3],f=c[6],h=c[1],u=c[4],e=c[7],L=c[2],l=c[5];c=c[8];var k=g[0],m=g[3],n=g[6],p=g[1],q=g[4],y=g[7],v=g[2],r=g[5];g=g[8];b[0]=a*k+d*p+f*v;b[3]=a*m+d*q+f*r;b[6]=a*n+d*y+f*g;b[1]=h*k+u*p+e*v;b[4]=h*m+u*q+e*r;b[7]=h*n+u*y+e*g;b[2]=L*k+l*p+c*v;b[5]=L*m+l*q+c*r;b[8]=L*n+l*y+c*g;return this};C.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=
a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this};C.prototype.extractBasis=function(a,b,c){a.fromMatrix3Column(this,0);b.fromMatrix3Column(this,1);c.fromMatrix3Column(this,2);return this};C.prototype.makeBasis=function(a,b,c){this.set(a.x,b.x,c.x,a.y,b.y,c.y,a.z,b.z,c.z);return this};C.prototype.lookAt=function(a,b,c){Ba.crossVectors(c,a).normalize();ma.crossVectors(Va,b).normalize();0===ma.squaredLength()&&(ub.copy(b).addScalar(Number.EPSILON),ma.crossVectors(Va,ub).normalize());
tb.crossVectors(b,ma).normalize();vb.makeBasis(ma,tb,b);wb.makeBasis(Ba,c,a);this.multiplyMatrices(vb,wb.transpose())};C.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this};C.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,g=a.y,d=a.z,f=a.w,h=c+c,u=g+g,e=d+d;a=c*h;var L=c*u;c*=e;var l=g*u;g*=e;d*=e;h*=f;u*=f;f*=e;b[0]=1-(l+d);b[3]=L-f;b[6]=c+u;b[1]=L+f;b[4]=1-(a+d);b[7]=g-h;b[2]=c-u;b[5]=g+h;b[8]=
1-(a+l);return this};C.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,g=0;9>g;g++)c[g]=a[g+b];return this};C.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=this.elements;a[b+0]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a};C.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var c=0;9>c;c++)if(b[c]!==a[c])return!1;return!0};var vb=new C,wb=new C,xb=new C,A=function(a,b,c,g){this.x=void 0===
a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c;this.w=void 0===g?1:g};A.prototype.set=function(a,b,c,g){this.x=a;this.y=b;this.z=c;this.w=g;return this};A.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};A.prototype.clone=function(){return(new this.constructor).copy(this)};A.prototype.inverse=function(){return this.conjugate().normalize()};A.prototype.conjugate=function(){this.x*=-1;this.y*=-1;this.z*=-1;return this};A.prototype.dot=function(a){return this.x*
a.x+this.y*a.y+this.z*a.z+this.w*a.w};A.prototype.length=function(){return Math.sqrt(this.squaredLength())};A.prototype.squaredLength=function(){return this.dot(this)};A.prototype.normalize=function(){var a=this.length();0===a?(this.z=this.y=this.x=0,this.w=1):(a=1/a,this.x*=a,this.y*=a,this.z*=a,this.w*=a);return this};A.prototype.multiply=function(a){return this.multiplyQuaternions(this,a)};A.prototype.premultiply=function(a){return this.multiplyQuaternions(a,this)};A.prototype.multiplyQuaternions=
function(a,b){var c=a.x,g=a.y,d=a.z;a=a.w;var f=b.x,h=b.y,u=b.z;b=b.w;this.x=c*b+a*f+g*u-d*h;this.y=g*b+a*h+d*f-c*u;this.z=d*b+a*u+c*h-g*f;this.w=a*b-c*f-g*h-d*u;return this};A.prototype.angleTo=function(a){return 2*Math.acos(Math.abs(X.clamp(this.dot(a),-1,1)))};A.prototype.rotateTo=function(a,b){var c=this.angleTo(a);if(0===c)return this;this.slerp(a,Math.min(1,b/c));return this};A.prototype.lookAt=function(a,b,c){xb.lookAt(a,b,c);this.fromMatrix3(xb)};A.prototype.slerp=function(a,b){if(0===b)return this;
if(1===b)return this.copy(a);var c=this.x,g=this.y,d=this.z,f=this.w,h=f*a.w+c*a.x+g*a.y+d*a.z;0>h?(this.w=-a.w,this.x=-a.x,this.y=-a.y,this.z=-a.z,h=-h):this.copy(a);if(1<=h)return this.w=f,this.x=c,this.y=g,this.z=d,this;a=Math.sqrt(1-h*h);if(.001>Math.abs(a))return this.w=.5*(f+this.w),this.x=.5*(c+this.x),this.y=.5*(g+this.y),this.z=.5*(d+this.z),this;var u=Math.atan2(a,h);h=Math.sin((1-b)*u)/a;b=Math.sin(b*u)/a;this.w=f*h+this.w*b;this.x=c*h+this.x*b;this.y=g*h+this.y*b;this.z=d*h+this.z*b;return this};
A.prototype.fromEuler=function(a,b,c){var g=Math.cos(a/2),d=Math.cos(b/2),f=Math.cos(c/2);a=Math.sin(a/2);b=Math.sin(b/2);c=Math.sin(c/2);this.x=a*d*f+g*b*c;this.y=g*b*f-a*d*c;this.z=g*d*c+a*b*f;this.w=g*d*f-a*b*c;return this};A.prototype.fromMatrix3=function(a){var b=a.elements,c=b[0];a=b[3];var g=b[6],d=b[1],f=b[4],h=b[7],u=b[2],e=b[5];b=b[8];var L=c+f+b;0<L?(c=.5/Math.sqrt(L+1),this.w=.25/c,this.x=(e-h)*c,this.y=(g-u)*c,this.z=(d-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this.w=(e-h)/c,this.x=.25*
c,this.y=(a+d)/c,this.z=(g+u)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this.w=(g-u)/c,this.x=(a+d)/c,this.y=.25*c,this.z=(h+e)/c):(c=2*Math.sqrt(1+b-c-f),this.w=(d-a)/c,this.x=(g+u)/c,this.y=(h+e)/c,this.z=.25*c);return this};A.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this};A.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a};A.prototype.equals=function(a){return a.x===this.x&&
a.y===this.y&&a.z===this.z&&a.w===this.w};var B=function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};B.prototype.set=function(a,b,c,g,d,f,h,u,e,L,l,k,m,n,p,q){var t=this.elements;t[0]=a;t[4]=b;t[8]=c;t[12]=g;t[1]=d;t[5]=f;t[9]=h;t[13]=u;t[2]=e;t[6]=L;t[10]=l;t[14]=k;t[3]=m;t[7]=n;t[11]=p;t[15]=q;return this};B.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];
b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return this};B.prototype.clone=function(){return(new this.constructor).copy(this)};B.prototype.identity=function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};B.prototype.extractBasis=function(a,b,c){a.fromMatrix4Column(this,0);b.fromMatrix4Column(this,1);c.fromMatrix4Column(this,2);return this};B.prototype.makeBasis=function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this};B.prototype.multiply=function(a){return this.multiplyMatrices(this,
a)};B.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};B.prototype.multiplyMatrices=function(a,b){var c=a.elements,g=b.elements;b=this.elements;a=c[0];var d=c[4],f=c[8],h=c[12],u=c[1],e=c[5],L=c[9],l=c[13],k=c[2],m=c[6],n=c[10],p=c[14],q=c[3],y=c[7],v=c[11];c=c[15];var r=g[0],w=g[4],x=g[8],z=g[12],A=g[1],B=g[5],C=g[9],D=g[13],E=g[2],F=g[6],G=g[10],H=g[14],I=g[3],J=g[7],K=g[11];g=g[15];b[0]=a*r+d*A+f*E+h*I;b[4]=a*w+d*B+f*F+h*J;b[8]=a*x+d*C+f*G+h*K;b[12]=a*z+d*D+f*H+h*g;b[1]=
u*r+e*A+L*E+l*I;b[5]=u*w+e*B+L*F+l*J;b[9]=u*x+e*C+L*G+l*K;b[13]=u*z+e*D+L*H+l*g;b[2]=k*r+m*A+n*E+p*I;b[6]=k*w+m*B+n*F+p*J;b[10]=k*x+m*C+n*G+p*K;b[14]=k*z+m*D+n*H+p*g;b[3]=q*r+y*A+v*E+c*I;b[7]=q*w+y*B+v*F+c*J;b[11]=q*x+y*C+v*G+c*K;b[15]=q*z+y*D+v*H+c*g;return this};B.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this};B.prototype.compose=function(a,
b,c){this.fromQuaternion(b);this.scale(c);this.setPosition(a);return this};B.prototype.scale=function(a){var b=this.elements,c=a.x,g=a.y;a=a.z;b[0]*=c;b[4]*=g;b[8]*=a;b[1]*=c;b[5]*=g;b[9]*=a;b[2]*=c;b[6]*=g;b[10]*=a;b[3]*=c;b[7]*=g;b[11]*=a;return this};B.prototype.setPosition=function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this};B.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=
b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this};B.prototype.getInverse=function(a){var b=this.elements,c=a.elements;a=c[0];var g=c[1],d=c[2],f=c[3],h=c[4],u=c[5],e=c[6],l=c[7],k=c[8],m=c[9],n=c[10],p=c[11],q=c[12],r=c[13],y=c[14];c=c[15];var w=m*y*l-r*n*l+r*e*p-u*y*p-m*e*c+u*n*c,x=q*n*l-k*y*l-q*e*p+h*y*p+k*e*c-h*n*c,A=k*r*l-q*m*l+q*u*p-h*r*p-k*u*c+h*m*c,B=q*m*e-k*r*e-q*u*n+h*r*n+k*u*y-h*m*y,z=a*w+g*x+d*A+f*B;if(0===z)return v.warn("YUKA.Matrix4: .getInverse() can not invert matrix, determinant is 0."),
this.identity();z=1/z;b[0]=w*z;b[1]=(r*n*f-m*y*f-r*d*p+g*y*p+m*d*c-g*n*c)*z;b[2]=(u*y*f-r*e*f+r*d*l-g*y*l-u*d*c+g*e*c)*z;b[3]=(m*e*f-u*n*f-m*d*l+g*n*l+u*d*p-g*e*p)*z;b[4]=x*z;b[5]=(k*y*f-q*n*f+q*d*p-a*y*p-k*d*c+a*n*c)*z;b[6]=(q*e*f-h*y*f-q*d*l+a*y*l+h*d*c-a*e*c)*z;b[7]=(h*n*f-k*e*f+k*d*l-a*n*l-h*d*p+a*e*p)*z;b[8]=A*z;b[9]=(q*m*f-k*r*f-q*g*p+a*r*p+k*g*c-a*m*c)*z;b[10]=(h*r*f-q*u*f+q*g*l-a*r*l-h*g*c+a*u*c)*z;b[11]=(k*u*f-h*m*f-k*g*l+a*m*l+h*g*p-a*u*p)*z;b[12]=B*z;b[13]=(k*r*d-q*m*d+q*g*n-a*r*n-k*g*
y+a*m*y)*z;b[14]=(q*u*d-h*r*d-q*g*e+a*r*e+h*g*y-a*u*y)*z;b[15]=(h*m*d-k*u*d+k*g*e-a*m*e-h*g*n+a*u*n)*z;return this};B.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,g=a.y,d=a.z,f=a.w,h=c+c,e=g+g,l=d+d;a=c*h;var k=c*e;c*=l;var m=g*e;g*=l;d*=l;h*=f;e*=f;f*=l;b[0]=1-(m+d);b[4]=k-f;b[8]=c+e;b[1]=k+f;b[5]=1-(a+d);b[9]=g-h;b[2]=c-e;b[6]=g+h;b[10]=1-(a+m);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this};B.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,
g=0;16>g;g++)c[g]=a[g+b];return this};B.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=this.elements;a[b+0]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a};B.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0};var Zb=0,yb=new A,Ca=new e,G=function(){this.id=Zb++;this.name=
"";this.active=!0;this.cache={position:new e,rotation:new A,scale:new e};this.children=[];this.parent=null;this.neighbors=[];this.neighborhoodRadius=1;this.updateNeighborhood=!1;this.position=new e;this.rotation=new A;this.scale=new e(1,1,1);this.forward=new e(0,0,1);this.up=new e(0,1,0);this.boundingRadius=0;this.maxTurnRate=Math.PI;this.matrix=new B;this.worldMatrix=new B;this.manager=null};G.prototype.start=function(){};G.prototype.update=function(){};G.prototype.add=function(a){null!==a.parent&&
a.parent.remove(a);this.children.push(a);a.parent=this;return this};G.prototype.remove=function(a){var b=this.children.indexOf(a);this.children.splice(b,1);a.parent=null;return this};G.prototype.getDirection=function(a){return a.copy(this.forward).applyRotation(this.rotation).normalize()};G.prototype.lookAt=function(a){Ca.subVectors(a,this.position).normalize();this.rotation.lookAt(this.forward,Ca,this.up);return this};G.prototype.rotateTo=function(a,b){Ca.subVectors(a,this.position).normalize();
yb.lookAt(this.forward,Ca,this.up);this.rotation.rotateTo(yb,this.maxTurnRate*b);return this};G.prototype.updateMatrix=function(){var a=this.cache;a.position.equals(this.position)&&a.rotation.equals(this.rotation)&&a.scale.equals(this.scale)||(this.matrix.compose(this.position,this.rotation,this.scale),a.position.copy(this.position),a.rotation.copy(this.rotation),a.scale.copy(this.scale))};G.prototype.updateWorldMatrix=function(a,b){b=void 0===b?!1:b;var c=this.parent,g=this.children;!0===(void 0===
a?!1:a)&&null!==c&&c.updateWorldMatrix(!0);this.updateMatrix();null===c?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiplyMatrices(this.parent.worldMatrix,this.matrix);if(!0===b)for(a=0,b=g.length;a<b;a++)g[a].updateWorldMatrix(!1,!0)};G.prototype.handleMessage=function(){return!1};G.prototype.sendMessage=function(a,b,c,g){null!==this.manager?this.manager.sendMessage(this,a,b,void 0===c?0:c,void 0===g?null:g):v.error("YUKA.GameEntity: The game entity must be added to a manager in order to send a message.")};
var zb=new e,Wa=new e,Y=function(){var a=G.call(this)||this;a.velocity=new e;a.maxSpeed=1;a.updateOrientation=!0;return a};$jscomp.inherits(Y,G);Y.prototype.update=function(a){this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));zb.copy(this.velocity).multiplyScalar(a);Wa.copy(this.position).add(zb);this.updateOrientation&&1e-8<this.getSpeedSquared()&&this.lookAt(Wa);this.position.copy(Wa)};Y.prototype.getSpeed=function(){return this.velocity.length()};
Y.prototype.getSpeedSquared=function(){return this.velocity.squaredLength()};var fa=function(){this.currentTime=this.previousTime=this.startTime=0};fa.prototype.getDelta=function(){return(this.currentTime-this.previousTime)/1E3};fa.prototype.getElapsed=function(){return(this.currentTime-this.startTime)/1E3};fa.prototype.update=function(){this.previousTime=this.currentTime;this.currentTime=this.now();return this};fa.prototype.now=function(){return("undefined"===typeof performance?Date:performance).now()};
var Ab=function(a){this.updateFrequency=void 0===a?0:a;this._time=new fa;this._nextUpdateTime=0};Ab.prototype.ready=function(){this._time.update();return this._time.currentTime>=this._nextUpdateTime?(this._nextUpdateTime=this._time.currentTime+1E3/this.updateFrequency,!0):!1};var ha=function(){};ha.prototype.enter=function(){};ha.prototype.execute=function(){};ha.prototype.exit=function(){};ha.prototype.onMessage=function(){return!1};var N=function(a){this.owner=a;this.globalState=this.previousState=
this.currentState=null;this.states=new Map};N.prototype.update=function(){null!==this.globalState&&this.globalState.execute(this.owner);null!==this.currentState&&this.currentState.execute(this.owner)};N.prototype.add=function(a,b){b instanceof ha?this.states.set(a,b):v.warn('YUKA.StateMachine: .add() needs a parameter of type "YUKA.State".')};N.prototype.remove=function(a){this.states.delete(a)};N.prototype.get=function(a){return this.states.get(a)};N.prototype.changeTo=function(a){a=this.get(a);
this._change(a)};N.prototype.revert=function(){this._change(this.previousState)};N.prototype.in=function(a){return this.get(a)===this.currentState};N.prototype.handleMessage=function(a){return null!==this.currentState&&!0===this.currentState.onMessage(this.owner,a)||null!==this.globalState&&!0===this.globalState.onMessage(this.owner,a)?!0:!1};N.prototype._change=function(a){this.previousState=this.currentState;this.currentState.exit(this.owner);this.currentState=a;this.currentState.enter(this.owner)};
var w=function(a){this.owner=void 0===a?null:a;this.status=w.STATUS.INACTIVE};w.prototype.addSubgoal=function(){v.warn("YUKA.Goal: Unable to add goal to atomic goals.")};w.prototype.activate=function(){};w.prototype.execute=function(){};w.prototype.terminate=function(){};w.prototype.handleMessage=function(){return!1};w.prototype.active=function(){return this.status===w.STATUS.ACTIVE};w.prototype.inactive=function(){return this.status===w.STATUS.INACTIVE};w.prototype.completed=function(){return this.status===
w.STATUS.COMPLETED};w.prototype.failed=function(){return this.status===w.STATUS.FAILED};w.prototype.replanIfFailed=function(){!0===this.failed()&&(this.status=w.STATUS.INACTIVE);return this};w.prototype.activateIfInactive=function(){!0===this.inactive()&&(this.activate(),this.status=w.STATUS.ACTIVE);return this};w.STATUS=Object.freeze({ACTIVE:"active",INACTIVE:"inactive",COMPLETED:"completed",FAILED:"failed"});var O=function(a){a=w.call(this,void 0===a?null:a)||this;a.subgoals=[];return a};$jscomp.inherits(O,
w);O.prototype.addSubgoal=function(a){this.subgoals.push(a);return this};O.prototype.clearSubgoals=function(){for(var a=this.subgoals,b=0,c=a.length;b<c;b++)a[b].terminate();a.length=0;return this};O.prototype.currentSubgoal=function(){var a=this.subgoals.length;return 0<a?this.subgoals[a-1]:null};O.prototype.executeSubgoals=function(){for(var a=this.subgoals,b=a.length-1;0<=b;b--){var c=a[b];if(!0===c.completed()||!0===c.failed())c.terminate(),a.pop();else break}b=this.currentSubgoal();return null!==
b?(b.activateIfInactive(),b.execute(),!0===b.completed()&&1<a.length?w.STATUS.ACTIVE:b.status):w.STATUS.COMPLETED};O.prototype.hasSubgoals=function(){return 0<this.subgoals.length};O.prototype.handleMessage=function(a){var b=this.currentSubgoal();return null!==b?b.handleMessage(a):!1};var Xa=function(a){this.characterBias=void 0===a?1:a};Xa.prototype.calculateDesirability=function(){return 0};Xa.prototype.setGoal=function(){};var T=function(a){a=O.call(this,void 0===a?null:a)||this;a.evaluators=[];
return a};$jscomp.inherits(T,O);T.prototype.activate=function(){this.arbitrate()};T.prototype.execute=function(){this.activateIfInactive();var a=this.executeSubgoals();if(a===w.STATUS.COMPLETED||a===w.STATUS.FAILED)this.status=w.STATUS.INACTIVE};T.prototype.terminate=function(){this.clearSubgoals()};T.prototype.addEvaluator=function(a){this.evaluators.push(a);return this};T.prototype.removeEvaluator=function(a){a=this.evaluators.indexOf(a);this.evaluators.splice(a,1);return this};T.prototype.arbitrate=
function(){for(var a=this.evaluators,b=-1,c=null,g=0,d=a.length;g<d;g++){var f=a[g],h=f.calculateDesirability(this.owner);h*=f.characterBias;h>=b&&(b=h,c=f)}null!==c?c.setGoal(this.owner):v.error("YUKA.Think: Unable to determine goal evaluator for game entity:",this.owner);return this};var Z=function(a,b,c){this.from=void 0===a?-1:a;this.to=void 0===b?-1:b;this.cost=void 0===c?0:c};Z.prototype.copy=function(a){this.from=a.from;this.to=a.to;this.cost=a.cost;return this};Z.prototype.clone=function(){return(new this.constructor).copy(this)};
var Ya=function(a){this.index=void 0===a?-1:a},E=function(){this.digraph=!1;this._nodes=new Map;this._edges=new Map};E.prototype.addNode=function(a){var b=a.index;this._nodes.set(b,a);this._edges.set(b,[]);return this};E.prototype.addEdge=function(a){var b=this._edges.get(a.from);b.push(a);if(!1===this.digraph){var c=a.clone();c.from=a.to;c.to=a.from;b=this._edges.get(a.to);b.push(c)}return this};E.prototype.getNode=function(a){return this._nodes.get(a)||null};E.prototype.getEdge=function(a,b){if(this.hasNode(a)&&
this.hasNode(b)){a=this._edges.get(a);for(var c=0,g=a.length;c<g;c++){var d=a[c];if(d.to===b)return d}}return null};E.prototype.getNodes=function(a){a.length=0;a.push.apply(a,$jscomp.arrayFromIterable(this._nodes.values()));return this};E.prototype.getEdgesOfNode=function(a,b){a=this._edges.get(a);void 0!==a&&(b.length=0,b.push.apply(b,$jscomp.arrayFromIterable(a)));return this};E.prototype.getNodeCount=function(){return this._nodes.size};E.prototype.getEdgeCount=function(){for(var a=0,b=$jscomp.makeIterator(this._edges.values()),
c=b.next();!c.done;c=b.next())a+=c.value.length;return a};E.prototype.removeNode=function(a){this._nodes.delete(a.index);if(!1===this.digraph){var b=this._edges.get(a.index);b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next()){c=this._edges.get(c.value.to);for(var g=c.length-1;0<=g;g--){var d=c[g];if(d.to===a.index){g=c.indexOf(d);c.splice(g,1);break}}}}else for(b=$jscomp.makeIterator(this._edges.values()),c=b.next();!c.done;c=b.next())for(c=c.value,g=c.length-1;0<=g;g--)d=c[g],this.hasNode(d.to)&&
this.hasNode(d.from)||(d=c.indexOf(d),c.splice(d,1));this._edges.delete(a.index);return this};E.prototype.removeEdge=function(a){var b=this._edges.get(a.from);if(void 0!==b){var c=b.indexOf(a);b.splice(c,1);if(!1===this.digraph){b=this._edges.get(a.to);c=0;for(var g=b.length;c<g;c++){var d=b[c];if(d.to===a.from){a=b.indexOf(d);b.splice(a,1);break}}}}return this};E.prototype.hasNode=function(a){return this._nodes.has(a)};E.prototype.hasEdge=function(a,b){if(this.hasNode(a)&&this.hasNode(b)){a=this._edges.get(a);
for(var c=0,g=a.length;c<g;c++)if(a[c].to===b)return!0}return!1};E.prototype.clear=function(){this._nodes.clear();this._edges.clear();return this};var Da=function(a,b,c){a=void 0===a?-1:a;b=void 0===b?new e:b;c=void 0===c?{}:c;a=Ya.call(this,a)||this;a.position=b;a.userData=c;return a};$jscomp.inherits(Da,Ya);var Ea=function(a,b,c){return Z.call(this,void 0===a?-1:a,void 0===b?-1:b,void 0===c?0:c)||this};$jscomp.inherits(Ea,Z);var Bb=function(){};Bb.createGridLayout=function(a,b){var c=new E;c.digraph=
!0;var g=a/2;a/=b;for(var d=0,f=0;f<=b;f++)for(var h=f*a-g,u=0;u<=b;u++){var l=new e(u*a-g,0,h);l=new Da(d,l);c.addNode(l);d++}b=c.getNodeCount();g=Math.pow(a+a/2,2);for(a=0;a<b;a++)for(d=c.getNode(a),f=0;f<b;f++)a!==f&&(h=c.getNode(f).position.squaredDistanceTo(d.position),h<=g&&(h=new Ea(a,f,Math.sqrt(h)),c.addEdge(h)));return c};var Za=function(){};Za.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.distanceTo(a.position)};var Cb=function(){};Cb.calculate=function(a,b,
c){b=a.getNode(b);a=a.getNode(c);return b.position.squaredDistanceTo(a.position)};var Db=function(){};Db.calculate=function(a,b,c){b=a.getNode(b);a=a.getNode(c);return b.position.manhattanDistanceTo(a.position)};var Eb=function(){};Eb.calculate=function(){return 0};var U=function(a){a=void 0===a?n:a;this.data=[];this.length=0;this.compare=a};U.prototype.push=function(a){this.data.push(a);this.length++;this._up(this.length-1)};U.prototype.pop=function(){if(0===this.length)return null;var a=this.data[0];
this.length--;0<this.length&&(this.data[0]=this.data[this.length],this._down(0));this.data.pop();return a};U.prototype.peek=function(){return this.data[0]||null};U.prototype._up=function(a){for(var b=this.data,c=this.compare,d=b[a];0<a;){var t=a-1>>1,f=b[t];if(0<=c(d,f))break;b[a]=f;a=t}b[a]=d};U.prototype._down=function(a){for(var b=this.data,c=this.compare,d=b[a],t=this.length>>1;a<t;){var f=(a<<1)+1,h=f+1,e=b[f];h<this.length&&0>c(b[h],e)&&(f=h,e=b[h]);if(0<=c(e,d))break;b[a]=e;a=f}b[a]=d};var ia=
function(a){this.vertex=a=void 0===a?new e:a;this.polygon=this.twin=this.prev=this.next=null;this.nodeIndex=-1};ia.prototype.from=function(){return this.vertex};ia.prototype.to=function(){return this.next?this.next.vertex:null};ia.prototype.length=function(){var a=this.from(),b=this.to();return null!==b?a.distanceTo(b):-1};ia.prototype.squaredLength=function(){var a=this.from(),b=this.to();return null!==b?a.squaredDistanceTo(b):-1};var ja=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===
b?-1:b;this.target=void 0===c?-1:c;this.heuristic=Za;this.found=!1;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};ja.prototype.search=function(){var a=[],b=new U(p);for(b.push({cost:0,index:this.source});0<b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,a);for(var d=0,t=a.length;d<t;d++){var f=
a[d],h=(this._cost.get(c)||0)+f.cost,e=this.heuristic.calculate(this.graph,f.to,this.target);e=h+e;if(!1===this._searchFrontier.has(f.to)||h<this._cost.get(f.to))this._cost.set(f.to,h),this._searchFrontier.set(f.to,f),b.push({cost:e,index:f.to})}}}this.found=!1;return this};ja.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,a.unshift(b);return a};ja.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};
ja.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear()};var Fb=new e,Fa=new e,P=function(a,b){a=void 0===a?new e:a;b=void 0===b?new e:b;this.from=a;this.to=b};P.prototype.set=function(a,b){this.from=a;this.to=b;return this};P.prototype.copy=function(a){this.from.copy(a.from);this.to.copy(a.to);return this};P.prototype.clone=function(){return(new this.constructor).copy(this)};P.prototype.delta=function(a){return a.subVectors(this.to,
this.from)};P.prototype.at=function(a,b){return this.delta(b).multiplyScalar(a).add(this.from)};P.prototype.closestPointToPoint=function(a,b,c){a=this.closestPointToPointParameter(a,b);return this.at(a,c)};P.prototype.closestPointToPointParameter=function(a,b){b=void 0===b?!0:b;Fb.subVectors(a,this.from);Fa.subVectors(this.to,this.from);a=Fa.dot(Fa);a=Fa.dot(Fb)/a;b&&(a=X.clamp(a,0,1));return a};P.prototype.equals=function(a){return a.from.equals(this.from)&&a.to.equals(this.to)};var $a=new e,Gb=
new e,ab=new e,bb=new e,na=new e,oa=new P,H=function(){this.graph=new E;this.graph.digraph=!0;this.regions=[];this.spatialIndex=null;this.epsilonCoplanarTest=.001;this.epsilonContainsTest=1};H.prototype.fromPolygons=function(a){this.clear();for(var b=[],c=[],d=0,t=a.length;d<t;d++){var f=a[d],h=f.edge;do b.push(h),h=h.next;while(h!==f.edge);this.regions.push(f)}a=0;for(d=b.length;a<d;a++)if(t=b[a],null===t.twin)for(f=a+1,h=b.length;f<h;f++){var e=b[f];if(t.from().equals(e.to())&&t.to().equals(e.from())){t.twin=
e;e.twin=t;f=t.squaredLength();c.push({cost:f,edge:t});break}}c.sort(q);this._buildRegions(c);this._buildNodeIndices();this._buildGraph();return this};H.prototype.clear=function(){this.graph.clear();this.regions.length=0;this.spatialIndex=null;return this};H.prototype.getClosestNodeIndex=function(a){var b=null,c=Infinity,d=[];this.graph.getNodes(d);for(var t=0,f=d.length;t<f;t++){var h=d[t],e=a.squaredDistanceTo(h.position);e<c&&(c=e,b=h.index)}return b};H.prototype.getClosestNodeIndexInRegion=function(a,
b,c){var d=null,t=Infinity,f=b.edge;do{if(f.twin||f.prev.twin){var h=a.squaredDistanceTo(f.from());c&&(h+=c.squaredDistanceTo(f.from()));h<t&&(t=h,d=f.twin?f.nodeIndex:f.prev.twin.nodeIndex)}f=f.next}while(f!==b.edge);return d};H.prototype.getClosestRegion=function(a){for(var b=this.regions,c=null,d=Infinity,t=0,f=b.length;t<f;t++){var h=b[t],e=a.squaredDistanceTo(h.centroid);e<d&&(d=e,c=h)}return c};H.prototype.getRegionForPoint=function(a,b){b=void 0===b?.001:b;if(null!==this.spatialIndex){var c=
this.spatialIndex.getIndexForPosition(a);c=this.spatialIndex.cells[c].entries}else c=this.regions;for(var d=0,t=c.length;d<t;d++){var f=c[d];if(!0===f.contains(a,b))return f}return null};H.prototype.findPath=function(a,b){var c=this.graph,d=[],t=this.getRegionForPoint(a,this.epsilonContainsTest),f=this.getRegionForPoint(b,this.epsilonContainsTest);if(null===t||null===f)null===t&&(t=this.getClosestRegion(a)),null===f&&(f=this.getClosestRegion(b));if(t===f)d.push((new e).copy(a)),d.push((new e).copy(b));
else{var h=this.getClosestNodeIndexInRegion(a,t,b),u=this.getClosestNodeIndexInRegion(b,f,a);h=new ja(c,h,u);h.search();if(!0===h.found){h=h.getPath();var l=h.length,k=0;for(u=h.length;k<u;k++){var m=c.getNode(h[k]);if(!1===t.contains(m.position)){l=k;break}}h.splice(0,l-1);h.reverse();l=h.length;t=0;for(u=h.length;t<u;t++)if(k=c.getNode(h[t]),!1===f.contains(k.position)){l=t;break}h.splice(0,l-1);h.reverse();d.push((new e).copy(a));a=0;for(u=h.length;a<u;a++)f=c.getNode(h[a]),d.push((new e).copy(f.position));
d.push((new e).copy(b))}}return d};H.prototype.clampMovement=function(a,b,c,d){var g=this.getRegionForPoint(c,this.epsilonContainsTest);if(null===g){if(null===a)throw Error("YUKA.NavMesh.clampMovement(): No current region available.");g=null;var f=Infinity,h=a.edge;do{if(null===h.twin){oa.set(h.vertex,h.next.vertex);var e=oa.closestPointToPointParameter(b);oa.at(e,$a);e=$a.squaredDistanceTo(b);e<f&&(f=e,g=h,Gb.copy($a))}h=h.next}while(h!==a.edge);ab.subVectors(g.next.vertex,g.vertex).normalize();
c=bb.subVectors(c,b).length();bb.divideScalar(c);f=ab.dot(bb);na.copy(Gb).add(ab.multiplyScalar(f*c));oa.set(g.vertex,g.next.vertex);g=oa.closestPointToPointParameter(na,!1);if(0<=g&&1>=g)d.copy(na);else{g=this.getRegionForPoint(na,this.epsilonContainsTest);if(null!==g)return d.copy(na),g;d.copy(b)}return a}return g};H.prototype.updateSpatialIndex=function(){if(null!==this.spatialIndex){this.spatialIndex.makeEmpty();for(var a=this.regions,b=0,c=a.length;b<c;b++)this.spatialIndex.addPolygon(a[b])}return this};
H.prototype._buildRegions=function(a){for(var b=this.regions,c,d,t,f,h=0,e=a.length;h<e;h++){var l=a[h],k=l.edge;c=k.prev;d=k.next;t=k.twin.prev;f=k.twin.next;k.prev.next=k.twin.next;k.next.prev=k.twin.prev;k.twin.prev.next=k.next;k.twin.next.prev=k.prev;var m=k.polygon;m.edge=k.prev;if(!0===m.convex()&&!0===m.coplanar(this.epsilonCoplanarTest)){c=m.edge;do c.polygon=m,c=c.next;while(c!==m.edge);l=b.indexOf(l.edge.twin.polygon);b.splice(l,1)}else c.next=k,d.prev=k,t.next=k.twin,f.prev=k.twin,m.edge=
k}a=0;for(e=b.length;a<e;a++)b[a].computeCentroid()};H.prototype._buildNodeIndices=function(){for(var a=this.regions,b=new Map,c=0,d=0,t=a.length;d<t;d++){var f=a[d],h=f.edge;do{if(null!==h.twin){for(var e=-1,k=h.from(),l=$jscomp.makeIterator(b.entries()),m=l.next();!m.done;m=l.next()){var n=$jscomp.makeIterator(m.value);m=n.next().value;n=n.next().value;if(!0===k.equals(n)){e=m;break}}-1===e&&(e=c++,b.set(e,k));h.nodeIndex=e;h.twin.next.nodeIndex=e}h=h.next}while(h!==f.edge)}};H.prototype._buildGraph=
function(){for(var a=this.graph,b=this.regions,c=new Set,d=0,t=b.length;d<t;d++){var f=b[d],h=[];c.add(h);var e=f.edge;do null!==e.twin&&(h.push(e.nodeIndex,e.twin.nodeIndex),!1===a.hasNode(e.nodeIndex)&&a.addNode(new Da(e.nodeIndex,e.from()))),e=e.next;while(e!==f.edge)}b=$jscomp.makeIterator(c);for(c=b.next();!c.done;c=b.next())for(c=c.value,d=$jscomp.makeIterator(c),t=d.next();!t.done;t=d.next())for(t=t.value,f=$jscomp.makeIterator(c),h=f.next();!h.done;h=f.next())if(h=h.value,t!==h&&!1===a.hasEdge(t,
h)){e=a.getNode(t);var k=a.getNode(h);e=e.position.distanceTo(k.position);a.addEdge(new Ea(t,h,e))}return this};var Hb=new e,$b=new e,R=function(a,b){this.normal=a=void 0===a?new e(0,0,1):a;this.constant=void 0===b?0:b};R.prototype.set=function(a,b){this.normal=a;this.constant=b;return this};R.prototype.copy=function(a){this.normal.copy(a.normal);this.constant=a.constant;return this};R.prototype.clone=function(){return(new this.constructor).copy(this)};R.prototype.distanceToPoint=function(a){return this.normal.dot(a)+
this.constant};R.prototype.fromNormalAndCoplanarPoint=function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this};R.prototype.fromCoplanarPoints=function(a,b,c){Hb.subVectors(c,b).cross($b.subVectors(a,b)).normalize();this.fromNormalAndCoplanarPoint(Hb,a);return this};R.prototype.equals=function(a){return a.normal.equals(this.normal)&&a.constant===this.constant};var S=function(){this.centroid=new e;this.edge=null;this.plane=new R};S.prototype.fromContour=function(a){var b=[];
if(3>a.length)return v.error("YUKA.Polygon: Unable to create polygon from contour. It needs at least three points."),this;for(var c=0,d=a.length;c<d;c++){var e=new ia(a[c]);b.push(e)}c=0;for(d=b.length;c<d;c++){if(0===c){e=b[c];var f=b[d-1];var h=b[c+1]}else c===d-1?(e=b[c],f=b[c-1],h=b[0]):(e=b[c],f=b[c-1],h=b[c+1]);e.prev=f;e.next=h;e.polygon=this}this.edge=b[0];this.plane.fromCoplanarPoints(a[0],a[1],a[2]);return this};S.prototype.computeCentroid=function(){var a=this.centroid,b=this.edge,c=0;
a.set(0,0,0);do a.add(b.from()),c++,b=b.next;while(b!==this.edge);a.divideScalar(c);return this};S.prototype.contains=function(a,b){b=void 0===b?.001:b;var c=this.plane,d=this.edge;do{var e=d.from(),f=d.to();if(!1===0<=(a.x-e.x)*(f.z-e.z)-(f.x-e.x)*(a.z-e.z))return!1;d=d.next}while(d!==this.edge);a=c.distanceToPoint(a);return Math.abs(a)>b?!1:!0};S.prototype.convex=function(){var a=this.edge;do{var b=a.from(),c=a.to(),d=a.next.to();if(!1===0<=(d.x-b.x)*(c.z-b.z)-(c.x-b.x)*(d.z-b.z))return!1;a=a.next}while(a!==
this.edge);return!0};S.prototype.coplanar=function(a){a=void 0===a?.001:a;var b=this.plane,c=this.edge;do{var d=b.distanceToPoint(c.from());if(Math.abs(d)>a)return!1;c=c.next}while(c!==this.edge);return!0};S.prototype.getContour=function(a){var b=this.edge;a.length=0;do a.push(b.vertex),b=b.next;while(b!==this.edge);return a};var Ib=function(){};Ib.prototype.load=function(a,b){return new Promise(function(c,d){fetch(a).then(function(a){if(200<=a.status&&300>a.status)return a.arrayBuffer();var b=Error(a.statusText||
a.status);b.response=a;return Promise.reject(b)}).then(function(c){var d=new Q,g=new TextDecoder;"glTF"===g.decode(new Uint8Array(c,0,4))?(d.parseBinary(c),c=d.extensions.get("BINARY").content):c=g.decode(new Uint8Array(c));c=JSON.parse(c);if(void 0===c.asset||2>c.asset.version[0])throw Error("YUKA.NavMeshLoader: Unsupported asset version.");g=a.lastIndexOf("/");g=-1===g?"./":a.substr(0,g+1);return d.parse(c,g,b)}).then(function(a){c(a)}).catch(function(a){v.error("YUKA.NavMeshLoader: Unable to load navigation mesh.",
a);d(a)})})};var Q=function(){this.path=this.json=null;this.cache=new Map;this.extensions=new Map};Q.prototype.parse=function(a,b,c){var d=this;this.json=a;this.path=b;return this.getDependency("mesh",0).then(function(a){a=d.parseGeometry(a);var b=new H;c&&c.epsilonCoplanarTest&&(b.epsilonCoplanarTest=c.epsilonCoplanarTest);return b.fromPolygons(a)})};Q.prototype.parseGeometry=function(a){var b=a.index,c=a.position;a=[];for(var d=[],t=0,f=c.length;t<f;t+=3){var h=new e;h.x=c[t+0];h.y=c[t+1];h.z=c[t+
2];a.push(h)}if(b)for(c=0,f=b.length;c<f;c+=3)t=[a[b[c+0]],a[b[c+1]],a[b[c+2]]],t=(new S).fromContour(t),d.push(t);else for(b=0,f=a.length;b<f;b+=3)c=[a[b+0],a[b+1],a[b+2]],c=(new S).fromContour(c),d.push(c);return d};Q.prototype.getDependencies=function(a){var b=this,c=this.cache,d=c.get(a);d||(d=Promise.all((this.json[a+("mesh"===a?"es":"s")]||[]).map(function(c,d){return b.getDependency(a,d)})),c.set(a,d));return d};Q.prototype.getDependency=function(a,b){var c=this.cache,d=a+":"+b,e=c.get(d);
if(void 0===e){switch(a){case "accessor":e=this.loadAccessor(b);break;case "buffer":e=this.loadBuffer(b);break;case "bufferView":e=this.loadBufferView(b);break;case "mesh":e=this.loadMesh(b);break;default:throw Error("Unknown type: "+a);}c.set(d,e)}return e};Q.prototype.loadBuffer=function(a){var b=this,c=this.json.buffers[a];return void 0===c.uri&&0===a?Promise.resolve(this.extensions.get("BINARY").body):new Promise(function(a,d){var g=k(c.uri,b.path);fetch(g).then(function(a){return a.arrayBuffer()}).then(function(b){a(b)}).catch(function(a){v.error("YUKA.NavMeshLoader: Unable to load buffer.",
a);d(a)})})};Q.prototype.loadBufferView=function(a){var b=this.json.bufferViews[a];return this.getDependency("buffer",b.buffer).then(function(a){var c=b.byteOffset||0;return a.slice(c,c+(b.byteLength||0))})};Q.prototype.loadAccessor=function(a){var b=this.json.accessors[a];return this.getDependency("bufferView",b.bufferView).then(function(a){return new ac[b.componentType](a,b.byteOffset||0,b.count*bc[b.type])})};Q.prototype.loadMesh=function(a){var b=this.json.meshes[a];return this.getDependencies("accessor").then(function(a){var c=
b.primitives[0];if(4!==c.mode)throw Error("YUKA.NavMeshLoader: Invalid geometry format. Please ensure to represent your geometry as triangles.");return{index:a[c.indices],position:a[c.attributes.POSITION],normal:a[c.attributes.NORMAL]}})};Q.prototype.parseBinary=function(a){for(var b=new DataView(a,12),c=0,d=new TextDecoder,e=null,f=null;c<b.byteLength;){var h=b.getUint32(c,!0);c+=4;var k=b.getUint32(c,!0);c+=4;k===Jb.JSON?(e=new Uint8Array(a,12+c,h),e=d.decode(e)):k===Jb.BIN&&(f=12+c,f=a.slice(f,
f+h));c+=h}this.extensions.set("BINARY",{content:e,body:f})};var bc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ac={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Jb={JSON:1313821514,BIN:5130562},pa=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};pa.prototype.search=function(){var a=[],b=[],c=new Z(this.source,
this.source);a.push(c);for(this._visited.add(this.source);0<a.length;){var d=a.shift();this._route.set(d.to,d.from);d!==c&&this._spanningTree.add(d);if(d.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(d.to,b);d=0;for(var e=b.length;d<e;d++){var f=b[d];!1===this._visited.has(f.to)&&(a.push(f),this._visited.add(f.to))}}this.found=!1;return this};pa.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=
this._route.get(b),a.unshift(b);return a};pa.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};pa.prototype.clear=function(){this.found=!1;this._route.clear();this._visited.clear();this._spanningTree.clear()};var qa=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._route=new Map;this._visited=new Set;this._spanningTree=new Set};qa.prototype.search=function(){var a=[],b=[],c=new Z(this.source,
this.source);for(a.push(c);0<a.length;){var d=a.pop();this._route.set(d.to,d.from);this._visited.add(d.to);d!==c&&this._spanningTree.add(d);if(d.to===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(d.to,b);d=0;for(var e=b.length;d<e;d++){var f=b[d];!1===this._visited.has(f.to)&&a.push(f)}}this.found=!1;return this};qa.prototype.getPath=function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._route.get(b),a.unshift(b);
return a};qa.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._spanningTree))};qa.prototype.clear=function(){this.found=!1;this._route.clear();this._visited.clear();this._spanningTree.clear()};var ra=function(a,b,c){this.graph=void 0===a?null:a;this.source=void 0===b?-1:b;this.target=void 0===c?-1:c;this.found=!1;this._cost=new Map;this._shortestPathTree=new Map;this._searchFrontier=new Map};ra.prototype.search=function(){var a=[],b=new U(M);for(b.push({cost:0,index:this.source});0<
b.length;){var c=b.pop().index;if(!this._shortestPathTree.has(c)){!0===this._searchFrontier.has(c)&&this._shortestPathTree.set(c,this._searchFrontier.get(c));if(c===this.target)return this.found=!0,this;this.graph.getEdgesOfNode(c,a);for(var d=0,e=a.length;d<e;d++){var f=a[d],h=(this._cost.get(c)||0)+f.cost;if(!1===this._searchFrontier.has(f.to)||h<this._cost.get(f.to))this._cost.set(f.to,h),this._searchFrontier.set(f.to,f),b.push({cost:h,index:f.to})}}}this.found=!1;return this};ra.prototype.getPath=
function(){var a=[];if(!1===this.found||-1===this.target)return a;var b=this.target;for(a.push(b);b!==this.source;)b=this._shortestPathTree.get(b).from,a.unshift(b);return a};ra.prototype.getSearchTree=function(){return[].concat($jscomp.arrayFromIterable(this._shortestPathTree.values()))};ra.prototype.clear=function(){this.found=!1;this._cost.clear();this._shortestPathTree.clear();this._searchFrontier.clear()};var sa=new e,F=function(a,b){a=void 0===a?new e(Infinity,Infinity,Infinity):a;b=void 0===
b?new e(-Infinity,-Infinity,-Infinity):b;this.min=a;this.max=b};F.prototype.set=function(a,b){this.min=a;this.max=b;return this};F.prototype.copy=function(a){this.min.copy(a.min);this.max.copy(a.max);return this};F.prototype.clone=function(){return(new this.constructor).copy(this)};F.prototype.clampPoint=function(a,b){b.copy(a).clamp(this.min,this.max);return this};F.prototype.containsPoint=function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?
!1:!0};F.prototype.expand=function(a){this.min.min(a);this.max.max(a);return this};F.prototype.intersectsAABB=function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0};F.prototype.intersectsBoundingSphere=function(a){this.clampPoint(a.center,sa);return sa.squaredDistanceTo(a.center)<=a.radius*a.radius};F.prototype.fromCenterAndSize=function(a,b){sa.copy(b).multiplyScalar(.5);this.min.copy(a).sub(sa);this.max.copy(a).add(sa);
return this};F.prototype.fromPoints=function(a){this.min.set(Infinity,Infinity,Infinity);this.max.set(-Infinity,-Infinity,-Infinity);for(var b=0,c=a.length;b<c;b++)this.expand(a[b]);return this};F.prototype.equals=function(a){return a.min.equals(this.min)&&a.max.equals(this.max)};var J=function(a,b){this.center=a=void 0===a?new e:a;this.radius=void 0===b?0:b};J.prototype.set=function(a,b){this.center=a;this.radius=b;return this};J.prototype.copy=function(a){this.center.copy(a.center);this.radius=
a.radius;return this};J.prototype.clone=function(){return(new this.constructor).copy(this)};J.prototype.containsPoint=function(a){return a.squaredDistanceTo(this.center)<=this.radius*this.radius};J.prototype.intersectsBoundingSphere=function(a){var b=this.radius+a.radius;return a.center.squaredDistanceTo(this.center)<=b*b};J.prototype.equals=function(a){return a.center.equals(this.center)&&a.radius===this.radius};var Ga=new e,aa=function(a,b){a=void 0===a?new e:a;b=void 0===b?new e:b;this.origin=
a;this.direction=b};aa.prototype.set=function(a,b){this.origin=a;this.direction=b;return this};aa.prototype.copy=function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this};aa.prototype.clone=function(){return(new this.constructor).copy(this)};aa.prototype.at=function(a,b){return b.copy(this.direction).multiplyScalar(a).add(this.origin)};aa.prototype.intersectSphere=function(a,b){Ga.subVectors(a.center,this.origin);var c=Ga.dot(this.direction),d=Ga.dot(Ga)-c*c;a=a.radius*
a.radius;if(d>a)return null;a=Math.sqrt(a-d);d=c-a;c+=a;return 0>d&&0>c?null:0>d?this.at(c,b):this.at(d,b)};aa.prototype.equals=function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)};var ba=function(a){this.aabb=a=void 0===a?new F:a;this.entries=[]};ba.prototype.add=function(a){this.entries.push(a);return this};ba.prototype.remove=function(a){a=this.entries.indexOf(a);this.entries.splice(a,1);return this};ba.prototype.makeEmpty=function(){this.entries.length=0;return this};
ba.prototype.empty=function(){return 0===this.entries.length};ba.prototype.intersects=function(a){return this.aabb.intersectsAABB(a)};var Ha=new e,ta=new F,Kb=[],V=function(a,b,c,d,t,f){this.cells=[];this.width=a;this.height=b;this.depth=c;this.halfWidth=a/2;this.halfHeight=b/2;this.halfDepth=c/2;this.min=new e(-this.halfWidth,-this.halfHeight,-this.halfDepth);this.max=new e(this.halfWidth,this.halfHeight,this.halfDepth);this.cellsX=d;this.cellsY=t;this.cellsZ=f;a/=d;b/=t;c/=f;for(var g=0;g<d;g++)for(var k=
g*a-this.halfWidth,l=0;l<t;l++)for(var m=l*b-this.halfHeight,n=0;n<f;n++){var p=n*c-this.halfDepth,q=new e,r=new e;q.set(k,m,p);r.x=q.x+a;r.y=q.y+b;r.z=q.z+c;p=new F(q,r);p=new ba(p);this.cells.push(p)}};V.prototype.updateEntity=function(a,b){b=void 0===b?-1:b;var c=this.getIndexForPosition(a.position);b!==c&&(this.addEntityToPartition(a,c),-1!==b&&this.removeEntityFromPartition(a,b));return c};V.prototype.addEntityToPartition=function(a,b){this.cells[b].add(a);return this};V.prototype.removeEntityFromPartition=
function(a,b){this.cells[b].remove(a);return this};V.prototype.getIndexForPosition=function(a){Ha.copy(a).clamp(this.min,this.max);a=Math.abs(Math.floor(this.cellsX*(Ha.x+this.halfWidth)/this.width));var b=Math.abs(Math.floor(this.cellsY*(Ha.y+this.halfHeight)/this.height)),c=Math.abs(Math.floor(this.cellsZ*(Ha.z+this.halfDepth)/this.depth));a===this.cellsX&&(a=this.cellsX-1);b===this.cellsY&&(b=this.cellsY-1);c===this.cellsZ&&(c=this.cellsZ-1);return a*this.cellsY*this.cellsZ+b*this.cellsZ+c};V.prototype.query=
function(a,b,c){var d=this.cells;c.length=0;ta.min.copy(a).subScalar(b);ta.max.copy(a).addScalar(b);a=0;for(b=d.length;a<b;a++){var e=d[a];!1===e.empty()&&!0===e.intersects(ta)&&c.push.apply(c,$jscomp.arrayFromIterable(e.entries))}return c};V.prototype.makeEmpty=function(){for(var a=this.cells,b=0,c=a.length;b<c;b++)a[b].makeEmpty();return this};V.prototype.addPolygon=function(a){var b=this.cells;a.getContour(Kb);ta.fromPoints(Kb);for(var c=0,d=b.length;c<d;c++){var e=b[c];!0===e.intersects(ta)&&
e.add(a)}return this};var ca=function(){this.loop=!1;this._waypoints=[];this._index=0};ca.prototype.add=function(a){this._waypoints.push(a);return this};ca.prototype.clear=function(){this._index=this._waypoints.length=0;return this};ca.prototype.finished=function(){var a=this._waypoints.length-1;return!0===this.loop?!1:this._index===a};ca.prototype.advance=function(){this._index++;this._index===this._waypoints.length&&(!0===this.loop?this._index=0:this._index--);return this};ca.prototype.current=
function(){return this._waypoints[this._index]};var cc={clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},randFloat:function(a,b){return a+Math.random()*(b-a)}},r=function(a,b,c){this.x=void 0===a?0:a;this.y=void 0===b?0:b;this.z=void 0===c?0:c};r.prototype.set=function(a,b,c){this.x=a;this.y=b;this.z=c;return this};r.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this};r.prototype.clone=function(){return(new this.constructor).copy(this)};r.prototype.add=function(a){this.x+=
a.x;this.y+=a.y;this.z+=a.z;return this};r.prototype.addScalar=function(a){this.x+=a;this.y+=a;this.z+=a;return this};r.prototype.addVectors=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this};r.prototype.sub=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};r.prototype.subScalar=function(a){this.x-=a;this.y-=a;this.z-=a;return this};r.prototype.subVectors=function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this};r.prototype.multiply=function(a){this.x*=
a.x;this.y*=a.y;this.z*=a.z;return this};r.prototype.multiplyScalar=function(a){this.x*=a;this.y*=a;this.z*=a;return this};r.prototype.multiplyVectors=function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this};r.prototype.divide=function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this};r.prototype.divideScalar=function(a){this.x/=a;this.y/=a;this.z/=a;return this};r.prototype.divideVectors=function(a,b){this.x=a.x/b.x;this.y=a.y/b.y;this.z=a.z/b.z;return this};r.prototype.clamp=function(a,
b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this};r.prototype.min=function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);return this};r.prototype.max=function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this};r.prototype.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};r.prototype.cross=function(a){var b=this.x,
c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this};r.prototype.crossVectors=function(a,b){var c=a.x,d=a.y;a=a.z;var e=b.x,f=b.y;b=b.z;this.x=d*b-a*f;this.y=a*e-c*b;this.z=c*f-d*e;return this};r.prototype.angleTo=function(a){a=this.dot(a)/Math.sqrt(this.squaredLength()*a.squaredLength());return Math.acos(cc.clamp(a,-1,1))};r.prototype.length=function(){return Math.sqrt(this.squaredLength())};r.prototype.squaredLength=function(){return this.dot(this)};r.prototype.manhattanLength=
function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)};r.prototype.distanceTo=function(a){return Math.sqrt(this.squaredDistanceTo(a))};r.prototype.squaredDistanceTo=function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a};r.prototype.manhattanDistanceTo=function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)};r.prototype.normalize=function(){return this.divideScalar(this.length()||1)};r.prototype.applyMatrix4=function(a){var b=this.x,c=this.y,
d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*c+a[10]*d+a[14])*e;return this};r.prototype.applyRotation=function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,h=a.z;a=a.w;var k=a*b+f*d-h*c,l=a*c+h*b-e*d,m=a*d+e*c-f*b;b=-e*b-f*c-h*d;this.x=k*a+b*-e+l*-h-m*-f;this.y=l*a+b*-f+m*-e-k*-h;this.z=m*a+b*-h+k*-f-l*-e;return this};r.prototype.fromMatrix3Column=function(a,b){return this.fromArray(a.elements,
3*b)};r.prototype.fromMatrix4Column=function(a,b){return this.fromArray(a.elements,4*b)};r.prototype.fromSpherical=function(a,b,c){var d=Math.sin(b)*a;this.x=d*Math.sin(c);this.y=Math.cos(b)*a;this.z=d*Math.cos(c);return this};r.prototype.fromArray=function(a,b){b=void 0===b?0:b;this.x=a[b+0];this.y=a[b+1];this.z=a[b+2];return this};r.prototype.toArray=function(a,b){b=void 0===b?0:b;a[b+0]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a};r.prototype.equals=function(a){return a.x===this.x&&a.y===this.y&&
a.z===this.z};var cb=function(a){this.count=void 0===a?10:a;this._history=[];for(a=this._slot=0;a<this.count;a++)this._history[a]=new r};cb.prototype.update=function(a,b){b.set(0,0,0);this._slot===this.count&&(this._slot=0);this._history[this._slot].copy(a);this._slot++;for(a=0;a<this.count;a++)b.add(this._history[a]);b.divideScalar(this.count)};var x=function(){this.active=!0;this.weigth=1};x.prototype.calculate=function(){};var Ia=new e,da=function(a){this.vehicle=a;this.behaviors=[];this._steeringForce=
new e};da.prototype.add=function(a){this.behaviors.push(a);return this};da.prototype.remove=function(a){a=this.behaviors.indexOf(a);this.behaviors.splice(a,1);return this};da.prototype.calculate=function(a,b){this._calculateByOrder(a);return b.copy(this._steeringForce)};da.prototype._accumulate=function(a){var b=this._steeringForce.length();b=this.vehicle.maxForce-b;if(0>=b)return!1;a.length()>b&&a.normalize().multiplyScalar(b);this._steeringForce.add(a);return!0};da.prototype._calculateByOrder=function(a){var b=
this.behaviors;this._steeringForce.set(0,0,0);for(var c=0,d=b.length;c<d;c++){var e=b[c];if(!0===e.active&&(Ia.set(0,0,0),e.calculate(this.vehicle,Ia,a),Ia.multiplyScalar(e.weigth),!1===this._accumulate(Ia)))break}};var Lb=new e,Ja=new e,Mb=new e,ua=new e,va=function(){var a=Y.call(this)||this;a.mass=1;a.maxForce=100;a.steering=new da(a);a._smoother=null;a._smoothedVelocity=new e;return a};$jscomp.inherits(va,Y);va.prototype.enableSmoothing=function(a){this._smoother=new cb(a)};va.prototype.disableSmoothing=
function(){this._smoother=null};va.prototype.update=function(a){this.steering.calculate(a,Lb);Mb.copy(Lb).divideScalar(this.mass);this.velocity.add(Mb.multiplyScalar(a));this.getSpeedSquared()>this.maxSpeed*this.maxSpeed&&(this.velocity.normalize(),this.velocity.multiplyScalar(this.maxSpeed));Ja.copy(this.velocity).multiplyScalar(a);ua.copy(this.position).add(Ja);this.updateOrientation&&1e-8<this.getSpeedSquared()&&this.lookAt(ua);this.position.copy(ua);this.updateOrientation&&null!==this._smoother&&
(this._smoother.update(this.velocity,this._smoothedVelocity),Ja.copy(this._smoothedVelocity).multiplyScalar(a),ua.copy(this.position).add(Ja),this.lookAt(ua))};var Ka=new e,La=new e,db=function(){return x.call(this)||this};$jscomp.inherits(db,x);db.prototype.calculate=function(a,b){Ka.set(0,0,0);for(var c=a.neighbors,d=0,e=c.length;d<e;d++)c[d].getDirection(La),Ka.add(La);0<c.length&&(Ka.divideScalar(c.length),a.getDirection(La),b.subVectors(Ka,La))};var Nb=new e,eb=new e,wa=function(a,b){a=void 0===
a?new e:a;b=void 0===b?3:b;var c=x.call(this)||this;c.target=a;c.deceleration=b;return c};$jscomp.inherits(wa,x);wa.prototype.calculate=function(a,b){var c=this.deceleration;eb.subVectors(this.target,a.position);var d=eb.length();0<d&&(c=Math.min(d/c,a.maxSpeed),Nb.copy(eb).multiplyScalar(c/d),b.subVectors(Nb,a.velocity))};var fb=new e,ka=function(a){a=void 0===a?new e:a;var b=x.call(this)||this;b.target=a;return b};$jscomp.inherits(ka,x);ka.prototype.calculate=function(a,b){fb.subVectors(this.target,
a.position).normalize();fb.multiplyScalar(a.maxSpeed);b.subVectors(fb,a.velocity)};var Ma=new e,gb=function(){var a=x.call(this)||this;a._seek=new ka;return a};$jscomp.inherits(gb,x);gb.prototype.calculate=function(a,b){Ma.set(0,0,0);for(var c=a.neighbors,d=0,e=c.length;d<e;d++)Ma.add(c[d].position);0<c.length&&(Ma.divideScalar(c.length),this._seek.target=Ma,this._seek.calculate(a,b),b.normalize())};var xa=new e,Na=function(a,b){a=void 0===a?new e:a;b=void 0===b?10:b;var c=x.call(this)||this;c.target=
a;c.panicDistance=b;return c};$jscomp.inherits(Na,x);Na.prototype.calculate=function(a,b){var c=this.target;a.position.squaredDistanceTo(c)<=this.panicDistance*this.panicDistance&&(xa.subVectors(a.position,c).normalize(),0===xa.squaredLength()&&xa.set(0,0,1),xa.multiplyScalar(a.maxSpeed),b.subVectors(xa,a.velocity))};var Ob=new e,Pb=new e,Qb=new e,hb=function(a,b,c){a=void 0===a?null:a;b=void 0===b?10:b;c=void 0===c?1:c;var d=x.call(this)||this;d.pursuer=a;d.panicDistance=b;d.predictionFactor=c;d._flee=
new Na;return d};$jscomp.inherits(hb,x);hb.prototype.calculate=function(a,b){var c=this.pursuer;Ob.subVectors(c.position,a.position);var d=Ob.length()/(a.maxSpeed+c.getSpeed());d*=this.predictionFactor;Pb.copy(c.velocity).multiplyScalar(d);Qb.addVectors(c.position,Pb);this._flee.target=Qb;this._flee.panicDistance=this.panicDistance;this._flee.calculate(a,b)};var ib=function(a,b){a=void 0===a?new ca:a;b=void 0===b?1:b;var c=x.call(this)||this;c.path=a;c.nextWaypointDistance=b;c._arrive=new wa;c._seek=
new ka;return c};$jscomp.inherits(ib,x);ib.prototype.calculate=function(a,b){var c=this.path;c.current().squaredDistanceTo(a.position)<this.nextWaypointDistance*this.nextWaypointDistance&&c.advance();var d=c.current();!0===c.finished()?(this._arrive.target=d,this._arrive.calculate(a,b)):(this._seek.target=d,this._seek.calculate(a,b))};var Oa=new e,Pa=new e,Rb=new e,Sb=new e,jb=function(a,b,c){a=void 0===a?null:a;b=void 0===b?null:b;c=void 0===c?3:c;var d=x.call(this)||this;d.entity1=a;d.entity2=b;
d.deceleration=c;d._arrive=new wa;return d};$jscomp.inherits(jb,x);jb.prototype.calculate=function(a,b){var c=this.entity1,d=this.entity2;Oa.addVectors(c.position,d.position).multiplyScalar(.5);var e=a.position.distanceTo(Oa)/a.maxSpeed;Pa.copy(c.velocity).multiplyScalar(e);Rb.addVectors(c.position,Pa);Pa.copy(d.velocity).multiplyScalar(e);Sb.addVectors(d.position,Pa);Oa.addVectors(Rb,Sb).multiplyScalar(.5);this._arrive.deceleration=this.deceleration;this._arrive.target=Oa;this._arrive.calculate(a,
b)};var D=function(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};D.prototype.set=function(a,b,c,d,e,f,h,k,l,m,n,p,q,r,v,w){var g=this.elements;g[0]=a;g[4]=b;g[8]=c;g[12]=d;g[1]=e;g[5]=f;g[9]=h;g[13]=k;g[2]=l;g[6]=m;g[10]=n;g[14]=p;g[3]=q;g[7]=r;g[11]=v;g[15]=w;return this};D.prototype.copy=function(a){var b=this.elements;a=a.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];
b[15]=a[15];return this};D.prototype.clone=function(){return(new this.constructor).copy(this)};D.prototype.identity=function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this};D.prototype.extractBasis=function(a,b,c){a.fromMatrix4Column(this,0);b.fromMatrix4Column(this,1);c.fromMatrix4Column(this,2);return this};D.prototype.makeBasis=function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this};D.prototype.multiply=function(a){return this.multiplyMatrices(this,a)};
D.prototype.premultiply=function(a){return this.multiplyMatrices(a,this)};D.prototype.multiplyMatrices=function(a,b){var c=a.elements,d=b.elements;b=this.elements;a=c[0];var e=c[4],f=c[8],h=c[12],k=c[1],l=c[5],m=c[9],n=c[13],p=c[2],q=c[6],r=c[10],v=c[14],w=c[3],y=c[7],x=c[11];c=c[15];var A=d[0],B=d[4],C=d[8],z=d[12],D=d[1],E=d[5],F=d[9],G=d[13],H=d[2],I=d[6],J=d[10],K=d[14],M=d[3],N=d[7],O=d[11];d=d[15];b[0]=a*A+e*D+f*H+h*M;b[4]=a*B+e*E+f*I+h*N;b[8]=a*C+e*F+f*J+h*O;b[12]=a*z+e*G+f*K+h*d;b[1]=k*A+
l*D+m*H+n*M;b[5]=k*B+l*E+m*I+n*N;b[9]=k*C+l*F+m*J+n*O;b[13]=k*z+l*G+m*K+n*d;b[2]=p*A+q*D+r*H+v*M;b[6]=p*B+q*E+r*I+v*N;b[10]=p*C+q*F+r*J+v*O;b[14]=p*z+q*G+r*K+v*d;b[3]=w*A+y*D+x*H+c*M;b[7]=w*B+y*E+x*I+c*N;b[11]=w*C+y*F+x*J+c*O;b[15]=w*z+y*G+x*K+c*d;return this};D.prototype.multiplyScalar=function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this};D.prototype.compose=function(a,b,c){this.fromQuaternion(b);
this.scale(c);this.setPosition(a);return this};D.prototype.scale=function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this};D.prototype.setPosition=function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this};D.prototype.transpose=function(){var a=this.elements;var b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=
b;b=a[11];a[11]=a[14];a[14]=b;return this};D.prototype.getInverse=function(a){var b=this.elements,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],h=c[4],k=c[5],l=c[6],m=c[7],n=c[8],p=c[9],q=c[10],r=c[11],w=c[12],x=c[13],y=c[14];c=c[15];var A=p*y*m-x*q*m+x*l*r-k*y*r-p*l*c+k*q*c,B=w*q*m-n*y*m-w*l*r+h*y*r+n*l*c-h*q*c,C=n*x*m-w*p*m+w*k*r-h*x*r-n*k*c+h*p*c,D=w*p*l-n*x*l-w*k*q+h*x*q+n*k*y-h*p*y,z=a*A+d*B+e*C+f*D;if(0===z)return v.warn("YUKA.Matrix4: .getInverse() can not invert matrix, determinant is 0."),
this.identity();z=1/z;b[0]=A*z;b[1]=(x*q*f-p*y*f-x*e*r+d*y*r+p*e*c-d*q*c)*z;b[2]=(k*y*f-x*l*f+x*e*m-d*y*m-k*e*c+d*l*c)*z;b[3]=(p*l*f-k*q*f-p*e*m+d*q*m+k*e*r-d*l*r)*z;b[4]=B*z;b[5]=(n*y*f-w*q*f+w*e*r-a*y*r-n*e*c+a*q*c)*z;b[6]=(w*l*f-h*y*f-w*e*m+a*y*m+h*e*c-a*l*c)*z;b[7]=(h*q*f-n*l*f+n*e*m-a*q*m-h*e*r+a*l*r)*z;b[8]=C*z;b[9]=(w*p*f-n*x*f-w*d*r+a*x*r+n*d*c-a*p*c)*z;b[10]=(h*x*f-w*k*f+w*d*m-a*x*m-h*d*c+a*k*c)*z;b[11]=(n*k*f-h*p*f-n*d*m+a*p*m+h*d*r-a*k*r)*z;b[12]=D*z;b[13]=(n*x*e-w*p*e+w*d*q-a*x*q-n*d*
y+a*p*y)*z;b[14]=(w*k*e-h*x*e-w*d*l+a*x*l+h*d*y-a*k*y)*z;b[15]=(h*p*e-n*k*e+n*d*l-a*p*l-h*d*q+a*k*q)*z;return this};D.prototype.fromQuaternion=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,h=c+c,k=d+d,l=e+e;a=c*h;var m=c*k;c*=l;var n=d*k;d*=l;e*=l;h*=f;k*=f;f*=l;b[0]=1-(n+e);b[4]=m-f;b[8]=c+k;b[1]=m+f;b[5]=1-(a+e);b[9]=d-h;b[2]=c-k;b[6]=d+h;b[10]=1-(a+n);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this};D.prototype.fromArray=function(a,b){b=void 0===b?0:b;for(var c=this.elements,
d=0;16>d;d++)c[d]=a[d+b];return this};D.prototype.toArray=function(a,b){b=void 0===b?0:b;var c=this.elements;a[b+0]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a};D.prototype.equals=function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0};var Qa=new r,ea=function(a,b){a=void 0===a?new r:a;b=void 0===
b?new r:b;this.origin=a;this.direction=b};ea.prototype.set=function(a,b){this.origin=a;this.direction=b;return this};ea.prototype.copy=function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this};ea.prototype.clone=function(){return(new this.constructor).copy(this)};ea.prototype.at=function(a,b){return b.copy(this.direction).multiplyScalar(a).add(this.origin)};ea.prototype.intersectSphere=function(a,b){Qa.subVectors(a.center,this.origin);var c=Qa.dot(this.direction),d=Qa.dot(Qa)-
c*c;a=a.radius*a.radius;if(d>a)return null;a=Math.sqrt(a-d);d=c-a;c+=a;return 0>d&&0>c?null:0>d?this.at(c,b):this.at(d,b)};ea.prototype.equals=function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)};var Tb=new D,la=new r,Ra=new r,kb=new r,lb=new J,dc=new ea(new r(0,0,0),new r(0,0,1)),mb=function(a){var b=x.call(this)||this;b.entityManager=a;b.weigth=3;b.brakingWeight=.2;b.dBoxMinLength=5;return b};$jscomp.inherits(mb,x);mb.prototype.calculate=function(a,b){var c=null,
d=Infinity,e=this.entityManager.entities,f=this.dBoxMinLength+a.getSpeed()/a.maxSpeed*this.dBoxMinLength;Tb.getInverse(a.matrix);for(var h=0,k=e.length;h<k;h++){var l=e[h];if(l!==a&&(la.copy(l.position).applyMatrix4(Tb),0<la.z&&Math.abs(la.z)<f)){var m=l.boundingRadius+a.boundingRadius;Math.abs(la.x)<m&&(lb.center.copy(la),lb.radius=m,dc.intersectSphere(lb,kb),kb.z<d&&(d=kb.z,c=l,Ra.copy(la)))}}null!==c&&(b.x=(c.boundingRadius-Ra.x)*(1+(f-Ra.z)/f),b.z=(c.boundingRadius-Ra.z)*this.brakingWeight,b.applyRotation(a.rotation))};
var nb=new e,ob=new e,Ub=new e,Vb=new e,Wb=new e,pb=function(a,b){a=void 0===a?null:a;b=void 0===b?1:b;var c=x.call(this)||this;c.evader=a;c.predictionFactor=b;c._seek=new ka;return c};$jscomp.inherits(pb,x);pb.prototype.calculate=function(a,b){var c=this.evader;nb.subVectors(c.position,a.position);a.getDirection(ob);c.getDirection(Ub);var d=0<nb.dot(ob),e=-.95>ob.dot(Ub);!0===d&&!0===e?this._seek.target=c.position:(d=nb.length()/(a.maxSpeed+c.getSpeed()),d*=this.predictionFactor,Vb.copy(c.velocity).multiplyScalar(d),
Wb.addVectors(c.position,Vb),this._seek.target=Wb);this._seek.calculate(a,b)};var Sa=new e,qb=function(){return x.call(this)||this};$jscomp.inherits(qb,x);qb.prototype.calculate=function(a,b){for(var c=a.neighbors,d=0,e=c.length;d<e;d++){Sa.subVectors(a.position,c[d].position);var f=Sa.length();0===f&&(f=.0001);Sa.normalize().divideScalar(f);b.add(Sa)}};var ya=new e,rb=new e,sb=function(a,b,c){a=void 0===a?1:a;b=void 0===b?5:b;c=void 0===c?5:c;var d=x.call(this)||this;d.radius=a;d.distance=b;d.jitter=
c;d._targetLocal=new e;a=d.radius;b=d._targetLocal;c=Math.random()*Math.PI*2;b.x=a*Math.cos(c);b.z=a*Math.sin(c);return d};$jscomp.inherits(sb,x);sb.prototype.calculate=function(a,b,c){c*=this.jitter;rb.x=X.randFloat(-1,1)*c;rb.z=X.randFloat(-1,1)*c;this._targetLocal.add(rb);this._targetLocal.normalize();this._targetLocal.multiplyScalar(this.radius);ya.copy(this._targetLocal);ya.z+=this.distance;ya.applyMatrix4(a.worldMatrix);b.subVectors(ya,a.position)};var za=function(){};za.prototype.touching=
function(){return!1};var Xb=new J,Aa=function(a,b){a=void 0===a?new e:a;b=void 0===b?new e:b;this._aabb=new F(a,b);return this};$jscomp.inherits(Aa,za);Aa.prototype.fromPositionAndSize=function(a,b){this._aabb.fromCenterAndSize(a,b);return this};Aa.prototype.touching=function(a){Xb.set(a.position,a.boundingRadius);return this._aabb.intersectsBoundingSphere(Xb)};$jscomp.global.Object.defineProperties(Aa.prototype,{min:{configurable:!0,enumerable:!0,get:function(){return this._aabb.min},set:function(a){this._aabb.min=
a}},max:{configurable:!0,enumerable:!0,get:function(){return this._aabb.max},set:function(a){this._aabb.max=a}}});var Yb=new J,Ta=function(a,b){a=void 0===a?new e:a;this._boundingSphere=new J(a,void 0===b?0:b);return this};$jscomp.inherits(Ta,za);Ta.prototype.touching=function(a){Yb.set(a.position,a.boundingRadius);return this._boundingSphere.intersectsBoundingSphere(Yb)};$jscomp.global.Object.defineProperties(Ta.prototype,{position:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.center},
set:function(a){this._boundingSphere.center=a}},radius:{configurable:!0,enumerable:!0,get:function(){return this._boundingSphere.radius},set:function(a){this._boundingSphere.radius=a}}});var Ua=function(a){a=void 0===a?new za:a;this.active=!0;this.region=a};Ua.prototype.check=function(a){!0===this.active&&!0===this.region.touching(a)&&this.execute(a)};Ua.prototype.execute=function(){};Ua.prototype.update=function(){};d.EntityManager=I;d.GameEntity=G;d.Logger=v;d.MessageDispatcher=K;d.MovingEntity=
Y;d.Regulator=Ab;d.Time=fa;d.Telegram=m;d.State=ha;d.StateMachine=N;d.CompositeGoal=O;d.Goal=w;d.GoalEvaluator=Xa;d.Think=T;d.Edge=Z;d.Node=Ya;d.Graph=E;d.GraphUtils=Bb;d.PriorityQueue=U;d.NavEdge=Ea;d.NavNode=Da;d.HalfEdge=ia;d.NavMesh=H;d.NavMeshLoader=Ib;d.Polygon=S;d.AStar=ja;d.BFS=pa;d.DFS=qa;d.Dijkstra=ra;d.AABB=F;d.BoundingSphere=J;d.LineSegment=P;d.Math=X;d.Matrix3=C;d.Matrix4=B;d.Plane=R;d.Quaternion=A;d.Ray=aa;d.Vector3=e;d.Cell=ba;d.CellSpacePartitioning=V;d.Path=ca;d.Smoother=cb;d.SteeringBehavior=
x;d.SteeringManager=da;d.Vehicle=va;d.AlignmentBehavior=db;d.ArriveBehavior=wa;d.CohesionBehavior=gb;d.EvadeBehavior=hb;d.FleeBehavior=Na;d.FollowPathBehavior=ib;d.InterposeBehavior=jb;d.ObstacleAvoidanceBehavior=mb;d.PursuitBehavior=pb;d.SeekBehavior=ka;d.SeparationBehavior=qb;d.WanderBehavior=sb;d.RectangularTriggerRegion=Aa;d.SphericalTriggerRegion=Ta;d.TriggerRegion=za;d.Trigger=Ua;d.HeuristicPolicyEuclid=Za;d.HeuristicPolicyEuclidSquared=Cb;d.HeuristicPolicyManhatten=Db;d.HeuristicPolicyDijkstra=
Eb;d.WorldUp=Va;Object.defineProperty(d,"__esModule",{value:!0})});
